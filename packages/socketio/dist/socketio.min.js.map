{"version":3,"file":"socketio.min.js","mappings":"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","sources":["webpack://@zhennann/socketio/../../node_modules/@zhennann/debounce/dist/index.js","webpack://@zhennann/socketio/webpack/bootstrap","webpack://@zhennann/socketio/webpack/runtime/compat get default export","webpack://@zhennann/socketio/webpack/runtime/define property getters","webpack://@zhennann/socketio/webpack/runtime/hasOwnProperty shorthand","webpack://@zhennann/socketio/webpack/runtime/make namespace object","webpack://@zhennann/socketio/./src/io/io_main.js","webpack://@zhennann/socketio/./src/io/io_socket.js","webpack://@zhennann/socketio/./src/io/io_message.js","webpack://@zhennann/socketio/./src/io/io_messageSystem.js","webpack://@zhennann/socketio/./src/io/io_performAction.js","webpack://@zhennann/socketio/./src/io/io_test.js","webpack://@zhennann/socketio/./src/simple/index.js","webpack://@zhennann/socketio/./src/progress/index.js","webpack://@zhennann/socketio/./src/main.js","webpack://@zhennann/socketio/./src/io/index.js"],"sourcesContent":["/******/ (() => { // webpackBootstrap\n/******/ \t\"use strict\";\n/******/ \t// The require scope\n/******/ \tvar __webpack_require__ = {};\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t(() => {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = (exports, definition) => {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t(() => {\n/******/ \t\t__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t(() => {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = (exports) => {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/************************************************************************/\nvar __webpack_exports__ = {};\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ debounce)\n/* harmony export */ });\nfunction debounce(func, wait) {\n  var i = 0;\n  return function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var ctx = this;\n    if (i !== 0) clearTimeout(i);\n    i = setTimeout(function () {\n      func.apply(ctx, args);\n    }, wait);\n  };\n}\nmodule.exports = __webpack_exports__;\n/******/ })()\n;\n//# sourceMappingURL=index.js.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export default adapter => {\n  const io = {\n    //\n    _onConnectCallbacks: [],\n    _onDisconnectCallbacks: [],\n    _onSocketCreateCallbacks: [],\n    _onSocketDestroyCallbacks: [],\n    _onResetCallbacks: [],\n    //\n    _logout() {\n      // timeout: not use window.\n      setTimeout(() => {\n        this.disconnect();\n        if (adapter.logout) {\n          adapter.logout();\n        }\n      }, 0);\n    },\n    reset() {\n      this.raiseOnReset();\n    },\n    //\n    registerOnConnect(callback) {\n      this._onConnectCallbacks.push(callback);\n    },\n    raiseOnConnect() {\n      for (const callback of this._onConnectCallbacks) {\n        callback.call(this);\n      }\n    },\n    registerOnDisconnect(callback) {\n      this._onDisconnectCallbacks.push(callback);\n    },\n    raiseOnDisconnect() {\n      for (const callback of this._onDisconnectCallbacks) {\n        callback.call(this);\n      }\n    },\n    registerOnSocketCreate(callback) {\n      this._onSocketCreateCallbacks.push(callback);\n    },\n    raiseOnSocketCreate(socket) {\n      for (const callback of this._onSocketCreateCallbacks) {\n        callback.call(this, socket);\n      }\n    },\n    registerOnSocketDestroy(callback) {\n      this._onSocketDestroyCallbacks.push(callback);\n    },\n    raiseOnSocketDestroy(socket) {\n      for (const callback of this._onSocketDestroyCallbacks) {\n        callback.call(this, socket);\n      }\n    },\n    registerOnReset(callback) {\n      this._onResetCallbacks.push(callback);\n    },\n    raiseOnReset() {\n      for (const callback of this._onResetCallbacks) {\n        callback.call(this);\n      }\n    },\n  };\n  return io;\n};\n","export default adapter => {\n  const io = {\n    // socket\n    _socket: null,\n    //\n    connect() {\n      if (this._socket) {\n        this._socket.connect();\n      }\n    },\n    disconnect() {\n      if (this._socket) {\n        this._socket.disconnect();\n      }\n    },\n    _onConnect() {\n      this.raiseOnConnect();\n    },\n    _onDisconnect(reason) {\n      this.raiseOnDisconnect();\n      // reconnect\n      if (reason === 'io server disconnect' || reason === 'transport close') {\n        // the disconnection was initiated by the server, you need to reconnect manually\n        this.connect();\n      }\n    },\n    _getSocket() {\n      if (!this._socket) {\n        this._socket = adapter.socket();\n        this.raiseOnSocketCreate(this._socket);\n      }\n      return this._socket;\n    },\n    _initialize() {\n      this._onConnectBind = this._onConnect.bind(this);\n      this._onDisconnectBind = this._onDisconnect.bind(this);\n      this.registerOnSocketCreate(socket => {\n        socket.on('connect', this._onConnectBind);\n        socket.on('disconnect', this._onDisconnectBind);\n      });\n      this.registerOnSocketDestroy(socket => {\n        socket.off('connect', this._onConnectBind);\n        socket.off('disconnect', this._onDisconnectBind);\n      });\n    },\n  };\n  return io;\n};\n","export default () => {\n  const io = {\n    // subscribes\n    _subscribeCounter: 0,\n    _subscribesAll: {},\n    _subscribesPath: {},\n    // methods\n    subscribe(path, cbMessage, cbSubscribed, options) {\n      // socket\n      const _socket = this._getSocket();\n      if (!_socket.connected) {\n        _socket.connect();\n      }\n      // record to All\n      const subscribeId = ++this._subscribeCounter;\n      this._subscribesAll[subscribeId] = {\n        path,\n        cbMessage,\n        cbSubscribed,\n        options,\n      };\n      // record to path\n      let _itemPath = this._subscribesPath[path];\n      let _newPathSubscribe = false;\n      if (!_itemPath) {\n        _itemPath = this._subscribesPath[path] = {\n          subscribed: false,\n          timestamp: Date.now(),\n          items: {},\n        };\n        _newPathSubscribe = true;\n      }\n      _itemPath.items[subscribeId] = true;\n      // just return subscribeId when disconnected\n      if (!_socket.connected) return subscribeId;\n      // connected\n      if (_newPathSubscribe) {\n        this._doSubscribePath(path);\n      } else {\n        if (_itemPath.subscribed) {\n          // invoke cbSubscribed directly\n          if (cbSubscribed) {\n            setTimeout(() => {\n              cbSubscribed({ subscribeId, path, options });\n            }, 0);\n          }\n        }\n      }\n      // ok\n      return subscribeId;\n    },\n    unsubscribe(subscribeId) {\n      const _item = this._subscribesAll[subscribeId];\n      if (!_item) return;\n\n      let _newPathUnsubscribe = false;\n      const _itemPath = this._subscribesPath[_item.path];\n      if (_itemPath) {\n        delete _itemPath.items[subscribeId];\n        if (Object.keys(_itemPath.items).length === 0) {\n          delete this._subscribesPath[_item.path];\n          _newPathUnsubscribe = true;\n        }\n      }\n\n      delete this._subscribesAll[subscribeId];\n      if (Object.keys(this._subscribesAll).length === 0) {\n        this.disconnect();\n        return; // just return because will be disconnected\n      }\n\n      // just return when disconnected\n      const _socket = this._getSocket();\n      if (!_socket.connected) return;\n\n      if (_newPathUnsubscribe) {\n        // force unsubscribe no matter whether _itemPath.subscribed\n        this._doUnsubscribePath(_item.path);\n      }\n    },\n    _onMessage(data) {\n      const _itemPath = this._subscribesPath[data.path];\n      if (!_itemPath) return;\n      for (const subscribeId in _itemPath.items) {\n        const _subscribe = this._subscribesAll[subscribeId];\n        if (_subscribe && _subscribe.cbMessage) {\n          _subscribe.cbMessage({\n            message: data.message,\n            subscribeId,\n            path: data.path,\n            options: _subscribe.options,\n          });\n        }\n      }\n    },\n    _doSubscribePath(path) {\n      // check\n      const _socket = this._getSocket();\n      if (!_socket.connected) return;\n      const _itemPath = this._subscribesPath[path];\n      if (!_itemPath) return;\n      // subscribe\n      this.performAction({\n        url: '/a/socketio/subscribe',\n        body: {\n          path,\n          timestamp: _itemPath.timestamp,\n        },\n      })\n        .then(() => {\n          _itemPath.subscribed = true;\n          for (const subscribeId in _itemPath.items) {\n            const _subscribe = this._subscribesAll[subscribeId];\n            if (_subscribe && _subscribe.cbSubscribed) {\n              _subscribe.cbSubscribed({ subscribeId, path, options: _subscribe.options });\n            }\n          }\n        })\n        .catch(() => {\n          // do nothing\n          // not check 401\n        });\n    },\n    _doUnsubscribePath(path) {\n      // check\n      const _socket = this._getSocket();\n      if (!_socket.connected) return;\n      const _itemPath = this._subscribesPath[path];\n      if (!_itemPath) return;\n      // subscribe\n      this.performAction({\n        url: '/a/socketio/unsubscribe',\n        body: {\n          path,\n          timestamp: Date.now(),\n        },\n      })\n        .then(() => {\n          _itemPath.subscribed = false;\n        })\n        .catch(() => {\n          // do nothing\n          // not check 401\n        });\n    },\n    _initialize() {\n      // OnConnect\n      this.registerOnConnect(() => {\n        // subscribe again\n        for (const path in this._subscribesPath) {\n          this._doSubscribePath(path);\n        }\n      });\n      // onDisconnect\n      this.registerOnDisconnect(() => {\n        // reset all paths\n        for (const path in this._subscribesPath) {\n          const _itemPath = this._subscribesPath[path];\n          _itemPath.subscribed = false;\n        }\n      });\n      // onReset\n      this.registerOnReset(() => {\n        this._subscribesAll = {};\n        this._subscribesPath = {};\n\n        this.disconnect();\n\n        // should clear socket\n        if (this._socket) {\n          this.raiseOnSocketDestroy(this._socket);\n          this._socket = null;\n        }\n      });\n      // message\n      this._onMessageBind = this._onMessage.bind(this);\n      this.registerOnSocketCreate(socket => {\n        socket.on('message', this._onMessageBind);\n      });\n      this.registerOnSocketDestroy(socket => {\n        socket.off('message', this._onMessageBind);\n      });\n    },\n  };\n  return io;\n};\n","export default adapter => {\n  const io = {\n    _onMessageSystem(data) {\n      if (data.code === 401) {\n        this._onMessageSystem_401(data);\n      }\n    },\n    _onMessageSystem_401(data) {\n      const type = data.type;\n      if (type === 'self' || type === 'all') {\n        this._logout();\n      } else if (type === 'provider') {\n        const user = adapter.user();\n        if (user) {\n          if (user.op.anonymous) {\n            this._logout();\n          } else {\n            const providerCurrent = user.provider;\n            const providerMessage = data.provider;\n            if (\n              providerCurrent &&\n              providerMessage &&\n              providerCurrent.scene === providerMessage.scene &&\n              providerCurrent.id === providerMessage.id\n            ) {\n              this._logout();\n            }\n          }\n        }\n      }\n    },\n    _initialize() {\n      // onMessageSystem\n      this._onMessageSystemBind = this._onMessageSystem.bind(this);\n      this.registerOnSocketCreate(socket => {\n        socket.on('message-system', this._onMessageSystemBind);\n      });\n      this.registerOnSocketDestroy(socket => {\n        socket.off('message-system', this._onMessageSystemBind);\n      });\n      // onReset\n      this.registerOnReset(() => {\n        setTimeout(() => {\n          const user = adapter.user();\n          if (user && !user.op.anonymous) {\n            this.subscribe('/a/socketio/messageSystem', ({ message }) => {\n              this._onMessageSystem(JSON.parse(message.content));\n            });\n          }\n        }, 0);\n      });\n    },\n  };\n  return io;\n};\n","export default () => {\n  const io = {\n    // performAction\n    _performActionCounter: 0,\n    _performActionPromises: {},\n    // performAction\n    async performAction({ url, body }) {\n      // socket\n      const _socket = this._getSocket();\n      if (!_socket.connected) {\n        return new Error('socket is disconnected');\n      }\n      // emit message\n      return new Promise((resolve, reject) => {\n        const id = ++this._performActionCounter;\n        this._performActionPromises[id] = { resolve, reject };\n        _socket.emit('performAction', { id, url, body });\n      });\n    },\n    _onMessagePerformActionCallback(data) {\n      const { id, result } = data;\n      const promise = this._performActionPromises[id];\n      if (!promise) return;\n      delete this._performActionPromises[id];\n      const { resolve, reject } = promise;\n      //\n      if (result.code === 0) {\n        resolve(result.data);\n      } else {\n        const error = new Error();\n        error.code = result.code;\n        error.message = result.message;\n        reject(error);\n      }\n    },\n    _clearPerformActionPromises() {\n      for (const id in this._performActionPromises) {\n        const promise = this._performActionPromises[id];\n        promise.reject(new Error('socket is disconnected'));\n      }\n      this._performActionPromises = {};\n    },\n    _initialize() {\n      this.registerOnDisconnect(() => {\n        this._clearPerformActionPromises();\n      });\n      this._onMessagePerformActionCallbackBind = this._onMessagePerformActionCallback.bind(this);\n      this.registerOnSocketCreate(socket => {\n        socket.on('performAction-callback', this._onMessagePerformActionCallbackBind);\n      });\n      this.registerOnSocketDestroy(socket => {\n        socket.off('performAction-callback', this._onMessagePerformActionCallbackBind);\n      });\n    },\n  };\n  return io;\n};\n","export default () => {\n  const io = {\n    __test: false, // true,\n    __testPerformAction(i) {\n      this.performAction({ url: '/a/socketio/test/echo', body: { echo: i } })\n        .then(data => {\n          console.log(data);\n        })\n        .catch(err => {\n          console.log(err);\n        });\n    },\n    _initialize() {\n      this.registerOnConnect(() => {\n        if (!this.__test) return;\n        for (const i of [1, 2]) {\n          this.__testPerformAction(i);\n        }\n      });\n    },\n  };\n  return io;\n};\n","import debounce from '@zhennann/debounce';\n\nexport default (io, options) => {\n  const Simple = function () {\n    this.initialize = function () {\n      options = options || {};\n      // messageClass is optional\n      this.messageClass = (options && options.messageClass) || null;\n      // callback\n      this.onMessageOffset = options.onMessageOffset || this._onMessageOffsetDefault;\n      this.onMessageSelect = options.onMessageSelect || this._onMessageSelectDefault;\n      this.onMessagePush = options.onMessagePush;\n      this.onSubscribed = options.onSubscribed;\n      // enableMessages\n      this.enableMessages = options.enableMessages !== false;\n    };\n\n    this.subscribe = function ({ path, options }) {\n      this.messagesData = [];\n      this.messageOffset = -1;\n      this.messageOffsetPending = -1;\n      this.messageOfflineFetching = false;\n      this.messageIdsToRead = {};\n\n      this.subscribeId = io.subscribe(path, this._onMessage.bind(this), this._onSubscribed.bind(this), options);\n    };\n\n    this.unsubscribe = function () {\n      if (!this.subscribeId) return;\n      // unsubscribe\n      io.unsubscribe(this.subscribeId);\n      this.subscribeId = null;\n    };\n\n    this._onMessageOffsetDefault = async function () {\n      return await io.performAction({\n        url: '/a/socketio/message/offset',\n        body: {\n          messageClass: this.messageClass,\n        },\n      });\n    };\n\n    this._onMessageSelectDefault = async function () {\n      return await io.performAction({\n        url: '/a/socketio/message/select',\n        body: {\n          messageClass: this.messageClass,\n          options: {\n            offset: this.messageOffset,\n          },\n        },\n      });\n    };\n\n    this._onMessage = function ({ message }) {\n      this._setMessageOffset(message.id);\n      this._pushMessage(message);\n    };\n\n    this._onSubscribed = async function (...args) {\n      // custom\n      if (this.onSubscribed) {\n        const res = await this.onSubscribed(...args);\n        if (res) return res;\n      }\n      //\n      if (this.messageOfflineFetching) return;\n      this.messageOfflineFetching = true;\n      // maybe messages are sent out of order, so need re-receive offset again\n      // // offset\n      // if (this.messageOffset > -1) {\n      //   await this._offlineFetch();\n      //   return;\n      // }\n      // get offset\n      try {\n        const data = await this.onMessageOffset();\n        this.messageOffset = data.offset;\n        if (this.messageOffset === -1) {\n          this._offlineFetchStop();\n        } else {\n          await this._offlineFetch();\n        }\n      } catch (err) {\n        this._offlineFetchStop();\n      }\n    };\n\n    this._offlineFetch = async function () {\n      try {\n        const data = await this.onMessageSelect({ offset: this.messageOffset });\n        // push\n        const list = data.list;\n        if (list.length > 0) {\n          // offset\n          this.messageOffset = list[list.length - 1].id;\n          for (const message of list) {\n            this._pushMessage(message);\n          }\n        }\n        // next\n        if (data.finished) {\n          this._offlineFetchStop();\n        } else {\n          await this._offlineFetch();\n        }\n      } catch (err) {\n        this._offlineFetchStop();\n      }\n    };\n\n    this._offlineFetchStop = function () {\n      this.messageOfflineFetching = false;\n      this._setMessageOffset(this.messageOffsetPending);\n      this.messageOffsetPending = -1;\n    };\n\n    this.setMessageOffset = function (offset) {\n      return this._setMessageOffset(offset);\n    };\n\n    this._setMessageOffset = function (offset) {\n      if (this.messageOfflineFetching) {\n        if (offset > this.messageOffsetPending) this.messageOffsetPending = offset;\n        return;\n      }\n      if (offset > this.messageOffset) {\n        this.messageOffset = offset;\n      }\n    };\n\n    this.pushMessage = function (message) {\n      return this._pushMessage(message);\n    };\n\n    this._pushMessage = function (message) {\n      // insert\n      const inserted = this._insertMessage(message);\n      if (!inserted) return false;\n      // convert content\n      if (typeof message.content === 'string') {\n        message.content = JSON.parse(message.content);\n      }\n      // read\n      this._messageToRead(message);\n      // callback\n      const result = { message };\n      if (this.enableMessages) {\n        result.messages = this.messagesData;\n      }\n      this.onMessagePush(result);\n      // ok\n      return true;\n    };\n\n    this._insertMessage = function (message) {\n      if (!this.enableMessages) return true;\n      if (!message.id || message.persistence === false) {\n        this.messagesData.push(message);\n        return true;\n      }\n      let indexBase = -1;\n      for (let index = this.messagesData.length - 1; index >= 0; index--) {\n        const _message = this.messagesData[index];\n        if (!_message.id) continue;\n        if (_message.id === message.id) {\n          return false; // ignore if exists\n        }\n        if (_message.id < message.id) {\n          indexBase = index;\n          break;\n        }\n      }\n      this.messagesData.splice(indexBase + 1, 0, message);\n      return true;\n    };\n\n    this._messageToRead = function (message) {\n      if (!message.id || message.messageRead === 1 || message.persistence === false) return;\n      this.messageIdsToRead[message.id] = true;\n      this._performRead();\n    };\n\n    this._performRead = debounce(() => {\n      this._performRead2();\n    }, 300);\n\n    this._performRead2 = async function () {\n      const messageIds = Object.keys(this.messageIdsToRead);\n      this.messageIdsToRead = {};\n      try {\n        await io.performAction({\n          url: '/a/socketio/message/setRead',\n          body: {\n            messageClass: this.messageClass,\n            messageIds,\n          },\n        });\n      } catch (err) {\n        // save back\n        for (const messageId of messageIds) {\n          this.messageIdsToRead[messageId] = true;\n        }\n      }\n    };\n  };\n  const simple = new Simple();\n  simple.initialize();\n  return simple;\n};\n","import debounce from '@zhennann/debounce';\nimport simpleFn from '../simple/index.js';\n\nexport default (io, options) => {\n  const Progress = function () {\n    this.initialize = function () {\n      options = options || {};\n      this.delayTimeout = options.delayTimeout || 500;\n      this.onSubscribed = options.onSubscribed;\n      this.onProgress = options.onProgress;\n      // io simple\n      this._initializeSimple();\n    };\n    this._initializeSimple = function () {\n      const options = {};\n      options.enableMessages = false;\n      options.onSubscribed = this._onSubscribedDefault;\n      options.onMessagePush = this._onMessagePushDefault;\n      this.ioSimple = simpleFn(io, options);\n    };\n    this.subscribe = function ({ progressId, options }) {\n      this.progressId = progressId;\n      this.counter = 0;\n      this.queue = [];\n      this.queueHandler = debounce(() => {\n        for (const queueItem of this.queue) {\n          this._checking(queueItem.item);\n        }\n        this.queue = [];\n      }, this.delayTimeout);\n      //\n      const path = `/a/progress/update/${progressId}`;\n      this.ioSimple.subscribe({ path, options });\n    };\n\n    this.unsubscribe = function () {\n      this.ioSimple.unsubscribe();\n    };\n    this._queuePush = function (item) {\n      if (!item) return;\n      this.counter = item.counter;\n      const queueItem = { item, timestamp: Date.now() };\n      // push\n      const index = this.queue.findIndex(_queueItem => _queueItem.item.counter > item.counter);\n      if (index === -1) {\n        this.queue.push(queueItem);\n      } else {\n        this.queue.splice(index, 0, queueItem);\n      }\n      // check directly\n      while (this.queue[0] && this.queue[0].timestamp + 2 * this.delayTimeout < queueItem.timestamp) {\n        const queueItem = this.queue.shift();\n        this._checking(queueItem.item);\n      }\n      // queueHandler\n      this.queueHandler();\n    };\n    this._checking = function (item) {\n      // data\n      const data = item.data ? (typeof item.data === 'string' ? JSON.parse(item.data) : item.data) : {};\n      this.onProgress({ item, data });\n    };\n    this._onSubscribedDefault = async function (...args) {\n      // custom\n      if (this.onSubscribed) {\n        const res = await this.onSubscribed(...args);\n        if (res) return res;\n      }\n      // progress check\n      const item = await io.performAction({\n        url: '/a/progress/progress/check',\n        body: {\n          progressId: this.progressId,\n          counter: this.counter,\n        },\n      });\n      this._queuePush(item);\n      // true\n      return true;\n    };\n    this._onMessagePushDefault = function ({ message }) {\n      this._queuePush(message.content);\n    };\n  };\n  const progress = new Progress();\n  progress.initialize();\n  return progress;\n};\n","import ioFn from './io/index.js';\nimport simpleFn from './simple/index.js';\nimport progressFn from './progress/index.js';\n\nexport default {\n  io: ioFn,\n  simple: simpleFn,\n  progress: progressFn,\n};\n","import io_main from './io_main.js';\nimport io_socket from './io_socket.js';\nimport io_message from './io_message.js';\nimport io_messageSystem from './io_messageSystem.js';\nimport io_performAction from './io_performAction.js';\nimport io_test from './io_test.js';\n\nexport default adapter => {\n  const io = {};\n  const _initializes = [];\n  function mixin(ioProviderFn) {\n    const ioProvider = ioProviderFn(adapter);\n    if (ioProvider._initialize) {\n      _initializes.push(ioProvider._initialize);\n    }\n    Object.assign(io, ioProvider);\n  }\n  // mixins\n  mixin(io_main);\n  mixin(io_socket);\n  mixin(io_message);\n  mixin(io_messageSystem);\n  mixin(io_performAction);\n  mixin(io_test);\n  // initialize providers\n  for (const _initialize of _initializes) {\n    _initialize.call(io);\n  }\n  // initialize adapter\n  adapter.initialize(io);\n  return io;\n};\n"],"names":["exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","__webpack_exports__","debounce","func","wait","i","_len","arguments","length","args","Array","_key","ctx","this","clearTimeout","setTimeout","apply","r","d","module","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","a","adapter","_onConnectCallbacks","_onDisconnectCallbacks","_onSocketCreateCallbacks","_onSocketDestroyCallbacks","_onResetCallbacks","_logout","disconnect","logout","reset","raiseOnReset","registerOnConnect","callback","push","raiseOnConnect","registerOnDisconnect","raiseOnDisconnect","registerOnSocketCreate","raiseOnSocketCreate","socket","registerOnSocketDestroy","raiseOnSocketDestroy","registerOnReset","_socket","connect","_onConnect","_onDisconnect","reason","_getSocket","_initialize","_onConnectBind","bind","_onDisconnectBind","on","off","_subscribeCounter","_subscribesAll","_subscribesPath","subscribe","path","cbMessage","cbSubscribed","options","connected","subscribeId","_itemPath","_newPathSubscribe","subscribed","timestamp","Date","now","items","_doSubscribePath","unsubscribe","_item","_newPathUnsubscribe","keys","_doUnsubscribePath","_onMessage","data","_subscribe","message","performAction","url","body","then","_onMessageBind","_onMessageSystem","code","_onMessageSystem_401","type","user","op","anonymous","providerCurrent","provider","providerMessage","scene","id","_onMessageSystemBind","JSON","parse","content","io","_performActionCounter","_performActionPromises","Error","Promise","resolve","reject","emit","_onMessagePerformActionCallback","result","promise","error","_clearPerformActionPromises","_onMessagePerformActionCallbackBind","__test","__testPerformAction","echo","console","log","err","simple","initialize","messageClass","onMessageOffset","_onMessageOffsetDefault","onMessageSelect","_onMessageSelectDefault","onMessagePush","onSubscribed","enableMessages","messagesData","messageOffset","messageOffsetPending","messageOfflineFetching","messageIdsToRead","_onSubscribed","offset","_setMessageOffset","_pushMessage","res","_offlineFetchStop","_offlineFetch","list","finished","setMessageOffset","pushMessage","_insertMessage","_messageToRead","messages","persistence","indexBase","index","_message","splice","messageRead","_performRead","_performRead2","messageIds","messageId","_initializes","mixin","ioProviderFn","ioProvider","assign","io_main","io_socket","io_message","io_messageSystem","io_performAction","io_test","simpleFn","progress","delayTimeout","onProgress","_initializeSimple","_onSubscribedDefault","_onMessagePushDefault","ioSimple","progressId","counter","queue","queueHandler","queueItem","_checking","item","_queuePush","findIndex","_queueItem","shift"],"sourceRoot":""}