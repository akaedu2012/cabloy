!function(s,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.socketio=i():s.socketio=i()}(self,(function(){return(()=>{"use strict";var s={d:(i,t)=>{for(var e in t)s.o(t,e)&&!s.o(i,e)&&Object.defineProperty(i,e,{enumerable:!0,get:t[e]})},o:(s,i)=>Object.prototype.hasOwnProperty.call(s,i),r:s=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})}},i={};function t(s,i){var t="undefined"!=typeof Symbol&&s[Symbol.iterator]||s["@@iterator"];if(!t){if(Array.isArray(s)||(t=function(s,i){if(s){if("string"==typeof s)return e(s,i);var t=Object.prototype.toString.call(s).slice(8,-1);return"Object"===t&&s.constructor&&(t=s.constructor.name),"Map"===t||"Set"===t?Array.from(s):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?e(s,i):void 0}}(s))||i&&s&&"number"==typeof s.length){t&&(s=t);var n=0,c=function(){};return{s:c,n:function(){return n>=s.length?{done:!0}:{done:!1,value:s[n++]}},e:function(s){throw s},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,b=!1;return{s:function(){t=t.call(s)},n:function(){var s=t.next();return o=s.done,s},e:function(s){b=!0,r=s},f:function(){try{o||null==t.return||t.return()}finally{if(b)throw r}}}}function e(s,i){(null==i||i>s.length)&&(i=s.length);for(var t=0,e=new Array(i);t<i;t++)e[t]=s[t];return e}s.r(i),s.d(i,{default:()=>n});const n=function(s){var i={_socket:null,_subscribeCounter:0,_subscribesAll:{},_subscribesPath:{},_subscribesWaitingTimeoutId:0,_subscribesWaitingDoing:!1,_subscribesWaiting:{},_unsubscribesWaitingTimeoutId:0,_unsubscribesWaitingDoing:!1,_unsubscribesWaiting:{},subscribe:function(s,i,t,e){e=e||{};var n=this._getSocket();n.connected||n.connect();var c=++this._subscribeCounter;this._subscribesAll[c]={path:s,cbMessage:i,cbSubscribed:t,options:e};var r=this._subscribesPath[s],o=!1;return r||(r=this._subscribesPath[s]={scene:e.scene,items:{}},o=!0,delete this._unsubscribesWaiting[s]),r.items[c]=!0,n.connected&&(o?(this._subscribesWaiting[s]=!0,this._doSubscribesWaiting()):this._subscribesWaiting[s]||t&&t()),c},unsubscribe:function(s){var i=this._subscribesAll[s];if(i){var t=this._subscribesPath[i.path];t&&(delete t.items[s],0===Object.keys(t.items).length&&(delete this._subscribesPath[i.path],delete this._subscribesWaiting[i.path],t.socketId&&(this._unsubscribesWaiting[i.path]={scene:t.scene,socketId:t.socketId},this._doUnsubscribesWaiting()))),delete this._subscribesAll[s],0===Object.keys(this._subscribesAll).length&&this._getSocket().disconnect()}},_doSubscribesWaiting:function(){var i=this;if(!this._subscribesWaitingDoing&&0===this._subscribesWaitingTimeoutId&&0!==Object.keys(this._subscribesWaiting).length&&this._socket.connected){var e=[];for(var n in this._subscribesWaiting){var c=this._subscribesPath[n];c&&e.push({path:n,scene:c.scene})}this._subscribesWaitingDoing=!0,s.subscribe({subscribes:e,socketId:this._socket.id}).then((function(){var s,n=t(e);try{for(n.s();!(s=n.n()).done;){var c=s.value;delete i._subscribesWaiting[c.path];var r=i._subscribesPath[c.path];if(r)for(var o in r.socketId=i._socket.id,r.items){var b=i._subscribesAll[o];b&&b.cbSubscribed&&b.cbSubscribed()}}}catch(s){n.e(s)}finally{n.f()}i._subscribesWaitingDoing=!1,i._doSubscribesWaiting()})).catch((function(){i._subscribesWaitingDoing=!1,i._subscribesWaitingTimeoutId=window.setTimeout((function(){i._subscribesWaitingTimeoutId=0,i._doSubscribesWaiting()}),2e3)}))}},_doUnsubscribesWaiting:function(){var i=this;if(!this._unsubscribesWaitingDoing&&0===this._unsubscribesWaitingTimeoutId&&0!==Object.keys(this._unsubscribesWaiting).length){var e=[];for(var n in this._unsubscribesWaiting)if(this._subscribesPath[n])delete this._unsubscribesWaiting[n];else{var c=this._unsubscribesWaiting[n];e.push({path:n,scene:c.scene,socketId:c.socketId})}this._unsubscribesWaitingDoing=!0,s.unsubscribe({subscribes:e}).then((function(){var s,n=t(e);try{for(n.s();!(s=n.n()).done;){var c=s.value;delete i._unsubscribesWaiting[c.path]}}catch(s){n.e(s)}finally{n.f()}i._unsubscribesWaitingDoing=!1,i._doUnsubscribesWaiting()})).catch((function(){i._unsubscribesWaitingDoing=!1,i._unsubscribesWaitingTimeoutId=window.setTimeout((function(){i._unsubscribesWaitingTimeoutId=0,i._doUnsubscribesWaiting()}),2e3)}))}},_getSocket:function(){return this._socket||(this._socket=s.socket(),this._socket.on("connect",this._onConnect.bind(this)),this._socket.on("disconnect",this._onDisconnect.bind(this)),this._socket.on("message",this._onMessage.bind(this))),this._socket},_onMessage:function(s){var i=this._subscribesPath[s.path];if(i)for(var t in i.items){var e=this._subscribesAll[t];e&&e.cbMessage&&e.cbMessage({message:s.message})}},_onConnect:function(){if(this._subscribesWaiting={},0===Object.keys(this._subscribesPath).length)this._socket.disconnect();else{for(var s in this._subscribesPath)this._subscribesWaiting[s]=!0;this._doSubscribesWaiting()}},_onDisconnect:function(s){this._subscribesWaiting={},"io server disconnect"===s&&this._socket.connect()},connect:function(){this._socket&&this._socket.connect()},disconnect:function(){this._socket&&this._socket.disconnect()},reset:function(){this._unsubscribesWaiting={},this._subscribesWaiting={},this._subscribesAll={},this._subscribesPath={},this.disconnect()}};return s.initialize(i),i};return i})()}));
//# sourceMappingURL=socketio.min.js.map