(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,s=function(){};return{s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){a=!0,o=t},f:function(){try{c||null==n.return||n.return()}finally{if(a)throw o}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function s(){s=function(){return t};var t={},e=Object.prototype,i=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",c=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function h(t,e,n,i){var r=e&&e.prototype instanceof l?e:l,s=Object.create(r.prototype),o=new x(i||[]);return s._invoke=function(t,e,n){var i="suspendedStart";return function(r,s){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw s;return{value:void 0,done:!0}}for(n.method=r,n.arg=s;;){var o=n.delegate;if(o){var c=W(o,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var a=f(t,e,n);if("normal"===a.type){if(i=n.done?"completed":"suspendedYield",a.arg===b)continue;return{value:a.arg,done:n.done}}"throw"===a.type&&(i="completed",n.method="throw",n.arg=a.arg)}}}(t,n,o),s}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=h;var b={};function l(){}function d(){}function g(){}var y={};u(y,o,(function(){return this}));var _=Object.getPrototypeOf,p=_&&_(_(L([])));p&&p!==e&&i.call(p,o)&&(y=p);var v=g.prototype=l.prototype=Object.create(y);function m(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function r(s,o,c,a){var u=f(t[s],t,o);if("throw"!==u.type){var h=u.arg,b=h.value;return b&&"object"==n(b)&&i.call(b,"__await")?e.resolve(b.__await).then((function(t){r("next",t,c,a)}),(function(t){r("throw",t,c,a)})):e.resolve(b).then((function(t){h.value=t,c(h)}),(function(t){return r("throw",t,c,a)}))}a(u.arg)}var s;this._invoke=function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return s=s?s.then(i,i):i()}}function W(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,W(t,e),"throw"===e.method))return b;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return b}var i=f(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,b;var r=i.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,b):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,b)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function L(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(i.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:O}}function O(){return{value:void 0,done:!0}}return d.prototype=g,u(v,"constructor",g),u(g,"constructor",d),d.displayName=u(g,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,u(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},m(w.prototype),u(w.prototype,c,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,i,r,s){void 0===s&&(s=Promise);var o=new w(h(e,n,i,r),s);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},m(v),u(v,a,"Generator"),u(v,o,(function(){return this})),u(v,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=L,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,i){return o.type="throw",o.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],o=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var c=i.call(s,"catchLoc"),a=i.call(s,"finallyLoc");if(c&&a){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,b):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;S(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:L(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),b}},t}function o(t,e,n,i,r,s,o){try{var c=t[s](o),a=c.value}catch(t){return void n(t)}c.done?e(a):Promise.resolve(a).then(i,r)}t.r(e),t.d(e,{default:()=>c});const c=function(t){var e={_socket:null,_subscribeCounter:0,_subscribesAll:{},_subscribesPath:{},_subscribesWaitingTimeoutId:0,_subscribesWaitingDoing:!1,_subscribesWaiting:{},_unsubscribesWaitingTimeoutId:0,_unsubscribesWaitingDoing:!1,_unsubscribesWaiting:{},performAction:function(t){return(e=s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.method,t.url,t.query,t.params,t.headers,t.body,e.abrupt("return",null);case 2:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,r){var s=e.apply(t,n);function c(t){o(s,i,r,c,a,"next",t)}function a(t){o(s,i,r,c,a,"throw",t)}c(void 0)}))})();var e},subscribe:function(t,e,n,i){i=i||{};var r=this._getSocket();r.connected||r.connect();var s=++this._subscribeCounter;this._subscribesAll[s]={path:t,cbMessage:e,cbSubscribed:n,options:i};var o=this._subscribesPath[t],c=!1;return o||(o=this._subscribesPath[t]={scene:i.scene,items:{}},c=!0,delete this._unsubscribesWaiting[t]),o.items[s]=!0,r.connected&&(c?(this._subscribesWaiting[t]=!0,this._doSubscribesWaiting()):this._subscribesWaiting[t]||n&&n()),s},unsubscribe:function(t){var e=this._subscribesAll[t];if(e){var n=this._subscribesPath[e.path];n&&(delete n.items[t],0===Object.keys(n.items).length&&(delete this._subscribesPath[e.path],delete this._subscribesWaiting[e.path],n.socketId&&(this._unsubscribesWaiting[e.path]={scene:n.scene,socketId:n.socketId},this._doUnsubscribesWaiting()))),delete this._subscribesAll[t],0===Object.keys(this._subscribesAll).length&&this.disconnect()}},_doSubscribesWaiting:function(){var e=this;if(!this._subscribesWaitingDoing&&0===this._subscribesWaitingTimeoutId&&0!==Object.keys(this._subscribesWaiting).length&&this._socket.connected){var n=[];for(var r in this._subscribesWaiting){var s=this._subscribesPath[r];s&&n.push({path:r,scene:s.scene})}this._subscribesWaitingDoing=!0,t.subscribe({subscribes:n,socketId:this._socket.id}).then((function(){var t,r=i(n);try{for(r.s();!(t=r.n()).done;){var s=t.value;delete e._subscribesWaiting[s.path];var o=e._subscribesPath[s.path];if(o)for(var c in o.socketId=e._socket.id,o.items){var a=e._subscribesAll[c];a&&a.cbSubscribed&&a.cbSubscribed()}}}catch(t){r.e(t)}finally{r.f()}e._subscribesWaitingDoing=!1,e._doSubscribesWaiting()})).catch((function(t){e._subscribesWaitingDoing=!1,401===t.code?e._logout():e._subscribesWaitingTimeoutId=setTimeout((function(){e._subscribesWaitingTimeoutId=0,e._doSubscribesWaiting()}),2e3)}))}},_doUnsubscribesWaiting:function(){var e=this;if(!this._unsubscribesWaitingDoing&&0===this._unsubscribesWaitingTimeoutId&&0!==Object.keys(this._unsubscribesWaiting).length){var n=[];for(var r in this._unsubscribesWaiting)if(this._subscribesPath[r])delete this._unsubscribesWaiting[r];else{var s=this._unsubscribesWaiting[r];n.push({path:r,scene:s.scene,socketId:s.socketId})}this._unsubscribesWaitingDoing=!0,t.unsubscribe({subscribes:n}).then((function(){var t,r=i(n);try{for(r.s();!(t=r.n()).done;){var s=t.value;delete e._unsubscribesWaiting[s.path]}}catch(t){r.e(t)}finally{r.f()}e._unsubscribesWaitingDoing=!1,e._doUnsubscribesWaiting()})).catch((function(t){e._unsubscribesWaitingDoing=!1,401===t.code?e._logout():e._unsubscribesWaitingTimeoutId=setTimeout((function(){e._unsubscribesWaitingTimeoutId=0,e._doUnsubscribesWaiting()}),2e3)}))}},_getSocket:function(){return this._socket||(this._socket=t.socket(),this._socket.on("connect",this._onConnectBind),this._socket.on("disconnect",this._onDisconnectBind),this._socket.on("message",this._onMessageBind),this._socket.on("message-system",this._onMessageSystemBind)),this._socket},_logout:function(){var e=this;setTimeout((function(){e.disconnect(),t.logout&&t.logout()}),0)},_onMessage:function(t){var e=this._subscribesPath[t.path];if(e)for(var n in e.items){var i=this._subscribesAll[n];i&&i.cbMessage&&i.cbMessage({message:t.message})}},_onMessageSystem:function(t){401===t.code&&this._onMessageSystem_401(t)},_onMessageSystem_401:function(e){var n=e.type;if("self"===n||"all"===n)this._logout();else if("provider"===n){var i=t.user();if(i)if(i.op.anonymous)this._logout();else{var r=i.provider,s=e.provider;r&&s&&r.scene===s.scene&&r.id===s.id&&this._logout()}}},_onConnect:function(){if(this._subscribesWaiting={},0===Object.keys(this._subscribesPath).length)this.disconnect();else{for(var t in this._subscribesPath)this._subscribesWaiting[t]=!0;this._doSubscribesWaiting()}},_onDisconnect:function(t){this._subscribesWaiting={},"io server disconnect"!==t&&"transport close"!==t||this.connect()},connect:function(){this._socket&&this._socket.connect()},disconnect:function(){this._socket&&this._socket.disconnect()},reset:function(){var e=this;this._unsubscribesWaiting={},this._unsubscribesWaitingTimeoutId=0,this._unsubscribesWaitingDoing=!1,this._subscribesWaiting={},this._subscribesWaitingTimeoutId=0,this._subscribesWaitingDoing=!1,this._subscribesAll={},this._subscribesPath={},this.disconnect(),this._socket&&(this._socket.off("connect",this._onConnectBind),this._socket.off("disconnect",this._onDisconnectBind),this._socket.off("message",this._onMessageBind),this._socket.off("message-system",this._onMessageSystemBind),this._socket=null);var n=t.user();n&&!n.op.anonymous&&this.subscribe("/a/socketio/messageSystem",(function(t){var n=t.message;e._onMessageSystem(JSON.parse(n.content))}))}};return e._onConnectBind=e._onConnect.bind(e),e._onDisconnectBind=e._onDisconnect.bind(e),e._onMessageBind=e._onMessage.bind(e),e._onMessageSystemBind=e._onMessageSystem.bind(e),t.initialize(e),e};module.exports=e})();
//# sourceMappingURL=socketio.min.js.map