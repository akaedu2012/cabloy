!function(s,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.socketio=t():s.socketio=t()}(window,(function(){return function(s){var t={};function i(e){if(t[e])return t[e].exports;var n=t[e]={i:e,l:!1,exports:{}};return s[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=s,i.c=t,i.d=function(s,t,e){i.o(s,t)||Object.defineProperty(s,t,{enumerable:!0,get:e})},i.r=function(s){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i.t=function(s,t){if(1&t&&(s=i(s)),8&t)return s;if(4&t&&"object"==typeof s&&s&&s.__esModule)return s;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:s}),2&t&&"string"!=typeof s)for(var n in s)i.d(e,n,function(t){return s[t]}.bind(null,n));return e},i.n=function(s){var t=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(t,"a",t),t},i.o=function(s,t){return Object.prototype.hasOwnProperty.call(s,t)},i.p="",i(i.s=0)}([function(s,t,i){"use strict";function e(s,t){var i;if("undefined"==typeof Symbol||null==s[Symbol.iterator]){if(Array.isArray(s)||(i=function(s,t){if(!s)return;if("string"==typeof s)return n(s,t);var i=Object.prototype.toString.call(s).slice(8,-1);"Object"===i&&s.constructor&&(i=s.constructor.name);if("Map"===i||"Set"===i)return Array.from(s);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(s,t)}(s))||t&&s&&"number"==typeof s.length){i&&(s=i);var e=0,r=function(){};return{s:r,n:function(){return e>=s.length?{done:!0}:{done:!1,value:s[e++]}},e:function(s){throw s},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,u=!1;return{s:function(){i=s[Symbol.iterator]()},n:function(){var s=i.next();return o=s.done,s},e:function(s){u=!0,c=s},f:function(){try{o||null==i.return||i.return()}finally{if(u)throw c}}}}function n(s,t){(null==t||t>s.length)&&(t=s.length);for(var i=0,e=new Array(t);i<t;i++)e[i]=s[i];return e}i.r(t),t.default=function(s){var t={_socket:null,_subscribeCounter:0,_subscribesAll:{},_subscribesPath:{},_subscribesWaitingTimeoutId:0,_subscribesWaitingDoing:!1,_subscribesWaiting:{},_unsubscribesWaitingTimeoutId:0,_unsubscribesWaitingDoing:!1,_unsubscribesWaiting:{},subscribe:function(s,t,i,e){e=e||{};var n=this._getSocket();n.connected||n.connect();var r=++this._subscribeCounter;this._subscribesAll[r]={path:s,cbMessage:t,cbSubscribed:i,options:e};var c=this._subscribesPath[s],o=!1;return c||(c=this._subscribesPath[s]={scene:e.scene,items:{}},o=!0,delete this._unsubscribesWaiting[s]),c.items[r]=!0,n.connected&&(o?(this._subscribesWaiting[s]=!0,this._doSubscribesWaiting()):this._subscribesWaiting[s]||i&&i()),r},unsubscribe:function(s){var t=this._subscribesAll[s];if(t){var i=this._subscribesPath[t.path];if(i&&(delete i.items[s],0===Object.keys(i.items).length&&(delete this._subscribesPath[t.path],delete this._subscribesWaiting[t.path],i.socketId&&(this._unsubscribesWaiting[t.path]={scene:i.scene,socketId:i.socketId},this._doUnsubscribesWaiting()))),delete this._subscribesAll[s],0===Object.keys(this._subscribesAll).length)this._getSocket().disconnect()}},_doSubscribesWaiting:function(){var t=this;if(!this._subscribesWaitingDoing&&0===this._subscribesWaitingTimeoutId&&0!==Object.keys(this._subscribesWaiting).length&&this._socket.connected){var i=[];for(var n in this._subscribesWaiting){var r=this._subscribesPath[n];r&&i.push({path:n,scene:r.scene})}this._subscribesWaitingDoing=!0,s.subscribe({subscribes:i,socketId:this._socket.id}).then((function(){var s,n=e(i);try{for(n.s();!(s=n.n()).done;){var r=s.value;delete t._subscribesWaiting[r.path];var c=t._subscribesPath[r.path];if(c)for(var o in c.socketId=t._socket.id,c.items){var u=t._subscribesAll[o];u&&u.cbSubscribed&&u.cbSubscribed()}}}catch(s){n.e(s)}finally{n.f()}t._subscribesWaitingDoing=!1,t._doSubscribesWaiting()})).catch((function(){t._subscribesWaitingDoing=!1,t._subscribesWaitingTimeoutId=window.setTimeout((function(){t._subscribesWaitingTimeoutId=0,t._doSubscribesWaiting()}),2e3)}))}},_doUnsubscribesWaiting:function(){var t=this;if(!this._unsubscribesWaitingDoing&&0===this._unsubscribesWaitingTimeoutId&&0!==Object.keys(this._unsubscribesWaiting).length){var i=[];for(var n in this._unsubscribesWaiting){if(this._subscribesPath[n])delete this._unsubscribesWaiting[n];else{var r=this._unsubscribesWaiting[n];i.push({path:n,scene:r.scene,socketId:r.socketId})}}this._unsubscribesWaitingDoing=!0,s.unsubscribe({subscribes:i}).then((function(){var s,n=e(i);try{for(n.s();!(s=n.n()).done;){var r=s.value;delete t._unsubscribesWaiting[r.path]}}catch(s){n.e(s)}finally{n.f()}t._unsubscribesWaitingDoing=!1,t._doUnsubscribesWaiting()})).catch((function(){t._unsubscribesWaitingDoing=!1,t._unsubscribesWaitingTimeoutId=window.setTimeout((function(){t._unsubscribesWaitingTimeoutId=0,t._doUnsubscribesWaiting()}),2e3)}))}},_getSocket:function(){return this._socket||(this._socket=s.socket(),this._socket.on("connect",this._onConnect.bind(this)),this._socket.on("disconnect",this._onDisconnect.bind(this)),this._socket.on("message",this._onMessage.bind(this))),this._socket},_onMessage:function(s){var t=this._subscribesPath[s.path];if(t)for(var i in t.items){var e=this._subscribesAll[i];e&&e.cbMessage&&e.cbMessage({message:s.message})}},_onConnect:function(){if(this._subscribesWaiting={},0===Object.keys(this._subscribesPath).length)this._socket.disconnect();else{for(var s in this._subscribesPath)this._subscribesWaiting[s]=!0;this._doSubscribesWaiting()}},_onDisconnect:function(s){this._subscribesWaiting={},"io server disconnect"===s&&this._socket.connect()},reset:function(){this._unsubscribesWaiting={},this._subscribesWaiting={},this._subscribesAll={},this._subscribesPath={},this._socket&&this._socket.disconnect()}};return s.initialize(t),t}}])}));
//# sourceMappingURL=socketio.min.js.map