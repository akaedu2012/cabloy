(()=>{var e={129:e=>{e.exports=e=>({})},169:e=>{function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function o(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function s(e){o(i,n,a,s,d,"next",e)}function d(e){o(i,n,a,s,d,"throw",e)}s(void 0)}))}}e.exports=e=>{class o extends e.meta.AtomBase{create(e){var t=()=>super.create,o=this;return r((function*(){let r=e.atomClass,n=e.item,a=e.user;const i=yield t().call(o,{atomClass:r,item:n,user:a}),s=yield o.ctx.model.product.insert({atomId:i.atomId});return{atomId:i.atomId,itemId:s.insertId}}))()}read(e){var t=()=>super.read,o=this;return r((function*(){let r=e.atomClass,n=e.options,a=e.key,i=e.user;const s=yield t().call(o,{atomClass:r,options:n,key:a,user:i});return s?(o._getMeta(s),s):null}))()}select(e){var o=()=>super.select,n=this;return r((function*(){let r=e.atomClass,a=e.options,i=e.items,s=e.user;yield o().call(n,{atomClass:r,options:a,items:i,user:s});var d,c=function(e,o){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,o){if(e){if("string"==typeof e)return t(e,o);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,o):void 0}}(e))||o&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){d=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(d)throw i}}}}(i);try{for(c.s();!(d=c.n()).done;){const e=d.value;n._getMeta(e)}}catch(e){c.e(e)}finally{c.f()}}))()}write(e){var t=()=>super.write,o=this;return r((function*(){let r=e.atomClass,n=e.target,a=e.key,i=e.item,s=e.options,d=e.user;yield t().call(o,{atomClass:r,target:n,key:a,item:i,options:s,user:d});const c=yield o.ctx.model.product.prepareData(i);c.id=a.itemId,yield o.ctx.model.product.update(c)}))()}delete(e){var t=()=>super.delete,o=this;return r((function*(){let r=e.atomClass,n=e.key,a=e.user;yield o.ctx.model.product.delete({id:n.itemId}),yield t().call(o,{atomClass:r,key:n,user:a})}))()}_getMeta(e){const t=[],o=(e.productPrice/100).toFixed(2);t.push(o);const r={summary:e.productCode,flags:t};e._meta=r}}return o}},434:e=>{function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function o(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function s(e){o(i,n,a,s,d,"next",e)}function d(e){o(i,n,a,s,d,"throw",e)}s(void 0)}))}}e.exports=e=>{class o extends e.meta.AtomBase{create(e){var t=()=>super.create,o=this;return r((function*(){let r=e.atomClass,n=e.item,a=e.user;const i=yield t().call(o,{atomClass:r,item:n,user:a}),s=yield o.ctx.model.purchaseOrder.insert({atomId:i.atomId});return{atomId:i.atomId,itemId:s.insertId}}))()}read(e){var t=()=>super.read,o=this;return r((function*(){let r=e.atomClass,n=e.options,a=e.key,i=e.user;const s=yield t().call(o,{atomClass:r,options:n,key:a,user:i});return s?(o._getMeta(s),s):null}))()}select(e){var o=()=>super.select,n=this;return r((function*(){let r=e.atomClass,a=e.options,i=e.items,s=e.user;yield o().call(n,{atomClass:r,options:a,items:i,user:s});var d,c=function(e,o){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,o){if(e){if("string"==typeof e)return t(e,o);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,o):void 0}}(e))||o&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){d=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(d)throw i}}}}(i);try{for(c.s();!(d=c.n()).done;){const e=d.value;n._getMeta(e)}}catch(e){c.e(e)}finally{c.f()}}))()}write(e){var t=()=>super.write,o=this;return r((function*(){let r=e.atomClass,n=e.target,a=e.key,i=e.item,s=e.options,d=e.user;yield t().call(o,{atomClass:r,target:n,key:a,item:i,options:s,user:d});const c=yield o.ctx.model.purchaseOrder.prepareData(i);c.id=a.itemId,yield o.ctx.model.purchaseOrder.update(c)}))()}delete(e){var t=()=>super.delete,o=this;return r((function*(){let r=e.atomClass,n=e.key,a=e.user;yield o.ctx.model.purchaseOrder.delete({id:n.itemId}),yield t().call(o,{atomClass:r,key:n,user:a})}))()}_getMeta(e){const t=[];e.detailsCount>0&&t.push(e.detailsCount);const o=(e.detailsAmount/100).toFixed(2);t.push(o);const r={flags:t};e._meta=r}}return o}},624:e=>{function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function o(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function s(e){o(i,n,a,s,d,"next",e)}function d(e){o(i,n,a,s,d,"throw",e)}s(void 0)}))}}e.exports=e=>{class o extends e.meta.DetailBase{create(e){var t=()=>super.create,o=this;return r((function*(){let r=e.atomKey,n=e.detailClass,a=e.item,i=e.user;const s=yield t().call(o,{atomKey:r,detailClass:n,item:a,user:i}),d=yield o.ctx.model.purchaseOrderDetail.insert({atomId:r.atomId,detailId:s.detailId});return{detailId:s.detailId,detailItemId:d.insertId}}))()}read(e){var t=()=>super.read,o=this;return r((function*(){let r=e.detailClass,n=e.options,a=e.key,i=e.user;const s=yield t().call(o,{detailClass:r,options:n,key:a,user:i});return s?(o._getMeta(s),s):null}))()}select(e){var o=()=>super.select,n=this;return r((function*(){let r=e.atomKey,a=e.detailClass,i=e.options,s=e.items,d=e.user;yield o().call(n,{atomKey:r,detailClass:a,options:i,items:s,user:d});var c,l=function(e,o){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,o){if(e){if("string"==typeof e)return t(e,o);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,o):void 0}}(e))||o&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){d=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(d)throw i}}}}(s);try{for(l.s();!(c=l.n()).done;){const e=c.value;n._getMeta(e)}}catch(e){l.e(e)}finally{l.f()}}))()}write(e){var t=()=>super.write,o=this;return r((function*(){let r=e.detailClass,n=e.target,a=e.key,i=e.item,s=e.options,d=e.user;yield t().call(o,{detailClass:r,target:n,key:a,item:i,options:s,user:d});const c=yield o.ctx.model.purchaseOrderDetail.prepareData(i);c.id=a.detailItemId,yield o.ctx.model.purchaseOrderDetail.update(c)}))()}delete(e){var t=()=>super.delete,o=this;return r((function*(){let r=e.detailClass,n=e.target,a=e.key,i=e.user;yield o.ctx.model.purchaseOrderDetail.delete({id:a.detailItemId}),yield t().call(o,{detailClass:r,target:n,key:a,user:i})}))()}_getMeta(e){const t=[];e.quantity>1&&t.push(e.quantity);const o=(e.amount/100).toFixed(2);t.push(o);const r={summary:e.detailCode,flags:t};e._meta=r}}return o}},758:e=>{function t(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}e.exports=e=>{class o extends e.app.meta.FlowServiceBase{execute(o){return(r=function*(){const t=o.parameter,r=t.flowDefId,n=t.parameter,a=t.node;yield e.bean.flow.startById({flowDefId:r,flowVars:n,flowUserId:1,startEventId:a.id})},function(){var e=this,o=arguments;return new Promise((function(n,a){var i=r.apply(e,o);function s(e){t(i,n,a,s,d,"next",e)}function d(e){t(i,n,a,s,d,"throw",e)}s(void 0)}))})();var r}}return o}},428:e=>{function t(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}e.exports=e=>{class o extends e.app.meta.FlowServiceBase{execute(e){return(o=function*(){const t=e.parameter;return e.contextNode.vars.set("echo",t),t},function(){var e=this,r=arguments;return new Promise((function(n,a){var i=o.apply(e,r);function s(e){t(i,n,a,s,d,"next",e)}function d(e){t(i,n,a,s,d,"throw",e)}s(void 0)}))})();var o}}return o}},223:e=>{function t(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}function o(e){return function(){var o=this,r=arguments;return new Promise((function(n,a){var i=e.apply(o,r);function s(e){t(i,n,a,s,d,"next",e)}function d(e){t(i,n,a,s,d,"throw",e)}s(void 0)}))}}e.exports=e=>{class t extends e.meta.BeanBase{update(e){var t=this;return o((function*(){if(1===e.version){const e="\n          CREATE TABLE testFlowPurchaseOrder (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            description varchar(255) DEFAULT NULL,\n            _flowDefKey varchar(255) DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        ";yield t.ctx.model.query(e)}if(2===e.version){let e="\n          CREATE TABLE testFlowProduct (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            productCode varchar(50) DEFAULT NULL,\n            productPrice int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        ";yield t.ctx.model.query(e),e="\n          CREATE TABLE testFlowPurchaseOrderDetail (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            detailId int(11) DEFAULT '0',\n            price int(11) DEFAULT '0',\n            quantity int(11) DEFAULT '0',\n            amount int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        ",yield t.ctx.model.query(e),e="\n          ALTER TABLE testFlowPurchaseOrder\n            ADD COLUMN detailsCount int(11) DEFAULT '0',\n            ADD COLUMN detailsAmount int(11) DEFAULT '0'\n        ",yield t.ctx.model.query(e)}}))()}init(e){var t=this;return o((function*(){if(1===e.version){const e=[{roleName:"authenticated",action:"create"},{roleName:"authenticated",action:"read",scopeNames:0},{roleName:"authenticated",action:"write",scopeNames:0},{roleName:"authenticated",action:"delete",scopeNames:0},{roleName:"authenticated",action:"clone",scopeNames:0},{roleName:"authenticated",action:"deleteBulk"},{roleName:"authenticated",action:"exportBulk"},{roleName:"system",action:"read",scopeNames:"authenticated"}];yield t.ctx.bean.role.addRoleRightBatch({atomClassName:"purchaseOrder",roleRights:e})}if(2===e.version){const e=[{roleName:"authenticated",action:"create"},{roleName:"authenticated",action:"read",scopeNames:0},{roleName:"authenticated",action:"write",scopeNames:0},{roleName:"authenticated",action:"delete",scopeNames:0},{roleName:"authenticated",action:"clone",scopeNames:0},{roleName:"authenticated",action:"deleteBulk"},{roleName:"authenticated",action:"exportBulk"},{roleName:"system",action:"read",scopeNames:"authenticated"}];yield t.ctx.bean.role.addRoleRightBatch({atomClassName:"product",roleRights:e})}}))()}test(){return o((function*(){}))()}}return t}},313:(e,t,o)=>{const r=o(223),n=o(434),a=o(169),i=o(624),s=o(428),d=o(758);e.exports=e=>({"version.manager":{mode:"app",bean:r},"atom.purchaseOrder":{mode:"app",bean:n},"atom.product":{mode:"app",bean:a},"detail.purchaseOrder":{mode:"app",bean:i},"flow.service.test":{title:"Test",mode:"ctx",bean:s},"flow.service.startEventTimer":{title:"StartTestFlow",mode:"ctx",bean:d}})},817:e=>{e.exports=e=>({})},971:e=>{e.exports={}},724:e=>{e.exports={StartTestFlow:"Start Test Flow"}},995:e=>{e.exports={Product:"产品","Create Product":"新建产品","Product List":"产品列表","Purchase Order":"采购订单","Create Purchase Order":"新建采购订单","Purchase Order List":"采购订单列表","Product Code Exists":"产品编码已存在","WorkFlow Test":"工作流测试",Test_Set00_Simple:"测试_分组00_简单流程",StartTestFlow:"启动测试工作流"}},266:(e,t,o)=>{e.exports={"en-us":o(724),"zh-cn":o(995)}},551:(e,t,o)=>{function r(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}function n(e){return function(){var t=this,o=arguments;return new Promise((function(n,a){var i=e.apply(t,o);function s(e){r(i,n,a,s,d,"next",e)}function d(e){r(i,n,a,s,d,"throw",e)}s(void 0)}))}}const a=o(638)("assert");e.exports=class{constructor(e){this.context=e}onNodeBegin(e){var t=this;return n((function*(){"activity_1"===e._nodeDef.id&&t.context.vars.set("echo","hello")}))()}onNodeDoing(e){return n((function*(){if("activity_2"===e._nodeDef.id){const t=yield e.utils.executeService({bean:{module:"test-flow",name:"test"},parameter:"hello world"});a.equal(t,"hello world")}}))()}onNodeEnd(e){return n((function*(){if("activity_1"===e._nodeDef.id){const t=e.vars.get("echo");a.equal(t,"hello")}}))()}}},539:e=>{function t(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}e.exports=class{constructor(e){this.context=e}onNodeEnter(e){var o,r=this;return(o=function*(){if("startEvent_1"===e._nodeDef.id){const t=r.context.vars.get("x");e.vars.set("x",t)}},function(){var e=this,r=arguments;return new Promise((function(n,a){var i=o.apply(e,r);function s(e){t(i,n,a,s,d,"next",e)}function d(e){t(i,n,a,s,d,"throw",e)}s(void 0)}))})()}}},688:(e,t,o)=>{function r(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}function n(e){return function(){var t=this,o=arguments;return new Promise((function(n,a){var i=e.apply(t,o);function s(e){r(i,n,a,s,d,"next",e)}function d(e){r(i,n,a,s,d,"throw",e)}s(void 0)}))}}const a=o(638)("assert");e.exports=class{constructor(e){this.context=e}onFlowStart(e){var t=this;return n((function*(){console.log("onFlowStart: ",e.startEventId);const o=t.context.vars.get("x.y.z");a.equal(o,void 0),t.context.vars.set("x.y.z","flow")}))()}onFlowEnd(e){var t=this;return n((function*(){console.log("onFlowEnd: ",e&&e.flowRemark);const o=t.context.vars.get("x.y.z");a.equal(o,"flow")}))()}onNodeEnter(e){return n((function*(){console.log("onNodeEnter: ",e._nodeDef.id);const t=e.vars.get("x.y.z");a.equal(t,void 0),e.vars.set("x.y.z",e._nodeDef.id)}))()}onNodeBegin(e){return n((function*(){console.log("onNodeBegin: ",e._nodeDef.id)}))()}onNodeDoing(e){return n((function*(){console.log("onNodeDoing: ",e._nodeDef.id)}))()}onNodeEnd(e){return n((function*(){console.log("onNodeEnd: ",e._nodeDef.id)}))()}onNodeLeave(e){return n((function*(){console.log("onNodeLeave: ",e._nodeDef.id);const t=e.vars.get("x.y.z");a.equal(t,e._nodeDef.id)}))()}onEdgeEnter(e,t){return n((function*(){console.log("onEdgeEnter: ",e._edgeDef.id," from node: ",t._nodeDef.id)}))()}onEdgeTake(e,t){return n((function*(){console.log("onEdgeTake: ",e._edgeDef.id," from node: ",t._nodeDef.id)}))()}onEdgeLeave(e,t){return n((function*(){console.log("onEdgeLeave: ",e._edgeDef.id," from node: ",t._nodeDef.id)}))()}getNodeDefOptions(e){console.log("getNodeDefOptions: ",e._nodeDef.id)}}},375:(e,t,o)=>{function r(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}function n(e){return function(){var t=this,o=arguments;return new Promise((function(n,a){var i=e.apply(t,o);function s(e){r(i,n,a,s,d,"next",e)}function d(e){r(i,n,a,s,d,"throw",e)}s(void 0)}))}}const a=o(638)("assert");e.exports=class{constructor(e){this.context=e}onNodeEnter(e){var t=this;return n((function*(){if("startEvent_1"===e._nodeDef.id){const e=t.context.atom._flowDefKey;a.equal(e,"set01_atomUserTask")}}))()}onTaskCreated(e,t){return n((function*(){console.log("onTaskCreated: ",e._flowTaskId," of node: ",t._nodeDef.id)}))()}onTaskClaimed(e,t){return n((function*(){console.log("onTaskClaimed: ",e._flowTaskId," of node: ",t._nodeDef.id)}))()}onTaskCompleted(e,t){return n((function*(){console.log("onTaskCompleted: ",e._flowTaskId," of node: ",t._nodeDef.id),console.log("handleStatus: %d, handleRemark: %s",e._flowTask.handleStatus,e._flowTask.handleRemark)}))()}getSchemaRead(e,t){return n((function*(){console.log("getSchemaRead: ",e._flowTaskId," of node: ",t._nodeDef.id)}))()}getSchemaWrite(e,t){return n((function*(){console.log("getSchemaWrite: ",e._flowTaskId," of node: ",t._nodeDef.id)}))()}getNodeDefOptions(e){console.log("getNodeDefOptions: ",e._nodeDef.id)}}},478:(e,t,o)=>{function r(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}const n=o(638)("assert");e.exports=class{constructor(e){this.context=e}onNodeEnter(e){var t,o=this;return(t=function*(){if("startEvent_1"===e._nodeDef.id){const e=o.context.atom._flowDefKey;n.equal(e,"set01_startEventAtom")}},function(){var e=this,o=arguments;return new Promise((function(n,a){var i=t.apply(e,o);function s(e){r(i,n,a,s,d,"next",e)}function d(e){r(i,n,a,s,d,"throw",e)}s(void 0)}))})()}}},796:e=>{e.exports=e=>({atomName:"Test_Set00_Activity_None",atomStaticKey:"set00_activityNone",atomRevision:0,description:"",content:JSON.stringify({process:{nodes:[{id:"startEvent_1",name:"Start",type:"startEventNone"},{id:"activity_1",name:"ActivityNone",type:"activityNone"},{id:"endEvent_1",name:"End",type:"endEventNone"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"endEvent_1"}]}})})},172:(e,t,o)=>{const r=o(551);e.exports=e=>{const t=e.meta.mockUtil.parseInfoFromPackage(__dirname),o={listener:r.toString(),process:{nodes:[{id:"startEvent_1",name:"Start",type:"startEventNone"},{id:"activity_1",name:"ActivityService",type:"activityService",options:{bean:{module:t.relativeName,name:"test"},parameterExpression:"context.vars.get(`echo`)"}},{id:"activity_2",name:"ActivityNone",type:"activityNone"},{id:"endEvent_1",name:"End",type:"endEventNone"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"activity_2"},{id:"edge_3",source:"activity_2",target:"endEvent_1"}]}};return{atomName:"Test_Set00_Activity_Service",atomStaticKey:"set00_activityService",atomRevision:0,description:"",content:JSON.stringify(o)}}},771:(e,t,o)=>{const r=o(539);e.exports=e=>{const t={listener:r.toString(),process:{nodes:[{id:"startEvent_1",name:"Start",type:"startEventNone"},{id:"endEvent_1",name:"End",type:"endEventNone"},{id:"endEvent_2",name:"End",type:"endEventNone"}],edges:[{id:"edge_1",name:"x=1",source:"startEvent_1",target:"endEvent_1",options:{conditionExpression:"context.vars.get('x')===1"}},{id:"edge_2",name:"x=2",source:"startEvent_1",target:"endEvent_2",options:{conditionExpression:"\n              contextNode.vars.get('x')===2\n            "}}]}};return{atomName:"Test_Set00_Edge_Sequence",atomStaticKey:"set00_edgeSequence",atomRevision:1,description:"",content:JSON.stringify(t)}}},332:(e,t,o)=>{const r=o(688);e.exports=e=>{const t={listener:r.toString(),process:{nodes:[{id:"startEvent_1",name:"Start",type:"startEventNone"},{id:"endEvent_1",name:"End",type:"endEventNone"}],edges:[{id:"edge_1",source:"startEvent_1",target:"endEvent_1"}]}};return{atomName:"Test_Set00_Simple",atomStaticKey:"set00_simple",atomRevision:0,description:"",content:JSON.stringify(t)}}},630:e=>{e.exports=e=>{const t={listener:null,process:{nodes:[{id:"startEvent_1",name:"Drafting",type:"startEventAtom",options:{atom:{module:e.meta.mockUtil.parseInfoFromPackage(__dirname).relativeName,atomClassName:"purchaseOrder"},conditionExpression:"atom._flowDefKey==='set01_atomAssigneesConfirmation'"}},{id:"activity_1",name:"Review",type:"activityUserTask",options:{assignees:{roles:"family"},confirmation:!0,bidding:!0,allowForward:!0,allowSubstitute:!0}},{id:"endEvent_1",name:"End",type:"endEventAtom"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"endEvent_1"}]}};return{atomName:"Test_Set01_Atom_AssigneesConfirmation",atomStaticKey:"set01_atomAssigneesConfirmation",atomRevision:1,description:"",content:JSON.stringify(t)}}},227:(e,t,o)=>{const r=o(375);e.exports=e=>{const t=e.meta.mockUtil.parseInfoFromPackage(__dirname),o={listener:r.toString(),process:{nodes:[{id:"startEvent_1",name:"Drafting",type:"startEventAtom",options:{atom:{module:t.relativeName,atomClassName:"purchaseOrder"},conditionExpression:"atom._flowDefKey==='set01_atomUserTask'"}},{id:"activity_1",name:"Review",type:"activityUserTask",options:{assignees:{vars:"flowUser"},confirmation:!1,bidding:!1,completionCondition:{},allowForward:!0,allowSubstitute:!0,schema:{write:["atomName",{name:"description",property:{type:"string",ebType:"text",ebTitle:"Description"}}]}}},{id:"endEvent_1",name:"End",type:"endEventAtom"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"endEvent_1"}]}};return{atomName:"Test_Set01_Atom_UserTask",atomStaticKey:"set01_atomUserTask",atomRevision:1,description:"",content:JSON.stringify(o)}}},280:(e,t,o)=>{const r=o(478);e.exports=e=>{const t=e.meta.mockUtil.parseInfoFromPackage(__dirname),o={listener:r.toString(),process:{nodes:[{id:"startEvent_1",name:"Drafting",type:"startEventAtom",options:{atom:{module:t.relativeName,atomClassName:"purchaseOrder"},conditionExpression:"atom._flowDefKey==='set01_startEventAtom'"}},{id:"activity_1",name:"ActivityNone",type:"activityNone"},{id:"endEvent_1",name:"End",type:"endEventAtom"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"endEvent_1"}]}};return{atomName:"Test_Set01_StartEvent_Atom",atomStaticKey:"set01_startEventAtom",atomRevision:0,description:"",content:JSON.stringify(o)}}},878:e=>{e.exports=e=>{const t={listener:null,process:{nodes:[{id:"startEvent_1",name:"Drafting",type:"startEventAtom",options:{atom:{module:e.meta.mockUtil.parseInfoFromPackage(__dirname).relativeName,atomClassName:"purchaseOrder"},conditionExpression:"atom._flowDefKey==='set02_behaviorOvertime'"}},{id:"activity_1",name:"Review",type:"activityUserTask",options:{assignees:{vars:"flowUser"}},behaviors:[{id:"behavior_1",name:"Overtime",type:"overtime",options:{cancelActivity:!0,timeDuration:3e3}}]},{id:"endEvent_1",name:"End",type:"endEventAtom"}],edges:[{id:"edge_1",source:"startEvent_1",target:"activity_1"},{id:"edge_2",source:"activity_1",target:"endEvent_1"},{id:"edge_3",source:"activity_1",target:"startEvent_1",behavior:"behavior_1"}]}};return{atomName:"Test_Set02_BehaviorOvertime",atomStaticKey:"set02_behaviorOvertime",atomRevision:0,description:"",content:JSON.stringify(t)}}},238:(e,t,o)=>{const r=o(332),n=o(771),a=o(796),i=o(172),s=o(280),d=o(227),c=o(630),l=o(878);e.exports=e=>[r(e),n(e),a(e),i(e),s(e),d(e),c(e),l(e)]},584:e=>{e.exports=e=>[{atomName:"Apple",atomStaticKey:"apple",atomRevision:0,productCode:"test-001",productPrice:1200},{atomName:"Pear",atomStaticKey:"pear",atomRevision:0,productCode:"test-002",productPrice:1e3},{atomName:"Banana",atomStaticKey:"banana",atomRevision:0,productCode:"test-003",productPrice:1300}]},1:e=>{e.exports=e=>{const t=e.meta.mockUtil.parseInfoFromPackage(__dirname);return[{atomName:"Create Purchase Order",atomStaticKey:"createPurchaseOrder",atomRevision:0,atomCategoryId:"a-base:menu.Create",resourceType:"a-base:menu",resourceConfig:JSON.stringify({module:t.relativeName,atomClassName:"purchaseOrder",atomAction:"create"}),resourceRoles:"authenticated"},{atomName:"Purchase Order List",atomStaticKey:"listPurchaseOrder",atomRevision:0,atomCategoryId:"a-base:menu.List",resourceType:"a-base:menu",resourceConfig:JSON.stringify({module:t.relativeName,atomClassName:"purchaseOrder",atomAction:"read"}),resourceRoles:"authenticated"},{atomName:"Create Product",atomStaticKey:"createProduct",atomRevision:0,atomCategoryId:"a-base:menu.Create",resourceType:"a-base:menu",resourceConfig:JSON.stringify({module:t.relativeName,atomClassName:"product",atomAction:"create"}),resourceRoles:"authenticated"},{atomName:"Product List",atomStaticKey:"listProduct",atomRevision:0,atomCategoryId:"a-base:menu.List",resourceType:"a-base:menu",resourceConfig:JSON.stringify({module:t.relativeName,atomClassName:"product",atomAction:"read"}),resourceRoles:"authenticated"}]}},623:e=>{function t(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}e.exports=e=>{const o={};return o.productCode={async:!0,type:"string",errors:!0,compile:function(){return function(){var o,r=(o=function*(t){if(!t)return!0;const o=this;if(!o.meta||!o.meta.validateHost)return!0;const r=o.meta.validateHost.key.atomId,n=yield o.model.queryOne("\n          select a.id from aAtom a\n            left join testFlowProduct b on a.id=b.atomId\n              where a.atomStage=0 and a.iid=? and a.deleted=0 and b.productCode=?\n          ",[o.instance.id,t]);if(n&&n.id!==r){const t=[{keyword:"x-productCode",params:[],message:o.text("Product Code Exists")}];throw new e.meta.ajv.ValidationError(t)}return!0},function(){var e=this,r=arguments;return new Promise((function(n,a){var i=o.apply(e,r);function s(e){t(i,n,a,s,d,"next",e)}function d(e){t(i,n,a,s,d,"throw",e)}s(void 0)}))});return function(e){return r.apply(this,arguments)}}()}},o}},908:e=>{e.exports=e=>({product:{type:"object",properties:{atomName:{type:"string",ebType:"text",ebTitle:"Product Name",notEmpty:!0},productCode:{type:"string",ebType:"text",ebTitle:"Product Code",notEmpty:!0,"x-productCode":!0},productPrice:{type:"number",ebType:"text",ebTitle:"Product Price",ebCurrency:!0}}},productSearch:{type:"object",properties:{productCode:{type:"string",ebType:"text",ebTitle:"Product Code"}}}})},261:e=>{e.exports=e=>{const t=e.meta.mockUtil.parseInfoFromPackage(__dirname),o={};return o.purchaseOrder={type:"object",properties:{__groupBasicInfo:{ebType:"group-flatten",ebTitle:"Basic Info"},atomName:{type:"string",ebType:"text",ebTitle:"Name",notEmpty:!0},description:{type:"string",ebType:"text",ebTitle:"Description"},_flowDefKey:{type:"string",ebType:"select",ebTitle:"Flow Definition",ebOptionsBlankAuto:!0,ebOptions:[{title:"Test_Set01_StartEvent_Atom",value:"set01_startEventAtom"},{title:"Test_Set01_Atom_UserTask",value:"set01_atomUserTask"},{title:"Test_Set01_Atom_AssigneesConfirmation",value:"set01_atomAssigneesConfirmation"}],notEmpty:!0},__groupStats:{ebType:"group-flatten",ebTitle:"Details Stats"},detailsCount:{type:"number",ebType:"detailsStat",ebTitle:"Quantity",ebParams:{detailClass:{module:t.relativeName,detailClassName:"default"},expression:"details.length"},ebReadOnly:!0},detailsAmount:{type:"number",ebType:"detailsStat",ebTitle:"Amount",ebParams:{detailClass:{module:t.relativeName,detailClassName:"default"},expression:"details.reduce(function(a,b){return a+b.amount;},0)"},ebAutoSubmit:!0,ebCurrency:!0,ebReadOnly:!0},__groupDetails:{ebType:"group-flatten",ebTitle:"Details",ebGroupWhole:!0,ebParams:{titleHidden:!0}},details:{ebType:"details",ebTitle:"Details",ebParams:{detailClass:{module:t.relativeName,detailClassName:"default"}},ebDisplay:{expression:"!!_flowDefKey",dependencies:["_flowDefKey"]}}}},o.purchaseOrderSearch={type:"object",properties:{description:{type:"string",ebType:"text",ebTitle:"Description"}}},o}},809:e=>{e.exports=e=>{const t={},o={expression:"!!detailCodeId",dependencies:["detailCodeId"]};return t.purchaseOrderDetail={type:"object",properties:{detailCodeId:{type:"number"},detailCode:{type:"string",ebType:"atom",ebTitle:"Product Code",ebParams:{target:"_self",atomClass:{module:"test-flow",atomClassName:"product"},selectOptions:{},atomId:"detailCodeId",mapper:{detailCodeId:"atomId",detailCode:"productCode",detailName:"atomName",price:"productPrice"}},notEmpty:!0},detailName:{type:"string",ebType:"text",ebTitle:"Product Name",notEmpty:!0,ebDisplay:o},price:{type:"number",ebType:"text",ebTitle:"Price",ebCurrency:!0,ebDisplay:o},quantity:{type:"number",ebType:"text",ebTitle:"Quantity",ebDisplay:o},amount:{type:"number",ebType:"text",ebTitle:"Amount",ebComputed:{expression:"price * quantity",dependencies:"price,quantity"},ebCurrency:!0,ebReadOnly:!0,ebDisplay:o}}},t}},326:(e,t,o)=>{const r=o(908),n=o(261),a=o(809);e.exports=e=>{const t={};return Object.assign(t,r(e)),Object.assign(t,n(e)),Object.assign(t,a(e)),t}},712:e=>{function t(e,t,o,r,n,a,i){try{var s=e[a](i),d=s.value}catch(e){return void o(e)}s.done?t(d):Promise.resolve(d).then(r,n)}e.exports=e=>{class o extends e.Controller{start(){var e,o=this;return(e=function*(){yield o.ctx.bean.flow.startByKey({flowDefKey:o.ctx.request.body.flowDefKey,flowVars:o.ctx.request.body.flowVars,flowUserId:o.ctx.state.user.op.id}),o.ctx.success()},function(){var o=this,r=arguments;return new Promise((function(n,a){var i=e.apply(o,r);function s(e){t(i,n,a,s,d,"next",e)}function d(e){t(i,n,a,s,d,"throw",e)}s(void 0)}))})()}}return o}},691:(e,t,o)=>{const r=o(712);e.exports=e=>({flow:r})},312:(e,t,o)=>{const r=o(817),n=o(266),a=o(971);e.exports=e=>{const t=o(129)(e),i=o(313)(e),s=o(788)(e),d=o(691)(e),c=o(481)(e),l=o(700)(e),u=o(730)(e);return{aops:t,beans:i,routes:s,controllers:d,services:c,models:l,config:r,locales:n,errors:a,meta:u}}},730:(e,t,o)=>{const r=o(638)("extend2");e.exports=e=>{const t={},n=o(623)(e),a=o(326)(e),i=o(238)(e),s=o(1)(e),d=o(584)(e);return r(!0,t,{base:{atoms:{purchaseOrder:{info:{bean:"purchaseOrder",title:"Purchase Order",tableName:"testFlowPurchaseOrder",details:["default"]},actions:{},validator:"purchaseOrder",search:{validator:"purchaseOrderSearch"}},product:{info:{bean:"product",title:"Product",tableName:"testFlowProduct"},actions:{},validator:"product",search:{validator:"productSearch"}}},statics:{"a-flow.flowDef":{items:i},"a-base.resource":{items:s},"test-flow.product":{items:d}}},detail:{details:{default:{info:{bean:"purchaseOrder",title:"Details",tableName:"testFlowPurchaseOrderDetail"},actions:{},validator:"purchaseOrderDetail"}}},validation:{validators:{purchaseOrder:{schemas:"purchaseOrder"},purchaseOrderSearch:{schemas:"purchaseOrderSearch"},product:{schemas:"product"},productSearch:{schemas:"productSearch"},purchaseOrderDetail:{schemas:"purchaseOrderDetail"}},keywords:{"x-productCode":n.productCode},schemas:a},index:{indexes:{testFlowProduct:"createdAt,updatedAt,atomId,productCode",testFlowPurchaseOrder:"createdAt,updatedAt,atomId",testFlowPurchaseOrderDetail:"createdAt,updatedAt,atomId,detailId"}}}),t}},54:e=>{e.exports=e=>{class t extends e.meta.Model{constructor(e){super(e,{table:"testFlowProduct",options:{disableDeleted:!1}})}}return t}},503:e=>{e.exports=e=>{class t extends e.meta.Model{constructor(e){super(e,{table:"testFlowPurchaseOrder",options:{disableDeleted:!1}})}}return t}},65:e=>{e.exports=e=>{class t extends e.meta.Model{constructor(e){super(e,{table:"testFlowPurchaseOrderDetail",options:{disableDeleted:!1}})}}return t}},700:(e,t,o)=>{const r=o(54),n=o(503),a=o(65);e.exports=e=>({product:r,purchaseOrder:n,purchaseOrderDetail:a})},788:e=>{e.exports=e=>{let t=[];return t=t.concat([{method:"post",path:"flow/start",controller:"flow",middlewares:"test"}]),t}},481:e=>{e.exports=e=>({})},638:e=>{"use strict";e.exports=require("require3")}},t={},o=function o(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}(312);module.exports=o})();