{"version":3,"sources":["webpack://egg-born-module-a-base-sync/./backend/src/bean/atom.resource.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/bean.atom.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/bean.atomAction.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/bean.atomClass.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/bean.auth.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/bean.base.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/bean.category.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/bean.resource.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/bean.role.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/bean.tag.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/bean.user.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/bean.util.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/broadcast.authProviderChanged.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/local.procedure.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/middleware.auth.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/middleware.cors.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/middleware.httpLog.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/middleware.inner.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/middleware.jsonp.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/middleware.right.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/middleware.test.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/middleware.transaction.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/queue.roleBuild.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/queue.schedule.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/startup.checkResourceLocales.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/startup.installAuthProviders.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/startup.loadAtomStatics.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/startup.loadSchedules.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/startup.registerPassport.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/stats.drafts.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/stats.stars.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version.manager.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/init2.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/init4.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/init5.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/init7.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/init8.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/init9.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/initData2.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/update1.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/update10.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/update1Data.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/update2.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/update3.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/update4.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/update6.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/update8.js","webpack://egg-born-module-a-base-sync/./backend/src/bean/version/update9.js","webpack://egg-born-module-a-base-sync/./backend/src/beans.js","webpack://egg-born-module-a-base-sync/./backend/src/common/atomBase.js","webpack://egg-born-module-a-base-sync/./backend/src/config/config.js","webpack://egg-born-module-a-base-sync/./backend/src/config/constants.js","webpack://egg-born-module-a-base-sync/./backend/src/config/errors.js","webpack://egg-born-module-a-base-sync/./backend/src/config/locale/en-us.js","webpack://egg-born-module-a-base-sync/./backend/src/config/locale/zh-cn.js","webpack://egg-born-module-a-base-sync/./backend/src/config/locales.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineAppearanceLanguage.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineAppearanceTheme.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineAppearanceView.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineAtomArchives.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineAtomDrafts.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineAtomStars.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineFlowEnds.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineFlowInitiateds.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineFlowParticipateds.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineMineAttachments.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineMineComments.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineMineExports.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineTaskClaimings.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineTaskCompleteds.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineTaskHandlings.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineWorkFlowFlows.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/mines/mineWorkFlowTasks.js","webpack://egg-born-module-a-base-sync/./backend/src/config/static/resources.js","webpack://egg-born-module-a-base-sync/./backend/src/config/validation/keywords.js","webpack://egg-born-module-a-base-sync/./backend/src/config/validation/schemas.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/atom.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/atomAction.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/atomClass.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/auth.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/base.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/category.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/comment.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/jwt.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/layoutConfig.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/resource.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/tag.js","webpack://egg-born-module-a-base-sync/./backend/src/controller/user.js","webpack://egg-born-module-a-base-sync/./backend/src/controllers.js","webpack://egg-born-module-a-base-sync/./backend/src/main.js","webpack://egg-born-module-a-base-sync/./backend/src/meta.js","webpack://egg-born-module-a-base-sync/./backend/src/model/atom.js","webpack://egg-born-module-a-base-sync/./backend/src/model/atomAction.js","webpack://egg-born-module-a-base-sync/./backend/src/model/atomClass.js","webpack://egg-born-module-a-base-sync/./backend/src/model/atomLabel.js","webpack://egg-born-module-a-base-sync/./backend/src/model/atomLabelRef.js","webpack://egg-born-module-a-base-sync/./backend/src/model/atomStar.js","webpack://egg-born-module-a-base-sync/./backend/src/model/auth.js","webpack://egg-born-module-a-base-sync/./backend/src/model/authProvider.js","webpack://egg-born-module-a-base-sync/./backend/src/model/category.js","webpack://egg-born-module-a-base-sync/./backend/src/model/comment.js","webpack://egg-born-module-a-base-sync/./backend/src/model/commentHeart.js","webpack://egg-born-module-a-base-sync/./backend/src/model/commentView.js","webpack://egg-born-module-a-base-sync/./backend/src/model/label.js","webpack://egg-born-module-a-base-sync/./backend/src/model/resource.js","webpack://egg-born-module-a-base-sync/./backend/src/model/resourceLocale.js","webpack://egg-born-module-a-base-sync/./backend/src/model/resourceRole.js","webpack://egg-born-module-a-base-sync/./backend/src/model/role.js","webpack://egg-born-module-a-base-sync/./backend/src/model/roleInc.js","webpack://egg-born-module-a-base-sync/./backend/src/model/roleIncRef.js","webpack://egg-born-module-a-base-sync/./backend/src/model/roleRef.js","webpack://egg-born-module-a-base-sync/./backend/src/model/roleRight.js","webpack://egg-born-module-a-base-sync/./backend/src/model/roleRightRef.js","webpack://egg-born-module-a-base-sync/./backend/src/model/tag.js","webpack://egg-born-module-a-base-sync/./backend/src/model/tagRef.js","webpack://egg-born-module-a-base-sync/./backend/src/model/user.js","webpack://egg-born-module-a-base-sync/./backend/src/model/userAgent.js","webpack://egg-born-module-a-base-sync/./backend/src/model/userRole.js","webpack://egg-born-module-a-base-sync/./backend/src/models.js","webpack://egg-born-module-a-base-sync/./backend/src/routes.js","webpack://egg-born-module-a-base-sync/./backend/src/service/atom.js","webpack://egg-born-module-a-base-sync/./backend/src/service/atomAction.js","webpack://egg-born-module-a-base-sync/./backend/src/service/atomClass.js","webpack://egg-born-module-a-base-sync/./backend/src/service/auth.js","webpack://egg-born-module-a-base-sync/./backend/src/service/base.js","webpack://egg-born-module-a-base-sync/./backend/src/service/category.js","webpack://egg-born-module-a-base-sync/./backend/src/service/comment.js","webpack://egg-born-module-a-base-sync/./backend/src/service/jwt.js","webpack://egg-born-module-a-base-sync/./backend/src/service/layoutConfig.js","webpack://egg-born-module-a-base-sync/./backend/src/service/resource.js","webpack://egg-born-module-a-base-sync/./backend/src/service/tag.js","webpack://egg-born-module-a-base-sync/./backend/src/service/user.js","webpack://egg-born-module-a-base-sync/./backend/src/services.js","webpack://egg-born-module-a-base-sync/external \"os\"","webpack://egg-born-module-a-base-sync/external \"path\"","webpack://egg-born-module-a-base-sync/external \"require3\"","webpack://egg-born-module-a-base-sync/webpack/bootstrap","webpack://egg-born-module-a-base-sync/webpack/startup"],"names":[],"mappings":";;;;;;;AAAA;;AAEA;;AAEA,kBAAkB,wBAAwB;AAC1C;AACA,sCAAsC,wBAAwB;AAC9D;AACA;AACA;AACA,OAAO;AACP;AACA,cAAc;AACd;;AAEA,gBAAgB,gCAAgC;AAChD;AACA,qCAAqC,gCAAgC;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,kCAAkC;AACpD;AACA,0BAA0B,kCAAkC;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iBAAiB,8CAA8C;AAC/D;AACA,yBAAyB,8CAA8C;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA,kBAAkB,uBAAuB;AACzC;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA,0BAA0B,uBAAuB;AACjD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;AClFA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,0BAA0B,+CAA+C;AACzE;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;;AAEA;AACA,kBAAkB,qCAAqC;AACvD;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,QAAQ,gBAAgB;AAC/E;AACA;AACA;AACA,kBAAkB,wBAAwB;AAC1C;AACA,OAAO;AACP,aAAa,iBAAiB;AAC9B;AACA;AACA,eAAe,qBAAqB;AACpC;AACA,OAAO;AACP;AACA;AACA;AACA,cAAc;AACd;;AAEA;AACA,gBAAgB,qBAAqB;AACrC,8DAA8D,qBAAqB;AACnF;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,QAAQ,gBAAgB;AAC/E;AACA;AACA;AACA,kBAAkB,gCAAgC;AAClD;AACA,OAAO;AACP;AACA,qCAAqC,OAAO;AAC5C;AACA;AACA;;AAEA;AACA,2BAA2B,oDAAoD;AAC/E;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,sCAAsC,qBAAqB;AAC3D;AACA;;AAEA;AACA,iBAAiB,2BAA2B;AAC5C,gCAAgC,qCAAqC;AACrE;;AAEA;AACA,kBAAkB,wDAAwD;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,4CAA4C;AACpF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,gCAAgC,yBAAyB,QAAQ,gBAAgB;AACjF;AACA;AACA;AACA,oBAAoB,kCAAkC;AACtD;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,yCAAyC,OAAO;AAChD;AACA;AACA;AACA;AACA;;AAEA;AACA,iBAAiB,mCAAmC;AACpD;AACA,8DAA8D,qBAAqB;AACnF;AACA;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,QAAQ,gBAAgB;AAC/E;AACA,wCAAwC;AACxC;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,kBAAkB,yDAAyD;AAC3E;AACA,OAAO;AACP;;AAEA;AACA,sBAAsB,aAAa;AACnC;AACA;AACA,iDAAiD,YAAY;AAC7D;AACA;AACA;AACA;AACA,cAAc;AACd;;AAEA,4BAA4B,YAAY;AACxC;AACA;AACA,eAAe,iBAAiB;AAChC,OAAO;AACP;AACA;AACA,yBAAyB,YAAY;AACrC;AACA;AACA;;AAEA;AACA,kBAAkB,YAAY;AAC9B,8DAA8D,qBAAqB;AACnF;AACA;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,QAAQ,gBAAgB;AAC/E;AACA,8CAA8C,iBAAiB;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA,sBAAsB,uBAAuB;AAC7C;AACA,WAAW;AACX;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA,sBAAsB,kBAAkB,uCAAuC,QAAQ;AACvF;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,sBAAsB,kBAAkB,iDAAiD,QAAQ;AACjG;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA,oBAAoB,kBAAkB,yCAAyC,QAAQ;AACvF;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,oBAAoB,kBAAkB,yCAAyC,QAAQ;AACvF;AACA,SAAS;AACT;AACA;;AAEA,kBAAkB,qBAAqB;AACvC,8DAA8D,qBAAqB;AACnF;AACA;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,QAAQ,gBAAgB;AAC/E;AACA;AACA;AACA,kBAAkB,gCAAgC;AAClD;AACA,OAAO;AACP;;AAEA,yBAAyB,gCAAgC;AACzD;AACA;AACA;AACA;AACA,mBAAmB,4BAA4B;AAC/C;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,iBAAiB,sBAAsB;AACvC,sCAAsC,4BAA4B;AAClE;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,cAAc,WAAW,kBAAkB;AAC3C;;AAEA,sBAAsB,MAAM;AAC5B;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,qBAAqB,YAAY;AACjC,8CAA8C,iBAAiB;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,gBAAgB,SAAS,MAAM;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,kBAAkB,SAAS,OAAO,4BAA4B,EAAE;AAChE;AACA;AACA;AACA;AACA,mBAAmB,qBAAqB;AACxC;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,gBAAgB,SAAS,gBAAgB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,qBAAqB;AACxC,wCAAwC,4BAA4B;AACpE;AACA,SAAS;AACT;AACA;AACA;AACA,oEAAoE,QAAQ;AAC5E;AACA,SAAS;AACT;AACA,gBAAgB,SAAS,gBAAgB;AACzC;AACA;;AAEA,2CAA2C,QAAQ;AACnD;AACA;AACA,iDAAiD,wBAAwB;AACzE;AACA,OAAO;AACP,iDAAiD,yBAAyB;AAC1E;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA,6BAA6B,6BAA6B;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,kBAAkB,YAAY;AAC9B;AACA,8DAA8D,qBAAqB;AACnF;AACA;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,QAAQ,gBAAgB;AAC/E;AACA;AACA;AACA,kBAAkB,uBAAuB;AACzC;AACA,OAAO;AACP;;AAEA,mBAAmB,YAAY;AAC/B;AACA,8DAA8D,qBAAqB;AACnF;AACA;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,QAAQ,gBAAgB;AAC/E;AACA;AACA;AACA,kBAAkB,uBAAuB;AACzC;AACA,OAAO;AACP;;AAEA,iBAAiB,YAAY;AAC7B;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA,OAAO;AACP;AACA,cAAc,SAAS,gBAAgB;AACvC;;AAEA;AACA,iBAAiB,kDAAkD;AACnE;AACA,8DAA8D,wBAAwB;AACtF;AACA;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,QAAQ,gBAAgB;AAC/E;AACA;AACA,4CAA4C,OAAO,wBAAwB,QAAQ;AACnF;AACA;AACA;AACA,qCAAqC,gEAAgE;AACrG;AACA;AACA,gDAAgD,qBAAqB;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,sBAAsB,iBAAiB,GAAG,0BAA0B;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,kBAAkB,iEAAiE;AACnF;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,kBAAkB,uEAAuE;AACzF;AACA,OAAO;AACP;AACA,mCAAmC,uDAAuD;AAC1F;AACA;AACA;;AAEA,4BAA4B,wBAAwB;AACpD;AACA,mCAAmC,8BAA8B;AACjE;AACA;AACA,gBAAgB,6BAA6B;AAC7C,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA,sBAAsB,mCAAmC;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,6CAA6C;AACpF;AACA;AACA,8BAA8B,yBAAyB,QAAQ,gBAAgB;AAC/E;AACA;AACA;AACA,kBAAkB,0CAA0C;AAC5D;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,kBAAkB,0DAA0D;AAC5E;AACA,OAAO;AACP;AACA;AACA;;AAEA,8BAA8B,OAAO;AACrC;AACA;AACA;AACA,mCAAmC,kBAAkB;AACrD;;AAEA;;AAEA,eAAe,SAAS;AACxB,uCAAuC,aAAa;AACpD;;AAEA,gBAAgB,aAAa,aAAa,EAAE;AAC5C;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,gBAAgB,aAAa,WAAW,QAAQ;AAChD;AACA,mCAAmC,qBAAqB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,cAAc;AACd;;AAEA,qBAAqB,aAAa,gBAAgB,QAAQ;AAC1D;AACA;AACA;;AAEA,mBAAmB,aAAa,cAAc,QAAQ;AACtD;AACA;AACA;;AAEA,sBAAsB,aAAa,iBAAiB,QAAQ;AAC5D;AACA;AACA;;AAEA,iBAAiB,gBAAgB;AACjC;AACA;AACA,+CAA+C,QAAQ,aAAa,yBAAyB;AAC7F;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;;AAEA,kBAAkB,aAAa,gBAAgB,QAAQ;AACvD;AACA,mCAAmC,qBAAqB;AACxD;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;;AAEA,kBAAkB,oBAAoB;AACtC,8CAA8C,YAAY;AAC1D;AACA,4CAA4C,mEAAmE;AAC/G;;AAEA,qBAAqB,aAAa,KAAK,EAAE;AACzC,gDAAgD,KAAK;AACrD;AACA,6CAA6C,YAAY;AACzD;;AAEA;;AAEA;AACA,kBAAkB,2CAA2C;AAC7D;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA,iEAAiE,mCAAmC;AACpG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,mBAAmB,mBAAmB;AACtC;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,mCAAmC,kBAAkB;AACrD;;AAEA,gBAAgB,sCAAsC;AACtD;AACA;AACA;AACA;AACA;AACA,4CAA4C,8BAA8B;AAC1E;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,iBAAiB,sBAAsB,8JAA8J,qCAAqC;AAC1O;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA,8BAA8B,QAAQ,KAAK,UAAU;AACrD;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,0BAA0B,QAAQ,KAAK,mBAAmB;AAC1D;AACA,8CAA8C,KAAK;AACnD;AACA;AACA;AACA;AACA,gDAAgD,gDAAgD;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,4BAA4B,QAAQ,KAAK,kCAAkC;AAC3E;AACA,8CAA8C,KAAK;AACnD;AACA;AACA,sDAAsD,wBAAwB;AAC9E;AACA;AACA;AACA;AACA,8BAA8B,yBAAyB,QAAQ,gBAAgB;AAC/E;AACA;AACA;AACA,kBAAkB,yDAAyD;AAC3E;AACA,OAAO;AACP;;AAEA,6BAA6B,uCAAuC;AACpE;AACA;AACA;AACA;AACA,sDAAsD,wBAAwB;AAC9E,+CAA+C,iFAAiF;AAChI,+DAA+D,iBAAiB,GAAG,wBAAwB,GAAG,OAAO;AACrH;AACA,gDAAgD,0CAA0C;AAC1F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,gDAAgD;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C,wBAAwB;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA,kBAAkB,mDAAmD;AACrE;AACA;AACA,KAAK;AACL,+CAA+C,2CAA2C;AAC1F;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,4BAA4B,kBAAkB;AAC9C,8CAA8C,6BAA6B;AAC3E;;AAEA;AACA,kBAAkB,mDAAmD;AACrE;AACA;AACA,KAAK;AACL;AACA,+CAA+C,2CAA2C;AAC1F;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA,mBAAmB,mBAAmB;AACtC;AACA,8DAA8D,qBAAqB;AACnF;AACA;AACA;AACA;AACA;AACA;AACA,6EAA6E;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,QAAQ,iBAAiB,6BAA6B;AACvG;AACA;AACA;AACA;;AAEA;AACA,uBAAuB,aAAa,mDAAmD,QAAQ;AAC/F,+CAA+C,2CAA2C;AAC1F;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA,0BAA0B,kBAAkB;AAC5C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;;AAEA;AACA;;;;;;;;AC5kCA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,eAAe,wBAAwB;AACvC,yBAAyB,KAAK,IAAI;AAClC;AACA;AACA;AACA;AACA;AACA,qBAAqB,wBAAwB;AAC7C;AACA;AACA;AACA;AACA;AACA,sBAAsB,oBAAoB;AAC1C;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,yBAAyB,oBAAoB;AAC7C;AACA,wCAAwC,oBAAoB;AAC5D;AACA,sDAAsD,kBAAkB;AACxE,2CAA2C,yEAAyE;AACpH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACtDA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,sCAAsC,mEAAmE;AACzG;;AAEA;AACA;AACA;AACA,oCAAoC,kCAAkC;AACtE;AACA;AACA;;AAEA,eAAe,mDAAmD;AAClE;AACA,yBAAyB,KAAK,IAAI;AAClC;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,wBAAwB;AAC7C;AACA;AACA;AACA;AACA;AACA,sBAAsB,2CAA2C;AACjE;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,yBAAyB,2CAA2C;AACpE;AACA,wCAAwC,2CAA2C;AACnF;AACA;AACA,iDAAiD,wBAAwB;AACzE,mDAAmD,OAAO,GAAG,cAAc;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,uBAAuB,SAAS;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0BAA0B,SAAS;AACnC,gDAAgD,SAAS;AACzD;AACA;;AAEA,qBAAqB,YAAY;AACjC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,2BAA2B,YAAY;AACvC;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;;AAEA;AACA;;;;;;;;ACtGA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA,UAAU,KAAK,GAAG,QAAQ,GAAG;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,OAAO;AACzC,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA,wCAAwC,wBAAwB;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qCAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,0BAA0B,eAAe,YAAY,mBAAmB,GAAG,aAAa;AACxF,6BAA6B,eAAe,YAAY,mBAAmB,GAAG,aAAa;AAC3F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,cAAc,gBAAgB,mFAAmF,QAAQ,gBAAgB,EAAE,EAAE;AACtJ,SAAS,eAAe,gBAAgB,qFAAqF,QAAQ,gBAAgB,EAAE,EAAE;AACzJ,SAAS,cAAc,mBAAmB,sFAAsF,QAAQ,gBAAgB,EAAE,EAAE;AAC5J,YAAY,eAAe,mBAAmB,uEAAuE,QAAQ,gBAAgB,EAAE,EAAE;AACjJ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,8BAA8B,IAAI,GAAG,mBAAmB,GAAG,aAAa;AACxE;AACA;AACA;AACA;AACA,0CAA0C,mBAAmB,GAAG,aAAa;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,oCAAoC;AACpC;AACA;;AAEA;AACA;AACA,sCAAsC,mBAAmB,GAAG,aAAa;;AAEzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B,gBAAgB,GAAG,mBAAmB,GAAG,aAAa;AAClF;AACA;AACA;AACA;;;;;;;;;ACrOA,aAAa,mBAAO,CAAC,IAAM;AAC3B,iBAAiB,mBAAO,CAAC,IAAU;AACnC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,oCAAoC,cAAc,KAAK,UAAU;AACjE,gBAAgB,OAAO,EAAE,KAAK;AAC9B;;AAEA;AACA;AACA;AACA,gBAAgB,OAAO,EAAE,gBAAgB,GAAG,KAAK;AACjD;;AAEA;AACA;AACA;AACA;AACA;AACA,oFAAoF,iCAAqB;AACzG;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+CAA+C,KAAK;AACpD;;AAEA;AACA,iBAAiB,OAAO;AACxB,oEAAoE,yCAAyC;AAC7G;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAe,wBAAwB;AACvC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,YAAY,oCAAoC;AAChD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,WAAW,GAAG,IAAI;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,wBAAwB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,aAAa,GAAG,aAAa;AACxD;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACnUA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,eAAe,wBAAwB;AACvC,qDAAqD,iBAAiB;AACtE;AACA;AACA;AACA;AACA;;AAEA,gBAAgB,mBAAmB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,iBAAiB,gEAAgE;AACjF,kCAAkC,0EAA0E;AAC5G;;AAEA,iBAAiB,yFAAyF;AAC1G,wCAAwC,yFAAyF;AACjI;AACA;;AAEA,oBAAoB,oGAAoG;AACxH;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAe,kBAAkB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA,kBAAkB,aAAa;AAC/B;AACA,yDAAyD,6BAA6B;AACtF;AACA;AACA,4CAA4C,aAAa;AACzD;;AAEA;AACA,qDAAqD,iBAAiB;AACtE;AACA;;AAEA;AACA,uCAAuC,iBAAiB;AACxD;AACA;AACA;;AAEA,gBAAgB,+BAA+B;AAC/C;AACA,qDAAqD,iBAAiB;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,4CAA4C,aAAa;AACzD;AACA;AACA;AACA,OAAO;AACP;;AAEA,gBAAgB,2EAA2E;AAC3F;AACA,uCAAuC,2EAA2E;AAClH;;AAEA,yBAAyB,2EAA2E;AACpG,wCAAwC,2EAA2E;AACnH;AACA;AACA;AACA,oDAAoD,oFAAoF;AACxI;AACA;AACA;AACA;;AAEA,uBAAuB,wBAAwB;AAC/C,sCAAsC,wBAAwB;AAC9D;;AAEA,wBAAwB,wBAAwB;AAChD;AACA,uCAAuC,wBAAwB;AAC/D;AACA;AACA,sCAAsC,mDAAmD;AACzF;;AAEA;AACA,6BAA6B,yEAAyE;AACtG;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,mCAAmC,aAAa;AAChD;AACA;AACA;AACA;AACA;;AAEA,qBAAqB,sDAAsD;AAC3E;AACA;AACA;AACA,qBAAqB,wBAAwB,qBAAqB,aAAa;AAC/E;AACA;AACA;AACA;AACA;AACA,sBAAsB,sDAAsD;AAC5E;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,yBAAyB,sDAAsD;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA;AACA;AACA;;;;;;;;ACpOA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,iBAAiB,gBAAgB;AACjC,gCAAgC,0BAA0B;AAC1D;;AAEA;AACA;AACA,kBAAkB,sBAAsB,2GAA2G,sCAAsC;AACzL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA,gBAAgB,qBAAqB;AACrC,+BAA+B,cAAc;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,qBAAqB;AAC5D;;AAEA,sBAAsB,mBAAmB;AACzC;AACA,6CAA6C,SAAS;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA,iCAAiC,SAAS;AAC1C;AACA;;AAEA,wBAAwB,SAAS;AACjC,0DAA0D,SAAS;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA,iCAAiC,SAAS;AAC1C;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA,iBAAiB,uBAAuB;AACxC;AACA;AACA,mDAAmD,sBAAsB;AACzE;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;;AAEA,8BAA8B,sCAAsC;AACpE;AACA,wDAAwD,+CAA+C;AACvG;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,yBAAyB,kBAAkB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,2BAA2B,gCAAgC;AAC3D;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA,8BAA8B,KAAK;AACnC,2CAA2C,KAAK;AAChD;;AAEA;;AAEA;AACA,aAAa,wCAAwC;AACrD;AACA,mCAAmC,wBAAwB;AAC3D;AACA;AACA;AACA;AACA,qDAAqD,kCAAkC;AACvF;AACA;AACA,0CAA0C,kCAAkC;AAC5E;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;;AAEA;AACA,6BAA6B,qBAAqB;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;;AAEA;AACA,8BAA8B,qBAAqB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;;AAEA;AACA,mCAAmC,qBAAqB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;;AAEA;AACA;;AAEA;;AAEA;AACA;;;;;;;;AC3QA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,yBAAyB,WAAW;AACpC;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA,eAAe,yFAAyF;AACxG;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,gBAAgB,uBAAuB;AACvC;AACA,mCAAmC,aAAa;AAChD;AACA;AACA;AACA;AACA,+BAA+B,2BAA2B;;AAE1D;AACA;AACA;;AAEA;AACA;AACA;;AAEA,kBAAkB,wBAAwB;AAC1C;AACA,mCAAmC,aAAa;AAChD;AACA;;AAEA;AACA;AACA;AACA;AACA,8CAA8C,SAAS;AACvD;AACA;;AAEA;AACA,sCAAsC,SAAS;AAC/C,sCAAsC,oBAAoB;;AAE1D;AACA,uCAAuC,SAAS;;AAEhD;AACA,wCAAwC,SAAS;AACjD,2CAA2C,SAAS;;AAEpD;AACA,+BAA+B,aAAa;;AAE5C;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,4CAA4C,sBAAsB;AAClE;AACA;AACA;AACA,OAAO;AACP;;AAEA,0BAA0B,2BAA2B;AACrD;AACA;AACA;AACA,+CAA+C,kBAAkB;AACjE,uBAAuB;AACvB;AACA;AACA;;AAEA;AACA,yBAAyB,wCAAwC;AACjE;AACA;AACA;AACA;AACA,iCAAiC,sBAAsB;AACvD,SAAS;AACT;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,+BAA+B,aAAa;AAC5C;AACA;AACA;AACA;AACA;;AAEA,qBAAqB,yBAAyB;AAC9C;AACA;AACA,qBAAqB,wBAAwB;AAC7C;AACA;AACA;AACA;AACA;AACA,sBAAsB,yBAAyB;AAC/C;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,yBAAyB,yBAAyB;AAClD;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,6BAA6B,yBAAyB;AACtD;;AAEA;AACA,sBAAsB,oBAAoB;AAC1C;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,yBAAyB,KAAK;AAC9B,sCAAsC,KAAK;;AAE3C;AACA;AACA;;AAEA;AACA,uBAAuB,iBAAiB;AACxC;AACA;AACA,OAAO;AACP;AACA;;AAEA,0BAA0B,qBAAqB;AAC/C;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,uCAAuC,KAAK;AAC5C;;AAEA,8BAA8B,SAAS;AACvC,uCAAuC,SAAS;AAChD;;AAEA;AACA,wBAAwB,qCAAqC;AAC7D;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,qCAAqC,4BAA4B;;AAEjE;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;;AAEA;AACA,2BAA2B,KAAK;AAChC,wCAAwC,KAAK;AAC7C,2CAA2C,kBAAkB;AAC7D;;AAEA;AACA,iBAAiB,mBAAmB;AACpC,wCAAwC,gCAAgC;AACxE;AACA;;AAEA;AACA,oBAAoB,yBAAyB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB,gBAAgB,qCAAqC,EAAE;AACvE,mCAAmC,aAAa;AAChD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,oBAAoB,eAAe;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;;AAEA;AACA,sBAAsB,eAAe;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA,kDAAkD,QAAQ;AAC1D;AACA;AACA;;AAEA;AACA,uBAAuB,eAAe;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA,kDAAkD,QAAQ;AAC1D;AACA;AACA;;AAEA;AACA,4BAA4B,eAAe;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA,kDAAkD,QAAQ;AAC1D;AACA;AACA;;AAEA,uBAAuB,QAAQ;AAC/B;AACA;AACA;AACA,2CAA2C,gBAAgB;AAC3D;AACA;;AAEA,8BAA8B,SAAS;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,8BAA8B,SAAS;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,8BAA8B,SAAS;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,iBAAiB;AAC7C;AACA;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,iBAAiB;AAC7C;AACA;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,iBAAiB;AAC7C;AACA;AACA;AACA;AACA;AACA;;AAEA,6BAA6B,wCAAwC;AACrE;AACA;AACA;AACA,oCAAoC,mBAAmB;AACvD;AACA;AACA;AACA;AACA;AACA,0DAA0D,4BAA4B;AACtF;AACA;AACA,iBAAiB,OAAO;AACxB;AACA,4CAA4C,UAAU;AACtD;AACA,cAAc;AACd;AACA;AACA;;AAEA,6BAA6B,wCAAwC;AACrE;AACA;AACA;AACA,oCAAoC,mBAAmB;AACvD;AACA;AACA;AACA;AACA;AACA,0DAA0D,4BAA4B;AACtF;AACA;AACA,iBAAiB,OAAO;AACxB;AACA,4CAA4C,UAAU;AACtD;AACA,cAAc;AACd;AACA;AACA;;AAEA,6BAA6B,wCAAwC;AACrE;AACA;AACA;AACA,oCAAoC,mBAAmB;AACvD;AACA;AACA;AACA;AACA;AACA,0DAA0D,4BAA4B;AACtF;AACA;AACA,iBAAiB,OAAO;AACxB;AACA,4CAA4C,UAAU;AACtD;AACA,cAAc;AACd;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,UAAU;AACzB,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA;AACA;AACA,sCAAsC,MAAM;AAC5C;AACA,mCAAmC,uBAAuB;AAC1D;AACA;AACA;AACA;AACA,wCAAwC,aAAa;AACrD;AACA,OAAO;AACP;AACA;AACA,yCAAyC,mCAAmC;AAC5E;AACA;AACA;AACA;;AAEA;AACA,UAAU,2CAA2C;AACrD,UAAU,yDAAyD;AACnE,UAAU,0DAA0D;AACpE,UAAU,sEAAsE;AAChF,UAAU,yEAAyE;AACnF,UAAU,0EAA0E;AACpF,UAAU,4EAA4E;AACtF,UAAU,gEAAgE;AAC1E;AACA,6BAA6B,2DAA2D;AACxF;AACA;AACA;AACA;AACA,sDAAsD,2CAA2C;AACjG;AACA;AACA;AACA;AACA,qCAAqC,+BAA+B;AACpE;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,8CAA8C,sBAAsB;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,cAAc,GAAG,iBAAiB;AACnG;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA,6BAA6B,MAAM;AACnC,uEAAuE,IAAI;AAC3E,6EAA6E,IAAI;AACjF,6EAA6E,IAAI;AACjF;;AAEA,0BAA0B,oBAAoB;AAC9C;AACA,qEAAqE,IAAI,sBAAsB,aAAa;AAC5G;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,cAAc;AAChD,qCAAqC,cAAc;AACnD,qCAAqC,cAAc;AACnD;AACA;AACA,qCAAqC,4BAA4B;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;;AAEA,yBAAyB,cAAc;AACvC;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,IAAI,GAAG,OAAO,GAAG,aAAa,GAAG,MAAM;AAC7D;AACA;AACA;AACA,4DAA4D,IAAI,YAAY,aAAa;AACzF;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,cAAc;AAC1C;AACA;AACA,qBAAqB,IAAI,GAAG,OAAO;AACnC,4BAA4B,IAAI,sEAAsE,IAAI,gBAAgB,OAAO;AACjI;AACA;;AAEA,4BAA4B,cAAc;AAC1C;AACA;AACA;AACA,4BAA4B,IAAI,gBAAgB;AAChD;AACA;AACA;AACA;AACA,4BAA4B,IAAI,gBAAgB;AAChD;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACvrBA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,eAAe,QAAQ;AACvB,sCAAsC,YAAY;AAClD;;AAEA,gBAAgB,+BAA+B;AAC/C;AACA;AACA;AACA,SAAS;AACT;AACA,oCAAoC,qBAAqB;AACzD;AACA;;AAEA,gBAAgB,qBAAqB;AACrC;AACA;AACA;AACA;AACA;;AAEA,eAAe,kBAAkB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,gBAAgB,cAAc;AAC9B;AACA;AACA;AACA,OAAO;AACP;;AAEA,kBAAkB,QAAQ;AAC1B;AACA,kDAAkD,QAAQ;AAC1D;;AAEA;AACA,kCAAkC,YAAY;AAC9C;;AAEA,yBAAyB,mBAAmB;AAC5C;AACA;AACA;AACA;AACA;AACA,gCAAgC,SAAS;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;;AAEA,yBAAyB,SAAS;AAClC;AACA;AACA,OAAO;AACP;;AAEA,2BAA2B,mBAAmB;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,QAAQ;AAC/D;AACA,oCAAoC,0BAA0B;AAC9D;AACA;;AAEA,yBAAyB,QAAQ;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qBAAqB,8CAA8C;AACnE;AACA;AACA;AACA,qCAAqC,yCAAyC;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA,qBAAqB,+BAA+B;AACpD;AACA;AACA;AACA,qBAAqB,wBAAwB,gBAAgB,aAAa;AAC1E;AACA;AACA;AACA;AACA;AACA,sBAAsB,+BAA+B;AACrD;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,yBAAyB,+BAA+B;AACxD;AACA,mCAAmC,+BAA+B;AAClE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA;AACA;AACA;;;;;;;;ACtLA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,uCAAuC,eAAe;AACtD;AACA;AACA;AACA;AACA;AACA,qCAAqC,4BAA4B;AACjE;AACA,sDAAsD,wBAAwB;AAC9E,uCAAuC,0BAA0B;AACjE;AACA,uCAAuC,aAAa;AACpD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uDAAuD,gBAAgB;AACvE;AACA;AACA;AACA,oDAAoD,wBAAwB;AAC5E;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,uCAAuC,qBAAqB;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,yBAAyB;AACnE;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,wBAAwB,OAAO;AAC/B;AACA;AACA,uBAAuB,OAAO;AAC9B;AACA;AACA;AACA,0CAA0C,kBAAkB;AAC5D;AACA;;AAEA,4BAA4B,SAAS;AACrC;AACA;AACA;AACA;AACA,8CAA8C,WAAW;AACzD,yCAAyC,0BAA0B;AACnE;AACA;;AAEA,iCAAiC,SAAS;AAC1C;AACA,mCAAmC,aAAa;AAChD;AACA;AACA;AACA;AACA;AACA,kEAAkE,SAAS;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oEAAoE,yBAAyB;AAC7F,8CAA8C,oCAAoC;AAClF;AACA;AACA,mEAAmE,gDAAgD;AACnH;AACA;AACA,6CAA6C,0BAA0B;AACvE;AACA;AACA;AACA;AACA;AACA,eAAe,2BAA2B;AAC1C,OAAO;AACP;;AAEA,kBAAkB,0BAA0B;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,uCAAuC,0BAA0B;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;AAEA,gBAAgB,OAAO;AACvB;AACA;AACA;AACA;;AAEA,iBAAiB,SAAS;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB,SAAS;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB,sBAAsB;AAC1C;AACA;AACA;AACA,OAAO;AACP;;AAEA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA,OAAO;AACP;;AAEA,uBAAuB,cAAc;AACrC;AACA,oCAAoC,kBAAkB;AACtD,qBAAqB;AACrB;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA,qCAAqC,uCAAuC;AAC5E;;AAEA,qBAAqB,gBAAgB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,2BAA2B,uBAAuB;AAClD,2CAA2C,gBAAgB;AAC3D,yDAAyD,MAAM,GAAG,KAAK;AACvE;;AAEA,gBAAgB,gDAAgD;AAChE;AACA,iDAAiD,0BAA0B;AAC3E,mDAAmD,yBAAyB;AAC5E,0DAA0D,UAAU,sBAAsB,UAAU,oBAAoB,UAAU;AAClI,0EAA0E,6BAA6B;AACvG;AACA;AACA,iDAAiD,4BAA4B;AAC7E;AACA;AACA,iBAAiB,OAAO;AACxB,YAAY;AACZ;AACA,oBAAoB;AACpB,oBAAoB;AACpB,oBAAoB;AACpB,cAAc;AACd;AACA;AACA;;AAEA,iBAAiB,UAAU;AAC3B,gCAAgC,oBAAoB;AACpD;;AAEA,kBAAkB,uCAAuC;AACzD,+BAA+B,4BAA4B;AAC3D;;AAEA,iBAAiB,WAAW,qCAAqC,+BAA+B;AAChG;AACA;AACA,iDAAiD,4BAA4B;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,mBAAmB,mBAAmB;AACtC,+BAA+B,uBAAuB;AACtD;;AAEA,kBAAkB,SAAS;AAC3B,8CAA8C,SAAS;AACvD,mCAAmC,SAAS;AAC5C,+BAA+B,aAAa;AAC5C;;AAEA;AACA,iBAAiB,eAAe;AAChC;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;;AAEA;AACA,kBAAkB,+BAA+B;AACjD;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,iCAAiC,yCAAyC;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,2CAA2C;AAClF;AACA;AACA,2CAA2C,iBAAiB;AAC5D;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,2CAA2C;AACpF,WAAW;AACX;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,uCAAuC,iBAAiB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,uCAAuC,aAAa;AACpD;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA,oEAAoE,0BAA0B;AAC9F,OAAO;;AAEP;AACA;AACA;;AAEA,4BAA4B,uBAAuB;AACnD;AACA;AACA,0EAA0E,uBAAuB;AACjG,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yFAAyF,YAAY;AACrG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,iBAAiB;AAChD;;AAEA,2BAA2B,SAAS;AACpC;AACA;AACA;AACA,sCAAsC,yBAAyB;AAC/D,OAAO;AACP,+DAA+D,yBAAyB;AACxF;AACA;AACA;;AAEA,0BAA0B,oBAAoB;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,yBAAyB;AACvE;AACA;AACA;AACA;AACA,iCAAiC,IAAI;AACrC;AACA;AACA;AACA;AACA,+BAA+B,eAAe;AAC9C,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,kBAAkB,0CAA0C;AAC5D;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,SAAS;AAC5C;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,aAAa;AAC5C;AACA;AACA;;AAEA;AACA;AACA,gBAAgB,aAAa;AAC7B;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,uBAAuB,OAAO;AAC9B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,kBAAkB;AACzD;AACA;AACA;AACA,qBAAqB,MAAM,IAAI,SAAS;AACxC;AACA,OAAO;AACP,uCAAuC,kBAAkB;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,2BAA2B,2CAA2C;AACtE;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,wBAAwB;AAC7C;AACA;AACA;AACA;AACA;AACA,sBAAsB,uBAAuB;AAC7C;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,qCAAqC,uBAAuB;AAC5D;AACA,oDAAoD,uBAAuB;AAC3E;AACA;AACA;AACA,6CAA6C,OAAO,GAAG,aAAa;AACpE,yDAAyD,OAAO,GAAG,aAAa;AAChF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACjtBA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,yBAAyB,WAAW,IAAI;AACxC;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yBAAyB,IAAI,IAAI,IAAI;AACrC;AACA;;AAEA;AACA;AACA,uBAAuB,IAAI,IAAI,IAAI;AACnC;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,gDAAgD,WAAW;AAC3D;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB,eAAe,GAAG,IAAI;AACvC;;AAEA;;AAEA;AACA;;;;;;;;AC9EA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACXA;AACA;;AAEA,iBAAiB,oJAAoJ;AACrK;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,wCAAwC,oHAAoH;AAC5J;AACA,uDAAuD,sHAAsH;AAC7K;AACA,gCAAgC,oJAAoJ;AACpL;;AAEA,wBAAwB,oHAAoH;AAC5I;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gCAAgC,MAAM;AACtC;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA,kDAAkD,SAAS;AAC3D,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA,kCAAkC,IAAI,eAAe,IAAI;AACzD,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,IAAI,gBAAgB,UAAU;AACjE,OAAO;AACP;AACA;AACA;AACA,4EAA4E,IAAI,oCAAoC,UAAU;;AAE9H;AACA;AACA;AACA,oCAAoC,IAAI,gBAAgB,UAAU,iBAAiB,MAAM;AACzF,OAAO;AACP;AACA;AACA;AACA,gFAAgF,IAAI,oCAAoC,UAAU;;AAElI;AACA;AACA;AACA;AACA,qEAAqE,IAAI,uCAAuC,UAAU;;AAE1H;AACA,sCAAsC,IAAI;AAC1C,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mCAAmC,IAAI;AACvC,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,UAAU;AAC7C,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,WAAW,GAAG,YAAY,GAAG,cAAc,GAAG,WAAW;AAC3E;;AAEA;AACA;AACA,kBAAkB,cAAc;AAChC;AACA;AACA;AACA;AACA,cAAc;AACd,cAAc;AACd,cAAc;AACd,cAAc;AACd,cAAc;AACd,cAAc;;AAEd,YAAY;AACZ;AACA,qCAAqC,IAAI,mBAAmB,MAAM,0CAA0C;AAC5G;AACA,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf;;AAEA,YAAY;AACZ,YAAY;AACZ;;AAEA;AACA;AACA;;AAEA,oBAAoB,sHAAsH;AAC1I;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,gCAAgC,MAAM;AACtC;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA,kDAAkD,SAAS;AAC3D,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA,kCAAkC,IAAI,eAAe,IAAI;AACzD,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sCAAsC,IAAI;AAC1C,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mCAAmC,IAAI;AACvC,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,UAAU;AAC7C,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,cAAc,GAAG,WAAW,GAAG,eAAe;AAChE;;AAEA;AACA;AACA,kBAAkB,cAAc;AAChC;AACA;AACA;AACA;AACA,cAAc;AACd,cAAc;AACd,cAAc;AACd,cAAc;AACd,cAAc;;AAEd,YAAY;AACZ;AACA,qCAAqC,IAAI,mBAAmB;AAC5D,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf;;AAEA,YAAY;AACZ,YAAY;AACZ;;AAEA;AACA;AACA;;AAEA,kBAAkB,oJAAoJ;AACtK;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,gCAAgC,MAAM;AACtC;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA,kDAAkD,SAAS;AAC3D,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA,kCAAkC,IAAI,eAAe,IAAI;AACzD,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,IAAI,gBAAgB,UAAU;AACjE,OAAO;AACP;AACA;AACA;AACA,4EAA4E,IAAI,oCAAoC,UAAU;;AAE9H;AACA;AACA;AACA,oCAAoC,IAAI,gBAAgB,UAAU,iBAAiB,MAAM;AACzF,OAAO;AACP;AACA;AACA;AACA,gFAAgF,IAAI,oCAAoC,UAAU;;AAElI;AACA;AACA;AACA;AACA,qEAAqE,IAAI,uCAAuC,UAAU;;AAE1H;AACA,sCAAsC,IAAI;AAC1C,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mCAAmC,IAAI;AACvC,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,UAAU;AAC7C,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,WAAW,GAAG,YAAY,GAAG,cAAc,GAAG,WAAW,GAAG,eAAe;AAC7F;;AAEA;AACA;AACA;AACA;AACA,6BAA6B,UAAU,8EAA8E,IAAI,gFAAgF,UAAU;AACnN;AACA,OAAO;AACP;AACA;AACA,gFAAgF,IAAI,6CAA6C;AACjI;AACA;AACA,OAAO;AACP;AACA;AACA,wEAAwE,IAAI,oDAAoD;AAChI;AACA;AACA;;AAEA;AACA;AACA,kBAAkB,cAAc;AAChC;AACA;AACA;AACA;AACA,cAAc;AACd,cAAc;AACd,cAAc;AACd,cAAc;AACd,cAAc;AACd,cAAc;AACd,cAAc;;AAEd,YAAY;AACZ;AACA,qCAAqC,IAAI,mBAAmB;AAC5D,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf,eAAe;AACf,qBAAqB,YAAY;AACjC;;AAEA,YAAY;AACZ,YAAY;AACZ;;AAEA;AACA;AACA;;AAEA,aAAa,8DAA8D;AAC3E;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,0DAA0D,IAAI,kCAAkC,UAAU;AAC1G,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA,6DAA6D,IAAI,kCAAkC,UAAU;AAC7G,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,UAAU;AAC7C,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB,kBAAkB;AAClB,kBAAkB;AAClB;;AAEA;AACA;AACA;AACA;AACA,cAAc;AACd,cAAc;;AAEd,uBAAuB;AACvB,wCAAwC;AACxC,cAAc;AACd;;AAEA;AACA;AACA;;AAEA,wBAAwB,yBAAyB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,IAAI,YAAY;AACvD;AACA;AACA;AACA,kFAAkF,IAAI,oDAAoD;AAC1I;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,oBAAoB,yBAAyB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,IAAI,YAAY;AACzD;AACA;AACA;AACA,wFAAwF,IAAI,oDAAoD;AAChJ;AACA;AACA,sCAAsC,UAAU,8EAA8E,IAAI,gFAAgF,UAAU;AAC5N;AACA;AACA;AACA;AACA;;AAEA,sBAAsB,iCAAiC;AACvD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sCAAsC,IAAI,YAAY;AACtD;AACA;AACA,sFAAsF,IAAI,kCAAkC,OAAO,mBAAmB,UAAU;AAChK,qCAAqC,UAAU,8EAA8E,IAAI,gDAAgD,OAAO,iCAAiC,UAAU;AACnO;AACA;AACA;AACA;AACA;;AAEA,0BAA0B,sCAAsC;AAChE;AACA;AACA;AACA;AACA;;AAEA,kDAAkD,OAAO;AACzD;AACA;AACA,4EAA4E,IAAI,uEAAuE;AACvJ;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,IAAI,kCAAkC,YAAY,GAAG,aAAa,GAAG;AACjG;AACA;AACA;;AAEA,0BAA0B,2CAA2C;AACrE;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,4EAA4E,IAAI,yDAAyD,UAAU,gBAAgB;AACnK;AACA;AACA;AACA;AACA;AACA,0BAA0B,IAAI,YAAY,YAAY,GAAG;AACzD;AACA;AACA;;;AAGA,wBAAwB,iCAAiC;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,IAAI,mEAAmE;AACjG;AACA,2FAA2F,IAAI,wBAAwB,eAAe,mBAAmB,UAAU;AACnK;AACA;AACA;AACA;;AAEA,2BAA2B,cAAc;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,IAAI;AAC9B;AACA;AACA,gCAAgC,IAAI,gBAAgB,OAAO;AAC3D;AACA;AACA;AACA;AACA;;AAEA,iBAAiB,0CAA0C;AAC3D;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,gCAAgC,MAAM;AACtC;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA,kBAAkB,cAAc;AAChC,YAAY;AACZ;AACA,qCAAqC;AACrC;;AAEA,YAAY;AACZ,YAAY;AACZ;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,6BAA6B,oDAAoD;AACjF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,+BAA+B,MAAM;AACrC;AACA;;AAEA;AACA;AACA;AACA;AACA,kCAAkC,IAAI,gBAAgB,UAAU;AAChE,MAAM;AACN;AACA,+DAA+D,IAAI,sCAAsC,UAAU;AACnH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oCAAoC,IAAI,gBAAgB,OAAO;AAC/D,MAAM;AACN;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,qBAAqB;AACrB;;AAEA;AACA;AACA,kBAAkB;AAClB,kBAAkB;;AAElB,kBAAkB;;AAElB;AACA,2CAA2C;AAC3C,qBAAqB;AACrB,qBAAqB;AACrB;AACA;AACA;AACA;AACA,kGAAkG,IAAI,yCAAyC;AAC/I;AACA;AACA;;AAEA,iBAAiB;AACjB,iBAAiB;AACjB;;AAEA;AACA;AACA;;AAEA,gCAAgC,6BAA6B;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,IAAI,YAAY;AAC7D;AACA,8FAA8F,IAAI,oBAAoB,WAAW,mBAAmB,UAAU;AAC9J;AACA;AACA;AACA;;;;;;;;ACt9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACVA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA,yCAAyC;;AAEzC;AACA;AACA;AACA,oBAAoB,UAAU,UAAU,KAAK;AAC7C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC/CA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,iBAAiB,IAAI;AACrB,IAAI;AACJ;AACA;AACA;AACA;AACA,iBAAiB,IAAI;AACrB,IAAI;AACJ;AACA;AACA;AACA;AACA,iBAAiB,IAAI;AACrB,IAAI;AACJ;AACA;AACA;AACA,eAAe,IAAI;AACnB,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,kCAAkC;AAC/C;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA,aAAa,kCAAkC;AAC/C;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,yBAAyB,+CAA+C,GAAG,aAAa;AACxF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;;;;;;ACxJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;;;;;;;ACvBA;AACA;;AAEA;AACA,aAAa,UAAU;AACvB;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACXA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACVA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACVA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;;ACfA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA,wCAAwC,8BAA8B;AACtE;AACA;AACA;AACA;;AAEA,2BAA2B,8BAA8B;AACzD;AACA;AACA,+BAA+B,WAAW,GAAG,mBAAmB;AAChE;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,2CAA2C,OAAO,sBAAsB,EAAE;AAC1E,SAAS;AACT;AACA;AACA,2CAA2C,+CAA+C;AAC1F,wCAAwC,4EAA4E;AACpH;AACA;AACA,OAAO;AACP;AACA;AACA,yCAAyC,8CAA8C;AACvF,+CAA+C,kBAAkB;AACjE,wCAAwC,oCAAoC;AAC5E;AACA;AACA;;AAEA,6BAA6B,gBAAgB;AAC7C;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA,uBAAuB,wCAAwC;AAC/D;AACA;AACA;AACA;AACA,0BAA0B,WAAW,GAAG,mBAAmB;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D,WAAW;AACxE;AACA;AACA;AACA,wEAAwE,gCAAgC;AACxG;AACA;AACA;AACA;AACA;;AAEA,2BAA2B,6CAA6C;AACxE;AACA;AACA,qBAAqB,wBAAwB,uBAAuB,mBAAmB;AACvF;AACA;AACA;AACA;AACA,6BAA6B,wBAAwB;AACrD,sBAAsB,6CAA6C;AACnE;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,+BAA+B,oBAAoB;AACnD;AACA,2DAA2D,kBAAkB;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,mCAAmC,QAAQ;AAC3C,OAAO;AACP;AACA;AACA;AACA,kBAAkB,mBAAmB;AACrC,eAAe,QAAQ;AACvB,OAAO;AACP;;AAEA,qBAAqB,kBAAkB;AACvC;AACA;AACA,qBAAqB,wBAAwB,uBAAuB,mBAAmB;AACvF;AACA;AACA;AACA;AACA,6BAA6B,wBAAwB;AACrD,sBAAsB,kBAAkB;AACxC;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,yBAAyB,kBAAkB;AAC3C;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,QAAQ;AACvB,OAAO;AACP;AACA;AACA,mCAAmC,QAAQ;AAC3C,OAAO;AACP;AACA;AACA;AACA,kBAAkB,mBAAmB;AACrC,eAAe,QAAQ;AACvB,OAAO;AACP;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACzMA;AACA;;AAEA;AACA,qCAAqC,gCAAgC;AACrE;;AAEA;;AAEA;AACA;;;;;;;;ACVA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,qBAAqB;AAChE,OAAO;AACP;AACA;AACA;AACA;AACA,eAAe,iEAAiE;AAChF;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;;;;;;;;AC/BA;AACA;AACA;;AAEA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACnBA;AACA;AACA;;AAEA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACjBA,yBAAyB,mBAAO,CAAC,IAAsB;AACvD,yBAAyB,mBAAO,CAAC,IAAsB;AACvD,yBAAyB,mBAAO,CAAC,IAAsB;AACvD,yBAAyB,mBAAO,CAAC,IAAsB;AACvD,yBAAyB,mBAAO,CAAC,IAAsB;AACvD,yBAAyB,mBAAO,CAAC,IAAsB;AACvD,yBAAyB,mBAAO,CAAC,IAAsB;AACvD,0BAA0B,mBAAO,CAAC,IAAuB;AACzD,uBAAuB,mBAAO,CAAC,IAAoB;AACnD,uBAAuB,mBAAO,CAAC,IAAoB;AACnD,uBAAuB,mBAAO,CAAC,IAAoB;AACnD,uBAAuB,mBAAO,CAAC,IAAoB;AACnD,uBAAuB,mBAAO,CAAC,IAAoB;AACnD,uBAAuB,mBAAO,CAAC,IAAoB;;AAEnD;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;AClGA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;AACA,iBAAiB,mBAAO,CAAC,IAAgB;;AAEzC;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,wCAAwC,0DAA0D;AAClG;AACA;;AAEA;AACA;AACA;AACA,sCAAsC;AACtC;AACA;AACA;AACA;AACA;AACA,eAAe,2BAA2B;AAC1C,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;;AAEA;AACA;;;;;;;;AC5DA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACVA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,wDAAwD,0BAA0B;AAClF;AACA;AACA,gEAAgE,8BAA8B;AAC9F;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,qEAAqE,wBAAwB;AAC7F,4CAA4C,8CAA8C;AAC1F;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;;;;;;;AC9CA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACVA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACVA;;AAEA;;AAEA;AACA;AACA;AACA,SAAS,uCAAuC;AAChD,SAAS,oDAAoD;AAC7D,SAAS,8DAA8D;AACvE,SAAS,qDAAqD;AAC9D,SAAS,+DAA+D;AACxE,SAAS,sDAAsD;AAC/D,SAAS,gEAAgE;AACzE,SAAS,qDAAqD;AAC9D,SAAS,+DAA+D;AACxE,SAAS,sDAAsD;AAC/D,SAAS,gEAAgE;AACzE,SAAS,uDAAuD;AAChE,SAAS,iEAAiE;AAC1E,SAAS,yDAAyD;AAClE,SAAS,mEAAmE;AAC5E,SAAS,2CAA2C;AACpD,SAAS,2CAA2C;AACpD;AACA,6CAA6C,wCAAwC;;AAErF;;AAEA;;AAEA;AACA;;;;;;;;AChCA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;;AAEA;AACA,GAAG,kCAAkC;AACrC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;AC5DA,oBAAoB,mBAAO,CAAC,GAAkB;;AAE9C;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;;;;;;;AC7CA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;AC7WA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;AC9BA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;AC5BA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;;;;;;;ACxEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;;;;;;;ACpBA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,sDAAsD,UAAU,EAAE;AAClE;AACA;AACA;AACA;AACA,2BAA2B,wBAAwB;AACnD;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,mBAAmB,GAAG,iBAAiB;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,oBAAoB,kBAAkB;AACtC,eAAe,aAAa;AAC5B,OAAO;AACP;AACA;AACA;;;AAGA;;AAEA;AACA;;;;;;;;ACnHA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACzPA,uBAAuB,mBAAO,CAAC,IAA2B;AAC1D,qBAAqB,mBAAO,CAAC,IAAyB;AACtD,uBAAuB,mBAAO,CAAC,IAA2B;AAC1D,qCAAqC,mBAAO,CAAC,GAAyC;AACtF,sBAAsB,mBAAO,CAAC,IAA0B;AACxD,uBAAuB,mBAAO,CAAC,GAA2B;AAC1D,gCAAgC,mBAAO,CAAC,IAAoC;AAC5E,oCAAoC,mBAAO,CAAC,IAAwC;AACpF,6BAA6B,mBAAO,CAAC,IAAiC;AACtE,+BAA+B,mBAAO,CAAC,IAAmC;AAC1E,oCAAoC,mBAAO,CAAC,IAAwC;AACpF,wBAAwB,mBAAO,CAAC,IAA4B;AAC5D,uBAAuB,mBAAO,CAAC,IAA2B;AAC1D,8BAA8B,mBAAO,CAAC,IAAkC;AACxE,uBAAuB,mBAAO,CAAC,IAA2B;AAC1D,uBAAuB,mBAAO,CAAC,IAA2B;AAC1D,wBAAwB,mBAAO,CAAC,IAA4B;AAC5D,wBAAwB,mBAAO,CAAC,IAA4B;AAC5D,0BAA0B,mBAAO,CAAC,IAA8B;AAChE,iBAAiB,mBAAO,CAAC,IAAqB;AAC9C,uBAAuB,mBAAO,CAAC,IAA2B;AAC1D,sBAAsB,mBAAO,CAAC,IAA0B;AACxD,iBAAiB,mBAAO,CAAC,GAAqB;AAC9C,iBAAiB,mBAAO,CAAC,IAAqB;AAC9C,qBAAqB,mBAAO,CAAC,IAAyB;AACtD,iBAAiB,mBAAO,CAAC,IAAqB;AAC9C,iBAAiB,mBAAO,CAAC,IAAqB;AAC9C,iBAAiB,mBAAO,CAAC,IAAqB;AAC9C,qBAAqB,mBAAO,CAAC,EAAyB;AACtD,gBAAgB,mBAAO,CAAC,IAAoB;AAC5C,mBAAmB,mBAAO,CAAC,IAAuB;AAClD,oBAAoB,mBAAO,CAAC,IAAwB;;AAEpD;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACzLA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,kBAAkB,wBAAwB;AAC1C;AACA;AACA;AACA;AACA;AACA,2BAA2B,uBAAuB,GAAG,QAAQ;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,8BAA8B;AAClF,cAAc;AACd;;AAEA,gBAAgB,gCAAgC;AAChD;AACA,4CAA4C,8CAA8C;AAC1F;;AAEA,qBAAqB,mCAAmC;AACxD;AACA;;AAEA,kBAAkB,uBAAuB;AACzC;AACA;AACA;AACA,iEAAiE,iBAAiB;AAClF;AACA;AACA;AACA,iDAAiD,qBAAqB;AACtE;AACA,qDAAqD,4CAA4C;AACjG;AACA;AACA;AACA;AACA;AACA,eAAe,iBAAiB;AAChC;AACA,OAAO;AACP;;AAEA,iBAAiB,8CAA8C;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2DAA2D,iBAAiB;AAC5E;AACA;AACA;AACA,kDAAkD,iCAAiC;AACnF;AACA;AACA,6BAA6B,6BAA6B;AAC1D;AACA;AACA,+CAA+C,8CAA8C;AAC7F;AACA,mDAAmD,qDAAqD;AACxG;AACA;AACA;;AAEA,sBAAsB,6BAA6B;AACnD;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,aAAa;AACrD;;AAEA,kBAAkB,qCAAqC;AACvD;AACA,mDAAmD,YAAY;AAC/D;AACA;AACA;AACA;AACA,yDAAyD,2CAA2C;AACpG;AACA;AACA;AACA,yCAAyC,aAAa,aAAa,EAAE;AACrE;AACA,kBAAkB,QAAQ,iBAAiB;AAC3C;AACA;AACA,qDAAqD,kCAAkC;AACvF;;AAEA,kBAAkB,iCAAiC;AACnD;AACA;AACA,OAAO;AACP;;AAEA,mBAAmB,iCAAiC;AACpD;AACA;AACA,OAAO;AACP;;AAEA,mBAAmB,8DAA8D;AACjF;AACA;;AAEA,sBAAsB,oDAAoD;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,yBAAyB;AAC9C;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,cAAc;AACd;;AAEA,4BAA4B,kDAAkD;AAC9E,yDAAyD,kDAAkD;AAC3G;;AAEA;AACA;AACA;;;;;;;;ACxLA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;AC7JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,kBAAkB;AACnC,SAAS;AACT;AACA;AACA;AACA,iEAAiE,QAAQ,UAAU,QAAQ;AAC3F;AACA;AACA,iBAAiB,yBAAyB;AAC1C,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,mBAAmB;AACpC,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,qBAAqB;AACtC,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,2BAA2B;AAC5C,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,yBAAyB;AAC1C,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,mBAAmB;AACpC,SAAS;AACT;AACA;AACA;AACA,gEAAgE,QAAQ,UAAU,QAAQ;AAC1F;AACA;AACA;AACA,iBAAiB,qBAAqB;AACtC,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,qBAAqB;AACtC,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,6BAA6B;AAC9C,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB,mBAAmB;AACpC,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB,mBAAmB;AACpC,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB,6BAA6B;AAC9C,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB,wBAAwB;AACzC,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB,4BAA4B;AAC7C,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;;;;;;;;ACtKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACfA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC1FA;AACA,WAAW,mBAAO,CAAC,IAAmB;AACtC,WAAW,mBAAO,CAAC,IAAmB;AACtC;;;;;;;;ACHA,uBAAuB,mBAAO,CAAC,IAA2B;AAC1D,sBAAsB,mBAAO,CAAC,IAA0B;AACxD,yBAAyB,mBAAO,CAAC,IAA6B;AAC9D,0BAA0B,mBAAO,CAAC,IAA8B;AAChE,0BAA0B,mBAAO,CAAC,IAA8B;AAChE,0BAA0B,mBAAO,CAAC,IAA8B;AAChE,0BAA0B,mBAAO,CAAC,GAA8B;AAChE,2BAA2B,mBAAO,CAAC,IAA+B;AAClE,2BAA2B,mBAAO,CAAC,IAA+B;AAClE,8BAA8B,mBAAO,CAAC,GAAkC;AACxE,qBAAqB,mBAAO,CAAC,IAAyB;AACtD,4BAA4B,mBAAO,CAAC,IAAgC;AACpE,yBAAyB,mBAAO,CAAC,GAA6B;AAC9D,wBAAwB,mBAAO,CAAC,IAA4B;AAC5D,+BAA+B,mBAAO,CAAC,IAAmC;AAC1E,4BAA4B,mBAAO,CAAC,IAAgC;AACpE,2BAA2B,mBAAO,CAAC,IAA+B;;AAElE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,4CAA4C;AACnG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,4CAA4C;AACnG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,4CAA4C;AACnG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,sDAAsD,4CAA4C;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;ACvBA;AACA;AACA;AACA;AACA;AACA,sDAAsD,4CAA4C;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA,sDAAsD,4CAA4C;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA,0DAA0D,4CAA4C;AACtG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA,0DAA0D,4CAA4C;AACtG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;ACpBA;AACA;AACA;AACA;AACA;AACA,0DAA0D,4CAA4C;AACtG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;ACxBA;AACA;AACA,wBAAwB,mBAAO,CAAC,IAAY;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACzDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,eAAe;AAC/D;AACA,2BAA2B,uEAAuE;AAClG;AACA;AACA;AACA,2BAA2B,0EAA0E;AACrG;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;;;;;;;ACxLA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;;;;;;;AClOA;;AAEA;AACA;;AAEA;AACA;;;;;;;;ACNA;;AAEA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;;AAEA;AACA;;;;;;;;AC7BA;;AAEA;;AAEA;AACA,UAAU,KAAK,GAAG,QAAQ,GAAG;AAC7B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACxBA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;AChEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,wBAAwB,OAAO;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,wBAAwB,OAAO;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;;;;;;;ACpGA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;;;;;;ACnEA;;AAEA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;;;;;;;ACbA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;;;;;;AChCA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,wBAAwB,OAAO;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACrDA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,wBAAwB,OAAO;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;;;;;;;ACzCA;;AAEA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;;;;;;;;ACrBA,aAAa,mBAAO,CAAC,IAAsB;AAC3C,mBAAmB,mBAAO,CAAC,GAA4B;AACvD,kBAAkB,mBAAO,CAAC,IAA2B;AACrD,aAAa,mBAAO,CAAC,IAAsB;AAC3C,aAAa,mBAAO,CAAC,IAAsB;AAC3C,gBAAgB,mBAAO,CAAC,IAAyB;AACjD,iBAAiB,mBAAO,CAAC,IAA0B;AACnD,YAAY,mBAAO,CAAC,IAAqB;AACzC,qBAAqB,mBAAO,CAAC,IAA8B;AAC3D,aAAa,mBAAO,CAAC,IAAsB;AAC3C,iBAAiB,mBAAO,CAAC,IAA0B;AACnD,YAAY,mBAAO,CAAC,IAAqB;;AAEzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC7BA,eAAe,mBAAO,CAAC,IAAoB;AAC3C,gBAAgB,mBAAO,CAAC,EAAqB;AAC7C,eAAe,mBAAO,CAAC,IAAoB;AAC3C,mBAAmB,mBAAO,CAAC,IAAsB;;AAEjD;AACA;;AAEA;AACA;;AAEA;AACA,gBAAgB,mBAAO,CAAC,IAAY;AACpC;AACA,iBAAiB,mBAAO,CAAC,IAAa;AACtC;AACA,sBAAsB,mBAAO,CAAC,IAAkB;AAChD;AACA,mBAAmB,mBAAO,CAAC,IAAe;AAC1C;AACA,iBAAiB,mBAAO,CAAC,IAAa;AACtC;AACA,oBAAoB,mBAAO,CAAC,IAAuB;AACnD;AACA,eAAe,mBAAO,CAAC,GAAW;;AAElC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACvCA;AACA;AACA;AACA,mBAAmB,mBAAO,CAAC,IAAiC;AAC5D;AACA,kBAAkB,mBAAO,CAAC,IAAgC;AAC1D;AACA,0BAA0B,mBAAO,CAAC,IAA8B;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;ACnHA;;AAEA;;AAEA;AACA,kBAAkB,2BAA2B,wBAAwB,EAAE;AACvE;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,iCAAiC,wBAAwB,EAAE;AAC7E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,gCAAgC,wBAAwB,EAAE;AAC5E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,gCAAgC,uBAAuB,EAAE;AAC3E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,mCAAmC,uBAAuB,EAAE;AAC9E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,+BAA+B,uBAAuB,EAAE;AAC1E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,2BAA2B,uBAAuB,EAAE;AACtE;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,mCAAmC,uBAAuB,EAAE;AAC9E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;AACA;AACA;AACA,kBAAkB,+BAA+B,wBAAwB,EAAE;AAC3E;AACA;AACA;AACA;;;;;;;;ACPA;;AAEA;;AAEA;AACA,kBAAkB,8BAA8B,wBAAwB,EAAE;AAC1E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,mCAAmC,uBAAuB,EAAE;AAC9E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,kCAAkC,wBAAwB,EAAE;AAC9E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,4BAA4B,uBAAuB,EAAE;AACvE;;AAEA;;AAEA;AACA;;;;;;;;ACXA;AACA;AACA;AACA,kBAAkB,+BAA+B,wBAAwB,EAAE;AAC3E;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA,kBAAkB,qCAAqC,uBAAuB,EAAE;AAChF;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA,kBAAkB,mCAAmC,uBAAuB,EAAE;AAC9E;AACA;AACA;AACA;;;;;;;;ACPA;;AAEA;;AAEA;AACA,kBAAkB,2BAA2B,uBAAuB,EAAE;AACtE;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,8BAA8B,uBAAuB,EAAE;AACzE;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,iCAAiC,uBAAuB,EAAE;AAC5E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,8BAA8B,uBAAuB,EAAE;AACzE;;AAEA,qBAAqB,oBAAoB;AACzC;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACnBA;;AAEA;;AAEA;AACA,kBAAkB,gCAAgC,uBAAuB,EAAE;AAC3E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,mCAAmC,uBAAuB,EAAE;AAC9E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;AACA;AACA;AACA,kBAAkB,0BAA0B,wBAAwB,EAAE;AACtE;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA,kBAAkB,6BAA6B,uBAAuB,EAAE;AACxE;AACA;AACA;AACA;;;;;;;;ACPA;;AAEA;;AAEA;AACA,kBAAkB,2BAA2B,wBAAwB,EAAE;AACvE;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,gCAAgC,uBAAuB,EAAE;AAC3E;;AAEA;;AAEA;AACA;;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,+BAA+B,uBAAuB,EAAE;AAC1E;;AAEA;;AAEA;AACA;;;;;;;;ACXA,aAAa,mBAAO,CAAC,IAAiB;AACtC,mBAAmB,mBAAO,CAAC,IAAuB;AAClD,kBAAkB,mBAAO,CAAC,IAAsB;AAChD,aAAa,mBAAO,CAAC,IAAiB;AACtC,qBAAqB,mBAAO,CAAC,IAAyB;AACtD,aAAa,mBAAO,CAAC,IAAiB;AACtC,gBAAgB,mBAAO,CAAC,IAAoB;AAC5C,mBAAmB,mBAAO,CAAC,IAAuB;AAClD,gBAAgB,mBAAO,CAAC,IAAoB;AAC5C,kBAAkB,mBAAO,CAAC,IAAsB;AAChD,qBAAqB,mBAAO,CAAC,IAAyB;AACtD,aAAa,mBAAO,CAAC,IAAiB;AACtC,kBAAkB,mBAAO,CAAC,IAAsB;AAChD,iBAAiB,mBAAO,CAAC,IAAqB;AAC9C,cAAc,mBAAO,CAAC,EAAkB;AACxC,kBAAkB,mBAAO,CAAC,IAAsB;AAChD,qBAAqB,mBAAO,CAAC,IAAyB;AACtD,iBAAiB,mBAAO,CAAC,IAAqB;AAC9C,gBAAgB,mBAAO,CAAC,IAAoB;AAC5C,oBAAoB,mBAAO,CAAC,IAAwB;AACpD,qBAAqB,mBAAO,CAAC,IAAyB;AACtD,iBAAiB,mBAAO,CAAC,IAAqB;AAC9C,YAAY,mBAAO,CAAC,IAAgB;AACpC,eAAe,mBAAO,CAAC,IAAmB;AAC1C,iBAAiB,mBAAO,CAAC,IAAqB;AAC9C,uBAAuB,mBAAO,CAAC,IAA2B;AAC1D,qBAAqB,mBAAO,CAAC,IAAyB;;;AAGtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC5DA;AACA;AACA;AACA,KAAK,2DAA2D;AAChE,KAAK,2DAA2D;AAChE,KAAK,iEAAiE;AACtE,KAAK,+DAA+D;AACpE,KAAK,2DAA2D;AAChE,KAAK,6FAA6F,QAAQ,gBAAgB,EAAE,EAAE;AAC9H,KAAK,gEAAgE,QAAQ,gBAAgB,EAAE,EAAE;AACjG,KAAK,0DAA0D;AAC/D;AACA,KAAK,kEAAkE;AACvE,KAAK;AACL,aAAa,SAAS,0BAA0B,EAAE;AAClD,KAAK;AACL,KAAK;AACL,aAAa,SAAS,0BAA0B,EAAE;AAClD,KAAK;AACL,KAAK,0DAA0D;AAC/D,KAAK,yDAAyD;AAC9D,KAAK;AACL,aAAa,SAAS,0CAA0C,EAAE;AAClE,KAAK;AACL,KAAK;AACL,aAAa,SAAS,0BAA0B,EAAE;AAClD,KAAK;AACL,KAAK;AACL,aAAa,SAAS,0CAA0C,EAAE;AAClE,KAAK;AACL,KAAK;AACL,aAAa,SAAS,0CAA0C,EAAE;AAClE,KAAK;AACL,KAAK;AACL,aAAa,SAAS,0BAA0B,EAAE;AAClD,KAAK;AACL,KAAK;AACL,aAAa,SAAS,0BAA0B,EAAE;AAClD,KAAK;AACL,KAAK;AACL,aAAa,SAAS,0BAA0B,EAAE;AAClD,KAAK;AACL,KAAK;AACL,aAAa,SAAS,0BAA0B,EAAE;AAClD,KAAK;AACL;AACA;AACA,aAAa,SAAS,2BAA2B,EAAE;AACnD,KAAK;AACL;AACA;AACA,aAAa,SAAS,2BAA2B,EAAE;AACnD,KAAK;AACL,KAAK;AACL;AACA,eAAe,aAAa;AAC5B,gBAAgB,0BAA0B;AAC1C,OAAO;AACP,KAAK;AACL,KAAK;AACL,aAAa,SAAS,2CAA2C,EAAE;AACnE,KAAK;AACL,KAAK,yDAAyD;AAC9D,KAAK;AACL;AACA,eAAe,aAAa;AAC5B,gBAAgB,0BAA0B;AAC1C,OAAO;AACP,KAAK;AACL,KAAK,2DAA2D;AAChE,KAAK,+DAA+D;AACpE,KAAK,0DAA0D;AAC/D,KAAK,6DAA6D;AAClE,KAAK,oEAAoE;AACzE;AACA,KAAK,6DAA6D;AAClE,KAAK;AACL,aAAa,SAAS,2CAA2C,EAAE;AACnE,KAAK;AACL,KAAK;AACL,aAAa,SAAS,2CAA2C,EAAE;AACnE,KAAK;AACL,KAAK;AACL;AACA,eAAe,aAAa;AAC5B,gBAAgB,2CAA2C;AAC3D,OAAO;AACP,KAAK;AACL,KAAK;AACL;AACA,eAAe,aAAa;AAC5B,gBAAgB,2CAA2C;AAC3D,OAAO;AACP,KAAK;AACL,KAAK;AACL;AACA,eAAe,aAAa;AAC5B,gBAAgB,2CAA2C;AAC3D,OAAO;AACP,KAAK;AACL;AACA,KAAK,6DAA6D;AAClE,KAAK,6DAA6D;AAClE;AACA,KAAK,kEAAkE;AACvE,KAAK,iEAAiE;AACtE,KAAK;AACL,aAAa,SAAS,2BAA2B,EAAE;AACnD,KAAK;AACL,KAAK;AACL,aAAa,SAAS,2BAA2B,EAAE;AACnD,KAAK;AACL,KAAK;AACL,aAAa,SAAS,2BAA2B,EAAE;AACnD,KAAK;AACL;AACA,KAAK,6EAA6E;AAClF,KAAK,8EAA8E;AACnF,KAAK,uEAAuE;AAC5E;AACA,KAAK,+DAA+D,QAAQ,gBAAgB,EAAE,EAAE;AAChG,KAAK,gEAAgE,QAAQ,aAAa,EAAE,EAAE;AAC9F,KAAK,iEAAiE,QAAQ,gBAAgB,EAAE,EAAE;AAClG;AACA,KAAK,gCAAgC;AACrC;AACA,KAAK,wDAAwD;AAC7D;AACA,KAAK,wEAAwE;AAC7E,KAAK,wEAAwE;AAC7E,KAAK,2EAA2E;AAChF;AACA,KAAK,iEAAiE;AACtE,KAAK,oEAAoE;AACzE,KAAK,sEAAsE,SAAS,2DAA2D,EAAE,EAAE;AACnJ,KAAK,yEAAyE,SAAS,2DAA2D,EAAE,EAAE;AACtJ,KAAK,uEAAuE,SAAS,2DAA2D,EAAE,EAAE;AACpJ,KAAK,uEAAuE,SAAS,2DAA2D,EAAE,EAAE;AACpJ,KAAK;AACL,iBAAiB,0CAA0C;AAC3D,cAAc,2DAA2D;AACzE,KAAK,EAAE;AACP,KAAK,gEAAgE;AACrE,KAAK,uEAAuE;AAC5E;AACA,KAAK,sDAAsD;AAC3D,KAAK,4DAA4D,SAAS,2DAA2D,EAAE,EAAE;AACzI,KAAK,6DAA6D,SAAS,2DAA2D,EAAE,EAAE;AAC1I,KAAK,+DAA+D,SAAS,2DAA2D,EAAE,EAAE;;AAE5I;AACA;AACA;;;;;;;;ACxJA;;AAEA;;AAEA,0BAA0B,kBAAkB;AAC5C,sDAAsD,kBAAkB;AACxE;;AAEA,kBAAkB,qCAAqC;AACvD,8CAA8C,qCAAqC;AACnF;;AAEA,gBAAgB,qBAAqB;AACrC,4CAA4C,qBAAqB;AACjE;;AAEA,kBAAkB,2BAA2B;AAC7C,8CAA8C,2BAA2B;AACzE;;AAEA,iBAAiB,2BAA2B;AAC5C,6CAA6C,2BAA2B;AACxE;;AAEA,iBAAiB,kBAAkB;AACnC,6CAA6C,kBAAkB;AAC/D;;AAEA,qBAAqB,YAAY;AACjC,iDAAiD,YAAY;AAC7D;;AAEA,kBAAkB,qBAAqB;AACvC,8CAA8C,qBAAqB;AACnE;;AAEA,kBAAkB,YAAY;AAC9B,8CAA8C,YAAY;AAC1D;;AAEA,sBAAsB,aAAa;AACnC,kDAAkD,aAAa;AAC/D;;AAEA,iBAAiB,YAAY;AAC7B,6CAA6C,YAAY;AACzD;;AAEA,kBAAkB,YAAY;AAC9B,8CAA8C,YAAY;AAC1D;;AAEA,mBAAmB,YAAY;AAC/B,+CAA+C,YAAY;AAC3D;;AAEA,sBAAsB,mCAAmC;AACzD,kDAAkD,mCAAmC;AACrF;;AAEA,gBAAgB,kBAAkB;AAClC,4CAA4C,kBAAkB;AAC9D;;AAEA,qBAAqB,kBAAkB;AACvC,iDAAiD,kBAAkB;AACnE;;AAEA,iBAAiB,gBAAgB;AACjC,6CAA6C,gBAAgB;AAC7D;;AAEA,kBAAkB,kBAAkB;AACpC,8CAA8C,kBAAkB;AAChE;;AAEA,mBAAmB,mBAAmB;AACtC,+CAA+C,mBAAmB;AAClE;;AAEA,uBAAuB,kBAAkB;AACzC,mDAAmD,kBAAkB;AACrE;;AAEA,4BAA4B,sCAAsC;AAClE,wDAAwD,QAAQ,iBAAiB,kCAAkC;AACnH;;AAEA,kBAAkB,oBAAoB;AACtC,8CAA8C,oBAAoB;AAClE;;AAEA,qBAAqB,YAAY;AACjC,iDAAiD,YAAY;AAC7D;;AAEA;;AAEA;AACA;;;;;;;;ACnGA;;AAEA;AACA;;AAEA;AACA;;;;;;;;ACNA;;AAEA;;AAEA,2BAA2B,YAAY;AACvC,4DAA4D,YAAY;AACxE;;AAEA,4BAA4B,kBAAkB;AAC9C,wDAAwD,kBAAkB;AAC1E;;AAEA,qBAAqB,YAAY;AACjC;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACnBA;;AAEA;AACA;;AAEA;AACA;;;;;;;;ACNA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;AC/BA;;AAEA;;AAEA,iBAAiB,yFAAyF;AAC1G,iDAAiD,yFAAyF;AAC1I;;AAEA,oBAAoB,yFAAyF;AAC7G,oDAAoD,yFAAyF;AAC7I;;AAEA,eAAe,kBAAkB;AACjC,+CAA+C,kBAAkB;AACjE;;AAEA,kBAAkB,aAAa;AAC/B,kDAAkD,aAAa;AAC/D;;AAEA,gBAAgB,+BAA+B;AAC/C,gDAAgD,+BAA+B;AAC/E;;AAEA,gBAAgB,wBAAwB;AACxC,+CAA+C,wBAAwB;AACvE;;AAEA,gBAAgB,mBAAmB;AACnC,gDAAgD,mBAAmB;AACnE;;AAEA,gBAAgB,2EAA2E;AAC3F,gDAAgD,2EAA2E;AAC3H;;AAEA,uBAAuB,wBAAwB;AAC/C,uDAAuD,wBAAwB;AAC/E;;AAEA;;AAEA;AACA;;;;;;;;AC3CA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;AACA;AACA;;AAEA;;AAEA;;AAEA,gBAAgB,qBAAqB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO,GAAG,QAAQ,GAAG,OAAO;AACvC;AACA;AACA;;AAEA,gBAAgB,aAAa,YAAY,QAAQ;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gBAAgB,kBAAkB;AAClC;AACA,oCAAoC,kBAAkB;AACtD;AACA,mCAAmC,kBAAkB;AACrD;;AAEA,qBAAqB,aAAa,qBAAqB,QAAQ;AAC/D;AACA,yDAAyD,gBAAgB;AACzE;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB,aAAa,mBAAmB,QAAQ;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sDAAsD,cAAc;AACpE;AACA;AACA;AACA,2BAA2B,+FAA+F;AAC1H;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,wCAAwC,aAAa,aAAa,QAAQ;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,aAAa,YAAY,QAAQ;AACnD;AACA,qDAAqD,gBAAgB;AACrE;AACA;AACA;AACA;AACA,qBAAqB,0CAA0C;AAC/D;AACA,SAAS;AACT;AACA;AACA;AACA,gDAAgD,YAAY;AAC5D;AACA,2CAA2C,gBAAgB;AAC3D;AACA,wCAAwC,aAAa,cAAc,QAAQ;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iBAAiB,aAAa,mBAAmB,QAAQ;AACzD;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,qDAAqD,gBAAgB;AACrE;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,uCAAuC;AACzD;AACA,gBAAgB;;AAEhB,MAAM,cAAc;;AAEpB;AACA,EAAE;AACF;;AAEA;AACA;;AAEA,oBAAoB,uCAAuC;AAC3D,0CAA0C,uCAAuC;AACjF;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACpOA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;;AAEA;;AAEA;;AAEA,kBAAkB,kBAAkB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;;AAEA;;AAEA;AACA;;;;;;;;AC1BA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;;AAEA;;AAEA;;AAEA,gBAAgB,eAAe;AAC/B,wCAAwC,OAAO,GAAG,QAAQ;AAC1D;AACA;;AAEA,gBAAgB,qBAAqB;AACrC,wCAAwC,OAAO,GAAG,QAAQ;AAC1D;AACA;;AAEA,mBAAmB,2BAA2B;AAC9C,4CAA4C,eAAe;AAC3D,kCAAkC,oBAAoB,GAAG,eAAe;AACxE,uBAAuB,qBAAqB;AAC5C;;AAEA;;AAEA;AACA;;;;;;;;AC1BA;;AAEA;;AAEA,kBAAkB,gBAAgB;AAClC,kDAAkD,gBAAgB;AAClE;;AAEA,iBAAiB,uBAAuB;AACxC,iDAAiD,uBAAuB;AACxE;;AAEA,yBAAyB,YAAY;AACrC,yDAAyD,YAAY;AACrE;;AAEA,8BAA8B,4BAA4B;AAC1D,8DAA8D,0BAA0B;AACxF;;AAEA,2BAA2B,uBAAuB;AAClD;AACA,sDAAsD,6BAA6B;AACnF;AACA;;AAEA;;AAEA;AACA;;;;;;;;AC7BA;;AAEA;;AAEA,gBAAgB,qBAAqB;AACrC,2CAA2C,qBAAqB;AAChE;;AAEA,eAAe,kBAAkB;AACjC,0CAA0C,kBAAkB;AAC5D;;AAEA,kBAAkB,QAAQ;AAC1B,6CAA6C,QAAQ;AACrD;;AAEA,gBAAgB,cAAc;AAC9B,2CAA2C,cAAc;AACzD;;AAEA;;AAEA;AACA;;;;;;;;ACvBA;;AAEA;;AAEA,qBAAqB,OAAO;AAC5B;AACA;AACA,OAAO;AACP;AACA;;AAEA,qBAAqB,eAAe;AACpC;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;;AAEA;AACA;;;;;;;;AChCA,aAAa,mBAAO,CAAC,IAAmB;AACxC,aAAa,mBAAO,CAAC,IAAmB;AACxC,aAAa,mBAAO,CAAC,IAAmB;AACxC,kBAAkB,mBAAO,CAAC,IAAwB;AAClD,mBAAmB,mBAAO,CAAC,IAAyB;AACpD,aAAa,mBAAO,CAAC,IAAmB;AACxC,iBAAiB,mBAAO,CAAC,IAAuB;AAChD,gBAAgB,mBAAO,CAAC,IAAsB;AAC9C,YAAY,mBAAO,CAAC,IAAkB;AACtC,qBAAqB,mBAAO,CAAC,IAA2B;AACxD,iBAAiB,mBAAO,CAAC,IAAuB;AAChD,YAAY,mBAAO,CAAC,IAAkB;;AAEtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC7BA,gC;;;;;;;;ACAA,kC;;;;;;;;ACAA,sC;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;UCrBA;UACA;UACA;UACA","file":"backend.js","sourcesContent":["module.exports = app => {\n\n  class Atom extends app.meta.AtomBase {\n\n    async create({ atomClass, item, user }) {\n      // super\n      const key = await super.create({ atomClass, item, user });\n      // add resource\n      const res = await this.ctx.model.resource.insert({\n        atomId: key.atomId,\n      });\n      const itemId = res.insertId;\n      return { atomId: key.atomId, itemId };\n    }\n\n    async read({ atomClass, options, key, user }) {\n      // super\n      const item = await super.read({ atomClass, options, key, user });\n      if (!item) return null;\n      // meta\n      item.atomNameLocale = this.ctx.text(item.atomName);\n      this._getMeta(item, true);\n      // ok\n      return item;\n    }\n\n    async select({ atomClass, options, items, user }) {\n      // super\n      await super.select({ atomClass, options, items, user });\n      // meta\n      const showSorting = options && options.category;\n      for (const item of items) {\n        item.atomNameLocale = this.ctx.text(item.atomName);\n        this._getMeta(item, showSorting);\n      }\n    }\n\n    async write({ atomClass, target, key, item, options, user }) {\n      // super\n      await super.write({ atomClass, target, key, item, options, user });\n      // update resource\n      const data = await this.ctx.model.resource.prepareData(item);\n      data.id = key.itemId;\n      await this.ctx.model.resource.update(data);\n      // update locales\n      if (item.atomStage === 1) {\n        await this.ctx.bean.resource.setLocales({\n          atomId: key.atomId,\n          atomName: item.atomName,\n        });\n      }\n    }\n\n    async delete({ atomClass, key, user }) {\n      // delete resource\n      await this.ctx.model.resource.delete({\n        id: key.itemId,\n      });\n      // delete resource locales\n      await this.ctx.model.resourceLocale.delete({\n        atomId: key.atomId,\n      });\n      // super\n      await super.delete({ atomClass, key, user });\n    }\n\n    _getMeta(item, showSorting) {\n      // flags\n      const flags = [];\n      if (item.resourceSorting && showSorting) flags.push(item.resourceSorting);\n      // meta\n      const meta = {\n        summary: item.description,\n        flags,\n      };\n      // ok\n      item._meta = meta;\n    }\n\n  }\n\n  return Atom;\n};\n","const require3 = require('require3');\nconst uuid = require3('uuid');\nconst mparse = require3('egg-born-mparse').default;\n\nmodule.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Atom extends ctx.app.meta.BeanModuleBase {\n\n    constructor(moduleName) {\n      super(ctx, 'atom');\n      this.moduleName = moduleName || ctx.module.info.relativeName;\n    }\n\n    get atomClass() {\n      return ctx.bean.atomClass.module(this.moduleName);\n    }\n\n    get modelAtom() {\n      return ctx.model.module(moduleInfo.relativeName).atom;\n    }\n\n    get modelAtomStar() {\n      return ctx.model.module(moduleInfo.relativeName).atomStar;\n    }\n\n    get modelAtomLabel() {\n      return ctx.model.module(moduleInfo.relativeName).atomLabel;\n    }\n\n    get modelAtomLabelRef() {\n      return ctx.model.module(moduleInfo.relativeName).atomLabelRef;\n    }\n    get modelFile() {\n      return ctx.model.module('a-file').file;\n    }\n\n    get sequence() {\n      return ctx.bean.sequence.module(moduleInfo.relativeName);\n    }\n\n    get sqlProcedure() {\n      return ctx.bean._getBean(moduleInfo.relativeName, 'local.procedure');\n    }\n\n    async getAtomClassId({ module, atomClassName, atomClassIdParent = 0 }) {\n      const res = await this.atomClass.get({\n        module,\n        atomClassName,\n        atomClassIdParent,\n      });\n      return res.id;\n    }\n\n    // atom and item\n\n    // create\n    async create({ atomClass, roleIdOwner, item, user }) {\n      // atomClass\n      atomClass = await ctx.bean.atomClass.get(atomClass);\n      // item\n      item = item || { };\n      item.roleIdOwner = roleIdOwner;\n      // atom bean\n      const _moduleInfo = mparse.parseInfo(atomClass.module);\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const beanFullName = `${_moduleInfo.relativeName}.atom.${_atomClass.bean}`;\n      const res = await ctx.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { atomClass, item, user },\n        fn: 'create',\n      });\n      const { atomId, itemId } = res;\n      // save itemId\n      await this._update({\n        atom: { id: atomId, itemId },\n        user,\n      });\n      // notify\n      this._notifyDrafts();\n      // ok\n      return { atomId, itemId };\n    }\n\n    // read\n    async read({ key, options, user }) {\n      const atomClass = await ctx.bean.atomClass.getByAtomId({ atomId: key.atomId });\n      if (!atomClass) ctx.throw.module(moduleInfo.relativeName, 1002);\n      // atom bean\n      const _moduleInfo = mparse.parseInfo(atomClass.module);\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const beanFullName = `${_moduleInfo.relativeName}.atom.${_atomClass.bean}`;\n      const item = await ctx.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { atomClass, options, key, user },\n        fn: 'read',\n      });\n      // revision\n      this._appendRevisionToHistory({ item });\n      // ok\n      return item;\n    }\n\n    // readByStaticKey\n    async readByStaticKey({ atomClass, atomStaticKey, atomRevision, atomStage }) {\n      const options = {\n        mode: 'full',\n        stage: atomStage,\n        where: {\n          'a.atomStaticKey': atomStaticKey,\n        },\n      };\n      if (atomRevision !== undefined) {\n        options.where['a.atomRevision'] = atomRevision;\n      }\n      const list = await this.select({ atomClass, options });\n      return list[0];\n    }\n\n    // count\n    async count({ atomClass, options, user }) {\n      return await this.select({ atomClass, options, user, count: 1 });\n    }\n\n    // select\n    async select({ atomClass, options, user, pageForce = true, count = 0 }) {\n      // atomClass\n      let _atomClass;\n      if (atomClass) {\n        atomClass = await ctx.bean.atomClass.get(atomClass);\n        _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      }\n      // tableName\n      let tableName = '';\n      if (_atomClass) {\n        tableName = this._getTableName({ atomClass: _atomClass, mode: options.mode });\n        // 'where' should append atomClassId, such as article/post using the same table\n        if (!options.where) options.where = {};\n        options.where['a.atomClassId'] = atomClass.id;\n      }\n      // select\n      const items = await this._list({\n        tableName,\n        options,\n        user,\n        pageForce,\n        count,\n      });\n      // select items\n      if (!count && atomClass) {\n        const _moduleInfo = mparse.parseInfo(atomClass.module);\n        const beanFullName = `${_moduleInfo.relativeName}.atom.${_atomClass.bean}`;\n        await ctx.executeBean({\n          beanModule: _moduleInfo.relativeName,\n          beanFullName,\n          context: { atomClass, options, items, user },\n          fn: 'select',\n        });\n      }\n      // revision\n      if (!count && options.stage === 'history') {\n        for (const item of items) {\n          this._appendRevisionToHistory({ item });\n        }\n      }\n      // ok\n      return items;\n    }\n\n    // write\n    async write({ key, target, item, options, user }) {\n      // atomClass\n      const atomClass = await ctx.bean.atomClass.getByAtomId({ atomId: key.atomId });\n      if (!atomClass) ctx.throw.module(moduleInfo.relativeName, 1002);\n      if (!key.itemId) key.itemId = atomClass.itemId;\n      // atom bean\n      const _moduleInfo = mparse.parseInfo(atomClass.module);\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const beanFullName = `${_moduleInfo.relativeName}.atom.${_atomClass.bean}`;\n      // item draft\n      const itemDraft = Object.assign({}, item, {\n        atomId: key.atomId,\n        itemId: key.itemId,\n        atomStage: ctx.constant.module(moduleInfo.relativeName).atom.stage.draft,\n      });\n      await ctx.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { atomClass, target, key, item: itemDraft, options, user },\n        fn: 'write',\n      });\n    }\n\n    // deleteBulk\n    async deleteBulk({ keys, user }) {\n      const resKeys = [];\n      for (const key of keys) {\n        const res = await this._deleteBulk_item({ key, user });\n        if (res) {\n          resKeys.push(key);\n        }\n      }\n      return { keys: resKeys };\n    }\n\n    async _deleteBulk_item({ key, user }) {\n      // check right\n      const res = await ctx.bean.atom.checkRightAction({\n        atom: { id: key.atomId }, action: 4, user,\n      });\n      if (!res) return false;\n      // delete\n      await this.delete({ key, user });\n      // ok\n      return true;\n    }\n\n    // delete\n    async delete({ key, user }) {\n      const atomClass = await ctx.bean.atomClass.getByAtomId({ atomId: key.atomId });\n      if (!atomClass) ctx.throw.module(moduleInfo.relativeName, 1002);\n      if (!key.itemId) key.itemId = atomClass.itemId;\n      // atom bean\n      const _moduleInfo = mparse.parseInfo(atomClass.module);\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const beanFullName = `${_moduleInfo.relativeName}.atom.${_atomClass.bean}`;\n      // atom\n      const _atom = await this.modelAtom.get({ id: key.atomId });\n      if (_atom.atomStage === 0) {\n        if (_atom.atomIdFormal) {\n          // just close\n          await this.modelAtom.update({\n            id: key.atomId,\n            atomClosed: 1,\n          });\n        } else {\n          // delete\n          await ctx.executeBean({\n            beanModule: _moduleInfo.relativeName,\n            beanFullName,\n            context: { atomClass, key, user },\n            fn: 'delete',\n          });\n        }\n        // notify\n        this._notifyDrafts();\n      } else if (_atom.atomStage === 1) {\n        // delete history\n        const listHistory = await this.modelAtom.select({\n          where: {\n            atomStage: 2,\n            atomIdFormal: _atom.id,\n          },\n        });\n        for (const item of listHistory) {\n          await ctx.executeBean({\n            beanModule: _moduleInfo.relativeName,\n            beanFullName,\n            context: { atomClass, key: { atomId: item.id, itemId: item.itemId }, user },\n            fn: 'delete',\n          });\n        }\n        // delete draft\n        const itemDraft = await this.modelAtom.get({\n          atomStage: 0,\n          atomIdFormal: _atom.id,\n        });\n        if (itemDraft) {\n          await ctx.executeBean({\n            beanModule: _moduleInfo.relativeName,\n            beanFullName,\n            context: { atomClass, key: { atomId: itemDraft.id, itemId: itemDraft.itemId }, user },\n            fn: 'delete',\n          });\n        }\n        // delete archive\n        await ctx.executeBean({\n          beanModule: _moduleInfo.relativeName,\n          beanFullName,\n          context: { atomClass, key: { atomId: _atom.id, itemId: _atom.itemId }, user },\n          fn: 'delete',\n        });\n        // notify\n        this._notifyDrafts();\n      } else if (_atom.atomStage === 2) {\n        // delete history self\n        await ctx.executeBean({\n          beanModule: _moduleInfo.relativeName,\n          beanFullName,\n          context: { atomClass, key: { atomId: _atom.id, itemId: _atom.itemId }, user },\n          fn: 'delete',\n        });\n      }\n    }\n\n    async submit({ key, options, user }) {\n      const atomClass = await ctx.bean.atomClass.getByAtomId({ atomId: key.atomId });\n      if (!atomClass) ctx.throw.module(moduleInfo.relativeName, 1002);\n      if (!key.itemId) key.itemId = atomClass.itemId;\n      // atom bean\n      const _moduleInfo = mparse.parseInfo(atomClass.module);\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const beanFullName = `${_moduleInfo.relativeName}.atom.${_atomClass.bean}`;\n      return await ctx.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { atomClass, key, options, user },\n        fn: 'submit',\n      });\n    }\n\n    async _submitDirect({ /* key,*/ item, options, user }) {\n      // archive -> history\n      if (item.atomIdFormal) {\n        await this._copy({\n          target: 'history',\n          srcKey: { atomId: item.atomIdFormal }, srcItem: null,\n          destKey: null,\n          options,\n          user,\n        });\n      }\n      // draft -> archive\n      const keyFormal = await this._copy({\n        target: 'archive',\n        srcKey: { atomId: item.atomId }, srcItem: item,\n        destKey: item.atomIdFormal ? { atomId: item.atomIdFormal } : null,\n        options,\n        user,\n      });\n      // update draft\n      await this.modelAtom.update({\n        id: item.atomId,\n        atomClosed: 1,\n        atomIdFormal: keyFormal.atomId,\n      });\n      // notify\n      this._notifyDrafts();\n      // return keyFormal\n      return { archive: { key: keyFormal } };\n    }\n\n    async closeDraft({ key }) {\n      await this.modelAtom.update({\n        id: key.atomId,\n        atomClosed: 1,\n      });\n      // notify\n      this._notifyDrafts();\n    }\n\n    async openDraft({ key, user }) {\n      const _atom = await this.modelAtom.get({ id: key.atomId });\n      if (!_atom) ctx.throw.module(moduleInfo.relativeName, 1002);\n      // draft\n      if (_atom.atomStage === 0) {\n        if (_atom.atomClosed === 1) {\n          // open\n          await this._openDraft_update({\n            atomId: _atom.id,\n            atomRevision: _atom.atomRevision + 1,\n            user,\n          });\n        }\n        return { draft: { key } };\n      }\n      // archive\n      if (_atom.atomStage === 1) {\n        if (_atom.atomIdDraft > 0) {\n          // open\n          await this._openDraft_update({\n            atomId: _atom.atomIdDraft,\n            atomRevision: _atom.atomRevision + 1,\n            user,\n          });\n          return { draft: { key: { atomId: _atom.atomIdDraft } } };\n        }\n        // ** create draft from archive\n        const keyDraft = await this._copy({\n          target: 'draft',\n          srcKey: { atomId: key.atomId }, srcItem: null,\n          destKey: null,\n          user,\n        });\n        // open\n        await this._openDraft_update({\n          atomId: keyDraft.atomId,\n          atomRevision: _atom.atomRevision + 1,\n          user,\n        });\n        // ok\n        return { draft: { key: keyDraft } };\n      }\n      // history\n      if (_atom.atomStage === 2) {\n        // ** create draft from history\n        const keyDraft = await this._copy({\n          target: 'draft',\n          srcKey: { atomId: key.atomId }, srcItem: null,\n          destKey: _atom.atomIdDraft ? { atomId: _atom.atomIdDraft } : null,\n          user,\n        });\n        // open\n        await this._openDraft_update({\n          atomId: keyDraft.atomId,\n          atomRevision: await this._openDraft_atomRevision_history({ _atom }),\n          user,\n        });\n        // ok\n        return { draft: { key: keyDraft } };\n      }\n    }\n\n    async _openDraft_atomRevision_history({ _atom }) {\n      let atomRevision;\n      if (_atom.atomIdDraft) {\n        const _atom2 = await this.modelAtom.get({ id: _atom.atomIdDraft });\n        atomRevision = _atom2.atomRevision + 1;\n      } else if (_atom.atomIdFormal) {\n        const _atom2 = await this.modelAtom.get({ id: _atom.atomIdFormal });\n        atomRevision = _atom2.atomRevision + 1;\n      } else {\n        atomRevision = _atom.atomRevision + 1;\n      }\n      return atomRevision;\n    }\n\n    async _openDraft_update({ atomId, atomRevision, user }) {\n      await this.modelAtom.update({\n        id: atomId,\n        atomFlowId: 0,\n        atomClosed: 0,\n        atomRevision,\n        userIdUpdated: user.id,\n      });\n      // notify\n      this._notifyDrafts();\n    }\n\n    async enable({ key, user }) {\n      // atomClass\n      const atomClass = await ctx.bean.atomClass.getByAtomId({ atomId: key.atomId });\n      if (!atomClass) ctx.throw.module(moduleInfo.relativeName, 1002);\n      if (!key.itemId) key.itemId = atomClass.itemId;\n      // atom bean\n      const _moduleInfo = mparse.parseInfo(atomClass.module);\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const beanFullName = `${_moduleInfo.relativeName}.atom.${_atomClass.bean}`;\n      await ctx.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { atomClass, key, user },\n        fn: 'enable',\n      });\n    }\n\n    async disable({ key, user }) {\n      // atomClass\n      const atomClass = await ctx.bean.atomClass.getByAtomId({ atomId: key.atomId });\n      if (!atomClass) ctx.throw.module(moduleInfo.relativeName, 1002);\n      if (!key.itemId) key.itemId = atomClass.itemId;\n      // atom bean\n      const _moduleInfo = mparse.parseInfo(atomClass.module);\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const beanFullName = `${_moduleInfo.relativeName}.atom.${_atomClass.bean}`;\n      await ctx.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { atomClass, key, user },\n        fn: 'disable',\n      });\n    }\n\n    async clone({ key, user }) {\n      const keyDraft = await this._copy({\n        target: 'clone',\n        srcKey: { atomId: key.atomId }, srcItem: null,\n        destKey: null,\n        user,\n      });\n      // ok\n      return { draft: { key: keyDraft } };\n    }\n\n    // target: draft/archive/history/clone\n    async _copy({ target, srcKey, srcItem, destKey, options, user }) {\n      // atomClass\n      const atomClass = await ctx.bean.atomClass.getByAtomId({ atomId: srcKey.atomId });\n      if (!atomClass) ctx.throw.module(moduleInfo.relativeName, 1002);\n      if (!srcKey.itemId) srcKey.itemId = atomClass.itemId;\n      // atom bean\n      const _moduleInfo = mparse.parseInfo(atomClass.module);\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const beanFullName = `${_moduleInfo.relativeName}.atom.${_atomClass.bean}`;\n      // srcItem\n      if (!srcItem) {\n        srcItem = await ctx.bean.atom.read({ key: { atomId: srcKey.atomId }, user });\n      }\n      // destKey\n      if (!destKey) {\n        destKey = await this.create({ atomClass, roleIdOwner: srcItem.roleIdOwner, item: null, user });\n      }\n      if (!destKey.itemId) {\n        const _item = await this.modelAtom.get({ id: destKey.atomId });\n        destKey.itemId = _item.itemId;\n      }\n      // atomStage\n      const atomStage = ctx.constant.module(moduleInfo.relativeName).atom.stage[target] || 0;\n      // atomClosed\n      const atomClosed = 0;\n      // atomIdDraft/atomIdFormal\n      let atomIdDraft;\n      let atomIdFormal;\n      let userIdUpdated = srcItem.userIdUpdated;\n      let userIdCreated = srcItem.userIdCreated || userIdUpdated;\n      let atomFlowId = srcItem.atomFlowId;\n      let atomName = srcItem.atomName;\n      let atomStatic = srcItem.atomStatic;\n      let atomStaticKey = srcItem.atomStaticKey;\n      let atomRevision = srcItem.atomRevision;\n      const atomLanguage = srcItem.atomLanguage;\n      const atomCategoryId = srcItem.atomCategoryId;\n      const atomTags = srcItem.atomTags;\n      if (target === 'draft') {\n        atomIdDraft = 0;\n        atomIdFormal = srcItem.atomStage === 1 ? srcItem.atomId : srcItem.atomIdFormal;\n        userIdUpdated = user.id;\n        atomFlowId = 0;\n        atomRevision = undefined;\n      } else if (target === 'archive') {\n        atomIdDraft = srcItem.atomId;\n        atomIdFormal = 0;\n      } else if (target === 'history') {\n        atomIdDraft = srcItem.atomIdDraft;\n        atomIdFormal = srcItem.atomId;\n      } else if (target === 'clone') {\n        atomIdDraft = 0;\n        atomIdFormal = 0;\n        userIdUpdated = user.id;\n        userIdCreated = user.id;\n        atomFlowId = 0;\n        atomName = `${srcItem.atomName}-${ctx.text('CloneCopyText')}`;\n        atomStatic = 0;\n        if (atomStaticKey) {\n          atomStaticKey = uuid.v4().replace(/-/g, '');\n        }\n        atomRevision = 0;\n      }\n      // destItem\n      const destItem = Object.assign({}, srcItem, {\n        atomId: destKey.atomId,\n        itemId: destKey.itemId,\n        userIdCreated,\n        userIdUpdated,\n        atomName,\n        atomStatic,\n        atomStaticKey,\n        atomRevision,\n        atomLanguage,\n        atomCategoryId,\n        atomTags,\n        atomStage,\n        atomFlowId,\n        allowComment: srcItem.allowComment,\n        attachmentCount: srcItem.attachmentCount,\n        atomClosed,\n        atomIdDraft,\n        atomIdFormal,\n        createdAt: srcItem.atomCreatedAt,\n        updatedAt: srcItem.atomUpdatedAt,\n      });\n      // update fields\n      await this.modelAtom.update({\n        id: destItem.atomId,\n        userIdCreated: destItem.userIdCreated,\n        userIdUpdated: destItem.userIdUpdated,\n        //   see also: atomBase\n        // atomName: destItem.atomName,\n        // atomStatic: destItem.atomStatic,\n        // atomStaticKey: destItem.atomStaticKey,\n        // atomRevision: destItem.atomRevision,\n        // atomLanguage: destItem.atomLanguage,\n        // atomCategoryId: destItem.atomCategoryId,\n        // atomTags: destItem.atomTags,\n        // allowComment: destItem.allowComment,\n        atomStage: destItem.atomStage,\n        atomFlowId: destItem.atomFlowId,\n        attachmentCount: destItem.attachmentCount,\n        atomClosed: destItem.atomClosed,\n        atomIdDraft: destItem.atomIdDraft,\n        atomIdFormal: destItem.atomIdFormal,\n        createdAt: destItem.createdAt,\n        updatedAt: destItem.updatedAt,\n      });\n      // bean write\n      await ctx.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { atomClass, target, key: destKey, item: destItem, options, user },\n        fn: 'write',\n      });\n      // bean copy\n      await ctx.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { atomClass, target, srcKey, srcItem, destKey, destItem, options, user },\n        fn: 'copy',\n      });\n      // copy attachments\n      await this._copyAttachments({ atomIdSrc: srcKey.atomId, atomIdDest: destKey.atomId });\n      // ok\n      return destKey;\n    }\n\n    async _copyAttachments({ atomIdSrc, atomIdDest }) {\n      // delete old files\n      await this.modelFile.delete({ atomId: atomIdDest, mode: 2 });\n      // add new files\n      const files = await this.modelFile.select({\n        where: { atomId: atomIdSrc, mode: 2 },\n      });\n      for (const file of files) {\n        delete file.id;\n        file.atomId = atomIdDest;\n        await this.modelFile.insert(file);\n      }\n    }\n\n    async exportBulk({ atomClass, options, fields, user }) {\n      // atomClass\n      let _atomClass;\n      if (atomClass) {\n        atomClass = await ctx.bean.atomClass.get(atomClass);\n        _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      }\n      // select\n      const items = await this.select({ atomClass, options, user, pageForce: false });\n      // export\n      const _moduleInfo = mparse.parseInfo(atomClass.module);\n      const beanFullName = `${_moduleInfo.relativeName}.atom.${_atomClass.bean}`;\n      const resExport = await ctx.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { atomClass, options, fields, items, user },\n        fn: 'exportBulk',\n      });\n      // file\n      const resFile = await ctx.executeBean({\n        beanModule: 'a-file',\n        beanFullName: 'a-file.service.file',\n        context: { fileContent: resExport.data, meta: resExport.meta, user },\n        fn: '_upload',\n      });\n      // ok\n      return resFile;\n    }\n\n    _appendRevisionToHistory({ item }) {\n      if (!item.atomRevision || item.atomStage !== 2) return;\n      if (!item._meta) item._meta = {};\n      if (!item._meta.flags) item._meta.flags = [];\n      item._meta.flags.push(`Rev.${item.atomRevision}`);\n    }\n\n    // atom other functions\n\n    async get({ atomId }) {\n      return await this.modelAtom.get({ id: atomId });\n    }\n\n    async flow({ key, atom: { atomFlowId } }) {\n      await this.modelAtom.update({\n        id: key.atomId,\n        atomFlowId,\n      });\n      // notify\n      this._notifyDrafts();\n    }\n\n    async star({ key, atom: { star = 1 }, user }) {\n      // get\n      const atom = await this.get({ atomId: key.atomId });\n      if (atom.atomStage !== 1) ctx.throw.module(moduleInfo.relativeName, 1010);\n      // check if exists\n      let diff = 0;\n      const _star = await this.modelAtomStar.get({\n        userId: user.id,\n        atomId: key.atomId,\n      });\n      if (_star && !star) {\n        diff = -1;\n        // delete\n        await this.modelAtomStar.delete({\n          id: _star.id,\n        });\n      } else if (!_star && star) {\n        diff = 1;\n        // new\n        await this.modelAtomStar.insert({\n          userId: user.id,\n          atomId: key.atomId,\n          star: 1,\n        });\n      }\n      // starCount\n      let starCount = atom.starCount;\n      if (diff !== 0) {\n        starCount += diff;\n        await this.modelAtom.update({\n          id: key.atomId,\n          starCount,\n        });\n      }\n      // notify\n      this._notifyStars();\n      // ok\n      return { star, starCount };\n    }\n\n    async readCount({ key, atom: { readCount = 1 }, user }) {\n      await this.modelAtom.query('update aAtom set readCount = readCount + ? where iid=? and id=?',\n        [ readCount, ctx.instance.id, key.atomId ]);\n    }\n\n    async comment({ key, atom: { comment = 1 }, user }) {\n      await this.modelAtom.query('update aAtom set commentCount = commentCount + ? where iid=? and id=?',\n        [ comment, ctx.instance.id, key.atomId ]);\n    }\n\n    async attachment({ key, atom: { attachment = 1 }, user }) {\n      await this.modelAtom.query('update aAtom set attachmentCount = attachmentCount + ? where iid=? and id=?',\n        [ attachment, ctx.instance.id, key.atomId ]);\n    }\n\n    async stats({ atomIds, user }) {\n      const list = [];\n      for (const atomId of atomIds) {\n        const res = await this.checkRightRead({ atom: { id: atomId }, user, checkFlow: true });\n        if (res) {\n          list.push({\n            id: atomId,\n            atomId,\n            readCount: res.readCount,\n            commentCount: res.commentCount,\n            starCount: res.starCount,\n          });\n        }\n      }\n      return list;\n    }\n\n    async labels({ key, atom: { labels = null }, user }) {\n      // get\n      const atom = await this.get({ atomId: key.atomId });\n      if (atom.atomStage !== 1) ctx.throw.module(moduleInfo.relativeName, 1010);\n      // force delete\n      await this.modelAtomLabel.delete({\n        userId: user.id,\n        atomId: key.atomId,\n      });\n      await this.modelAtomLabelRef.delete({\n        userId: user.id,\n        atomId: key.atomId,\n      });\n      // new\n      if (labels && labels.length > 0) {\n        await this.modelAtomLabel.insert({\n          userId: user.id,\n          atomId: key.atomId,\n          labels: JSON.stringify(labels),\n        });\n        for (const labelId of labels) {\n          await this.modelAtomLabelRef.insert({\n            userId: user.id,\n            atomId: key.atomId,\n            labelId,\n          });\n        }\n      }\n    }\n\n    async schema({ atomClass, schema }) {\n      const validator = await this.validator({ atomClass });\n      if (!validator) return null;\n      return ctx.bean.validation.getSchema({ module: validator.module, validator: validator.validator, schema });\n    }\n\n    async validator({ atomClass: { id } }) {\n      let atomClass = await this.atomClass.get({ id });\n      atomClass = await this.atomClass.top(atomClass);\n      return await this.atomClass.validator({ atomClass });\n    }\n\n    // atom\n\n    async _add({\n      atomClass: { id, atomClassName, atomClassIdParent = 0 },\n      atom: {\n        itemId, atomName, roleIdOwner = 0,\n        atomStatic = 0, atomStaticKey = null, atomRevision = 0,\n        atomLanguage = null, atomCategoryId = 0, atomTags = null,\n        allowComment = 1,\n      },\n      user,\n    }) {\n      let atomClassId = id;\n      if (!atomClassId) atomClassId = await this.getAtomClassId({ atomClassName, atomClassIdParent });\n      const res = await this.modelAtom.insert({\n        atomStage: 0,\n        itemId,\n        atomClassId,\n        atomName,\n        atomStatic,\n        atomStaticKey,\n        atomRevision,\n        atomLanguage,\n        atomCategoryId,\n        atomTags,\n        allowComment,\n        userIdCreated: user.id,\n        userIdUpdated: user.id,\n        roleIdOwner,\n      });\n      return res.insertId;\n    }\n\n    async _update({ atom/* , user,*/ }) {\n      await this.modelAtom.update(atom);\n    }\n\n    async _delete({\n      atom,\n      /* user,*/\n    }) {\n      // aAtom\n      await this.modelAtom.delete(atom);\n      // aFile\n      await this.modelFile.delete({ atomId: atom.id });\n    }\n\n    async _get({ atomClass, options, key, mode, user }) {\n      if (!options) options = {};\n      const resource = options.resource || 0;\n      const resourceLocale = options.resourceLocale || ctx.locale;\n      //\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const tableName = this._getTableName({ atomClass: _atomClass, mode });\n      const sql = this.sqlProcedure.getAtom({\n        iid: ctx.instance.id,\n        userIdWho: user ? user.id : 0,\n        tableName, atomId: key.atomId,\n        resource, resourceLocale,\n      });\n      return await ctx.model.queryOne(sql);\n    }\n\n    async _list({ tableName, options: { where, orders, page, star = 0, label = 0, comment = 0, file = 0, stage = 'archive', language, category = 0, tag = 0, mine = 0, resource = 0, resourceLocale }, user, pageForce = true, count = 0 }) {\n      page = ctx.bean.util.page(page, pageForce);\n      stage = typeof stage === 'number' ? stage : ctx.constant.module(moduleInfo.relativeName).atom.stage[stage];\n      const sql = this.sqlProcedure.selectAtoms({\n        iid: ctx.instance.id,\n        userIdWho: user ? user.id : 0,\n        tableName, where, orders, page,\n        star, label, comment, file, count,\n        stage,\n        language, category, tag,\n        mine,\n        resource, resourceLocale,\n      });\n      const res = await ctx.model.query(sql);\n      return count ? res[0]._count : res;\n    }\n\n    // right\n\n    async checkRoleRightRead({ atom: { id }, roleId }) {\n      // not check draft\n      // archive/history\n      const sql = this.sqlProcedure.checkRoleRightRead({\n        iid: ctx.instance.id,\n        roleIdWho: roleId,\n        atomId: id,\n      });\n      return await ctx.model.queryOne(sql);\n    }\n\n    async checkRightRead({ atom: { id }, user, checkFlow }) {\n      // draft: only userIdUpdated\n      const _atom = await this.modelAtom.get({ id });\n      if (!_atom) ctx.throw.module(moduleInfo.relativeName, 1002);\n      if (_atom.atomStage === 0) {\n        // checkFlow\n        if (_atom.atomFlowId > 0 && checkFlow) {\n          const flow = await ctx.bean.flow.get({ flowId: _atom.atomFlowId, history: true, user });\n          if (!flow) return null;\n          return _atom;\n        }\n        // 1. closed\n        if (_atom.atomClosed) return null;\n        // 2. flow\n        if (_atom.atomFlowId > 0) return null;\n        // 3. self\n        if (_atom.userIdUpdated === user.id) return _atom;\n        // others\n        return null;\n      }\n      // archive/history\n      const sql = this.sqlProcedure.checkRightRead({\n        iid: ctx.instance.id,\n        userIdWho: user.id,\n        atomId: id,\n      });\n      return await ctx.model.queryOne(sql);\n    }\n\n    async checkRightAction({ atom: { id }, action, stage, user, checkFlow }) {\n      // atom\n      const _atom = await this.modelAtom.get({ id });\n      if (!_atom) ctx.throw.module(moduleInfo.relativeName, 1002);\n      // atomClass\n      const atomClass = await ctx.bean.atomClass.get({ id: _atom.atomClassId });\n      if (!atomClass) ctx.throw.module(moduleInfo.relativeName, 1002);\n      // atom bean\n      const _moduleInfo = mparse.parseInfo(atomClass.module);\n      const _atomClass = await ctx.bean.atomClass.atomClass(atomClass);\n      const beanFullName = `${_moduleInfo.relativeName}.atom.${_atomClass.bean}`;\n      return await ctx.executeBean({\n        beanModule: _moduleInfo.relativeName,\n        beanFullName,\n        context: { atom: _atom, atomClass, action, stage, user, checkFlow },\n        fn: 'checkRightAction',\n      });\n    }\n\n    async _checkRightAction({ atom, action, stage, user, checkFlow }) {\n      const _atom = atom;\n      if (!_atom) ctx.throw.module(moduleInfo.relativeName, 1002);\n      if ((stage === 'draft' && _atom.atomStage > 0) || ((stage === 'archive' || stage === 'history') && _atom.atomStage === 0)) return null;\n      // action.stage\n      const atomClass = await ctx.bean.atomClass.get({ id: _atom.atomClassId });\n      const actionBase = ctx.bean.base.action({ module: atomClass.module, atomClassName: atomClass.atomClassName, code: action });\n      // if (!actionBase) throw new Error(`action not found: ${atomClass.module}:${atomClass.atomClassName}:${action}`);\n      if (!actionBase) {\n        await ctx.bean.atomAction.model.delete({ atomClassId: atomClass.id, code: action });\n        return null;\n      }\n      if (actionBase.stage) {\n        const stages = actionBase.stage.split(',');\n        if (!stages.some(item => ctx.constant.module(moduleInfo.relativeName).atom.stage[item] === _atom.atomStage)) return null;\n      }\n      // actionBase.enableOnStatic\n      if (_atom.atomStatic === 1 && !actionBase.enableOnStatic) {\n        return null;\n      }\n      // draft\n      if (_atom.atomStage === 0) {\n        // checkFlow\n        if (_atom.atomFlowId > 0 && checkFlow) {\n          const flow = await ctx.bean.flow.get({ flowId: _atom.atomFlowId, history: true, user });\n          if (!flow) return null;\n          return _atom;\n        }\n        // 1. closed\n        if (_atom.atomClosed) return null;\n        // 2. flow\n        if (_atom.atomFlowId > 0) return null;\n        // 3. self\n        if (_atom.userIdUpdated === user.id) return _atom;\n        // others\n        return null;\n      }\n      // draft: must closed\n      let _atomDraft;\n      if (_atom.atomIdDraft) {\n        _atomDraft = await this.modelAtom.get({ id: _atom.atomIdDraft });\n      }\n      if (_atomDraft && !_atomDraft.atomClosed && !actionBase.enableOnOpened) return null;\n      // enable/disable\n      if (action === 6 && _atom.atomDisabled === 0) return null;\n      if (action === 7 && _atom.atomDisabled === 1) return null;\n      // check archive/history\n      const sql = this.sqlProcedure.checkRightAction({\n        iid: ctx.instance.id,\n        userIdWho: user.id,\n        atomId: atom.id,\n        action,\n      });\n      return await ctx.model.queryOne(sql);\n    }\n\n    async checkRightActionBulk({\n      atomClass: { id, module, atomClassName, atomClassIdParent = 0 },\n      action,\n      user,\n    }) {\n      if (!id) id = await this.getAtomClassId({ module, atomClassName, atomClassIdParent });\n      const sql = this.sqlProcedure.checkRightActionBulk({\n        iid: ctx.instance.id,\n        userIdWho: user.id,\n        atomClassId: id,\n        action,\n      });\n      return await ctx.model.queryOne(sql);\n    }\n\n    async checkRightCreate({ atomClass, user }) {\n      return await this.checkRightActionBulk({ atomClass, action: 1, user });\n    }\n\n    async checkRightCreateRole({\n      atomClass: { id, module, atomClassName, atomClassIdParent = 0 },\n      roleIdOwner,\n      user,\n    }) {\n      if (!roleIdOwner) return null;\n      if (!id) id = await this.getAtomClassId({ module, atomClassName, atomClassIdParent });\n      const sql = this.sqlProcedure.checkRightCreateRole({\n        iid: ctx.instance.id,\n        userIdWho: user.id,\n        atomClassId: id,\n        roleIdOwner,\n      });\n      return await ctx.model.queryOne(sql);\n    }\n\n    // actions of atom\n    async actions({ key, basic, user }) {\n      // atomClass\n      const atomClass = await ctx.bean.atomClass.getByAtomId({ atomId: key.atomId });\n      if (!atomClass) ctx.throw.module(moduleInfo.relativeName, 1002);\n      // actions\n      const _basic = basic ? 'and a.code in (3,4)' : '';\n      const sql = `\n        select a.*,b.module,b.atomClassName,b.atomClassIdParent from aAtomAction a\n          left join aAtomClass b on a.atomClassId=b.id\n            where a.iid=? and a.deleted=0 and a.bulk=0 and a.atomClassId=? ${_basic}\n              order by a.code asc\n      `;\n      const actions = await ctx.model.query(sql, [ ctx.instance.id, atomClass.id ]);\n      // actions res\n      const actionsRes = [];\n      for (const action of actions) {\n        const res = await this.checkRightAction({ atom: { id: key.atomId }, action: action.code, user });\n        if (res) actionsRes.push(action);\n      }\n      return actionsRes;\n    }\n\n    // actionsBulk of atomClass\n    async actionsBulk({ atomClass: { id, module, atomClassName, atomClassIdParent = 0 }, user }) {\n      if (!id) id = await this.getAtomClassId({ module, atomClassName, atomClassIdParent });\n      const sql = this.sqlProcedure.checkRightActionBulk({\n        iid: ctx.instance.id,\n        userIdWho: user.id,\n        atomClassId: id,\n      });\n      return await ctx.model.query(sql);\n    }\n\n    // preffered roles\n    async preferredRoles({ atomClass, user }) {\n      // atomClass\n      atomClass = await ctx.bean.atomClass.get(atomClass);\n\n      const roles = await ctx.model.query(\n        `select a.*,b.userId,c.roleName as roleNameWho from aViewRoleRightAtomClass a\n          inner join aUserRole b on a.roleIdWho=b.roleId\n          left join aRole c on a.roleIdWho=c.id\n          where a.iid=? and a.atomClassId=? and a.action=1 and b.userId=?\n          order by a.roleIdWho desc`,\n        [ ctx.instance.id, atomClass.id, user.id ]);\n      return roles;\n    }\n\n    _getTableName({ atomClass, mode }) {\n      const tableNameModes = atomClass.tableNameModes || {};\n      if (mode === 'search') {\n        return tableNameModes.search || tableNameModes.full || tableNameModes.default || atomClass.tableName;\n      }\n      return tableNameModes[mode] || tableNameModes.default || atomClass.tableName;\n    }\n\n    _notifyDrafts() {\n      ctx.bean.stats.notify({\n        module: moduleInfo.relativeName,\n        name: 'drafts',\n      });\n    }\n\n    _notifyStars() {\n      ctx.bean.stats.notify({\n        module: moduleInfo.relativeName,\n        name: 'stars',\n      });\n    }\n\n  }\n\n  return Atom;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class AtomAction extends ctx.app.meta.BeanModuleBase {\n\n    constructor(moduleName) {\n      super(ctx, 'atomAction');\n      this.moduleName = moduleName || ctx.module.info.relativeName;\n    }\n\n    get model() {\n      return ctx.model.module(moduleInfo.relativeName).atomAction;\n    }\n\n    async get({ id, atomClassId, code }) {\n      const data = id ? { id } : { atomClassId, code };\n      const res = await this.model.get(data);\n      if (res) return res;\n      // lock\n      return await ctx.app.meta.util.lock({\n        subdomain: ctx.subdomain,\n        resource: `${moduleInfo.relativeName}.atomAction.register`,\n        fn: async () => {\n          return await ctx.app.meta.util.executeBean({\n            subdomain: ctx.subdomain,\n            beanModule: moduleInfo.relativeName,\n            beanFullName: 'atomAction',\n            context: { atomClassId, code },\n            fn: '_registerLock',\n          });\n        },\n      });\n    }\n\n    async _registerLock({ atomClassId, code }) {\n      // get\n      const res = await this.model.get({ atomClassId, code });\n      if (res) return res;\n      const atomClass = await ctx.bean.atomClass.get({ id: atomClassId });\n      const action = ctx.bean.base.action({ module: atomClass.module, atomClassName: atomClass.atomClassName, code });\n      const data = {\n        atomClassId,\n        code,\n        name: action.name,\n        bulk: action.bulk || 0,\n      };\n      // insert\n      const res2 = await this.model.insert(data);\n      data.id = res2.insertId;\n      return data;\n    }\n\n  }\n\n  return AtomAction;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class AtomClass extends ctx.app.meta.BeanModuleBase {\n\n    constructor(moduleName) {\n      super(ctx, 'atomClass');\n      this.moduleName = moduleName || ctx.module.info.relativeName;\n    }\n\n    get model() {\n      return ctx.model.module(moduleInfo.relativeName).atomClass;\n    }\n\n    async atomClass(atomClass) {\n      atomClass = await this.top(atomClass);\n      return ctx.bean.base.atomClass({ module: atomClass.module, atomClassName: atomClass.atomClassName });\n    }\n\n    async top(atomClass) {\n      while (true) {\n        if (atomClass.atomClassIdParent === 0) break;\n        atomClass = await this.get({ id: atomClass.atomClassIdParent });\n      }\n      return atomClass;\n    }\n\n    async get({ id, module, atomClassName, atomClassIdParent = 0 }) {\n      module = module || this.moduleName;\n      const data = id ? { id } : { module, atomClassName, atomClassIdParent };\n      const res = await this.model.get(data);\n      if (res) return res;\n      if (!module || !atomClassName) ctx.throw.module(moduleInfo.relativeName, 1011);\n      // lock\n      return await ctx.app.meta.util.lock({\n        subdomain: ctx.subdomain,\n        resource: `${moduleInfo.relativeName}.atomClass.register`,\n        fn: async () => {\n          return await ctx.app.meta.util.executeBean({\n            subdomain: ctx.subdomain,\n            beanModule: moduleInfo.relativeName,\n            beanFullName: 'atomClass',\n            context: { module, atomClassName, atomClassIdParent },\n            fn: '_registerLock',\n          });\n        },\n      });\n    }\n\n    async _registerLock({ module, atomClassName, atomClassIdParent }) {\n      // get\n      const res = await this.model.get({ module, atomClassName, atomClassIdParent });\n      if (res) return res;\n      // data\n      const atomClass = ctx.bean.base.atomClass({ module, atomClassName });\n      if (!atomClass) throw new Error(`atomClass ${module}:${atomClassName} not found!`);\n      const data = {\n        module,\n        atomClassName,\n        atomClassIdParent,\n      };\n      // insert\n      const res2 = await this.model.insert(data);\n      data.id = res2.insertId;\n      return data;\n    }\n\n    async getByAtomId({ atomId }) {\n      const res = await this.model.query(`\n        select a.*,b.id as atomId,b.itemId from aAtomClass a\n          left join aAtom b on a.id=b.atomClassId\n            where b.iid=? and b.id=?\n        `, [ ctx.instance.id, atomId ]);\n      return res[0];\n    }\n\n    async getTopByAtomId({ atomId }) {\n      const atomClass = await this.getByAtomId({ atomId });\n      return await this.top(atomClass);\n    }\n\n    async validator({ atomClass }) {\n      // default\n      const _module = ctx.app.meta.modules[atomClass.module];\n      const validator = _module.main.meta.base.atoms[atomClass.atomClassName].validator;\n      return validator ? {\n        module: atomClass.module,\n        validator,\n      } : null;\n    }\n\n    async validatorSearch({ atomClass }) {\n      const _module = ctx.app.meta.modules[atomClass.module];\n      const validator = _module.main.meta.base.atoms[atomClass.atomClassName].search.validator;\n      return validator ? {\n        module: atomClass.module,\n        validator,\n      } : null;\n    }\n\n  }\n\n  return AtomClass;\n};\n","const require3 = require('require3');\nconst extend = require3('extend2');\nconst mparse = require3('egg-born-mparse').default;\n\nmodule.exports = ctx => {\n\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n\n  class Auth {\n    // return current user auth info\n    //   { op:{id},agent:{id},provider}\n    async echo() {\n      try {\n        // check\n        await ctx.bean.user.check();\n        // logined\n        return await this.getLoginInfo();\n      } catch (e) {\n        // deleted,disabled\n        return await this.logout();\n      }\n    }\n\n    async check() {\n      return await this.getLoginInfo();\n    }\n\n    async logout() {\n      await ctx.logout();\n      await ctx.bean.user.loginAsAnonymous();\n      return await this.getLoginInfo();\n    }\n\n    async getLoginInfo() {\n      const config = await this._getConfig();\n      const info = {\n        user: ctx.state.user,\n        instance: this._getInstance(),\n        config,\n      };\n      // login info event\n      await ctx.bean.event.invoke({\n        name: 'loginInfo', data: { info },\n      });\n      return info;\n    }\n\n    _getInstance() {\n      return {\n        name: ctx.instance.name,\n        title: ctx.instance.title,\n      };\n    }\n\n    async _getConfig() {\n      // config\n      const config = {\n        modules: {\n          'a-base': {\n            account: this._getAccount(),\n          },\n        },\n      };\n      // theme\n      const themeStatus = `user-theme:${ctx.state.user.agent.id}`;\n      const theme = await ctx.bean.status.module('a-user').get(themeStatus);\n      if (theme) {\n        config.theme = theme;\n      }\n      // localeModules\n      config.localeModules = ctx.bean.base.localeModules();\n      // ok\n      return config;\n    }\n\n    _getAccount() {\n      // account\n      const account = extend(true, {}, ctx.config.module(moduleInfo.relativeName).account);\n      account.activatedRoles = undefined;\n      // url\n      for (const key in account.activationProviders) {\n        const relativeName = account.activationProviders[key];\n        if (relativeName) {\n          const moduleConfig = ctx.config.module(relativeName);\n          extend(true, account.url, moduleConfig.account.url);\n        }\n      }\n      return account;\n    }\n\n    async _installAuthProviders() {\n      // registerAllRouters\n      this._registerAllRouters();\n      // registerAllProviders\n      await this._registerAllProviders();\n    }\n\n    _registerAllRouters() {\n      const authProviders = ctx.bean.base.authProviders();\n      for (const key in authProviders) {\n        const [ moduleRelativeName, providerName ] = key.split(':');\n        this._registerProviderRouters(moduleRelativeName, providerName);\n      }\n    }\n\n    _registerProviderRouters(moduleRelativeName, providerName) {\n      // config\n      const moduleInfo = mparse.parseInfo(moduleRelativeName);\n      const config = {\n        loginURL: `/api/${moduleInfo.url}/passport/${moduleRelativeName}/${providerName}`,\n        callbackURL: `/api/${moduleInfo.url}/passport/${moduleRelativeName}/${providerName}/callback`,\n      };\n      // authenticate\n      const authenticate = _createAuthenticate(moduleRelativeName, providerName, config);\n      // middlewares\n      const middlewaresPost = [];\n      const middlewaresGet = [];\n      if (!ctx.app.meta.isTest) middlewaresPost.push('inner');\n      middlewaresPost.push(authenticate);\n      middlewaresGet.push(authenticate);\n      // mount routes\n      const routes = [\n        { name: `get:${config.loginURL}`, method: 'get', path: '/' + config.loginURL, middlewares: middlewaresGet, meta: { auth: { enable: false } } },\n        { name: `post:${config.loginURL}`, method: 'post', path: '/' + config.loginURL, middlewares: middlewaresPost, meta: { auth: { enable: false } } },\n        { name: `get:${config.callbackURL}`, method: 'get', path: '/' + config.callbackURL, middlewares: middlewaresGet, meta: { auth: { enable: false } } },\n        // { name: `post:${config.callbackURL}`, method: 'post', path: '/' + config.callbackURL, middlewares, meta: { auth: { enable: false } } },\n      ];\n      for (const route of routes) {\n        ctx.app.meta.router.unRegister(route.name);\n        ctx.app.meta.router.register(moduleInfo, route);\n      }\n    }\n\n    async _registerAllProviders() {\n      await this._registerInstanceProviders(ctx.instance.name, ctx.instance.id);\n    }\n\n    async _registerInstanceProviders(subdomain, iid) {\n      const authProviders = ctx.bean.base.authProviders();\n      for (const key in authProviders) {\n        const [ moduleRelativeName, providerName ] = key.split(':');\n        await this._registerInstanceProvider(subdomain, iid, moduleRelativeName, providerName);\n      }\n    }\n\n    async _registerInstanceProvider(subdomain, iid, moduleRelativeName, providerName) {\n      // provider of db\n      const providerItem = await ctx.bean.user.getAuthProvider({\n        subdomain,\n        iid,\n        module: moduleRelativeName,\n        providerName,\n      });\n      if (!providerItem) return;\n      // strategy\n      const strategyName = `${iid}:${moduleRelativeName}:${providerName}`;\n      // unuse/use\n      if (providerItem.disabled === 0) {\n        // provider\n        const authProviders = ctx.bean.base.authProviders();\n        const provider = authProviders[`${moduleRelativeName}:${providerName}`];\n        if (provider.handler) {\n          // config\n          const config = provider.config;\n          config.passReqToCallback = true;\n          config.failWithError = false;\n          config.successRedirect = config.successReturnToOrRedirect = (provider.meta.mode === 'redirect') ? '/' : false;\n          // handler\n          const handler = provider.handler(ctx.app);\n          // use strategy\n          ctx.app.passport.unuse(strategyName);\n          ctx.app.passport.use(strategyName, new handler.strategy(config, handler.callback));\n        }\n      } else {\n        // unuse strategy\n        ctx.app.passport.unuse(strategyName);\n      }\n    }\n\n  }\n\n  return Auth;\n};\n\nfunction _createAuthenticate(moduleRelativeName, providerName, _config) {\n  return async function(ctx, next) {\n    // provider of db\n    const providerItem = await ctx.bean.user.getAuthProvider({\n      module: moduleRelativeName,\n      providerName,\n    });\n    if (!providerItem || providerItem.disabled !== 0) ctx.throw(423);\n\n    // returnTo\n    if (ctx.url.indexOf(_config.callbackURL) === -1) {\n      if (ctx.request.query && ctx.request.query.returnTo) {\n        ctx.session.returnTo = ctx.request.query.returnTo;\n      } else {\n        delete ctx.session.returnTo; // force to delete\n      }\n    }\n\n    // provider\n    const authProviders = ctx.bean.base.authProviders();\n    const provider = authProviders[`${moduleRelativeName}:${providerName}`];\n\n    // config\n    const config = provider.config;\n    config.passReqToCallback = true;\n    config.failWithError = false;\n    config.loginURL = ctx.bean.base.getAbsoluteUrl(_config.loginURL);\n    config.callbackURL = ctx.bean.base.getAbsoluteUrl(_config.callbackURL);\n    config.state = ctx.request.query.state;\n    config.successRedirect = config.successReturnToOrRedirect = (provider.meta.mode === 'redirect') ? '/' : false;\n\n    // config functions\n    if (provider.configFunctions) {\n      for (const key in provider.configFunctions) {\n        config[key] = function(...args) {\n          return provider.configFunctions[key](ctx, ...args);\n        };\n      }\n    }\n\n    // invoke authenticate\n    const strategyName = `${ctx.instance.id}:${moduleRelativeName}:${providerName}`;\n    const authenticate = ctx.app.passport.authenticate(strategyName, config);\n    await authenticate(ctx, next);\n  };\n}\n\n","const path = require('path');\nconst require3 = require('require3');\nconst fse = require3('fs-extra');\nconst extend = require3('extend2');\n\nconst _modulesLocales = {};\nconst _themesLocales = {};\nconst _locales = {};\nconst _localeModules = {};\nconst _resourceTypes = {};\nconst _atomClasses = {};\nconst _actions = {};\nconst _authProvidersLocales = {};\n\nmodule.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Base extends ctx.app.meta.BeanModuleBase {\n\n    constructor(moduleName) {\n      super(ctx, 'base');\n      this.moduleName = moduleName || ctx.module.info.relativeName;\n    }\n\n    get host() {\n      const config = ctx.config.module(moduleInfo.relativeName);\n      return config.host || ctx.host;\n    }\n\n    get protocol() {\n      const config = ctx.config.module(moduleInfo.relativeName);\n      return config.protocol || ctx.protocol;\n    }\n\n    getAbsoluteUrl(path) {\n      const prefix = this.host ? `${this.protocol}://${this.host}` : '';\n      return `${prefix}${path}`;\n    }\n\n    // get forward url\n    getForwardUrl(path) {\n      const prefix = (ctx.app.meta.isTest || ctx.app.meta.isLocal) ? ctx.app.config.static.prefix + 'public/' : '/public/';\n      return `${prefix}${ctx.instance.id}/${path}`;\n    }\n\n    // get root path\n    async getRootPath() {\n      if (ctx.app.meta.isTest || ctx.app.meta.isLocal) {\n        return ctx.app.config.static.dir;\n      }\n      const dir = ctx.config.module(moduleInfo.relativeName).publicDir || path.join(require('os').homedir(), 'cabloy', ctx.app.name, 'public');\n      await fse.ensureDir(dir);\n      return dir;\n    }\n\n    // get path\n    async getPath(subdir, ensure) {\n      const rootPath = await this.getRootPath();\n      const dir = path.join(rootPath, ctx.instance.id.toString(), subdir || '');\n      if (ensure) {\n        await fse.ensureDir(dir);\n      }\n      return dir;\n    }\n\n    // static\n    getStaticUrl(path) {\n      return this.getAbsoluteUrl(`/api/static${path}`);\n    }\n\n    // alert\n    getAlertUrl({ data }) {\n      return this.getAbsoluteUrl(`/#!/a/basefront/base/alert?data=${encodeURIComponent(JSON.stringify(data))}`);\n    }\n\n    modules() {\n      if (!_modulesLocales[ctx.locale]) {\n        _modulesLocales[ctx.locale] = this._prepareModules();\n      }\n      return _modulesLocales[ctx.locale];\n    }\n\n    themes() {\n      if (!_themesLocales[ctx.locale]) {\n        _themesLocales[ctx.locale] = this._prepareThemes();\n      }\n      return _themesLocales[ctx.locale];\n    }\n\n    locales() {\n      if (!_locales[ctx.locale]) {\n        _locales[ctx.locale] = this._prepareLocales();\n      }\n      return _locales[ctx.locale];\n    }\n\n    localeModules() {\n      if (!_localeModules[ctx.locale]) {\n        _localeModules[ctx.locale] = this._prepareLocaleModules();\n      }\n      return _localeModules[ctx.locale];\n    }\n\n    resourceTypes() {\n      if (!_resourceTypes[ctx.locale]) {\n        _resourceTypes[ctx.locale] = this._prepareResourceTypes();\n      }\n      return _resourceTypes[ctx.locale];\n    }\n\n    atomClasses() {\n      if (!_atomClasses[ctx.locale]) {\n        _atomClasses[ctx.locale] = this._prepareAtomClasses();\n      }\n      return _atomClasses[ctx.locale];\n    }\n\n    atomClass({ module, atomClassName }) {\n      const _atomClasses = this.atomClasses();\n      return _atomClasses[module] && _atomClasses[module][atomClassName];\n    }\n\n    actions() {\n      if (!_actions[ctx.locale]) {\n        _actions[ctx.locale] = this._prepareActions();\n      }\n      return _actions[ctx.locale];\n    }\n\n    action({ module, atomClassName, code, name }) {\n      const _actions = this.actions();\n      const actions = _actions[module][atomClassName];\n      if (name) return actions[name];\n      const key = Object.keys(actions).find(key => actions[key].code === code);\n      return actions[key];\n    }\n\n    authProviders() {\n      const subdomain = ctx.subdomain;\n      if (!_authProvidersLocales[subdomain]) _authProvidersLocales[subdomain] = {};\n      const authProvidersSubdomain = _authProvidersLocales[subdomain];\n      if (!authProvidersSubdomain[ctx.locale]) {\n        authProvidersSubdomain[ctx.locale] = this._prepareAuthProviders();\n      }\n      return authProvidersSubdomain[ctx.locale];\n    }\n\n    authProvidersReset() {\n      const subdomain = ctx.subdomain;\n      _authProvidersLocales[subdomain] = {};\n    }\n\n    // inner methods\n\n    _prepareModules() {\n      const modules = {};\n      for (const relativeName in ctx.app.meta.modules) {\n        const module = ctx.app.meta.modules[relativeName];\n        const _module = {\n          name: relativeName,\n          title: module.package.title || module.info.name,\n          description: ctx.text(module.package.description),\n          info: module.info,\n        };\n        _module.titleLocale = ctx.text(_module.title);\n        modules[relativeName] = _module;\n      }\n      return modules;\n    }\n\n    _prepareThemes() {\n      const modules = {};\n      for (const relativeName in ctx.app.meta.modules) {\n        const module = ctx.app.meta.modules[relativeName];\n        if (module.package.eggBornModule && module.package.eggBornModule.theme) {\n          const _module = {\n            name: relativeName,\n            title: module.package.title || module.info.name,\n            description: ctx.text(module.package.description),\n            info: module.info,\n          };\n          _module.titleLocale = ctx.text(_module.title);\n          modules[relativeName] = _module;\n        }\n      }\n      return modules;\n    }\n\n    _prepareLocales() {\n      const locales = [];\n      const config = ctx.config.module(moduleInfo.relativeName);\n      for (const locale in config.locales) {\n        locales.push({\n          title: ctx.text(config.locales[locale]),\n          value: locale,\n        });\n      }\n      return locales;\n    }\n\n    _prepareLocaleModules() {\n      const localeModules = [];\n      for (const module of ctx.app.meta.modulesArray) {\n        const locale = module.package.eggBornModule && module.package.eggBornModule.locale;\n        if (!locale) continue;\n        const locales = locale.split(',');\n        if (locales.findIndex(item => item === ctx.locale) > -1) {\n          localeModules.push(module.info.relativeName);\n        }\n      }\n      return localeModules;\n    }\n\n    _prepareResourceTypes() {\n      const resourceTypes = {};\n      for (const module of ctx.app.meta.modulesArray) {\n        const moduleName = module.info.relativeName;\n        const resources = module.main.meta && module.main.meta.base && module.main.meta.base.resources;\n        if (!resources) continue;\n        for (const key in resources) {\n          const resource = resources[key];\n          const fullKey = `${moduleName}:${key}`;\n          resourceTypes[fullKey] = {\n            ...resource,\n            titleLocale: ctx.text(resource.title),\n          };\n        }\n      }\n      return resourceTypes;\n    }\n\n    _prepareAtomClasses() {\n      const atomClasses = {};\n      for (const relativeName in ctx.app.meta.modules) {\n        const module = ctx.app.meta.modules[relativeName];\n        if (module.main.meta && module.main.meta.base && module.main.meta.base.atoms) {\n          const res = this._prepareAtomClassesModule(module, module.main.meta.base.atoms);\n          if (Object.keys(res).length > 0) {\n            atomClasses[relativeName] = res;\n          }\n        }\n      }\n      return atomClasses;\n    }\n\n    _prepareAtomClassesModule(module, _atoms) {\n      const atomClasses = {};\n      for (const key in _atoms) {\n        // info\n        const atomClass = {\n          name: key,\n          ..._atoms[key].info,\n        };\n        // titleLocale\n        atomClass.titleLocale = ctx.text(atomClass.title);\n        // ok\n        atomClasses[key] = atomClass;\n      }\n      return atomClasses;\n    }\n\n    _prepareActions() {\n      const actions = {};\n      for (const relativeName in ctx.app.meta.modules) {\n        const module = ctx.app.meta.modules[relativeName];\n        if (module.main.meta && module.main.meta.base && module.main.meta.base.atoms) {\n          actions[relativeName] = {};\n          for (const atomClassName in module.main.meta.base.atoms) {\n            actions[relativeName][atomClassName] = this._prepareActionsAtomClass(module, module.main.meta.base.atoms[atomClassName]);\n          }\n        }\n      }\n      return actions;\n    }\n\n    _prepareActionsAtomClass(module, atomClass) {\n      const actions = {};\n      const _actions = atomClass.actions;\n      const _actionsSystem = ctx.constant.module(moduleInfo.relativeName).atom.action;\n      const _actionsSystemMeta = ctx.constant.module(moduleInfo.relativeName).atom.actionMeta;\n      const _actionsAll = extend(true, {}, _actionsSystemMeta, _actions);\n      for (const key in _actionsAll) {\n        if (key === 'custom') continue;\n        const action = _actionsAll[key];\n        if (!action.code) action.code = _actionsSystem[key];\n        action.name = key;\n        action.titleLocale = ctx.text(action.title);\n        actions[key] = action;\n      }\n      return actions;\n    }\n\n    _prepareAuthProviders() {\n      const authProviders = {};\n      for (const relativeName in ctx.app.meta.modules) {\n        const module = ctx.app.meta.modules[relativeName];\n        let metaAuth = module.main.meta && module.main.meta.auth;\n        if (!metaAuth) continue;\n        if (typeof metaAuth === 'function') {\n          metaAuth = metaAuth(ctx);\n        }\n        if (!metaAuth.providers) continue;\n        // loop\n        for (const providerName in metaAuth.providers) {\n          const _authProvider = metaAuth.providers[providerName];\n          if (!_authProvider) continue;\n          const authProvider = {\n            meta: { ..._authProvider.meta }, // for titleLocale separately\n            config: _authProvider.config,\n            configFunctions: _authProvider.configFunctions,\n            handler: _authProvider.handler,\n          };\n          if (authProvider.meta && authProvider.meta.title) {\n            authProvider.meta.titleLocale = ctx.text(authProvider.meta.title);\n          }\n          authProviders[`${relativeName}:${providerName}`] = authProvider;\n        }\n      }\n      return authProviders;\n    }\n\n  }\n\n  return Base;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Category {\n\n    get modelCategory() {\n      return ctx.model.module(moduleInfo.relativeName).category;\n    }\n\n    async get({ categoryId, setLocale }) {\n      const category = await this.modelCategory.get({ id: categoryId });\n      if (category && setLocale) {\n        category.categoryNameLocale = ctx.text(category.categoryName);\n      }\n      return category;\n    }\n\n    async save({ categoryId, data }) {\n      await this.modelCategory.update({\n        id: categoryId,\n        categoryName: data.categoryName,\n        categoryHidden: data.categoryHidden,\n        categorySorting: data.categorySorting,\n        categoryFlag: data.categoryFlag,\n        categoryUrl: data.categoryUrl,\n      });\n    }\n\n    async count({ atomClass, language, categoryId, categoryHidden, categoryFlag }) {\n      return await this.children({ atomClass, language, categoryId, categoryHidden, categoryFlag, count: 1 });\n    }\n\n    async child({ atomClass, language, categoryId, categoryName, categoryHidden, categoryFlag, setLocale }) {\n      const list = await this.children({ atomClass, language, categoryId, categoryName, categoryHidden, categoryFlag, setLocale });\n      return list[0];\n    }\n\n    async children({ atomClass, language, categoryId, categoryName, categoryHidden, categoryFlag, setLocale, count = 0 }) {\n      //\n      const where = { };\n      if (categoryId !== undefined) where.categoryIdParent = categoryId;\n      // atomClassId\n      if (!where.categoryIdParent) {\n        // atomClass\n        atomClass = await ctx.bean.atomClass.get(atomClass);\n        where.atomClassId = atomClass.id;\n      }\n      //\n      if (language !== undefined) where.language = language;\n      if (categoryName !== undefined) where.categoryName = categoryName;\n      if (categoryHidden !== undefined) where.categoryHidden = categoryHidden;\n      if (categoryFlag !== undefined) where.categoryFlag = categoryFlag;\n      //\n      if (count) {\n        return await this.modelCategory.count(where);\n      }\n      const list = await this.modelCategory.select({\n        where,\n        orders: [[ 'categorySorting', 'asc' ], [ 'createdAt', 'asc' ]],\n      });\n      if (setLocale) {\n        for (const category of list) {\n          category.categoryNameLocale = ctx.text(category.categoryName);\n        }\n      }\n      return list;\n    }\n\n    async add({ atomClass, data }) {\n      atomClass = await ctx.bean.atomClass.get(atomClass);\n      // add\n      const res = await this.modelCategory.insert({\n        atomClassId: atomClass.id,\n        language: data.language,\n        categoryName: data.categoryName,\n        categoryHidden: data.categoryHidden || 0,\n        categorySorting: data.categorySorting || 0,\n        categoryFlag: data.categoryFlag,\n        categoryUrl: data.categoryUrl,\n        categoryIdParent: data.categoryIdParent,\n        categoryCatalog: 0,\n      });\n      // adjust catalog\n      await this.adjustCatalog(data.categoryIdParent);\n      return res.insertId;\n    }\n\n    async delete({ categoryId }) {\n      // check atoms\n      const count = await ctx.bean.atom.modelAtom.count({ atomCategoryId: categoryId });\n      if (count > 0) ctx.throw.module(moduleInfo.relativeName, 1012);\n      // check children\n      const children = await this.children({ categoryId });\n      if (children.length > 0) ctx.throw.module(moduleInfo.relativeName, 1013);\n\n      // category\n      const category = await this.modelCategory.get({ id: categoryId });\n      // parent\n      const categoryIdParent = category.categoryIdParent;\n\n      // delete\n      await this.modelCategory.delete({ id: categoryId });\n      // adjust catalog\n      await this.adjustCatalog(categoryIdParent);\n    }\n\n    async move({ categoryId, categoryIdParent }) {\n      // category\n      const category = await this.modelCategory.get({ id: categoryId });\n      // categoryIdParentOld\n      const categoryIdParentOld = category.categoryIdParent;\n      if (categoryIdParentOld === categoryIdParent) return;\n      // move\n      await this.modelCategory.update({\n        id: categoryId,\n        categoryIdParent,\n      });\n      // adjust catalog\n      await this.adjustCatalog(categoryIdParentOld);\n      await this.adjustCatalog(categoryIdParent);\n    }\n\n    // for donothing on categoryId === 0, so need not input param:atomClass\n    async adjustCatalog(categoryId) {\n      if (categoryId === 0) return;\n      const children = await this.children({ categoryId });\n      await this.modelCategory.update({\n        id: categoryId,\n        categoryCatalog: children.length === 0 ? 0 : 1,\n      });\n    }\n\n    async tree({ atomClass, language, categoryId, categoryHidden, categoryFlag, setLocale }) {\n      if (categoryId === undefined) categoryId = 0;\n      return await this._treeChildren({ atomClass, language, categoryId, categoryHidden, categoryFlag, setLocale });\n    }\n\n    async _treeChildren({ atomClass, language, categoryId, categoryHidden, categoryFlag, setLocale }) {\n      const list = await this.children({ atomClass, language, categoryId, categoryHidden, categoryFlag, setLocale });\n      for (const item of list) {\n        if (item.categoryCatalog) {\n          // only categoryId\n          item.children = await this._treeChildren({ atomClass, language, categoryId: item.id, categoryHidden, categoryFlag, setLocale });\n        }\n      }\n      return list;\n    }\n\n    async relativeTop({ categoryId, setLocale }) {\n      return await this._relativeTop({ categoryId, setLocale });\n    }\n\n    async _relativeTop({ categoryId, setLocale }) {\n      if (categoryId === 0) return null;\n      const category = await this.get({ categoryId, setLocale });\n      if (!category) return null;\n      if (category.categoryUrl) return category;\n      return await this._relativeTop({ categoryId: category.categoryIdParent, setLocale });\n    }\n\n    // categoryA.categoryB\n    async parseCategoryName({ atomClass, language, categoryName, categoryIdParent = 0, force = false }) {\n      const categoryNames = categoryName.split('.');\n      let category;\n      for (const _categoryName of categoryNames) {\n        category = await this.child({\n          atomClass, language,\n          categoryId: categoryIdParent,\n          categoryName: _categoryName,\n        });\n        // next\n        if (category) {\n          categoryIdParent = category.id;\n          continue;\n        }\n        // null\n        if (!force) return null;\n        // create\n        const categoryId = await this._register({\n          atomClass, language,\n          categoryName: _categoryName,\n          categoryIdParent,\n        });\n        category = await this.get({ categoryId });\n        // next\n        categoryIdParent = categoryId;\n      }\n      return category;\n    }\n\n    async _register({ atomClass, language, categoryName, categoryIdParent }) {\n      atomClass = await ctx.bean.atomClass.get(atomClass);\n      return await ctx.app.meta.util.lock({\n        subdomain: ctx.subdomain,\n        resource: `${moduleInfo.relativeName}.category.register.${atomClass.id}`,\n        fn: async () => {\n          return await ctx.app.meta.util.executeBean({\n            subdomain: ctx.subdomain,\n            beanModule: moduleInfo.relativeName,\n            beanFullName: 'category',\n            context: { atomClass, language, categoryName, categoryIdParent },\n            fn: '_registerLock',\n          });\n        },\n      });\n    }\n\n    async _registerLock({ atomClass, language, categoryName, categoryIdParent }) {\n      // get again\n      const category = await this.child({\n        atomClass,\n        language,\n        categoryId: categoryIdParent,\n        categoryName,\n      });\n      if (category) return category.id;\n      // add\n      return await this.add({\n        atomClass,\n        data: {\n          language,\n          categoryName,\n          categoryIdParent,\n        },\n      });\n    }\n\n  }\n  return Category;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n\n  const __atomClass = {\n    module: moduleInfo.relativeName,\n    atomClassName: 'resource',\n  };\n\n  class Resource extends ctx.app.meta.BeanModuleBase {\n\n    constructor(moduleName) {\n      super(ctx, 'resource');\n      this.moduleName = moduleName || ctx.module.info.relativeName;\n    }\n\n    get model() {\n      return ctx.model.module(moduleInfo.relativeName).resource;\n    }\n\n    get modelResourceLocale() {\n      return ctx.model.module(moduleInfo.relativeName).resourceLocale;\n    }\n\n    get modelResourceRole() {\n      return ctx.model.module(moduleInfo.relativeName).resourceRole;\n    }\n\n    get sqlProcedure() {\n      return ctx.bean._getBean(moduleInfo.relativeName, 'local.procedure');\n    }\n\n    // count\n    async count({ options, user }) {\n      return await this.select({ options, user, count: 1 });\n    }\n\n    // select\n    //   donot set atomDisabled\n    async select({ atomClass, options: { where, orders, page, resourceType, star = 0, label = 0, stage = 'archive', category = 0, tag = 0, locale }, user, pageForce = false, count = 0 }) {\n      // atomClass\n      atomClass = atomClass || __atomClass;\n      // locale\n      if (locale !== false) {\n        locale = locale || ctx.locale;\n      }\n      // where\n      if (!where) where = {};\n      if (resourceType) {\n        where['f.resourceType'] = resourceType;\n      }\n      // options\n      const options = {\n        where, orders, page, star, label, stage, category, tag, resource: 1, resourceLocale: locale,\n      };\n      return await ctx.bean.atom.select({\n        atomClass, options, user, pageForce, count,\n      });\n    }\n\n    // read\n    async read({ key, options, user }) {\n      options = Object.assign({ resource: 1 }, options);\n      // locale\n      let locale = options.locale;\n      if (locale !== false) {\n        locale = locale || ctx.locale;\n      }\n      options.resourceLocale = locale;\n      return await ctx.bean.atom.read({ key, options, user });\n    }\n\n    async setLocales({ atomId, atomName }) {\n      // delete\n      await this.modelResourceLocale.delete({ atomId });\n      // setLocales\n      const locales = ctx.config.module(moduleInfo.relativeName).locales;\n      for (const locale in locales) {\n        await this.modelResourceLocale.insert({\n          atomId,\n          locale,\n          atomNameLocale: ctx.text.locale(locale, atomName),\n        });\n      }\n    }\n\n    async checkLocales() {\n      // setLocales\n      const locales = ctx.config.module(moduleInfo.relativeName).locales;\n      for (const locale in locales) {\n        await this._checkLocale({ locale });\n      }\n    }\n\n    async _checkLocale({ locale }) {\n      const resources = await this._checkResourceLocales({ locale });\n      if (resources.length === 0) return;\n      // insert locales\n      for (const resource of resources) {\n        await this.modelResourceLocale.insert({\n          atomId: resource.atomId,\n          locale,\n          atomNameLocale: ctx.text.locale(locale, resource.atomName),\n        });\n      }\n    }\n\n    async _checkResourceLocales({ locale }) {\n      const sql = this.sqlProcedure._checkResourceLocales({\n        iid: ctx.instance.id,\n        locale,\n      });\n      return await ctx.model.query(sql);\n    }\n\n    // check\n    async check({ atomStaticKeys, user }) {\n      const output = [];\n      for (const atomStaticKey of atomStaticKeys) {\n        const res = await this.checkRightResource({ atomStaticKey, user });\n        if (res) {\n          output.push({\n            passed: true,\n            atomId: res.atomId,\n            atomStaticKey,\n          });\n        } else {\n          output.push({\n            passed: false,\n            atomStaticKey,\n          });\n        }\n      }\n      return output;\n    }\n\n    async checkRightResource({ resourceAtomId, atomStaticKey, user }) {\n      if (!resourceAtomId) {\n        const atom = await ctx.bean.atom.modelAtom.get({ atomStaticKey, atomDisabled: 0, atomStage: 1 });\n        if (!atom) return null;\n        resourceAtomId = atom.id;\n      }\n      const sql = this.sqlProcedure.checkRightResource({\n        iid: ctx.instance.id,\n        userIdWho: user.id,\n        resourceAtomId,\n      });\n      return await ctx.model.queryOne(sql);\n    }\n\n    async resourceRoles({ key/* , user */ }) {\n      const list = await ctx.model.query(`\n        select a.*,b.roleName from aResourceRole a\n          left join aRole b on a.roleId=b.id\n            where a.iid=? and a.atomId=?\n            order by b.roleName\n        `, [ ctx.instance.id, key.atomId ]);\n      return list;\n    }\n\n    // add resource role\n    async addResourceRole({ atomId, atomStaticKey, roleId }) {\n      if (!atomId && !atomStaticKey) return null;\n      if (!atomId) {\n        const atom = await ctx.bean.atom.modelAtom.get({\n          atomStaticKey,\n          atomStage: 1, // archive\n        });\n        if (!atom) ctx.throw.module(moduleInfo.relativeName, 1002);\n        atomId = atom.id;\n      }\n      await this.modelResourceRole.insert({\n        atomId, roleId,\n      });\n    }\n\n    // delete resource role\n    async deleteResourceRole({ id }) {\n      await this.modelResourceRole.delete({ id });\n    }\n\n    // /* backup */\n\n    // // const roleFunctions = [\n    // //   { roleName: 'root', name: 'listComment' },\n    // // ];\n    // async addRoleFunctionBatch({ module, roleFunctions }) {\n    //   if (!roleFunctions || !roleFunctions.length) return;\n    //   module = module || this.moduleName;\n    //   for (const roleFunction of roleFunctions) {\n    //     // func\n    //     const func = await ctx.bean.function.get({ module, name: roleFunction.name });\n    //     if (roleFunction.roleName) {\n    //       // role\n    //       const role = await this.get({ roleName: roleFunction.roleName });\n    //       // add role function\n    //       await this.addRoleFunction({\n    //         roleId: role.id,\n    //         functionId: func.id,\n    //       });\n    //     }\n    //   }\n    // }\n\n    // // function rights\n    // async functionRights({ menu, roleId, page }) {\n    //   // check locale\n    //   const locale = ctx.locale;\n    //   // list\n    //   page = ctx.bean.util.page(page, false);\n    //   const _limit = ctx.model._limit(page.size, page.index);\n    //   const list = await ctx.model.query(`\n    //     select a.*,b.module,b.name,b.title,b.sceneId,g.sceneName,b.sorting,f.titleLocale from aRoleFunction a\n    //       left join aFunction b on a.functionId=b.id\n    //       left join aFunctionLocale f on a.functionId=f.functionId\n    //       left join aFunctionScene g on g.id=b.sceneId\n    //         where a.iid=? and a.roleId=? and b.menu=? and f.locale=?\n    //         order by b.module,g.sceneSorting,b.sorting\n    //         ${_limit}\n    //     `, [ ctx.instance.id, roleId, menu, locale ]);\n    //   return list;\n    // }\n\n    // // function spreads\n    // async functionSpreads({ menu, roleId, page }) {\n    //   // check locale\n    //   const locale = ctx.locale;\n    //   // list\n    //   page = ctx.bean.util.page(page, false);\n    //   const _limit = ctx.model._limit(page.size, page.index);\n    //   const list = await ctx.model.query(`\n    //     select d.*,d.id as roleExpandId,a.id as roleFunctionId,b.module,b.name,b.title,b.sceneId,g.sceneName,e.roleName,f.titleLocale from aRoleFunction a\n    //       left join aFunction b on a.functionId=b.id\n    //       left join aRoleExpand d on a.roleId=d.roleIdBase\n    //       left join aRole e on d.roleIdBase=e.id\n    //       left join aFunctionLocale f on a.functionId=f.functionId\n    //       left join aFunctionScene g on g.id=b.sceneId\n    //         where d.iid=? and d.roleId=? and b.menu=? and f.locale=?\n    //         order by b.module,g.sceneSorting,b.sorting\n    //         ${_limit}\n    //     `, [ ctx.instance.id, roleId, menu, locale ]);\n    //   return list;\n    // }\n\n    // // function rights of user\n    // async functionRightsOfUser({ menu, userId, page }) {\n    //   // check locale\n    //   const locale = ctx.locale;\n    //   // list\n    //   page = ctx.bean.util.page(page, false);\n    //   const _limit = ctx.model._limit(page.size, page.index);\n    //   const list = await ctx.model.query(`\n    //     select a.*,b.module,b.name,b.title,b.sceneId,g.sceneName,b.sorting,f.titleLocale,e.roleName from aViewUserRightFunction a\n    //       left join aFunction b on a.functionId=b.id\n    //       left join aFunctionLocale f on a.functionId=f.functionId\n    //       left join aFunctionScene g on g.id=b.sceneId\n    //       left join aRole e on a.roleIdBase=e.id\n    //         where a.iid=? and a.userIdWho=? and b.menu=? and f.locale=?\n    //         order by b.module,g.sceneSorting,b.sorting\n    //         ${_limit}\n    //     `, [ ctx.instance.id, userId, menu, locale ]);\n\n    //   return list;\n    // }\n\n  }\n\n  return Resource;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Role extends ctx.app.meta.BeanModuleBase {\n\n    constructor(moduleName) {\n      super(ctx, 'role');\n      this.moduleName = moduleName || ctx.module.info.relativeName;\n    }\n\n    get model() {\n      return ctx.model.module(moduleInfo.relativeName).role;\n    }\n\n    get modelRoleInc() {\n      return ctx.model.module(moduleInfo.relativeName).roleInc;\n    }\n\n    get modelUserRole() {\n      return ctx.model.module(moduleInfo.relativeName).userRole;\n    }\n\n    get modelRoleRight() {\n      return ctx.model.module(moduleInfo.relativeName).roleRight;\n    }\n\n    get modelRoleRightRef() {\n      return ctx.model.module(moduleInfo.relativeName).roleRightRef;\n    }\n\n    async get(where) {\n      return await this.model.get(where);\n    }\n\n    async getSystemRole({ roleName }) {\n      return await this.get({\n        roleName,\n        system: 1,\n      });\n    }\n\n    // add role\n    async add({ roleName = '', leader = 0, /* catalog = 0,*/ system = 0, sorting = 0, roleIdParent = 0 }) {\n      const res = await this.model.insert({\n        roleName,\n        leader,\n        catalog: 0,\n        system,\n        sorting,\n        roleIdParent,\n      });\n      const roleId = res.insertId;\n\n      // adjust catalog\n      await this.adjustCatalog(roleIdParent);\n\n      // set dirty\n      await this.setDirty(true);\n\n      return roleId;\n    }\n\n    async move({ roleId, roleIdParent }) {\n      // role\n      const role = await this.get({ id: roleId });\n      // roleIdParentOld\n      const roleIdParentOld = role.roleIdParent;\n      if (roleIdParentOld === roleIdParent) return;\n      // update\n      await this.model.update({ id: roleId, roleIdParent });\n\n      // adjust catalog\n      await this.adjustCatalog(roleIdParentOld);\n      await this.adjustCatalog(roleIdParent);\n\n      // set dirty\n      await this.setDirty(true);\n    }\n\n    async delete({ roleId, force = false }) {\n      // role\n      const role = await this.get({ id: roleId });\n      // parent\n      const roleIdParent = role.roleIdParent;\n\n      // check if system\n      if (role.system) ctx.throw(403);\n      // check if children\n      if (role.catalog && !force) {\n        const children = await this.children({ roleId });\n        if (children.length > 0) ctx.throw.module(moduleInfo.relativeName, 1008);\n      }\n\n      // delete all includes\n      await this.modelRoleInc.delete({ roleId });\n      await this.modelRoleInc.delete({ roleIdInc: roleId });\n\n      // delete all users\n      await this.modelUserRole.delete({ roleId });\n\n      // delete all atom rights\n      await this.modelRoleRight.delete({ roleId });\n      await this.modelRoleRightRef.delete({ roleId });\n\n      // delete this\n      await this.model.delete({ id: roleId });\n\n      // adjust catalog\n      await this.adjustCatalog(roleIdParent);\n\n      // set dirty\n      await this.setDirty(true);\n    }\n\n    // for donothing on roleId === 0\n    async adjustCatalog(roleId) {\n      if (roleId === 0) return;\n      const children = await this.children({ roleId, page: false });\n      await this.model.update({\n        id: roleId,\n        catalog: children.length === 0 ? 0 : 1,\n      });\n    }\n\n    async parseRoleNames({ roleNames, force = false }) {\n      const arr = roleNames.split(',');\n      const res = [];\n      for (const roleName of arr) {\n        const role = await this.parseRoleName({ roleName, force });\n        res.push(role); // not check if null\n      }\n      return res;\n    }\n\n    // roleA.roleB\n    async parseRoleName({ roleName, roleIdParent, force = false }) {\n      const roleNames = roleName.split('.');\n      let role;\n      for (const _roleName of roleNames) {\n        if (roleIdParent === undefined) {\n          role = await this.get({ roleName: _roleName });\n        } else {\n          role = await this.child({\n            roleId: roleIdParent,\n            roleName: _roleName,\n          });\n        }\n        // next\n        if (role) {\n          roleIdParent = role.id;\n          continue;\n        }\n        // null\n        if (!roleIdParent || !force) return null;\n        // create\n        const roleId = await this._register({\n          roleName: _roleName, roleIdParent,\n        });\n        role = await this.get({ id: roleId });\n        // next\n        roleIdParent = roleId;\n      }\n      return role;\n    }\n\n    async _register({ roleName, roleIdParent }) {\n      return await ctx.app.meta.util.lock({\n        subdomain: ctx.subdomain,\n        resource: `${moduleInfo.relativeName}.role.register`,\n        fn: async () => {\n          return await ctx.app.meta.util.executeBean({\n            subdomain: ctx.subdomain,\n            beanModule: moduleInfo.relativeName,\n            beanFullName: 'role',\n            context: { roleName, roleIdParent },\n            fn: '_registerLock',\n          });\n        },\n      });\n    }\n\n    async _registerLock({ roleName, roleIdParent }) {\n      // get again\n      const role = await this.child({\n        roleId: roleIdParent,\n        roleName,\n      });\n      if (role) return role.id;\n      // add\n      return await this.add({ roleName, roleIdParent });\n    }\n\n    // add role include\n    async addRoleInc({ roleId, roleIdInc }) {\n      const res = await this.modelRoleInc.insert({\n        roleId,\n        roleIdInc,\n      });\n      const id = res.insertId;\n\n      // set dirty\n      await this.setDirty(true);\n\n      return id;\n    }\n\n    // remove role include\n    async removeRoleInc({ id }) {\n      await this.modelRoleInc.delete({ id });\n\n      // set dirty\n      await this.setDirty(true);\n    }\n\n    // add user role\n    async addUserRole({ userId, roleId }) {\n      const res = await this.modelUserRole.insert({\n        userId, roleId,\n      });\n      return res.insertId;\n    }\n\n    async deleteUserRole({ id, userId, roleId }) {\n      if (!id) {\n        const item = await this.modelUserRole.get({\n          userId, roleId,\n        });\n        if (!item) return;\n        id = item.id;\n      }\n      await this.modelUserRole.delete({ id });\n    }\n\n    async deleteAllUserRoles({ userId }) {\n      await this.modelUserRole.delete({ userId });\n    }\n\n    // add role right\n    async addRoleRight({ roleId, atomClassId, action, scope }) {\n      if (scope) {\n        if (typeof scope === 'string') {\n          scope = scope.split(',');\n        } else if (!Array.isArray(scope)) {\n          scope = [ scope ];\n        }\n      }\n      // force action exists in db\n      await ctx.bean.atomAction.get({ atomClassId, code: action });\n\n      // roleRight\n      const res = await this.modelRoleRight.insert({\n        roleId,\n        atomClassId,\n        action,\n        scope: JSON.stringify(scope),\n      });\n      const roleRightId = res.insertId;\n      // roleRightRef\n      if (scope) {\n        for (const roleIdScope of scope) {\n          await this.modelRoleRightRef.insert({\n            roleRightId,\n            roleId,\n            atomClassId,\n            action,\n            roleIdScope,\n          });\n        }\n      }\n      return roleRightId;\n    }\n\n    // delete role right\n    async deleteRoleRight({ id }) {\n      await this.modelRoleRight.delete({ id });\n      await this.modelRoleRightRef.delete({ roleRightId: id });\n    }\n\n    // child\n    async child({ roleId, roleName }) {\n      const list = await this.children({ roleId, roleName, page: false });\n      return list[0];\n    }\n\n    // children\n    async children({ roleId, roleName, page }) {\n      page = ctx.bean.util.page(page, false);\n      // roleId\n      if (!roleId || roleId === 'root') {\n        roleId = 0;\n      }\n      // where\n      const where = { roleIdParent: roleId };\n      if (roleName !== undefined) where.roleName = roleName;\n      // select\n      const options = {\n        where,\n        orders: [[ 'sorting', 'asc' ], [ 'roleName', 'asc' ]],\n      };\n      if (page.size !== 0) {\n        options.limit = page.size;\n        options.offset = page.index;\n      }\n      return await this.model.select(options);\n    }\n\n    // save\n    async save({ roleId, data: { roleName, leader, sorting, catalog } }) {\n      const role = await this.get({ id: roleId });\n      if (roleName !== undefined) role.roleName = roleName;\n      if (leader !== undefined) role.leader = leader;\n      if (sorting !== undefined) role.sorting = sorting;\n      if (catalog !== undefined) role.catalog = catalog;\n      await this.model.update(role);\n    }\n\n    // includes\n    async includes({ roleId, page }) {\n      page = ctx.bean.util.page(page, false);\n      const _limit = ctx.model._limit(page.size, page.index);\n      return await ctx.model.query(`\n        select a.*,b.roleName from aRoleInc a\n          left join aRole b on a.roleIdInc=b.id\n            where a.iid=? and a.roleId=?\n            ${_limit}\n        `, [ ctx.instance.id, roleId ]);\n    }\n\n    // role rights\n    async roleRights({ roleId, page }) {\n      page = ctx.bean.util.page(page, false);\n      const _limit = ctx.model._limit(page.size, page.index);\n      const list = await ctx.model.query(`\n        select a.*,b.module,b.atomClassName,c.name as actionName,c.bulk as actionBulk from aRoleRight a\n          left join aAtomClass b on a.atomClassId=b.id\n          left join aAtomAction c on a.atomClassId=c.atomClassId and a.action=c.code\n            where a.iid=? and a.roleId=?\n            order by b.module,a.atomClassId,a.action\n            ${_limit}\n        `, [ ctx.instance.id, roleId ]);\n      // scope\n      for (const item of list) {\n        const scope = JSON.parse(item.scope);\n        item.scopeRoles = await this._scopeRoles({ scope });\n      }\n      return list;\n    }\n\n    // role spreads\n    async roleSpreads({ roleId, page }) {\n      page = ctx.bean.util.page(page, false);\n      const _limit = ctx.model._limit(page.size, page.index);\n      const list = await ctx.model.query(`\n        select d.*,d.id as roleExpandId,a.id as roleRightId,a.scope,b.module,b.atomClassName,c.code as actionCode,c.name as actionName,c.bulk as actionBulk,e.roleName from aRoleRight a\n          left join aAtomClass b on a.atomClassId=b.id\n          left join aAtomAction c on a.atomClassId=c.atomClassId and a.action=c.code\n          left join aRoleExpand d on a.roleId=d.roleIdBase\n          left join aRole e on d.roleIdBase=e.id\n            where d.iid=? and d.roleId=?\n            order by b.module,a.atomClassId,a.action\n            ${_limit}\n        `, [ ctx.instance.id, roleId ]);\n      // scope\n      for (const item of list) {\n        const scope = JSON.parse(item.scope);\n        item.scopeRoles = await this._scopeRoles({ scope });\n      }\n      return list;\n    }\n\n    // atom rights of user\n    async atomRightsOfUser({ userId, page }) {\n      page = ctx.bean.util.page(page, false);\n      const _limit = ctx.model._limit(page.size, page.index);\n      const list = await ctx.model.query(`\n        select a.*,b.module,b.atomClassName,c.code as actionCode,c.name as actionName,c.bulk as actionBulk,e.roleName from aViewUserRightAtomClass a\n          left join aAtomClass b on a.atomClassId=b.id\n          left join aAtomAction c on a.atomClassId=c.atomClassId and a.action=c.code\n          left join aRole e on a.roleIdBase=e.id\n            where a.iid=? and a.userIdWho=?\n            order by b.module,a.atomClassId,a.action\n            ${_limit}\n        `, [ ctx.instance.id, userId ]);\n      // scope\n      for (const item of list) {\n        const scope = JSON.parse(item.scope);\n        item.scopeRoles = await this._scopeRoles({ scope });\n      }\n      return list;\n    }\n\n    async _scopeRoles({ scope }) {\n      if (!scope || scope.length === 0) return null;\n      return await ctx.model.query(`\n            select a.* from aRole a\n              where a.iid=? and a.id in (${scope.join(',')})\n            `, [ ctx.instance.id ]);\n    }\n\n    async getUserRolesDirect({ userId }) {\n      const list = await ctx.model.query(`\n        select a.* from aRole a\n          left join aUserRole b on a.id=b.roleId\n            where a.iid=? and b.userId=?\n        `, [ ctx.instance.id, userId ]);\n      return list;\n    }\n\n    async getUserRolesParent({ userId }) {\n      const list = await ctx.model.query(`\n        select a.* from aRole a\n          left join aViewUserRoleRef b on a.id=b.roleIdParent\n            where a.iid=? and b.userId=?\n        `, [ ctx.instance.id, userId ]);\n      return list;\n    }\n\n    async getUserRolesExpand({ userId }) {\n      const list = await ctx.model.query(`\n        select a.* from aRole a\n          left join aViewUserRoleExpand b on a.id=b.roleIdBase\n            where a.iid=? and b.userId=?\n        `, [ ctx.instance.id, userId ]);\n      return list;\n    }\n\n    async userInRoleDirect({ userId, roleId }) {\n      const list = await ctx.model.query(`\n        select count(*) as count from aUserRole a\n          where a.iid=? and a.userId=? and a.roleId=?\n        `, [ ctx.instance.id, userId, roleId ]);\n      return list[0].count > 0;\n    }\n\n    async userInRoleParent({ userId, roleId }) {\n      const list = await ctx.model.query(`\n        select count(*) as count from aViewUserRoleRef a\n          where a.iid=? and a.userId=? and a.roleIdParent=?\n        `, [ ctx.instance.id, userId, roleId ]);\n      return list[0].count > 0;\n    }\n\n    async userInRoleExpand({ userId, roleId }) {\n      const list = await ctx.model.query(`\n        select count(*) as count from aViewUserRoleExpand a\n          where a.iid=? and a.userId=? and a.roleIdBase=?\n        `, [ ctx.instance.id, userId, roleId ]);\n      return list[0].count > 0;\n    }\n\n    async usersOfRoleDirect({ roleId, disabled, page, removePrivacy }) {\n      // disabled\n      let _disabled = '';\n      if (disabled !== undefined) {\n        _disabled = `and disabled=${parseInt(disabled)}`;\n      }\n      // page\n      page = ctx.bean.util.page(page, false);\n      const _limit = ctx.model._limit(page.size, page.index);\n      // fields\n      const fields = await ctx.bean.user.getFieldsSelect({ removePrivacy, alias: 'a' });\n      // query\n      const list = await ctx.model.query(`\n        select ${fields} from aUser a\n          inner join aUserRole b on a.id=b.userId\n            where a.iid=? and a.deleted=0 ${_disabled} and b.roleId=?\n            order by a.userName\n            ${_limit}\n        `, [ ctx.instance.id, roleId ]);\n      return list;\n    }\n\n    async usersOfRoleParent({ roleId, disabled, page, removePrivacy }) {\n      // disabled\n      let _disabled = '';\n      if (disabled !== undefined) {\n        _disabled = `and disabled=${parseInt(disabled)}`;\n      }\n      // page\n      page = ctx.bean.util.page(page, false);\n      const _limit = ctx.model._limit(page.size, page.index);\n      // fields\n      const fields = await ctx.bean.user.getFieldsSelect({ removePrivacy, alias: 'a' });\n      // query\n      const list = await ctx.model.query(`\n        select ${fields} from aUser a\n          inner join aViewUserRoleRef b on a.id=b.userId\n            where a.iid=? and a.deleted=0 ${_disabled} and b.roleIdParent=?\n            order by a.userName\n            ${_limit}\n        `, [ ctx.instance.id, roleId ]);\n      return list;\n    }\n\n    async usersOfRoleExpand({ roleId, disabled, page, removePrivacy }) {\n      // disabled\n      let _disabled = '';\n      if (disabled !== undefined) {\n        _disabled = `and disabled=${parseInt(disabled)}`;\n      }\n      // page\n      page = ctx.bean.util.page(page, false);\n      const _limit = ctx.model._limit(page.size, page.index);\n      // fields\n      const fields = await ctx.bean.user.getFieldsSelect({ removePrivacy, alias: 'a' });\n      // query\n      const list = await ctx.model.query(`\n        select ${fields} from aUser a\n          inner join aViewUserRoleExpand b on a.id=b.userId\n            where a.iid=? and a.deleted=0 ${_disabled} and b.roleIdBase=?\n            order by a.userName\n            ${_limit}\n        `, [ ctx.instance.id, roleId ]);\n      return list;\n    }\n\n    // set dirty\n    async setDirty(dirty) {\n      await ctx.bean.status.module(moduleInfo.relativeName).set('roleDirty', dirty);\n    }\n\n    async getDirty() {\n      return await ctx.bean.status.module(moduleInfo.relativeName).get('roleDirty');\n    }\n\n    // build roles\n    async build(options) {\n      // queue\n      await ctx.app.meta.queue.pushAsync({\n        subdomain: ctx.subdomain,\n        module: moduleInfo.relativeName,\n        queueName: 'roleBuild',\n        data: { options },\n      });\n    }\n\n    async _buildQueue(options) {\n      options = options || {};\n      const progressId = options.progressId;\n      // total\n      let total;\n      if (progressId) {\n        total = await this.model.count();\n      }\n      // progress\n      const progress = { progressId, total, progress: 0 };\n      try {\n        // iid\n        const iid = ctx.instance.id;\n        // remove\n        await this._buildRolesRemove({ iid });\n        // add\n        await this._buildRolesAdd({ iid, roleIdParent: 0 }, progress);\n        // setDirty\n        await this.setDirty(false);\n        // done\n        if (progressId) {\n          await ctx.bean.progress.done({ progressId });\n        }\n      } catch (err) {\n        // error\n        if (progressId) {\n          await ctx.bean.progress.error({ progressId, message: err.message });\n        }\n        throw err;\n      }\n    }\n\n    // const roleRights = [\n    //   { roleName: 'cms-writer', action: 'create' },\n    //   { roleName: 'cms-writer', action: 'write', scopeNames: 0 },\n    //   { roleName: 'cms-writer', action: 'delete', scopeNames: 0 },\n    //   { roleName: 'cms-writer', action: 'read', scopeNames: 'authenticated' },\n    //   { roleName: 'cms-publisher', action: 'read', scopeNames: 'authenticated' },\n    //   { roleName: 'cms-publisher', action: 'write', scopeNames: 'authenticated' },\n    //   { roleName: 'cms-publisher', action: 'publish', scopeNames: 'authenticated' },\n    //   { roleName: 'root', action: 'read', scopeNames: 'authenticated' },\n    // ];\n    async addRoleRightBatch({ module, atomClassName, atomClassIdParent = 0, roleRights }) {\n      // module\n      module = module || this.moduleName;\n      const _module = ctx.app.meta.modules[module];\n      // atomClass\n      const atomClass = await ctx.bean.atomClass.get({ module, atomClassName, atomClassIdParent });\n      // roleRights\n      if (!roleRights || !roleRights.length) return;\n      for (const roleRight of roleRights) {\n        // role\n        const role = await this.get({ roleName: roleRight.roleName });\n        // scope\n        let scope;\n        if (!roleRight.scopeNames) {\n          scope = 0;\n        } else {\n          scope = [];\n          const scopeNames = Array.isArray(roleRight.scopeNames) ? roleRight.scopeNames : roleRight.scopeNames.split(',');\n          for (const scopeName of scopeNames) {\n            const roleScope = await this.get({ roleName: scopeName });\n            scope.push(roleScope.id);\n          }\n        }\n        // add role right\n        let actionCode = ctx.constant.module('a-base').atom.action[roleRight.action];\n        if (!actionCode) {\n          const action = _module.main.meta.base.atoms[atomClassName].actions[roleRight.action];\n          if (!action) throw new Error(`atom action not found: ${atomClassName}.${roleRight.action}`);\n          actionCode = action.code;\n        }\n        await this.addRoleRight({\n          roleId: role.id,\n          atomClassId: atomClass.id,\n          action: actionCode,\n          scope,\n        });\n      }\n    }\n\n    async _buildRolesRemove({ iid }) {\n      await ctx.model.query(`delete from aRoleRef where aRoleRef.iid=${iid}`);\n      await ctx.model.query(`delete from aRoleIncRef where aRoleIncRef.iid=${iid}`);\n      await ctx.model.query(`delete from aRoleExpand where aRoleExpand.iid=${iid}`);\n    }\n\n    async _buildRolesAdd({ iid, roleIdParent }, progress) {\n      const list = await ctx.model.query(\n        `select a.id,a.roleName,a.catalog from aRole a where a.iid=${iid} and a.roleIdParent=${roleIdParent}`\n      );\n      for (const item of list) {\n        // info\n        const roleId = item.id;\n        const catalog = item.catalog;\n        // build\n        await this._buildRoleRef({ iid, roleId });\n        await this._buildRoleIncRef({ iid, roleId });\n        await this._buildRoleExpand({ iid, roleId });\n        // catalog\n        if (catalog === 1) {\n          await this._buildRolesAdd({ iid, roleIdParent: roleId }, progress);\n        }\n        // progress\n        if (progress.progressId) {\n          await ctx.bean.progress.update({\n            progressId: progress.progressId, progressNo: 0,\n            total: progress.total, progress: progress.progress++,\n            text: item.roleName,\n          });\n        }\n      }\n    }\n\n    async _buildRoleRef({ iid, roleId }) {\n      let level = 0;\n      let roleIdParent = roleId;\n      // loop\n      while (level !== -1) {\n        await ctx.model.query(\n          `insert into aRoleRef(iid,roleId,roleIdParent,level)\n             values(${iid},${roleId},${roleIdParent},${level})\n          `\n        );\n        const item = await ctx.model.queryOne(\n          `select a.roleIdParent from aRole a where a.iid=${iid} and a.id=${roleIdParent}`\n        );\n        if (!item || !item.roleIdParent) {\n          level = -1;\n        } else {\n          roleIdParent = item.roleIdParent;\n          level++;\n        }\n      }\n    }\n\n    async _buildRoleIncRef({ iid, roleId }) {\n      await ctx.model.query(\n        `insert into aRoleIncRef(iid,roleId,roleIdInc,roleIdSrc)\n            select ${iid},${roleId},a.roleIdInc,a.roleId from aRoleInc a\n              where a.iid=${iid} and a.roleId in (select b.roleIdParent from aRoleRef b where b.iid=${iid} and b.roleId=${roleId})\n        `);\n    }\n\n    async _buildRoleExpand({ iid, roleId }) {\n      await ctx.model.query(\n        `insert into aRoleExpand(iid,roleId,roleIdBase)\n            select a.iid,a.roleId,a.roleIdParent from aRoleRef a\n              where a.iid=${iid} and a.roleId=${roleId}\n        `);\n      await ctx.model.query(\n        `insert into aRoleExpand(iid,roleId,roleIdBase)\n            select a.iid,a.roleId,a.roleIdInc from aRoleIncRef a\n              where a.iid=${iid} and a.roleId=${roleId}\n        `);\n    }\n\n  }\n\n  return Role;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Tag {\n\n    get modelTag() {\n      return ctx.model.module(moduleInfo.relativeName).tag;\n    }\n\n    get modelTagRef() {\n      return ctx.model.module(moduleInfo.relativeName).tagRef;\n    }\n\n    async count({ atomClass, language }) {\n      atomClass = await ctx.bean.atomClass.get(atomClass);\n      return await this.modelTag.count({\n        atomClassId: atomClass.id,\n        language,\n      });\n    }\n\n    async get({ tagId }) {\n      return await this.modelTag.get({ id: tagId });\n    }\n\n    async item({ atomClass, language, tagName }) {\n      const options = {\n        where: {\n          language, tagName,\n        },\n      };\n      const list = await this.list({ atomClass, options });\n      return list[0];\n    }\n\n    async list({ atomClass, options }) {\n      atomClass = await ctx.bean.atomClass.get(atomClass);\n      if (!options.where) options.where = {};\n      options.where.atomClassId = atomClass.id;\n      return await this.modelTag.select(options);\n    }\n\n    async add({ atomClass, data }) {\n      atomClass = await ctx.bean.atomClass.get(atomClass);\n      // add\n      const res = await this.modelTag.insert({\n        atomClassId: atomClass.id,\n        language: data.language,\n        tagName: data.tagName,\n        tagAtomCount: data.tagAtomCount || 0,\n      });\n      return res.insertId;\n    }\n\n    async save({ tagId, data }) {\n      await this.modelTag.update({\n        id: tagId,\n        tagName: data.tagName,\n      });\n    }\n\n    async delete({ tagId }) {\n      // check atoms\n      const count = await this.modelTagRef.count({ tagId });\n      if (count > 0) ctx.throw.module(moduleInfo.relativeName, 1012);\n\n      // delete\n      await this.modelTag.delete({ id: tagId });\n    }\n\n    async updateTagRefs({ atomId, atomTags }) {\n      // tags\n      if (typeof atomTags === 'string') {\n        atomTags = JSON.parse(atomTags);\n      }\n      // force delete\n      await this.deleteTagRefs({ atomId });\n      // new\n      if (atomTags && atomTags.length > 0) {\n        for (const tagId of atomTags) {\n          await this.modelTagRef.insert({\n            atomId,\n            tagId,\n          });\n        }\n      }\n      // ok\n      return atomTags;\n    }\n\n    async deleteTagRefs({ atomId }) {\n      await this.modelTagRef.delete({\n        atomId,\n      });\n    }\n\n    async setTagAtomCount({ tagsNew, tagsOld }) {\n      // tags\n      const tags = {};\n      if (tagsNew) {\n        const _tags = typeof tagsNew === 'string' ? JSON.parse(tagsNew) : tagsNew;\n        for (const tagId of _tags) {\n          tags[tagId] = true;\n        }\n      }\n      if (tagsOld) {\n        const _tags = typeof tagsOld === 'string' ? JSON.parse(tagsOld) : tagsOld;\n        for (const tagId of _tags) {\n          tags[tagId] = true;\n        }\n      }\n      // loop\n      for (const tagId in tags) {\n        const tagAtomCount = await this.calcAtomCount({ tagId });\n        // update\n        await this.modelTag.update({ id: tagId, tagAtomCount });\n      }\n    }\n\n    async calcAtomCount({ tagId }) {\n      const res = await ctx.model.query(`\n        select count(*) atomCount from aTagRef a\n          inner join aAtom b on a.atomId=b.id\n          where a.iid=? and a.tagId=? and b.iid=? and b.deleted=0 and b.atomStage=1\n        `,\n      [ ctx.instance.id, tagId, ctx.instance.id ]);\n      return res[0].atomCount;\n    }\n\n    async parseTags({ atomClass, language, tagName, force = false }) {\n      const tagNames = tagName.split(',');\n      const tagIds = [];\n      for (const _tagName of tagNames) {\n        const tag = await this.item({ atomClass, language, tagName: _tagName });\n        // next\n        if (tag) {\n          tagIds.push(tag.id);\n          continue;\n        }\n        // null\n        if (!force) continue;\n        // create\n        const tagId = await this._register({\n          atomClass, language, tagName: _tagName,\n        });\n        tagIds.push(tagId);\n      }\n      return tagIds;\n    }\n\n    async _register({ atomClass, language, tagName }) {\n      atomClass = await ctx.bean.atomClass.get(atomClass);\n      return await ctx.app.meta.util.lock({\n        subdomain: ctx.subdomain,\n        resource: `${moduleInfo.relativeName}.tag.register.${atomClass.id}`,\n        fn: async () => {\n          return await ctx.app.meta.util.executeBean({\n            subdomain: ctx.subdomain,\n            beanModule: moduleInfo.relativeName,\n            beanFullName: 'tag',\n            context: { atomClass, language, tagName },\n            fn: '_registerLock',\n          });\n        },\n      });\n    }\n\n    async _registerLock({ atomClass, language, tagName }) {\n      // get again\n      const tag = await this.item({ atomClass, language, tagName });\n      if (tag) return tag.id;\n      // add\n      return await this.add({\n        atomClass,\n        data: {\n          language,\n          tagName,\n        },\n      });\n    }\n\n  }\n  return Tag;\n};\n","const require3 = require('require3');\nconst uuid = require3('uuid');\n\nconst _usersAnonymous = {};\n\nmodule.exports = ctx => {\n\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n\n  class User {\n\n    constructor() {\n      this._sequence = null;\n      this._config = null;\n    }\n\n    get model() {\n      return ctx.model.module(moduleInfo.relativeName).user;\n    }\n\n    get modelAgent() {\n      return ctx.model.module(moduleInfo.relativeName).userAgent;\n    }\n\n    get modelAuth() {\n      return ctx.model.module(moduleInfo.relativeName).auth;\n    }\n\n    get modelAuthProvider() {\n      return ctx.model.module(moduleInfo.relativeName).authProvider;\n    }\n\n    get sequence() {\n      if (!this._sequence) this._sequence = ctx.bean.sequence.module(moduleInfo.relativeName);\n      return this._sequence;\n    }\n\n    get config() {\n      if (!this._config) this._config = ctx.config.module(moduleInfo.relativeName);\n      return this._config;\n    }\n\n    get sqlProcedure() {\n      return ctx.bean._getBean(moduleInfo.relativeName, 'local.procedure');\n    }\n\n    async anonymous() {\n      // cache\n      let _userAnonymous = _usersAnonymous[ctx.instance.id];\n      if (_userAnonymous) return _userAnonymous;\n      // try get\n      _userAnonymous = await this.get({ anonymous: 1 });\n      if (_userAnonymous) {\n        _usersAnonymous[ctx.instance.id] = _userAnonymous;\n        return _userAnonymous;\n      }\n      // add user\n      const userId = await this.add({ disabled: 0, anonymous: 1 });\n      // addRole\n      const role = await ctx.bean.role.getSystemRole({ roleName: 'anonymous' });\n      await ctx.bean.role.addUserRole({ userId, roleId: role.id });\n      // ready\n      _userAnonymous = await this.get({ id: userId });\n      _usersAnonymous[ctx.instance.id] = _userAnonymous;\n      return _userAnonymous;\n    }\n\n    async loginAsAnonymous() {\n      const userOp = await this.anonymous();\n      const user = {\n        op: userOp,\n        agent: userOp,\n        provider: null,\n      };\n      await ctx.login(user);\n      // maxAge\n      const maxAge = this.config.anonymous.maxAge;\n      ctx.session.maxAge = maxAge;\n      // ok\n      return user;\n    }\n\n    anonymousId() {\n      let _anonymousId = ctx.cookies.get('anonymous', { encrypt: true });\n      if (!_anonymousId) {\n        _anonymousId = uuid.v4().replace(/-/g, '');\n        const maxAge = this.config.anonymous.maxAge;\n        ctx.cookies.set('anonymous', _anonymousId, { encrypt: true, maxAge });\n      }\n      return _anonymousId;\n    }\n\n    async check(options) {\n      // options\n      const checkUser = options && options.user;\n      // always has anonymous id\n      ctx.bean.user.anonymousId();\n      // check if has ctx.user\n      if (!ctx.isAuthenticated() || !ctx.user.op || ctx.user.op.iid !== ctx.instance.id) {\n        // anonymous\n        await ctx.bean.user.loginAsAnonymous();\n      } else {\n        // state\n        ctx.state.user = {\n          provider: ctx.user.provider,\n        };\n        // check if deleted,disabled,agent\n        const userOp = await this.get({ id: ctx.user.op.id });\n        // deleted\n        if (!userOp) ctx.throw.module(moduleInfo.relativeName, 1004);\n        // disabled\n        if (userOp.disabled) ctx.throw.module(moduleInfo.relativeName, 1005);\n        // hold user\n        ctx.state.user.op = userOp;\n        // agent\n        if (ctx.user.agent && ctx.user.agent.id !== ctx.user.op.id) {\n          const agent = await this.agent({ userId: ctx.user.op.id });\n          if (!agent) ctx.throw.module(moduleInfo.relativeName, 1006);\n          if (agent.id !== ctx.user.agent.id) ctx.throw.module(moduleInfo.relativeName, 1006);\n          if (agent.disabled) ctx.throw.module(moduleInfo.relativeName, 1005);\n          // hold agent\n          ctx.state.user.agent = agent;\n        } else {\n          // hold agent\n          ctx.state.user.agent = userOp;\n        }\n      }\n      // check user\n      if (checkUser && ctx.state.user.op.anonymous) ctx.throw(401);\n    }\n\n    async setActivated({ user }) {\n      // save\n      if (user.activated !== undefined) delete user.activated;\n      await this.save({ user });\n      // tryActivate\n      const tryActivate = user.emailConfirmed || user.mobileVerified;\n      if (tryActivate) {\n        await this.userRoleStageActivate({ userId: user.id });\n      }\n    }\n\n    async userRoleStageAdd({ userId }) {\n      // roleNames\n      let roleNames = this.config.account.needActivation ? 'registered' : this.config.account.activatedRoles;\n      roleNames = roleNames.split(',');\n      for (const roleName of roleNames) {\n        const role = await ctx.bean.role.get({ roleName });\n        await ctx.bean.role.addUserRole({ userId, roleId: role.id });\n      }\n    }\n\n    async userRoleStageActivate({ userId }) {\n      // get\n      const user = await this.get({ id: userId });\n      // only once\n      if (user.activated) return;\n      // adjust role\n      if (this.config.account.needActivation) {\n        // userRoles\n        const userRoles = await ctx.bean.role.getUserRolesDirect({ userId });\n        // userRolesMap\n        const map = {};\n        for (const role of userRoles) {\n          map[role.roleName] = role;\n        }\n        // remove from registered\n        if (map.registered) {\n          const roleRegistered = await ctx.bean.role.getSystemRole({ roleName: 'registered' });\n          await ctx.bean.role.deleteUserRole({ userId, roleId: roleRegistered.id });\n        }\n        // add to activated\n        const rolesActivated = await ctx.bean.role.parseRoleNames({ roleNames: this.config.account.activatedRoles });\n        for (const role of rolesActivated) {\n          if (!map[role.roleName]) {\n            await ctx.bean.role.addUserRole({ userId, roleId: role.id });\n          }\n        }\n      }\n      // set activated\n      await this.save({\n        user: { id: userId, activated: 1 },\n      });\n    }\n\n    async exists({ userName, email, mobile }) {\n      userName = userName || '';\n      email = email || '';\n      mobile = mobile || '';\n      if (this.config.checkUserName === true && userName) {\n        return await this.model.queryOne(\n          `select * from aUser\n             where iid=? and deleted=0 and ((userName=?) or (?<>'' and email=?) or (?<>'' and mobile=?))`,\n          [ ctx.instance.id, userName, email, email, mobile, mobile ]);\n      }\n      return await this.model.queryOne(\n        `select * from aUser\n             where iid=? and deleted=0 and ((?<>'' and email=?) or (?<>'' and mobile=?))`,\n        [ ctx.instance.id, email, email, mobile, mobile ]);\n    }\n\n    async add({\n      disabled = 0, userName, realName, email, mobile, avatar, motto, locale, anonymous = 0,\n    }) {\n      // check if incomplete information\n      let needCheck;\n      if (anonymous) {\n        needCheck = false;\n      } else if (this.config.checkUserName === true) {\n        needCheck = userName || email || mobile;\n      } else {\n        needCheck = email || mobile;\n      }\n      // if exists\n      if (needCheck) {\n        const res = await this.exists({ userName, email, mobile });\n        if (res) ctx.throw.module(moduleInfo.relativeName, 1001);\n      }\n      // insert\n      const res = await this.model.insert({\n        disabled,\n        userName,\n        realName,\n        email,\n        mobile,\n        avatar,\n        motto,\n        locale,\n        anonymous,\n      });\n      return res.insertId;\n    }\n\n    async get(where) {\n      return await this.model.get(where);\n    }\n\n    async save({ user }) {\n      if (Object.keys(user).length > 1) {\n        await this.model.update(user);\n      }\n    }\n\n    async agent({ userId }) {\n      const sql = `\n        select a.* from aUser a\n          left join aUserAgent b on a.id=b.userIdAgent\n            where a.iid=? and a.deleted=0 and b.userId=?\n      `;\n      return await ctx.model.queryOne(sql, [ ctx.instance.id, userId ]);\n    }\n\n    async agentsBy({ userId }) {\n      const sql = `\n        select a.* from aUser a\n          left join aUserAgent b on a.id=b.userId\n            where a.iid=? and a.deleted=0 and b.userIdAgent=?\n      `;\n      return await ctx.model.query(sql, [ ctx.instance.id, userId ]);\n    }\n\n    async addAgent({ userIdAgent, userId }) {\n      await this.modelAgent.insert({\n        userIdAgent,\n        userId,\n      });\n    }\n\n    async removeAgent({ userIdAgent, userId }) {\n      await this.modelAgent.delete({\n        userIdAgent,\n        userId,\n      });\n    }\n\n    async switchAgent({ userIdAgent }) {\n      const op = ctx.user.op;\n      const _user = await this.get({ id: userIdAgent });\n      ctx.user.op = { id: _user.id, iid: _user.iid, anonymous: _user.anonymous };\n      try {\n        await this.check();\n        await ctx.login(ctx.state.user);\n        return ctx.state.user;\n      } catch (err) {\n        ctx.user.op = op;\n        throw err;\n      }\n    }\n\n    async switchOffAgent() {\n      return await this.switchAgent({ userIdAgent: ctx.state.user.agent.id });\n    }\n\n    async getFields({ removePrivacy }) {\n      const fields = await this.model.columns();\n      if (removePrivacy) {\n        const privacyFields = ctx.config.module(moduleInfo.relativeName).user.privacyFields.split(',');\n        for (const privacyField of privacyFields) {\n          delete fields[privacyField];\n        }\n      }\n      return fields;\n    }\n\n    async getFieldsSelect({ removePrivacy, alias }) {\n      const fields = await this.getFields({ removePrivacy });\n      return Object.keys(fields).map(item => (alias ? `${alias}.${item}` : item)).join(',');\n    }\n\n    async list({ roleId, query, anonymous, page, removePrivacy }) {\n      const roleJoin = roleId ? 'left join aUserRole b on a.id=b.userId' : '';\n      const roleWhere = roleId ? `and b.roleId=${ctx.model._format(roleId)}` : '';\n      const queryLike = query ? ctx.model._format({ op: 'like', val: query }) : '';\n      const queryWhere = query ? `and ( a.userName like ${queryLike} or a.realName like ${queryLike} or a.mobile like ${queryLike} )` : '';\n      const anonymousWhere = anonymous !== undefined ? `and a.anonymous=${ctx.model._format(anonymous)}` : '';\n      const _limit = ctx.model._limit(page.size, page.index);\n      // fields\n      const fields = await this.getFieldsSelect({ removePrivacy, alias: 'a' });\n      // sql\n      const sql = `\n        select ${fields} from aUser a\n          ${roleJoin}\n            where a.iid=? and a.deleted=0\n                  ${anonymousWhere}\n                  ${roleWhere}\n                  ${queryWhere}\n            ${_limit}\n      `;\n      return await ctx.model.query(sql, [ ctx.instance.id ]);\n    }\n\n    async count({ options }) {\n      return await this.select({ options, count: 1 });\n    }\n\n    async select({ options, pageForce = true, count = 0 }) {\n      return await this._list({ options, pageForce, count });\n    }\n\n    async _list({ options: { where, orders, page, removePrivacy }, pageForce = true, count = 0 }) {\n      page = ctx.bean.util.page(page, pageForce);\n      // fields\n      const fields = await this.getFieldsSelect({ removePrivacy, alias: 'a' });\n      // sql\n      const sql = this.sqlProcedure.selectUsers({\n        iid: ctx.instance.id,\n        where, orders, page,\n        count,\n        fields,\n      });\n      const res = await ctx.model.query(sql);\n      return count ? res[0]._count : res;\n    }\n\n    async disable({ userId, disabled }) {\n      await this.model.update({ id: userId, disabled });\n    }\n\n    async delete({ userId }) {\n      await ctx.bean.role.deleteAllUserRoles({ userId });\n      await this.modelAuth.delete({ userId });\n      await this.model.delete({ id: userId });\n    }\n\n    // roles\n    async roles({ userId, page }) {\n      page = ctx.bean.util.page(page, false);\n      const _limit = ctx.model._limit(page.size, page.index);\n      return await ctx.model.query(`\n        select a.*,b.roleName from aUserRole a\n          left join aRole b on a.roleId=b.id\n            where a.iid=? and a.userId=?\n            ${_limit}\n        `, [ ctx.instance.id, userId ]);\n    }\n\n    // state: login/associate/migrate\n    async verify({ state = 'login', profileUser }) {\n      // verifyUser\n      const verifyUser = {};\n\n      // provider\n      const providerItem = await this.getAuthProvider({\n        module: profileUser.module,\n        providerName: profileUser.provider,\n      });\n\n      // check if auth exists\n      const authItem = await this.modelAuth.get({\n        providerId: providerItem.id,\n        profileId: profileUser.profileId,\n      });\n      // avatar\n      await this._prepareAvatar({ authItem, profile: profileUser.profile });\n      // auth\n      let authId;\n      let authUserId;\n      if (authItem) {\n        // update\n        authItem.profile = JSON.stringify(profileUser.profile);\n        await this.modelAuth.update(authItem);\n        authId = authItem.id;\n        authUserId = authItem.userId;\n      } else {\n        if (state === 'migrate' || profileUser.authShouldExists === true) ctx.throw.module(moduleInfo.relativeName, 1009);\n        // add\n        const res = await this.modelAuth.insert({\n          providerId: providerItem.id,\n          profileId: profileUser.profileId,\n          profile: JSON.stringify(profileUser.profile),\n        });\n        authId = res.insertId;\n      }\n      verifyUser.provider = {\n        id: authId,\n        providerId: providerItem.id,\n        module: profileUser.module,\n        providerName: profileUser.provider,\n        // profile: profileUser.profile,  // maybe has private info\n      };\n\n      // columns\n      const columns = [\n        'userName', 'realName', 'email', 'mobile', 'avatar', 'motto', 'locale',\n      ];\n\n      //\n      let userId;\n      if (state === 'migrate') {\n        // should check user so as to create ctx.state.user\n        await this.check();\n        // check if ctx.user exists\n        if (!ctx.state.user || ctx.state.user.agent.anonymous) return false;\n        userId = ctx.state.user.agent.id;\n        // migrate\n        if (authUserId !== userId) {\n          await this.accountMigration({ userIdFrom: userId, userIdTo: authUserId });\n        }\n        // user\n        const user = await this.model.get({ id: authUserId });\n        // ready\n        verifyUser.op = user;\n        verifyUser.agent = user;\n      } else if (state === 'associate') {\n        // should check user so as to create ctx.state.user\n        await this.check();\n        // check if ctx.user exists\n        if (!ctx.state.user || ctx.state.user.agent.anonymous) return false;\n        userId = ctx.state.user.agent.id;\n        // associated\n        // update user\n        await this._updateUserInfo(userId, profileUser.profile, columns);\n        // force update auth's userId, maybe different\n        if (authUserId !== userId) {\n          // accountMigration / update\n          if (authUserId) {\n            await this.accountMigration({ userIdFrom: authUserId, userIdTo: userId });\n          } else {\n            // delete old record\n            await this.modelAuth.delete({\n              providerId: providerItem.id,\n              userId,\n            });\n            await this.modelAuth.update({\n              id: authId,\n              userId,\n            });\n          }\n        }\n        // ready\n        verifyUser.op = ctx.state.user.op;\n        verifyUser.agent = ctx.state.user.agent;\n      } else if (state === 'login') {\n        // check if user exists\n        let user;\n        if (authUserId) {\n          user = await this.model.get({ id: authUserId });\n        }\n        if (user) {\n          // check if disabled\n          if (user.disabled) return false;\n          // update user\n          await this._updateUserInfo(user.id, profileUser.profile, columns);\n          userId = user.id;\n        } else {\n          // add user\n          userId = await this._addUserInfo(profileUser.profile, columns);\n          user = await this.model.get({ id: userId });\n          // update auth's userId\n          await this.modelAuth.update({\n            id: authId,\n            userId,\n          });\n        }\n        // ready\n        verifyUser.op = user;\n        verifyUser.agent = user;\n      }\n\n      // restore maxAge\n      if (profileUser.maxAge === 0) {\n        ctx.session.maxAge = 0;\n      } else {\n        ctx.session.maxAge = profileUser.maxAge || this.config.authenticated.maxAge;\n      }\n\n      // user verify event\n      await ctx.bean.event.invoke({\n        module: moduleInfo.relativeName, name: 'userVerify', data: { verifyUser, profileUser },\n      });\n\n      // ok\n      return verifyUser;\n    }\n\n    async accountMigration({ userIdFrom, userIdTo }) {\n      // accountMigration event\n      await ctx.bean.event.invoke({\n        module: moduleInfo.relativeName, name: 'accountMigration', data: { userIdFrom, userIdTo },\n      });\n      // aAuth: delete old records\n      const list = await ctx.model.query(\n        'select a.providerId from aAuth a where a.deleted=0 and a.iid=? and a.userId=?',\n        [ ctx.instance.id, userIdFrom ]\n      );\n      if (list.length > 0) {\n        const providerIds = list.map(item => item.providerId).join(',');\n        await ctx.model.query(\n          `delete from aAuth where deleted=0 and iid=? and userId=? and providerId in (${providerIds})`,\n          [ ctx.instance.id, userIdTo, providerIds ]\n        );\n      }\n      // aAuth: update records\n      await ctx.model.query(\n        'update aAuth a set a.userId=? where a.deleted=0 and a.iid=? and a.userId=?',\n        [ userIdTo, ctx.instance.id, userIdFrom ]\n      );\n      // aUserRole\n      await ctx.model.query(\n        'update aUserRole a set a.userId=? where a.iid=? and a.userId=?',\n        [ userIdTo, ctx.instance.id, userIdFrom ]\n      );\n      // delete user\n      await this.model.delete({ id: userIdFrom });\n    }\n\n    async _downloadAvatar({ avatar }) {\n      const timeout = this.config.auth.avatar.timeout;\n      let res;\n      try {\n        res = await ctx.curl(avatar, { method: 'GET', timeout });\n      } catch (err) {\n        res = await ctx.curl(this.config.auth.avatar.default, { method: 'GET', timeout });\n      }\n      return res;\n    }\n\n    async _prepareAvatar({ authItem, profile }) {\n      // avatar\n      let avatarOld;\n      let _avatarOld;\n      if (authItem) {\n        const _profile = JSON.parse(authItem.profile);\n        avatarOld = _profile.avatar;\n        _avatarOld = _profile._avatar;\n      }\n      if (!profile.avatar || profile.avatar === avatarOld) {\n        profile._avatar2 = _avatarOld;\n        return;\n      }\n      // download image\n      const res = await this._downloadAvatar({ avatar: profile.avatar });\n      // meta\n      const mime = res.headers['content-type'] || '';\n      const ext = mime.split('/')[1] || '';\n      const meta = {\n        filename: `user-avatar.${ext}`,\n        encoding: '7bit',\n        mime,\n        fields: {\n          mode: 1,\n          flag: `user-avatar:${profile.avatar}`,\n        },\n      };\n      // upload\n      const res2 = await ctx.executeBean({\n        beanModule: 'a-file',\n        beanFullName: 'a-file.service.file',\n        context: { fileContent: res.data, meta, user: null },\n        fn: '_upload',\n      });\n      // hold\n      profile._avatar = res2.downloadUrl;\n    }\n\n    async _addUserInfo(profile, columns) {\n      const user = {};\n      for (const column of columns) {\n        // others\n        await this._setUserInfoColumn(user, column, profile);\n      }\n      // add user\n      const userId = await this.add(user);\n      // add role\n      await this.userRoleStageAdd({ userId });\n      // try setActivated\n      const data = { id: userId };\n      // emailConfirmed\n      if (profile.emailConfirmed && profile.email) {\n        data.emailConfirmed = 1;\n      }\n      // mobileVerified\n      if (profile.mobileVerified && profile.mobile) {\n        data.mobileVerified = 1;\n      }\n      // setActivated\n      await this.setActivated({ user: data });\n      // ok\n      return userId;\n    }\n\n    async _updateUserInfo(userId, profile, columns) {\n      const users = await this.model.select({\n        where: { id: userId },\n        columns,\n      });\n      const user = users[0];\n      for (const column of columns) {\n        await this._setUserInfoColumn(user, column, profile);\n      }\n      user.id = userId;\n      await this.save({ user });\n    }\n\n    async _setUserInfoColumn(user, column, profile) {\n      // avatar / if empty\n      if (column === 'avatar' && !user[column] && profile._avatar2) {\n        user[column] = profile._avatar2;\n        return;\n      }\n      // avatar / if changed\n      if (column === 'avatar' && profile._avatar) {\n        user[column] = profile._avatar;\n        return;\n      }\n      // value\n      let value = profile[column];\n      // only set when empty\n      if (user[column] || !value) return;\n      // userName\n      if (column === 'userName') {\n        const res = await this.exists({ [column]: value });\n        if (res) {\n          // sequence\n          const sequence = await this.sequence.next('userName');\n          value = `${value}__${sequence}`;\n        }\n      } else if (column === 'email' || column === 'mobile') {\n        const res = await this.exists({ [column]: value });\n        if (res) {\n          value = null;\n        }\n      }\n      if (value) {\n        user[column] = value;\n      }\n    }\n\n    async getAuthProvider({ subdomain, iid, id, module, providerName }) {\n      // ctx.instance maybe not exists\n      const data = id ? {\n        iid: iid || ctx.instance.id,\n        id,\n      } : {\n        iid: iid || ctx.instance.id,\n        module,\n        providerName,\n      };\n      const res = await ctx.db.get('aAuthProvider', data);\n      if (res) return res;\n      if (!module || !providerName) throw new Error('Invalid arguments');\n      // lock\n      const _subdomain = subdomain !== undefined ? subdomain : ctx.subdomain;\n      return await ctx.app.meta.util.lock({\n        subdomain: _subdomain,\n        resource: `${moduleInfo.relativeName}.authProvider.register`,\n        fn: async () => {\n          return await ctx.app.meta.util.executeBean({\n            subdomain: _subdomain,\n            beanModule: moduleInfo.relativeName,\n            beanFullName: 'user',\n            context: { module, providerName },\n            fn: '_registerAuthProviderLock',\n          });\n        },\n      });\n    }\n\n    async _registerAuthProviderLock({ module, providerName }) {\n      // get\n      const res = await this.modelAuthProvider.get({ module, providerName });\n      if (res) return res;\n      // data\n      // const _authProviders = ctx.bean.base.authProviders();\n      // const _provider = _authProviders[`${module}:${providerName}`];\n      // if (!_provider) throw new Error(`authProvider ${module}:${providerName} not found!`);\n      const data = {\n        module,\n        providerName,\n        // config: JSON.stringify(_provider.config),\n        disabled: 0,\n      };\n      // insert\n      const res2 = await this.modelAuthProvider.insert(data);\n      data.id = res2.insertId;\n      return data;\n    }\n\n  }\n\n  return User;\n};\n","const require3 = require('require3');\nconst moment = require3('moment');\nconst mparse = require3('egg-born-mparse').default;\n\nmodule.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Util {\n\n    page(_page, force = true) {\n      const pageSize = ctx.config.module(moduleInfo.relativeName).pageSize;\n      if (!_page) {\n        _page = force ? { index: 0 } : { index: 0, size: 0 };\n      }\n      if (_page.size === undefined || (force && (_page.size === 0 || _page.size === -1 || _page.size > pageSize))) _page.size = pageSize;\n      return _page;\n    }\n\n    user(_user) {\n      return _user || ctx.state.user.op;\n    }\n\n    now() {\n      return moment().format('YYYY-MM-DD HH:mm:ss');\n    }\n\n    today() {\n      return moment().format('YYYY-MM-DD');\n    }\n\n    formatDateTime(date, fmt) {\n      date = date || new Date();\n      fmt = fmt || 'YYYY-MM-DD HH:mm:ss';\n      if (typeof (date) !== 'object') date = new Date(date);\n      return moment(date).format(fmt);\n    }\n\n    formatDate(date, sep) {\n      if (this.isUndefined(sep)) sep = '-';\n      const fmt = `YYYY${sep}MM${sep}DD`;\n      return this.formatDateTime(date, fmt);\n    }\n\n    formatTime(date, sep) {\n      if (this.isUndefined(sep)) sep = ':';\n      const fmt = `HH${sep}mm${sep}ss`;\n      return this.formatDateTime(date, fmt);\n    }\n\n    fromNow(date) {\n      if (typeof (date) !== 'object') date = new Date(date);\n      return moment(date).fromNow();\n    }\n\n    replaceTemplate(content, scope) {\n      if (!content) return null;\n      return content.toString().replace(/(\\\\)?{{ *(\\w+) *}}/g, (block, skip, key) => {\n        if (skip) {\n          return block.substring(skip.length);\n        }\n        return scope[key] !== undefined ? scope[key] : '';\n      });\n    }\n\n    sleep(ms) {\n      return new Promise(resolve => setTimeout(resolve, ms));\n    }\n\n    combinePagePath(moduleName, arg) {\n      if (!arg || typeof arg !== 'string') return arg;\n      const first = arg.charAt(0);\n      if (first === '/' || first === '#') return arg;\n      const moduleInfo = typeof moduleName === 'string' ? mparse.parseInfo(moduleName) : moduleName;\n      return `/${moduleInfo.url}/${arg}`;\n    }\n\n  }\n\n  return Util;\n};\n","module.exports = app => {\n  class Broadcast extends app.meta.BeanBase {\n\n    async execute(context) {\n      const data = context.data;\n      await this.ctx.bean.auth._registerInstanceProvider(this.ctx.subdomain, this.ctx.instance.id, data.module, data.providerName);\n    }\n\n  }\n\n  return Broadcast;\n};\n","module.exports = ctx => {\n  class Procedure {\n\n    selectAtoms({ iid, userIdWho, tableName, where, orders, page, star, label, comment, file, count, stage, language, category, tag, mine, resource, resourceLocale }) {\n      iid = parseInt(iid);\n      userIdWho = parseInt(userIdWho);\n      star = parseInt(star);\n      label = parseInt(label);\n      comment = parseInt(comment);\n      file = parseInt(file);\n      stage = parseInt(stage);\n      category = parseInt(category);\n      tag = parseInt(tag);\n      mine = parseInt(mine);\n      resource = parseInt(resource);\n\n      // draft\n      if (stage === 0) {\n        // userIdWho must be set\n        return this._selectAtoms_draft({ iid, userIdWho, tableName, where, orders, page, star, label, comment, file, count, stage, language, category, tag });\n      }\n      if (userIdWho === 0) return this._selectAtoms_0({ iid, tableName, where, orders, page, comment, file, count, stage, language, category, tag, resource, resourceLocale });\n      // archive/history\n      return this._selectAtoms({ iid, userIdWho, tableName, where, orders, page, star, label, comment, file, count, stage, language, category, tag, mine, resource, resourceLocale });\n    }\n\n    _selectAtoms_draft({ iid, userIdWho, tableName, where, orders, page, star, label, comment, file, count, stage, language, category, tag }) {\n      // -- tables\n      // -- a: aAtom\n      // -- b: aAtomClass\n      // -- c: aViewUserRightAtomRole\n      // -- d: aAtomStar\n      // -- e: aAtomLabelRef\n      // -- f: {item}\n      // -- g: aUser\n      // -- g2: aUser\n      // -- h: aComment\n      // -- i: aFile\n      // -- j: aCategory\n      // -- k: aTagRef\n\n      // for safe\n      tableName = tableName ? ctx.model.format('??', tableName) : null;\n      where = where ? ctx.model._where(where) : null;\n      orders = orders ? ctx.model._orders(orders) : null;\n      const limit = page ? ctx.model._limit(page.size, page.index) : null;\n\n      // vars\n      let\n        _languageWhere;\n      let\n        _categoryWhere;\n      let\n        _tagJoin,\n        _tagWhere;\n\n      let\n        _starJoin,\n        _starWhere;\n\n      let\n        _labelJoin,\n        _labelWhere;\n      let _commentField,\n        _commentJoin,\n        _commentWhere;\n      let _fileField,\n        _fileJoin,\n        _fileWhere;\n      let _itemField,\n        _itemJoin;\n\n      //\n      const _where = where ? `${where} AND` : ' WHERE';\n      const _orders = orders || '';\n      const _limit = limit || '';\n\n      // language\n      if (language) {\n        _languageWhere = ctx.model.format(' and a.atomLanguage=?', language);\n      } else {\n        _languageWhere = '';\n      }\n\n      // category\n      if (category) {\n        _categoryWhere = ` and a.atomCategoryId=${category}`;\n      } else {\n        _categoryWhere = '';\n      }\n\n      // tag\n      if (tag) {\n        _tagJoin = ' inner join aTagRef k on k.atomId=a.id';\n        _tagWhere = ` and k.iid=${iid} and k.tagId=${tag}`;\n      } else {\n        _tagJoin = '';\n        _tagWhere = '';\n      }\n\n      // star\n      if (star) {\n        _starJoin = ' inner join aAtomStar d on a.id=d.atomId';\n        _starWhere = ` and d.iid=${iid} and d.userId=${userIdWho} and d.star=1`;\n      } else {\n        _starJoin = '';\n        _starWhere = '';\n      }\n      const _starField = `,(select d2.star from aAtomStar d2 where d2.iid=${iid} and d2.atomId=a.id and d2.userId=${userIdWho}) as star`;\n\n      // label\n      if (label) {\n        _labelJoin = ' inner join aAtomLabelRef e on a.id=e.atomId';\n        _labelWhere = ` and e.iid=${iid} and e.userId=${userIdWho} and e.labelId=${label}`;\n      } else {\n        _labelJoin = '';\n        _labelWhere = '';\n      }\n      const _labelField = `,(select e2.labels from aAtomLabel e2 where e2.iid=${iid} and e2.atomId=a.id and e2.userId=${userIdWho}) as labels`;\n\n      // comment\n      if (comment) {\n        _commentField =\n             `,h.id h_id,h.createdAt h_createdAt,h.updatedAt h_updatedAt,h.userId h_userId,h.sorting h_sorting,h.heartCount h_heartCount,h.replyId h_replyId,h.replyUserId h_replyUserId,h.replyContent h_replyContent,h.content h_content,h.summary h_summary,h.html h_html,h.userName h_userName,h.avatar h_avatar,h.replyUserName h_replyUserName,\n               (select h2.heart from aCommentHeart h2 where h2.iid=${iid} and h2.commentId=h.id and h2.userId=${userIdWho}) as h_heart`;\n\n        _commentJoin = ' inner join aViewComment h on h.atomId=a.id';\n        _commentWhere = ` and h.iid=${iid} and h.deleted=0`;\n      } else {\n        _commentField = '';\n        _commentJoin = '';\n        _commentWhere = '';\n      }\n\n      // file\n      if (file) {\n        _fileField = ',i.id i_id,i.createdAt i_createdAt,i.updatedAt i_updatedAt,i.userId i_userId,i.downloadId i_downloadId,i.mode i_mode,i.fileSize i_fileSize,i.width i_width,i.height i_height,i.filePath i_filePath,i.fileName i_fileName,i.realName i_realName,i.fileExt i_fileExt,i.encoding i_encoding,i.mime i_mime,i.attachment i_attachment,i.flag i_flag,i.userName i_userName,i.avatar i_avatar';\n        _fileJoin = ' inner join aViewFile i on i.atomId=a.id';\n        _fileWhere = ` and i.iid=${iid} and i.deleted=0`;\n      } else {\n        _fileField = '';\n        _fileJoin = '';\n        _fileWhere = '';\n      }\n\n      // tableName\n      if (tableName) {\n        _itemField = 'f.*,';\n        _itemJoin = ` inner join ${tableName} f on f.atomId=a.id`;\n      } else {\n        _itemField = '';\n        _itemJoin = '';\n      }\n\n      // fields\n      let _selectFields;\n      if (count) {\n        _selectFields = 'count(*) as _count';\n      } else {\n        _selectFields = `${_itemField}\n                a.id as atomId,a.itemId,a.atomStage,a.atomFlowId,a.atomClosed,a.atomIdDraft,a.atomIdFormal,a.roleIdOwner,a.atomClassId,a.atomName,\n                a.atomStatic,a.atomStaticKey,a.atomRevision,a.atomLanguage,a.atomCategoryId,j.categoryName as atomCategoryName,a.atomTags,a.atomDisabled,\n                a.allowComment,a.starCount,a.commentCount,a.attachmentCount,a.readCount,a.userIdCreated,a.userIdUpdated,a.createdAt as atomCreatedAt,a.updatedAt as atomUpdatedAt,\n                b.module,b.atomClassName,b.atomClassIdParent,\n                g.userName,g.avatar,\n                g2.userName as userNameUpdated,g2.avatar as avatarUpdated\n                ${_starField} ${_labelField} ${_commentField} ${_fileField}`;\n      }\n\n      // sql\n      const _sql =\n        `select ${_selectFields} from aAtom a\n            inner join aAtomClass b on a.atomClassId=b.id\n            left join aUser g on a.userIdCreated=g.id\n            left join aUser g2 on a.userIdUpdated=g2.id\n            left join aCategory j on a.atomCategoryId=j.id\n            ${_itemJoin}\n            ${_tagJoin}\n            ${_starJoin}\n            ${_labelJoin}\n            ${_commentJoin}\n            ${_fileJoin}\n\n          ${_where}\n           (\n             a.deleted=0 and a.iid=${iid} and a.atomStage=${stage} and a.atomClosed=0 and a.userIdUpdated=${userIdWho}\n             and a.atomFlowId=0\n             ${_languageWhere}\n             ${_categoryWhere}\n             ${_tagWhere}\n             ${_starWhere}\n             ${_labelWhere}\n             ${_commentWhere}\n             ${_fileWhere}\n           )\n\n          ${count ? '' : _orders}\n          ${count ? '' : _limit}\n        `;\n\n      // ok\n      return _sql;\n    }\n\n    _selectAtoms_0({ iid, tableName, where, orders, page, comment, file, count, stage, language, category, tag, resource, resourceLocale }) {\n      // -- tables\n      // -- a: aAtom\n      // -- b: aAtomClass\n      // -- c: aViewUserRightAtomRole\n      // -- d: aAtomStar\n      // -- e: aAtomLabelRef\n      // -- f: {item}\n      // -- g: aUser\n      // -- g2: aUser\n      // -- h: aComment\n      // -- i: aFile\n      // -- j: aCategory\n      // -- k: aTagRef\n      // -- m: aResourceLocale\n\n      // for safe\n      tableName = tableName ? ctx.model.format('??', tableName) : null;\n      where = where ? ctx.model._where(where) : null;\n      orders = orders ? ctx.model._orders(orders) : null;\n      const limit = page ? ctx.model._limit(page.size, page.index) : null;\n\n      // vars\n      let\n        _languageWhere;\n      let\n        _categoryWhere;\n      let\n        _tagJoin,\n        _tagWhere;\n\n      let _commentField,\n        _commentJoin,\n        _commentWhere;\n      let _fileField,\n        _fileJoin,\n        _fileWhere;\n      let _itemField,\n        _itemJoin;\n\n      let _resourceField,\n        _resourceJoin,\n        _resourceWhere;\n\n      //\n      const _where = where ? `${where} AND` : ' WHERE';\n      const _orders = orders || '';\n      const _limit = limit || '';\n\n      // language\n      if (language) {\n        _languageWhere = ctx.model.format(' and a.atomLanguage=?', language);\n      } else {\n        _languageWhere = '';\n      }\n\n      // category\n      if (category) {\n        _categoryWhere = ` and a.atomCategoryId=${category}`;\n      } else {\n        _categoryWhere = '';\n      }\n\n      // tag\n      if (tag) {\n        _tagJoin = ' inner join aTagRef k on k.atomId=a.id';\n        _tagWhere = ` and k.iid=${iid} and k.tagId=${tag}`;\n      } else {\n        _tagJoin = '';\n        _tagWhere = '';\n      }\n\n      // comment\n      if (comment) {\n        _commentField =\n             ',h.id h_id,h.createdAt h_createdAt,h.updatedAt h_updatedAt,h.userId h_userId,h.sorting h_sorting,h.heartCount h_heartCount,h.replyId h_replyId,h.replyUserId h_replyUserId,h.replyContent h_replyContent,h.content h_content,h.summary h_summary,h.html h_html,h.userName h_userName,h.avatar h_avatar,h.replyUserName h_replyUserName';\n        _commentJoin = ' inner join aViewComment h on h.atomId=a.id';\n        _commentWhere = ` and h.iid=${iid} and h.deleted=0`;\n      } else {\n        _commentField = '';\n        _commentJoin = '';\n        _commentWhere = '';\n      }\n\n      // file\n      if (file) {\n        _fileField = ',i.id i_id,i.createdAt i_createdAt,i.updatedAt i_updatedAt,i.userId i_userId,i.downloadId i_downloadId,i.mode i_mode,i.fileSize i_fileSize,i.width i_width,i.height i_height,i.filePath i_filePath,i.fileName i_fileName,i.realName i_realName,i.fileExt i_fileExt,i.encoding i_encoding,i.mime i_mime,i.attachment i_attachment,i.flag i_flag,i.userName i_userName,i.avatar i_avatar';\n        _fileJoin = ' inner join aViewFile i on i.atomId=a.id';\n        _fileWhere = ` and i.iid=${iid} and i.deleted=0`;\n      } else {\n        _fileField = '';\n        _fileJoin = '';\n        _fileWhere = '';\n      }\n\n      // resource\n      if (resource && resourceLocale) {\n        _resourceField = ',m.atomNameLocale';\n        _resourceJoin = ' left join aResourceLocale m on m.atomId=a.id';\n        _resourceWhere = ctx.model.format(' and a.atomDisabled=0 and m.locale=?', resourceLocale);\n      } else {\n        _resourceField = '';\n        _resourceJoin = '';\n        _resourceWhere = '';\n      }\n\n      // tableName\n      if (tableName) {\n        _itemField = 'f.*,';\n        _itemJoin = ` inner join ${tableName} f on f.atomId=a.id`;\n      } else {\n        _itemField = '';\n        _itemJoin = '';\n      }\n\n      // fields\n      let _selectFields;\n      if (count) {\n        _selectFields = 'count(*) as _count';\n      } else {\n        _selectFields = `${_itemField}\n                a.id as atomId,a.itemId,a.atomStage,a.atomFlowId,a.atomClosed,a.atomIdDraft,a.atomIdFormal,a.roleIdOwner,a.atomClassId,a.atomName,\n                a.atomStatic,a.atomStaticKey,a.atomRevision,a.atomLanguage,a.atomCategoryId,j.categoryName as atomCategoryName,a.atomTags,a.atomDisabled,\n                a.allowComment,a.starCount,a.commentCount,a.attachmentCount,a.readCount,a.userIdCreated,a.userIdUpdated,a.createdAt as atomCreatedAt,a.updatedAt as atomUpdatedAt,\n                b.module,b.atomClassName,b.atomClassIdParent,\n                g.userName,g.avatar,\n                g2.userName as userNameUpdated,g2.avatar as avatarUpdated\n                ${_commentField} ${_fileField} ${_resourceField}`;\n      }\n\n      // sql\n      const _sql =\n        `select ${_selectFields} from aAtom a\n            inner join aAtomClass b on a.atomClassId=b.id\n            left join aUser g on a.userIdCreated=g.id\n            left join aUser g2 on a.userIdUpdated=g2.id\n            left join aCategory j on a.atomCategoryId=j.id\n            ${_itemJoin}\n            ${_tagJoin}\n            ${_commentJoin}\n            ${_fileJoin}\n            ${_resourceJoin}\n\n          ${_where}\n           (\n             a.deleted=0 and a.iid=${iid} and a.atomStage=${stage}\n             ${_languageWhere}\n             ${_categoryWhere}\n             ${_tagWhere}\n             ${_commentWhere}\n             ${_fileWhere}\n             ${_resourceWhere}\n           )\n\n          ${count ? '' : _orders}\n          ${count ? '' : _limit}\n        `;\n\n      // ok\n      return _sql;\n    }\n\n    _selectAtoms({ iid, userIdWho, tableName, where, orders, page, star, label, comment, file, count, stage, language, category, tag, mine, resource, resourceLocale }) {\n      // -- tables\n      // -- a: aAtom\n      // -- b: aAtomClass\n      // -- c: aViewUserRightAtomRole\n      // -- d: aAtomStar\n      // -- e: aAtomLabelRef\n      // -- f: {item}\n      // -- g: aUser\n      // -- g2: aUser\n      // -- h: aComment\n      // -- i: aFile\n      // -- j: aCategory\n      // -- k: aTagRef\n      // -- m: aResourceLocale\n\n      // for safe\n      tableName = tableName ? ctx.model.format('??', tableName) : null;\n      where = where ? ctx.model._where(where) : null;\n      orders = orders ? ctx.model._orders(orders) : null;\n      const limit = page ? ctx.model._limit(page.size, page.index) : null;\n\n      // vars\n      let\n        _languageWhere;\n      let\n        _categoryWhere;\n      let\n        _tagJoin,\n        _tagWhere;\n\n      let\n        _starJoin,\n        _starWhere;\n\n      let\n        _labelJoin,\n        _labelWhere;\n      let _commentField,\n        _commentJoin,\n        _commentWhere;\n      let _fileField,\n        _fileJoin,\n        _fileWhere;\n      let _itemField,\n        _itemJoin;\n\n      let _resourceField,\n        _resourceJoin,\n        _resourceWhere;\n\n      //\n      const _where = where ? `${where} AND` : ' WHERE';\n      const _orders = orders || '';\n      const _limit = limit || '';\n\n      // language\n      if (language) {\n        _languageWhere = ctx.model.format(' and a.atomLanguage=?', language);\n      } else {\n        _languageWhere = '';\n      }\n\n      // category\n      if (category) {\n        _categoryWhere = ` and a.atomCategoryId=${category}`;\n      } else {\n        _categoryWhere = '';\n      }\n\n      // tag\n      if (tag) {\n        _tagJoin = ' inner join aTagRef k on k.atomId=a.id';\n        _tagWhere = ` and k.iid=${iid} and k.tagId=${tag}`;\n      } else {\n        _tagJoin = '';\n        _tagWhere = '';\n      }\n\n      // star\n      if (star) {\n        _starJoin = ' inner join aAtomStar d on a.id=d.atomId';\n        _starWhere = ` and d.iid=${iid} and d.userId=${userIdWho} and d.star=1`;\n      } else {\n        _starJoin = '';\n        _starWhere = '';\n      }\n      const _starField = `,(select d2.star from aAtomStar d2 where d2.iid=${iid} and d2.atomId=a.id and d2.userId=${userIdWho}) as star`;\n\n      // label\n      if (label) {\n        _labelJoin = ' inner join aAtomLabelRef e on a.id=e.atomId';\n        _labelWhere = ` and e.iid=${iid} and e.userId=${userIdWho} and e.labelId=${label}`;\n      } else {\n        _labelJoin = '';\n        _labelWhere = '';\n      }\n      const _labelField = `,(select e2.labels from aAtomLabel e2 where e2.iid=${iid} and e2.atomId=a.id and e2.userId=${userIdWho}) as labels`;\n\n      // comment\n      if (comment) {\n        _commentField =\n             `,h.id h_id,h.createdAt h_createdAt,h.updatedAt h_updatedAt,h.userId h_userId,h.sorting h_sorting,h.heartCount h_heartCount,h.replyId h_replyId,h.replyUserId h_replyUserId,h.replyContent h_replyContent,h.content h_content,h.summary h_summary,h.html h_html,h.userName h_userName,h.avatar h_avatar,h.replyUserName h_replyUserName,\n               (select h2.heart from aCommentHeart h2 where h2.iid=${iid} and h2.commentId=h.id and h2.userId=${userIdWho}) as h_heart`;\n\n        _commentJoin = ' inner join aViewComment h on h.atomId=a.id';\n        _commentWhere = ` and h.iid=${iid} and h.deleted=0`;\n      } else {\n        _commentField = '';\n        _commentJoin = '';\n        _commentWhere = '';\n      }\n\n      // file\n      if (file) {\n        _fileField = ',i.id i_id,i.createdAt i_createdAt,i.updatedAt i_updatedAt,i.userId i_userId,i.downloadId i_downloadId,i.mode i_mode,i.fileSize i_fileSize,i.width i_width,i.height i_height,i.filePath i_filePath,i.fileName i_fileName,i.realName i_realName,i.fileExt i_fileExt,i.encoding i_encoding,i.mime i_mime,i.attachment i_attachment,i.flag i_flag,i.userName i_userName,i.avatar i_avatar';\n        _fileJoin = ' inner join aViewFile i on i.atomId=a.id';\n        _fileWhere = ` and i.iid=${iid} and i.deleted=0`;\n      } else {\n        _fileField = '';\n        _fileJoin = '';\n        _fileWhere = '';\n      }\n\n      // resource\n      if (resource && resourceLocale) {\n        _resourceField = ',m.atomNameLocale';\n        _resourceJoin = ' left join aResourceLocale m on m.atomId=a.id';\n        _resourceWhere = ctx.model.format(' and a.atomDisabled=0 and m.locale=?', resourceLocale);\n      } else {\n        _resourceField = '';\n        _resourceJoin = '';\n        _resourceWhere = '';\n      }\n\n      // tableName\n      if (tableName) {\n        _itemField = 'f.*,';\n        _itemJoin = ` inner join ${tableName} f on f.atomId=a.id`;\n      } else {\n        _itemField = '';\n        _itemJoin = '';\n      }\n\n      // fields\n      let _selectFields;\n      if (count) {\n        _selectFields = 'count(*) as _count';\n      } else {\n        _selectFields = `${_itemField}\n                a.id as atomId,a.itemId,a.atomStage,a.atomFlowId,a.atomClosed,a.atomIdDraft,a.atomIdFormal,a.roleIdOwner,a.atomClassId,a.atomName,\n                a.atomStatic,a.atomStaticKey,a.atomRevision,a.atomLanguage,a.atomCategoryId,j.categoryName as atomCategoryName,a.atomTags,a.atomDisabled,\n                a.allowComment,a.starCount,a.commentCount,a.attachmentCount,a.readCount,a.userIdCreated,a.userIdUpdated,a.createdAt as atomCreatedAt,a.updatedAt as atomUpdatedAt,\n                b.module,b.atomClassName,b.atomClassIdParent,\n                g.userName,g.avatar,\n                g2.userName as userNameUpdated,g2.avatar as avatarUpdated\n                ${_starField} ${_labelField} ${_commentField} ${_fileField} ${_resourceField}`;\n      }\n\n      // mine\n      let _rightWhere;\n      if (mine) {\n        _rightWhere = `\n          (a.userIdCreated=${userIdWho} and exists(select c.atomClassId from aViewUserRightAtomClass c where c.iid=${iid} and a.atomClassId=c.atomClassId and c.action=2 and c.scope=0 and c.userIdWho=${userIdWho}))\n        `;\n      } else if (resource) {\n        _rightWhere = `\n          exists(\n            select c.resourceAtomId from aViewUserRightResource c where c.iid=${iid} and a.id=c.resourceAtomId and c.userIdWho=${userIdWho}\n          )\n        `;\n      } else {\n        _rightWhere = `\n          exists(\n            select c.atomId from aViewUserRightAtomRole c where c.iid=${iid} and a.id=c.atomId and c.action=2 and c.userIdWho=${userIdWho}\n          )\n        `;\n      }\n\n      // sql\n      const _sql =\n        `select ${_selectFields} from aAtom a\n            inner join aAtomClass b on a.atomClassId=b.id\n            left join aUser g on a.userIdCreated=g.id\n            left join aUser g2 on a.userIdUpdated=g2.id\n            left join aCategory j on a.atomCategoryId=j.id\n            ${_itemJoin}\n            ${_tagJoin}\n            ${_starJoin}\n            ${_labelJoin}\n            ${_commentJoin}\n            ${_fileJoin}\n            ${_resourceJoin}\n\n          ${_where}\n           (\n             a.deleted=0 and a.iid=${iid} and a.atomStage=${stage}\n             ${_languageWhere}\n             ${_categoryWhere}\n             ${_tagWhere}\n             ${_starWhere}\n             ${_labelWhere}\n             ${_commentWhere}\n             ${_fileWhere}\n             ${_resourceWhere}\n             and ( ${_rightWhere} )\n           )\n\n          ${count ? '' : _orders}\n          ${count ? '' : _limit}\n        `;\n\n      // ok\n      return _sql;\n    }\n\n    getAtom({ iid, userIdWho, tableName, atomId, resource, resourceLocale }) {\n      // -- tables\n      // -- a: aAtom\n      // -- b: aAtomClass\n      // -- d: aAtomStar\n      // -- e: aAtomLabelRef\n      // -- f: {item}\n      // -- g: aUser\n      // -- g2: aUser\n      // -- j: aCategory\n      // -- m: aResourceLocale\n\n      // for safe\n      tableName = tableName ? ctx.model.format('??', tableName) : null;\n\n      iid = parseInt(iid);\n      userIdWho = parseInt(userIdWho);\n      atomId = parseInt(atomId);\n      resource = parseInt(resource);\n\n      // vars\n      let _starField,\n        _labelField;\n      let _itemField,\n        _itemJoin;\n\n      let _resourceField,\n        _resourceJoin,\n        _resourceWhere;\n\n      // star\n      if (userIdWho) {\n        _starField =\n          `,(select d.star from aAtomStar d where d.iid=${iid} and d.atomId=a.id and d.userId=${userIdWho}) as star`;\n      } else {\n        _starField = '';\n      }\n\n      // label\n      if (userIdWho) {\n        _labelField =\n          `,(select e.labels from aAtomLabel e where e.iid=${iid} and e.atomId=a.id and e.userId=${userIdWho}) as labels`;\n      } else {\n        _labelField = '';\n      }\n\n      // resource\n      if (resource && resourceLocale) {\n        _resourceField = ',m.atomNameLocale';\n        _resourceJoin = ' left join aResourceLocale m on m.atomId=a.id';\n        // not check atomDisabled\n        _resourceWhere = ctx.model.format(' and m.locale=?', resourceLocale);\n      } else {\n        _resourceField = '';\n        _resourceJoin = '';\n        _resourceWhere = '';\n      }\n\n      // tableName\n      if (tableName) {\n        _itemField = 'f.*,';\n        _itemJoin = ` inner join ${tableName} f on f.atomId=a.id`;\n      } else {\n        _itemField = '';\n        _itemJoin = '';\n      }\n\n      // sql\n      const _sql =\n        `select ${_itemField}\n                a.id as atomId,a.itemId,a.atomStage,a.atomFlowId,a.atomClosed,a.atomIdDraft,a.atomIdFormal,a.roleIdOwner,a.atomClassId,a.atomName,\n                a.atomStatic,a.atomStaticKey,a.atomRevision,a.atomLanguage,a.atomCategoryId,j.categoryName as atomCategoryName,a.atomTags,a.atomDisabled,\n                a.allowComment,a.starCount,a.commentCount,a.attachmentCount,a.readCount,a.userIdCreated,a.userIdUpdated,a.createdAt as atomCreatedAt,a.updatedAt as atomUpdatedAt,\n                b.module,b.atomClassName,b.atomClassIdParent,\n                g.userName,g.avatar,\n                g2.userName as userNameUpdated,g2.avatar as avatarUpdated\n                ${_starField}\n                ${_labelField}\n                ${_resourceField}\n          from aAtom a\n\n            inner join aAtomClass b on a.atomClassId=b.id\n            left join aUser g on a.userIdCreated=g.id\n            left join aUser g2 on a.userIdUpdated=g2.id\n            left join aCategory j on a.atomCategoryId=j.id\n            ${_itemJoin}\n            ${_resourceJoin}\n\n          where a.id=${atomId}\n            and a.deleted=0 and a.iid=${iid}\n            ${_resourceWhere}\n        `;\n\n      // ok\n      return _sql;\n    }\n\n    checkRoleRightRead({ iid, roleIdWho, atomId }) {\n      // for safe\n      iid = parseInt(iid);\n      roleIdWho = parseInt(roleIdWho);\n      atomId = parseInt(atomId);\n      // sql\n      const _sql =\n        `select a.* from aAtom a\n           left join aAtomClass b on a.atomClassId=b.id\n            where\n            (\n               a.deleted=0 and a.iid=${iid} and a.id=${atomId}\n               and a.atomStage>0 and\n                (\n                  exists(\n                          select c.atomId from aViewRoleRightAtom c where c.iid=${iid} and a.id=c.atomId and c.action=2 and c.roleIdWho=${roleIdWho}\n                        )\n                )\n            )\n        `;\n      return _sql;\n    }\n\n    // check for archive/history\n    checkRightRead({ iid, userIdWho, atomId }) {\n      // for safe\n      iid = parseInt(iid);\n      userIdWho = parseInt(userIdWho);\n      atomId = parseInt(atomId);\n      // sql\n      const _sql =\n        `select a.* from aAtom a\n           left join aAtomClass b on a.atomClassId=b.id\n             where\n             (\n                 a.deleted=0 and a.iid=${iid} and a.id=${atomId}\n                 and a.atomStage>0 and\n                  (\n                    exists(\n                            select c.atomId from aViewUserRightAtomRole c where c.iid=${iid} and a.id=c.atomId and c.action=2 and c.userIdWho=${userIdWho}\n                          )\n                      or\n                   (a.userIdCreated=${userIdWho} and exists(select c.atomClassId from aViewUserRightAtomClass c where c.iid=${iid} and a.atomClassId=c.atomClassId and c.action=2 and c.scope=0 and c.userIdWho=${userIdWho}))\n                  )\n             )\n        `;\n      return _sql;\n    }\n\n    checkRightAction({ iid, userIdWho, atomId, action }) {\n      // for safe\n      iid = parseInt(iid);\n      userIdWho = parseInt(userIdWho);\n      atomId = parseInt(atomId);\n      action = parseInt(action);\n\n      // sql\n      const _sql =\n        `select a.* from aAtom a\n            where\n            (\n              a.deleted=0 and a.iid=${iid} and a.id=${atomId}\n              and a.atomStage>0 and\n                (\n                  (exists(select c.atomId from aViewUserRightAtomRole c where c.iid=${iid} and a.id=c.atomId and c.action=${action} and c.userIdWho=${userIdWho})) or\n                  (a.userIdCreated=${userIdWho} and exists(select c.atomClassId from aViewUserRightAtomClass c where c.iid=${iid} and a.atomClassId=c.atomClassId and c.action=${action} and c.scope=0 and c.userIdWho=${userIdWho}))\n                )\n            )\n        `;\n      return _sql;\n    }\n\n    checkRightActionBulk({ iid, userIdWho, atomClassId, action }) {\n      // for safe\n      iid = parseInt(iid);\n      userIdWho = parseInt(userIdWho);\n      atomClassId = parseInt(atomClassId);\n      action = parseInt(action || 0);\n\n      const _actionWhere = action ? `and a.code=${action}` : '';\n      const _rightWhere = `\n        and exists(\n          select b.atomClassId from aViewUserRightAtomClass b where b.iid=${iid} and a.atomClassId=b.atomClassId and a.code=b.action and b.userIdWho=${userIdWho}\n        )\n      `;\n      // sql\n      const _sql =\n        `select a.*,c.module,c.atomClassName,c.atomClassIdParent from aAtomAction a\n            left join aAtomClass c on a.atomClassId=c.id\n              where a.iid=${iid} and a.bulk=1 and a.atomClassId=${atomClassId} ${_actionWhere} ${_rightWhere}\n        `;\n      return _sql;\n    }\n\n    checkRightCreateRole({ iid, userIdWho, atomClassId, roleIdOwner }) {\n      // for safe\n      iid = parseInt(iid);\n      userIdWho = parseInt(userIdWho);\n      atomClassId = parseInt(atomClassId);\n      roleIdOwner = parseInt(roleIdOwner);\n\n      const _rightWhere = `\n        and exists(\n          select b.atomClassId from aViewUserRightAtomClass b where b.iid=${iid} and a.id=b.atomClassId and b.action=1 and b.userIdWho=${userIdWho} and b.roleId=${roleIdOwner}\n        )\n      `;\n      // sql\n      const _sql =\n        `select a.* from aAtomClass a\n            where a.iid=${iid} and a.id=${atomClassId} ${_rightWhere}\n        `;\n      return _sql;\n    }\n\n\n    checkRightResource({ iid, userIdWho, resourceAtomId }) {\n      // for safe\n      iid = parseInt(iid);\n      userIdWho = parseInt(userIdWho);\n      resourceAtomId = parseInt(resourceAtomId);\n      // sql\n      const _sql =\n        `select a.id as atomId,a.atomName from aAtom a\n            where a.iid=${iid} and a.deleted=0 and a.atomDisabled=0 and a.atomStage=1 and a.id=${resourceAtomId}\n              and (\n                exists(select c.resourceAtomId from aViewUserRightResource c where c.iid=${iid} and c.resourceAtomId=${resourceAtomId} and c.userIdWho=${userIdWho})\n                  )\n        `;\n      return _sql;\n    }\n\n    _checkResourceLocales({ iid, locale }) {\n      // for safe\n      iid = parseInt(iid);\n      locale = ctx.model.format('?', locale);\n      // sql\n      const _sql =\n        `select a.id,a.atomId,c.atomName from aResource a\n          inner join aAtom c on c.id=a.atomId\n            where a.iid=${iid} and a.deleted=0 and c.atomStage=1\n              and not exists(\n                select b.id from aResourceLocale b\n                  where b.iid=${iid} and b.locale=${locale} and b.atomId=a.atomId\n                    and (b.atomNameLocale is not null and b.atomNameLocale<>'')\n                )\n        `;\n      return _sql;\n    }\n\n    selectUsers({ iid, where, orders, page, count, fields }) {\n      // -- tables\n      // -- a: aUser\n\n      // for safe\n      where = where ? ctx.model._where(where) : null;\n      orders = orders ? ctx.model._orders(orders) : null;\n      const limit = page ? ctx.model._limit(page.size, page.index) : null;\n\n      // vars\n\n      //\n      const _where = where ? `${where} AND` : ' WHERE';\n      const _orders = orders || '';\n      const _limit = limit || '';\n\n      // fields\n      let _selectFields;\n      if (count) {\n        _selectFields = 'count(*) as _count';\n      } else {\n        _selectFields = fields;\n      }\n\n      // sql\n      const _sql =\n        `select ${_selectFields} from aUser a\n          ${_where}\n           (\n             a.deleted=0 and a.iid=${iid}\n           )\n\n          ${count ? '' : _orders}\n          ${count ? '' : _limit}\n        `;\n\n      // ok\n      return _sql;\n    }\n\n  }\n\n  return Procedure;\n\n};\n\n// /* backup */\n\n// function selectFunctions({ iid, locale, userIdWho, where, orders, page, star }) {\n//   // -- tables\n//   // -- a: aFunction\n//   // -- b: aFunctionLocale\n//   // -- c: aViewUserRightFunction\n//   // -- d: aFunctionStar\n//   // -- e: aAtomClass\n//   // -- f: aFunctionScene\n\n//   // for safe\n//   where = where ? ctx.model._where(where) : null;\n//   orders = orders ? ctx.model._orders(orders) : null;\n//   const limit = page ? ctx.model._limit(page.size, page.index) : null;\n\n//   iid = parseInt(iid);\n//   userIdWho = parseInt(userIdWho);\n//   star = parseInt(star);\n\n//   locale = locale ? ctx.model.format('?', locale) : null;\n\n//   // vars\n//   let _starField,\n//     _starJoin,\n//     _starWhere;\n//   let _localeField,\n//     _localeJoin,\n//     _localeWhere;\n\n//   //\n//   const _where = where ? `${where} AND` : ' WHERE';\n//   const _orders = orders || '';\n//   const _limit = limit || '';\n\n//   // star\n//   if (star) {\n//     _starField = '';\n//     _starJoin = ' inner join aFunctionStar d on a.id=d.functionId';\n//     _starWhere = ` and d.iid=${iid} and d.userId=${userIdWho} and d.star=1`;\n//   } else {\n//     _starField =\n//         `,(select d.star from aFunctionStar d where d.iid=${iid} and d.functionId=a.id and d.userId=${userIdWho}) as star`;\n//     _starJoin = '';\n//     _starWhere = '';\n//   }\n\n//   // locale\n//   if (locale) {\n//     _localeField = ',b.titleLocale';\n//     _localeJoin = ' inner join aFunctionLocale b on a.id=b.functionId';\n//     _localeWhere = ` and b.iid=${iid} and b.locale=${locale}`;\n//   } else {\n//     _localeField = '';\n//     _localeJoin = '';\n//     _localeWhere = '';\n//   }\n\n//   // sql\n//   const _sql =\n//         `select a.*,\n//                 e.atomClassName,e.atomClassIdParent\n//                 ${_localeField}\n//                 ${_starField}\n//            from aFunction a\n\n//              left join aAtomClass e on a.atomClassId=e.id\n//              left join aFunctionScene f on a.sceneId=f.id\n//              ${_localeJoin}\n//              ${_starJoin}\n\n//              ${_where}\n\n//               (\n//                 a.deleted=0 and a.iid=${iid}\n//                 ${_localeWhere}\n//                 ${_starWhere}\n//                 and (\n//                        a.public=1\n//                        or\n//                        exists(\n//                                select c.functionId from aViewUserRightFunction c where c.iid=${iid} and a.id=c.functionId and c.userIdWho=${userIdWho}\n//                              )\n//                     )\n//               )\n\n//             ${_orders}\n//             ${_limit}\n//        `;\n\n//   // ok\n//   return _sql;\n// }\n\n// function checkRightFunction({ iid, userIdWho, functionId }) {\n//   // for safe\n//   iid = parseInt(iid);\n//   userIdWho = parseInt(userIdWho);\n//   functionId = parseInt(functionId);\n//   // sql\n//   const _sql =\n//         `select a.* from aFunction a\n//             where a.deleted=0 and a.iid=${iid} and a.id=${functionId}\n//               and ( a.public=1 or\n//                     exists(select c.functionId from aViewUserRightFunction c where c.iid=${iid} and c.functionId=${functionId} and c.userIdWho=${userIdWho})\n//                   )\n//         `;\n//   return _sql;\n// }\n","module.exports = ctx => {\n  class Middleware {\n    async execute(options, next) {\n      // check\n      await ctx.bean.user.check(options);\n      // next\n      await next();\n    }\n  }\n  return Middleware;\n};\n","const require3 = require('require3');\nconst extend = require3('extend2');\nconst koaCors = require3('@koa/cors');\n\nconst optionsDefault = {\n  // origin: undefined,\n  allowMethods: 'GET,HEAD,PUT,POST,DELETE,PATCH',\n  // exposeHeaders: '',\n  // allowHeaders: '',\n  // maxAge: 0,\n  credentials: true,\n  // keepHeadersOnError:undefined,\n};\n\nmodule.exports = ctx => {\n  class Middleware {\n    async execute(options, next) {\n      // not cors (safari not send sec-fetch-mode)\n    // if (ctx.headers['sec-fetch-mode'] !== 'cors') return await next();\n      if (ctx.innerAccess) return await next();\n\n      let origin = ctx.get('origin');\n\n      if (!origin || origin === 'null') origin = 'null';\n\n      const host = ctx.host;\n      if (host && origin.indexOf(host) > -1) return await next();\n\n      // options\n      const optionsCors = extend(true, {}, optionsDefault, options);\n\n      // origin\n      // if security plugin enabled, and origin config is not provided, will only allow safe domains support CORS.\n      optionsCors.origin = optionsCors.origin || function corsOrigin(ctx) {\n      // origin is {protocol}{hostname}{port}...\n        if (ctx.app.meta.util.isSafeDomain(ctx, origin)) {\n          return origin;\n        }\n        return '';\n      };\n\n      // cors\n      const fn = koaCors(optionsCors);\n      await fn(ctx, next);\n    }\n  }\n  return Middleware;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Middleware {\n    async execute(options, next) {\n      await next();\n\n      // check if log\n      const _config = ctx.config.module(moduleInfo.relativeName);\n      if (!_config.httpLog) return;\n\n      //\n      const req = ctx.request;\n      const res = ctx.response;\n\n      // check if json\n      if (res.type.indexOf('application/json') === -1) return;\n\n      // log\n      let log = '\\n';\n      // query\n      if (req.query && Object.keys(req.query).length > 0) {\n        log = `${log}query:\n  ${JSON.stringify(req.query)}\n`;\n      }\n      // params\n      if (req.params && Object.keys(req.params).length > 0) {\n        log = `${log}params:\n  ${JSON.stringify(req.params)}\n`;\n      }\n      // body\n      if (req.body && Object.keys(req.body).length > 0) {\n        log = `${log}body:\n  ${JSON.stringify(req.body)}\n`;\n      }\n      // res\n      log = `${log}response:\n  ${JSON.stringify(res.body)}\n`;\n      // log\n      ctx.logger.info(log);\n    }\n  }\n  return Middleware;\n};\n","module.exports = ctx => {\n  class Middleware {\n    async execute(options, next) {\n      if (!ctx.innerAccess) ctx.throw(403);\n      // next\n      await next();\n    }\n  }\n  return Middleware;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Middleware {\n    async execute(options, next) {\n      // options\n      options = options || {};\n      // whiteList\n      if (ctx.app.meta.isTest) {\n        options.whiteList = false;\n      } else {\n        const _config = ctx.config.module(moduleInfo.relativeName);\n        const _whiteList = _config && _config.jsonp && _config.jsonp.whiteList;\n        const hostSelf = ctx.hostname;\n        if (_whiteList) {\n          if (!Array.isArray(_whiteList)) {\n            options.whiteList = _whiteList.split(',');\n          } else {\n            options.whiteList = _whiteList.concat();\n          }\n          options.whiteList.push(hostSelf);\n        } else {\n          options.whiteList = [ hostSelf ];\n        }\n      }\n      // jsonp\n      const fn = ctx.app.jsonp(options);\n      await fn(ctx, next);\n    }\n  }\n  return Middleware;\n};\n","// request.body\n//   key: atomId itemId\n//   atomClass: id,module,atomClassName,atomClassIdParent\n//   item:\n// options\n//   type: atom/function\n//   action(atom):\n//   name(function):\n//   module:\nmodule.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Middleware {\n    async execute(options, next) {\n      // ignore\n      if (!options.type) return await next();\n\n      const types = options.type.split(',');\n      if (types.length === 1) {\n        await checkRight(types[0], moduleInfo, options, ctx);\n      } else {\n        let error;\n        for (const type of types) {\n          try {\n            await checkRight(type, moduleInfo, options, ctx);\n            // ok\n            error = null;\n            break;\n          } catch (err) {\n            error = err;\n          }\n        }\n        if (error) throw error;\n      }\n\n      // next\n      await next();\n    }\n  }\n  return Middleware;\n};\n\nasync function checkRight(type, moduleInfo, options, ctx) {\n  // atom\n  if (type === 'atom') await checkAtom(moduleInfo, options, ctx);\n\n  // resource\n  if (type === 'resource') await checkResource(moduleInfo, options, ctx);\n}\n\nasync function checkAtom(moduleInfo, options, ctx) {\n  // constant\n  const constant = ctx.constant.module(moduleInfo.relativeName);\n\n  // create\n  if (options.action === constant.atom.action.create) {\n    // atomClassId\n    let atomClassId = ctx.request.body.atomClass.id;\n    if (!atomClassId) {\n      const res = await ctx.bean.atomClass.get({\n        module: ctx.request.body.atomClass.module,\n        atomClassName: ctx.request.body.atomClass.atomClassName,\n        atomClassIdParent: ctx.request.body.atomClass.atomClassIdParent || 0,\n      });\n      atomClassId = res.id;\n    }\n    // roleIdOwner\n    const roleIdOwner = ctx.request.body.roleIdOwner;\n    if (roleIdOwner) {\n      // check\n      const res = await ctx.bean.atom.checkRightCreateRole({\n        atomClass: {\n          id: atomClassId,\n        },\n        roleIdOwner,\n        user: ctx.state.user.op,\n      });\n      if (!res) ctx.throw(403);\n      ctx.meta._atomClass = res;\n    } else {\n      // retrieve default one\n      const roles = await ctx.bean.atom.preferredRoles({\n        atomClass: {\n          id: atomClassId,\n        },\n        user: ctx.state.user.op,\n      });\n      if (roles.length === 0) ctx.throw(403);\n      ctx.request.body.roleIdOwner = roles[0].roleIdWho;\n      ctx.meta._atomClass = { id: atomClassId };\n    }\n    return;\n  }\n\n  // read\n  if (options.action === constant.atom.action.read) {\n    const res = await ctx.bean.atom.checkRightRead({\n      atom: { id: ctx.request.body.key.atomId },\n      user: ctx.state.user.op,\n      checkFlow: options.checkFlow,\n    });\n    if (!res) ctx.throw(403);\n    ctx.request.body.key.itemId = res.itemId;\n    ctx.meta._atom = res;\n    return;\n  }\n\n  // other action (including write/delete)\n  if (!ctx.request.body.key && !ctx.request.body.atomClass) ctx.throw.module(moduleInfo.relativeName, 1011);\n  const actionOther = options.action;\n  const bulk = !ctx.request.body.key;\n  if (bulk) {\n    const res = await ctx.bean.atom.checkRightActionBulk({\n      atomClass: ctx.request.body.atomClass,\n      action: actionOther,\n      user: ctx.state.user.op,\n    });\n    if (!res) ctx.throw(403);\n    ctx.meta._atomAction = res;\n  } else {\n    const res = await ctx.bean.atom.checkRightAction({\n      atom: { id: ctx.request.body.key.atomId },\n      action: actionOther, stage: options.stage,\n      user: ctx.state.user.op,\n      checkFlow: options.checkFlow,\n    });\n    if (!res) ctx.throw(403);\n    ctx.request.body.key.itemId = res.itemId;\n    ctx.meta._atom = res;\n  }\n\n}\n\nasync function checkResource(moduleInfo, options, ctx) {\n  if (ctx.innerAccess) return;\n  let resourceAtomId;\n  let atomStaticKey;\n  if (options.useKey) {\n    resourceAtomId = ctx.request.body.key.atomId;\n  } else {\n    atomStaticKey = options.atomStaticKey;\n    if (!atomStaticKey && options.name) {\n      atomStaticKey = `${options.module || ctx.module.info.relativeName}:${options.name}`;\n    }\n  }\n  if (!resourceAtomId && !atomStaticKey) ctx.throw(403);\n  const res = await ctx.bean.resource.checkRightResource({\n    resourceAtomId,\n    atomStaticKey,\n    user: ctx.state.user.op,\n  });\n  if (!res) ctx.throw(403);\n  ctx.meta._resource = res;\n}\n","module.exports = ctx => {\n  class Middleware {\n    async execute(options, next) {\n      if (!ctx.app.meta.isTest) ctx.throw(403);\n      // next\n      await next();\n    }\n  }\n  return Middleware;\n};\n","module.exports = ctx => {\n  class Middleware {\n    async execute(options, next) {\n      await ctx.transaction.begin(async () => {\n        // next\n        await next();\n        checkIfSuccess(ctx);\n      });\n    }\n  }\n  return Middleware;\n};\n\nfunction checkIfSuccess(ctx) {\n  if (typeof ctx.response.body === 'object' && ctx.response.body && ctx.response.body.code !== undefined) {\n    if (ctx.response.body.code !== 0) {\n      throw ctx.app.meta.util.createError(ctx.response.body);\n    }\n  } else {\n    if (ctx.response.status !== 200) {\n      ctx.throw(ctx.response.status);\n    }\n  }\n}\n","module.exports = app => {\n  class Queue extends app.meta.BeanBase {\n\n    async execute(context) {\n      const { options } = context.data;\n      await this.ctx.bean.role._buildQueue(options);\n    }\n\n  }\n\n  return Queue;\n};\n","module.exports = app => {\n  class Queue extends app.meta.BeanBase {\n\n    async execute(context) {\n      await app.meta._runSchedule(context);\n    }\n\n  }\n\n  return Queue;\n};\n","module.exports = app => {\n  class Startup extends app.meta.BeanBase {\n\n    async execute() {\n      await this.ctx.bean.resource.checkLocales();\n    }\n\n  }\n\n  return Startup;\n};\n","module.exports = app => {\n  class Startup extends app.meta.BeanBase {\n\n    async execute(context) {\n      const options = context.options;\n      // reset auth providers\n      if (options.force) {\n        await this.ctx.bean.base.authProvidersReset();\n      }\n      // register all authProviders\n      await this.ctx.bean.auth._installAuthProviders();\n    }\n\n  }\n\n  return Startup;\n};\n","\nmodule.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Startup extends app.meta.BeanBase {\n\n    async execute() {\n      await this._loadAtomStatics();\n    }\n\n    async _loadAtomStatics() {\n      for (const module of this.ctx.app.meta.modulesArray) {\n        const moduleName = module.info.relativeName;\n        const statics = module.main.meta && module.main.meta.base && module.main.meta.base.statics;\n        if (!statics) continue;\n        for (const atomClassKey in statics) {\n          const [ atomClassModule, atomClassName ] = atomClassKey.split('.');\n          const atomClass = { module: atomClassModule, atomClassName };\n          const items = statics[atomClassKey].items;\n          if (!items) continue;\n          for (const item of items) {\n            await this._loadAtomStatic({ moduleName, atomClass, item });\n          }\n        }\n      }\n    }\n\n    async _loadAtomStatic({ moduleName, atomClass, item }) {\n      // key not empty\n      if (!item.atomStaticKey) throw new Error('atomStaticKey cannot be empty');\n      const atomStaticKey = `${moduleName}:${item.atomStaticKey}`;\n      const atomRevision = item.atomRevision || 0;\n      // get by key\n      const atom = await this.ctx.bean.atom.readByStaticKey({\n        atomClass,\n        atomStaticKey,\n        atomStage: 'archive',\n      });\n      if (atom) {\n        if (atomRevision === -1) {\n          // delete\n          await this.ctx.bean.atom.delete({ key: { atomId: atom.atomId } });\n        } else {\n          // check revision: not use !==\n          if (atomRevision > atom.atomRevision) {\n            item = await this._adjustItem({ moduleName, atomClass, item, register: false });\n            await this._updateRevision({ atomClass, atomIdFormal: atom.atomId, atomIdDraft: atom.atomIdDraft, item });\n          }\n        }\n      } else {\n        if (atomRevision !== -1) {\n          // register\n          item = await this._adjustItem({ moduleName, atomClass, item, register: true });\n          const atomId = await this._register({ atomClass, item });\n          await this._addResourceRoles({ atomId, roles: item.resourceRoles });\n        }\n      }\n    }\n\n    async _addResourceRoles({ atomId, roles }) {\n      if (!roles || !roles.length) return;\n      for (const role of roles) {\n        if (!role) continue;\n        await this.ctx.bean.resource.addResourceRole({\n          atomId, roleId: role.id,\n        });\n      }\n    }\n\n    async _adjustItem({ moduleName, atomClass, item, register }) {\n      // item\n      item = {\n        ...item,\n        atomStatic: 1,\n        atomStaticKey: `${moduleName}:${item.atomStaticKey}`,\n        atomRevision: item.atomRevision || 0,\n        // ctx.text is not good for resource\n        // atomName: this.ctx.text(item.atomName),\n        // description: this.ctx.text(item.description),\n      };\n      // atomLanguage,atomCategoryId,atomTags\n      if (typeof item.atomCategoryId === 'string') {\n        const category = await this.ctx.bean.category.parseCategoryName({\n          atomClass,\n          language: item.atomLanguage,\n          categoryName: item.atomCategoryId,\n          force: true,\n        });\n        item.atomCategoryId = category.id;\n      }\n      if (typeof item.atomTags === 'string') {\n        const tagIds = await this.ctx.bean.tag.parseTags({\n          atomClass,\n          language: item.atomLanguage,\n          tagName: item.atomTags,\n          force: true,\n        });\n        item.atomTags = JSON.stringify(tagIds);\n      }\n      // only valid for register\n      if (register) {\n        // roleIdOwner\n        const roleName = item.roleIdOwner || 'superuser';\n        const role = await this.ctx.bean.role.parseRoleName({ roleName });\n        item.roleIdOwner = role.id;\n        // resourceRoles\n        if (item.resourceRoles) {\n          item.resourceRoles = await this.ctx.bean.role.parseRoleNames({ roleNames: item.resourceRoles });\n        }\n      }\n      // ok\n      return item;\n    }\n\n    async _updateRevision({ atomClass, atomIdFormal, atomIdDraft, item }) {\n      return await this.ctx.app.meta.util.lock({\n        subdomain: this.ctx.subdomain,\n        resource: `${moduleInfo.relativeName}.atomStatic.register.${item.atomStaticKey}`,\n        fn: async () => {\n          return await this.ctx.app.meta.util.executeBean({\n            subdomain: this.ctx.subdomain,\n            beanModule: moduleInfo.relativeName,\n            beanFullName: `${moduleInfo.relativeName}.startup.loadAtomStatics`,\n            context: { atomClass, atomIdFormal, atomIdDraft, item },\n            fn: '_updateRevisionLock',\n          });\n        },\n      });\n    }\n\n    async _updateRevisionLock({ atomIdDraft, item }) {\n      // get draft\n      const atom = await this.ctx.bean.atom.modelAtom.get({ id: atomIdDraft });\n      if (item.atomRevision === atom.atomRevision) return;\n      const atomKey = {\n        atomId: atomIdDraft, itemId: atom.itemId,\n      };\n      // update\n      await this.ctx.bean.atom.modelAtom.update({\n        id: atomIdDraft,\n        atomName: item.atomName,\n        atomRevision: item.atomRevision,\n      });\n      // write\n      await this.ctx.bean.atom.write({\n        key: atomKey, item, user: { id: 0 },\n      });\n      // submit\n      await this.ctx.bean.atom.submit({\n        key: atomKey,\n        options: { ignoreFlow: true },\n        user: { id: 0 },\n      });\n    }\n\n    async _register({ atomClass, item }) {\n      return await this.ctx.app.meta.util.lock({\n        subdomain: this.ctx.subdomain,\n        resource: `${moduleInfo.relativeName}.atomStatic.register.${item.atomStaticKey}`,\n        fn: async () => {\n          return await this.ctx.app.meta.util.executeBean({\n            subdomain: this.ctx.subdomain,\n            beanModule: moduleInfo.relativeName,\n            beanFullName: `${moduleInfo.relativeName}.startup.loadAtomStatics`,\n            context: { atomClass, item },\n            fn: '_registerLock',\n          });\n        },\n      });\n    }\n\n    async _registerLock({ atomClass, item }) {\n      // get again\n      const atom = await this.ctx.bean.atom.readByStaticKey({\n        atomClass,\n        atomStaticKey: item.atomStaticKey,\n        atomStage: 'archive',\n      });\n      if (atom) return atom.atomId;\n      // add atom\n      const atomKey = await this.ctx.bean.atom.create({\n        atomClass,\n        roleIdOwner: item.roleIdOwner,\n        item,\n        user: { id: 0 },\n      });\n      // write\n      await this.ctx.bean.atom.write({\n        key: atomKey, item, user: { id: 0 },\n      });\n      // submit\n      const res = await this.ctx.bean.atom.submit({\n        key: atomKey,\n        options: { ignoreFlow: true },\n        user: { id: 0 },\n      });\n      return res.formal.key.atomId;\n    }\n\n  }\n\n  return Startup;\n};\n","module.exports = app => {\n  class Startup extends app.meta.BeanBase {\n\n    async execute() {\n      await app.meta._loadSchedules({ subdomain: this.ctx.subdomain });\n    }\n\n  }\n\n  return Startup;\n};\n","module.exports = app => {\n  class Startup extends app.meta.BeanBase {\n\n    async execute() {\n      // verify\n      app.passport.verify(async (ctx, profileUser) => {\n        // state: login/associate\n        const state = ctx.request.query.state || 'login';\n        // user verify\n        return await ctx.bean.user.verify({ state, profileUser });\n      });\n      // serializeUser\n      app.passport.serializeUser(async (ctx, user) => {\n        ctx.state.user = user;\n        const _user = {\n          op: { id: user.op.id, iid: user.op.iid, anonymous: user.op.anonymous },\n          provider: user.provider,\n        };\n        if (user.agent.id !== user.op.id) {\n          _user.agent = { id: user.agent.id, iid: user.agent.iid, anonymous: user.agent.anonymous };\n        }\n        return _user;\n      });\n      // deserializeUser\n      app.passport.deserializeUser(async (ctx, user) => {\n        return user;\n      });\n    }\n  }\n\n  return Startup;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Stats {\n\n    async execute(context) {\n      const { user } = context;\n      const modelAtom = ctx.model.module(moduleInfo.relativeName).atom;\n      const count = await modelAtom.count({\n        userIdUpdated: user.id,\n        atomStage: 0,\n        atomClosed: 0,\n        atomFlowId: 0,\n      });\n      return count;\n    }\n\n  }\n\n  return Stats;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Stats {\n\n    async execute(context) {\n      const { user } = context;\n      const modelStar = ctx.model.module(moduleInfo.relativeName).atomStar;\n      const count = await modelStar.count({\n        userId: user.id,\n        star: 1,\n      });\n      return count;\n    }\n\n  }\n\n  return Stats;\n};\n","const VersionUpdate1Fn = require('./version/update1.js');\nconst VersionUpdate2Fn = require('./version/update2.js');\nconst VersionUpdate3Fn = require('./version/update3.js');\nconst VersionUpdate4Fn = require('./version/update4.js');\nconst VersionUpdate6Fn = require('./version/update6.js');\nconst VersionUpdate8Fn = require('./version/update8.js');\nconst VersionUpdate9Fn = require('./version/update9.js');\nconst VersionUpdate10Fn = require('./version/update10.js');\nconst VersionInit2Fn = require('./version/init2.js');\nconst VersionInit4Fn = require('./version/init4.js');\nconst VersionInit5Fn = require('./version/init5.js');\nconst VersionInit7Fn = require('./version/init7.js');\nconst VersionInit8Fn = require('./version/init8.js');\nconst VersionInit9Fn = require('./version/init9.js');\n\nmodule.exports = app => {\n\n  class Version extends app.meta.BeanBase {\n\n    async update(options) {\n\n      if (options.version === 10) {\n        const versionUpdate10 = new (VersionUpdate10Fn(this.ctx))();\n        await versionUpdate10.run();\n      }\n\n      if (options.version === 9) {\n        const versionUpdate9 = new (VersionUpdate9Fn(this.ctx))();\n        await versionUpdate9.run();\n      }\n\n      if (options.version === 8) {\n        const versionUpdate8 = new (VersionUpdate8Fn(this.ctx))();\n        await versionUpdate8.run();\n      }\n\n      if (options.version === 6) {\n        const versionUpdate6 = new (VersionUpdate6Fn(this.ctx))();\n        await versionUpdate6.run();\n      }\n\n      if (options.version === 4) {\n        const versionUpdate4 = new (VersionUpdate4Fn(this.ctx))();\n        await versionUpdate4.run();\n      }\n\n      if (options.version === 3) {\n        const versionUpdate3 = new (VersionUpdate3Fn(this.ctx))();\n        await versionUpdate3.run();\n      }\n\n      if (options.version === 2) {\n        const versionUpdate2 = new (VersionUpdate2Fn(this.ctx))();\n        await versionUpdate2.run();\n      }\n\n      if (options.version === 1) {\n        const versionUpdate1 = new (VersionUpdate1Fn(this.ctx))();\n        await versionUpdate1.run();\n      }\n    }\n\n    async init(options) {\n\n      if (options.version === 2) {\n        const versionInit2 = new (VersionInit2Fn(this.ctx))();\n        await versionInit2.run(options);\n      }\n      if (options.version === 4) {\n        const versionInit4 = new (VersionInit4Fn(this.ctx))();\n        await versionInit4.run(options);\n      }\n      if (options.version === 5) {\n        const versionInit5 = new (VersionInit5Fn(this.ctx))();\n        await versionInit5.run(options);\n      }\n      if (options.version === 7) {\n        const versionInit7 = new (VersionInit7Fn(this.ctx))();\n        await versionInit7.run(options);\n      }\n      if (options.version === 8) {\n        const versionInit8 = new (VersionInit8Fn(this.ctx))();\n        await versionInit8.run(options);\n      }\n      if (options.version === 9) {\n        const versionInit9 = new (VersionInit9Fn(this.ctx))();\n        await versionInit9.run(options);\n      }\n    }\n\n    async update8Atoms(options) {\n      const versionUpdate8 = new (VersionUpdate8Fn(this.ctx))();\n      await versionUpdate8._updateAtomsInstance(options);\n    }\n\n  }\n\n  return Version;\n};\n","const require3 = require('require3');\nconst extend = require3('extend2');\nconst initData = require('./initData2.js');\n\nmodule.exports = function(ctx) {\n\n  class VersionInit {\n\n    async run(options) {\n      // roles\n      const roleIds = await this._initRoles();\n      // role includes\n      await this._roleIncludes(roleIds);\n      // build\n      await ctx.bean.role.setDirty(true);\n      // users\n      await this._initUsers(roleIds, options);\n    }\n\n    // roles\n    async _initRoles() {\n      const roleIds = {};\n      roleIds.system = 0;\n      // system roles\n      for (const roleName of ctx.constant.systemRoles) {\n        const role = extend(true, {}, initData.roles[roleName]);\n        role.roleIdParent = roleIds[role.roleIdParent];\n        roleIds[roleName] = await ctx.bean.role.add(role);\n      }\n      return roleIds;\n    }\n\n    // role includes\n    async _roleIncludes(roleIds) {\n      for (const item of initData.includes) {\n        await ctx.bean.role.addRoleInc({ roleId: roleIds[item.from], roleIdInc: roleIds[item.to] });\n      }\n    }\n\n    // users\n    async _initUsers(roleIds, options) {\n      // root user\n      const userRoot = extend(true, {}, initData.users.root);\n      userRoot.item.email = options.email;\n      userRoot.item.mobile = options.mobile;\n      const userId = await ctx.bean.user.add(userRoot.item);\n      // activated\n      await ctx.bean.user.save({\n        user: { id: userId, activated: 1 },\n      });\n      // user->role\n      await ctx.bean.role.addUserRole({\n        userId,\n        roleId: roleIds[userRoot.roleId],\n      });\n    }\n\n  }\n\n  return VersionInit;\n};\n","module.exports = function(ctx) {\n\n  class VersionInit {\n\n    async run(options) {\n    }\n\n  }\n\n  return VersionInit;\n};\n","module.exports = function(ctx) {\n\n  class VersionInit {\n\n    async run(options) {\n      // add role:template to authenticated\n      // add role:system to template\n      const items = [\n        {\n          roleName: 'template', leader: 0, catalog: 1, system: 1, sorting: 0, roleIdParent: 'authenticated',\n        },\n        {\n          roleName: 'system', leader: 0, catalog: 0, system: 1, sorting: 1, roleIdParent: 'template',\n        },\n      ];\n      let needBuild = false;\n      for (const item of items) {\n        const role = await ctx.bean.role.getSystemRole({ roleName: item.roleName });\n        if (!role) {\n          needBuild = true;\n          const roleParent = await ctx.bean.role.getSystemRole({ roleName: item.roleIdParent });\n          const roleId = await ctx.bean.role.add({\n            roleName: item.roleName,\n            leader: item.leader,\n            catalog: item.catalog,\n            system: item.system,\n            sorting: item.sorting,\n            roleIdParent: roleParent.id,\n          });\n          if (item.roleName === 'system') {\n            // superuser include system\n            const roleSuperuser = await ctx.bean.role.getSystemRole({ roleName: 'superuser' });\n            await ctx.bean.role.addRoleInc({ roleId: roleSuperuser.id, roleIdInc: roleId });\n          }\n        }\n      }\n      // build\n      if (needBuild) {\n        await ctx.bean.role.setDirty(true);\n      }\n\n    }\n\n  }\n\n  return VersionInit;\n};\n","module.exports = function(ctx) {\n\n  class VersionInit {\n\n    async run(options) {\n    }\n\n  }\n\n  return VersionInit;\n};\n","module.exports = function(ctx) {\n\n  class VersionInit {\n\n    async run() {\n    }\n\n  }\n\n  return VersionInit;\n};\n","module.exports = function(ctx) {\n\n  class VersionInit {\n\n    async run() {\n      // add role rights\n      const roleRights = [\n        { roleName: 'system', action: 'create' },\n        { roleName: 'system', action: 'read', scopeNames: 0 },\n        { roleName: 'system', action: 'read', scopeNames: 'superuser' },\n        { roleName: 'system', action: 'write', scopeNames: 0 },\n        { roleName: 'system', action: 'write', scopeNames: 'superuser' },\n        { roleName: 'system', action: 'delete', scopeNames: 0 },\n        { roleName: 'system', action: 'delete', scopeNames: 'superuser' },\n        { roleName: 'system', action: 'clone', scopeNames: 0 },\n        { roleName: 'system', action: 'clone', scopeNames: 'superuser' },\n        { roleName: 'system', action: 'enable', scopeNames: 0 },\n        { roleName: 'system', action: 'enable', scopeNames: 'superuser' },\n        { roleName: 'system', action: 'disable', scopeNames: 0 },\n        { roleName: 'system', action: 'disable', scopeNames: 'superuser' },\n        { roleName: 'system', action: 'authorize', scopeNames: 0 },\n        { roleName: 'system', action: 'authorize', scopeNames: 'superuser' },\n        { roleName: 'system', action: 'deleteBulk' },\n        { roleName: 'system', action: 'exportBulk' },\n      ];\n      await ctx.bean.role.addRoleRightBatch({ atomClassName: 'resource', roleRights });\n\n    }\n\n  }\n\n  return VersionInit;\n};\n","// roles\nconst roles = {\n  root: {\n    roleName: 'root', leader: 0, system: 1, sorting: 0, roleIdParent: 'system',\n  },\n  anonymous: {\n    roleName: 'anonymous', leader: 0, system: 1, sorting: 1, roleIdParent: 'root',\n  },\n  authenticated: {\n    roleName: 'authenticated', leader: 0, system: 1, sorting: 2, roleIdParent: 'root',\n  },\n  template: {\n    roleName: 'template', leader: 0, system: 1, sorting: 1, roleIdParent: 'authenticated',\n  },\n  system: {\n    roleName: 'system', leader: 0, system: 1, sorting: 1, roleIdParent: 'template',\n  },\n  registered: {\n    roleName: 'registered', leader: 0, system: 1, sorting: 2, roleIdParent: 'authenticated',\n  },\n  activated: {\n    roleName: 'activated', leader: 0, system: 1, sorting: 3, roleIdParent: 'authenticated',\n  },\n  superuser: {\n    roleName: 'superuser', leader: 0, system: 1, sorting: 4, roleIdParent: 'authenticated',\n  },\n  organization: {\n    roleName: 'organization', leader: 0, system: 1, sorting: 5, roleIdParent: 'authenticated',\n  },\n  internal: {\n    roleName: 'internal', leader: 0, system: 1, sorting: 1, roleIdParent: 'organization',\n  },\n  external: {\n    roleName: 'external', leader: 0, system: 1, sorting: 2, roleIdParent: 'organization',\n  },\n};\n\nconst includes = [\n  { from: 'superuser', to: 'system' },\n];\n\nconst users = {\n  root: {\n    item: {\n      userName: 'root',\n      realName: 'root',\n      email: null,\n      mobile: null,\n      avatar: null,\n      motto: null,\n      locale: null,\n    },\n    roleId: 'superuser',\n  },\n};\n\nmodule.exports = {\n  roles,\n  includes,\n  users,\n};\n","const update1Data = require('./update1Data.js');\n\nmodule.exports = function(ctx) {\n\n  class VersionUpdate1 {\n\n    async run() {\n      // tables\n      const tableNames = [\n        'aUser', 'aUserAgent', 'aAuthProvider', 'aAuth', 'aRole', 'aRoleInc', 'aUserRole', 'aRoleRight',\n        'aAtomClass', 'aAtom', 'aAtomAction',\n        'aLabel', 'aAtomLabel', 'aAtomLabelRef', 'aAtomStar',\n        'aRoleRef', 'aRoleIncRef', 'aRoleExpand', 'aRoleRightRef',\n        'aFunction', 'aFunctionStar', 'aFunctionLocale', 'aRoleFunction',\n      ];\n\n      for (const tableName of tableNames) {\n        await ctx.model.query(update1Data.tables[tableName]);\n      }\n\n      // views\n      const viewNames = [\n        'aViewUserRoleRef',\n        'aViewUserRoleExpand',\n        'aViewUserRightAtomClass',\n        'aViewUserRightAtomClassUser',\n        'aViewUserRightAtom',\n        'aViewUserRightFunction',\n      ];\n      for (const viewName of viewNames) {\n        await ctx.model.query(update1Data.views[viewName]);\n      }\n\n      // functions\n      const functionNames = [\n      ];\n      for (const functionName of functionNames) {\n        await ctx.model.query(update1Data.functions[functionName]);\n      }\n\n    }\n\n  }\n\n  return VersionUpdate1;\n};\n","module.exports = function(ctx) {\n  class VersionUpdate10 {\n\n    async run() {\n\n      // aAtom: atomIdArchive -> atomIdFormal\n      const sql = `\n        ALTER TABLE aAtom\n          CHANGE COLUMN atomIdArchive atomIdFormal int(11) DEFAULT '0'\n                  `;\n      await ctx.model.query(sql);\n\n    }\n\n  }\n\n  return VersionUpdate10;\n};\n","const tables = {\n  aUser: `\n          CREATE TABLE aUser (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            disabled int(11) DEFAULT '0',\n            userName varchar(50) DEFAULT NULL,\n            realName varchar(50) DEFAULT NULL,\n            email varchar(50) DEFAULT NULL,\n            mobile varchar(50) DEFAULT NULL,\n            avatar varchar(255) DEFAULT NULL,\n            motto varchar(255) DEFAULT NULL,\n            locale varchar(255) DEFAULT NULL,\n            anonymous int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aUserAgent: `\n          CREATE TABLE aUserAgent (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            userIdAgent int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aAuthProvider: `\n          CREATE TABLE aAuthProvider (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            disabled int(11) DEFAULT '0',\n            module varchar(255) DEFAULT NULL,\n            providerName varchar(50) DEFAULT NULL,\n            config json DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `,\n  aAuth: `\n          CREATE TABLE aAuth (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            providerId int(11) DEFAULT '0',\n            profileId varchar(255) DEFAULT NULL,\n            profile json DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `,\n  aRole: `\n          CREATE TABLE aRole (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            roleName varchar(50) DEFAULT NULL,\n            leader int(11) DEFAULT '0',\n            catalog int(11) DEFAULT '0',\n            \\`system\\` int(11) DEFAULT '0',\n            sorting int(11) DEFAULT '0',\n            roleIdParent int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aRoleRef: `\n          CREATE TABLE aRoleRef (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            roleId int(11) DEFAULT '0',\n            roleIdParent int(11) DEFAULT '0',\n            level int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aRoleInc: `\n          CREATE TABLE aRoleInc (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            roleId int(11) DEFAULT '0',\n            roleIdInc int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aRoleIncRef: `\n          CREATE TABLE aRoleIncRef (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            roleId int(11) DEFAULT '0',\n            roleIdInc int(11) DEFAULT '0',\n            roleIdSrc int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aRoleExpand: `\n          CREATE TABLE aRoleExpand (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            roleId int(11) DEFAULT '0',\n            roleIdBase int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aUserRole: `\n          CREATE TABLE aUserRole (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            roleId int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aAtomClass: `\n          CREATE TABLE aAtomClass (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            module varchar(255) DEFAULT NULL,\n            atomClassName varchar(255) DEFAULT NULL,\n            atomClassIdParent int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aAtom: `\n          CREATE TABLE aAtom (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            itemId int(11) DEFAULT '0',\n            atomEnabled int(11) DEFAULT '0',\n            atomFlow int(11) DEFAULT '0',\n            atomClassId int(11) DEFAULT '0',\n            atomName varchar(255) DEFAULT NULL,\n            userIdCreated int(11) DEFAULT '0',\n            userIdUpdated int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aAtomAction: `\n          CREATE TABLE aAtomAction (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomClassId int(11) DEFAULT '0',\n            code int(11) DEFAULT '0',\n            name varchar(50) DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `,\n  aLabel: `\n          CREATE TABLE aLabel (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            labels JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `,\n  aAtomLabel: `\n          CREATE TABLE aAtomLabel (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            labels JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `,\n  aAtomLabelRef: `\n          CREATE TABLE aAtomLabelRef (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            labelId int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aAtomStar: `\n          CREATE TABLE aAtomStar (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            star int(11) DEFAULT '1',\n            PRIMARY KEY (id)\n          )\n        `,\n  aRoleRight: `\n          CREATE TABLE aRoleRight (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            roleId int(11) DEFAULT '0',\n            atomClassId int(11) DEFAULT '0',\n            action int(11) DEFAULT '0',\n            scope JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `,\n  aRoleRightRef: `\n          CREATE TABLE aRoleRightRef (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            roleRightId int(11) DEFAULT '0',\n            roleId int(11) DEFAULT '0',\n            atomClassId int(11) DEFAULT '0',\n            action int(11) DEFAULT '0',\n            roleIdScope int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aFunction: `\n          CREATE TABLE aFunction (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            module varchar(255) DEFAULT NULL,\n            name varchar(255) DEFAULT NULL,\n            title varchar(255) DEFAULT NULL,\n            scene int(11) DEFAULT '0',\n            autoRight int(11) DEFAULT '0',\n            atomClassId int(11) DEFAULT '0',\n            action int(11) DEFAULT '0',\n            sorting int(11) DEFAULT '0',\n            menu int(11) DEFAULT '0',\n            public int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n  aFunctionStar: `\n          CREATE TABLE aFunctionStar (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            functionId int(11) DEFAULT '0',\n            star int(11) DEFAULT '1',\n            PRIMARY KEY (id)\n          )\n        `,\n  aFunctionLocale: `\n          CREATE TABLE aFunctionLocale (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            functionId int(11) DEFAULT '0',\n            locale varchar(50) DEFAULT NULL,\n            titleLocale varchar(255) DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `,\n  aRoleFunction: `\n          CREATE TABLE aRoleFunction (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            roleId int(11) DEFAULT '0',\n            functionId int(11) DEFAULT '0',\n            roleRightId int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `,\n};\n\nconst views = {\n  aViewUserRoleRef: `\ncreate view aViewUserRoleRef as\n  select a.iid,a.userId,a.roleId,b.roleIdParent,b.level from aUserRole a\n    inner join aRoleRef b on a.roleId=b.roleId\n  `,\n  aViewUserRoleExpand: `\ncreate view aViewUserRoleExpand as\n  select a.iid,a.userId,a.roleId,b.roleIdBase,b.id as roleExpandId from aUserRole a\n    left join aRoleExpand b on a.roleId=b.roleId\n  `,\n  aViewUserRightAtomClass: `\ncreate view aViewUserRightAtomClass as\n  select a.iid,a.userId as userIdWho,a.roleExpandId,a.roleId,a.roleIdBase,b.id as roleRightId,b.atomClassId,b.action,b.scope from aViewUserRoleExpand a\n    inner join aRoleRight b on a.roleIdBase=b.roleId\n  `,\n  aViewUserRightAtomClassUser: `\ncreate view aViewUserRightAtomClassUser as\n  select a.iid,a.userId as userIdWho,b.atomClassId,b.action,c.userId as userIdWhom from aViewUserRoleExpand a\n    inner join aRoleRightRef b on a.roleIdBase=b.roleId\n    inner join aViewUserRoleRef c on b.roleIdScope=c.roleIdParent\n  `,\n  aViewUserRightAtom: `\ncreate view aViewUserRightAtom as\n  select a.iid, a.id as atomId,a.userIdCreated as userIdWhom,b.userIdWho,b.action from aAtom a,aViewUserRightAtomClassUser b\n    where a.deleted=0 and a.atomEnabled=1\n      and a.atomClassId=b.atomClassId\n      and a.userIdCreated=b.userIdWhom\n  `,\n  aViewUserRightFunction: `\ncreate view aViewUserRightFunction as\n  select a.iid,a.userId as userIdWho,a.roleExpandId,a.roleId,a.roleIdBase,b.id as roleFunctionId,b.functionId from aViewUserRoleExpand a\n    inner join aRoleFunction b on a.roleIdBase=b.roleId\n  `,\n};\n\nconst functions = {\n};\n\nmodule.exports = {\n  tables,\n  views,\n  functions,\n};\n","module.exports = function(ctx) {\n\n  class VersionUpdate2 {\n\n    async run() {\n      // enable 0\n      await ctx.model.query('SET SESSION sql_mode=\\'NO_AUTO_VALUE_ON_ZERO\\'');\n      // add userId 0\n      await ctx.db.insert('aUser', {\n        id: 0,\n        iid: 0,\n        userName: 'system',\n        realName: 'system',\n      });\n      // add roleId 0\n      await ctx.db.insert('aRole', {\n        id: 0,\n        iid: 0,\n        roleName: 'system',\n        catalog: 1,\n        system: 1,\n        roleIdParent: -1,\n      });\n      // disable 0\n      await ctx.model.query('SET SESSION sql_mode=\\'\\'');\n    }\n\n  }\n\n  return VersionUpdate2;\n};\n","module.exports = function(ctx) {\n\n  class VersionUpdate3 {\n\n    async run() {\n      // aViewRoleRightAtomClassUser\n      let sql = `\n        create view aViewRoleRightAtomClassUser as\n          select a.iid,a.roleId as roleIdWho,b.atomClassId,b.action,c.userId as userIdWhom from aRoleExpand a\n            inner join aRoleRightRef b on a.roleIdBase=b.roleId\n            inner join aViewUserRoleRef c on b.roleIdScope=c.roleIdParent\n          `;\n      await ctx.model.query(sql);\n\n      // aViewRoleRightAtom\n      sql = `\n        create view aViewRoleRightAtom as\n          select a.iid, a.id as atomId,a.userIdCreated as userIdWhom,b.roleIdWho,b.action from aAtom a,aViewRoleRightAtomClassUser b\n            where a.deleted=0 and a.atomEnabled=1\n              and a.atomClassId=b.atomClassId\n              and a.userIdCreated=b.userIdWhom\n          `;\n      await ctx.model.query(sql);\n    }\n\n  }\n\n  return VersionUpdate3;\n};\n","module.exports = function(ctx) {\n\n  class VersionUpdate4 {\n\n    async run() {\n\n      // aComment\n      let sql = `\n          CREATE TABLE aComment (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            sorting int(11) DEFAULT '0',\n            heartCount int(11) DEFAULT '0',\n            replyId int(11) DEFAULT '0',\n            replyUserId int(11) DEFAULT '0',\n            replyContent text DEFAULT NULL,\n            content text DEFAULT NULL,\n            summary text DEFAULT NULL,\n            html text DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n      await ctx.model.query(sql);\n\n      // aViewComment\n      sql = `\n          create view aViewComment as\n            select a.*,b.userName,b.avatar,c.userName as replyUserName from aComment a\n              left join aUser b on a.userId=b.id\n              left join aUser c on a.replyUserId=c.id\n        `;\n      await ctx.model.query(sql);\n\n      // aCommentHeart\n      sql = `\n          CREATE TABLE aCommentHeart (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            commentId int(11) DEFAULT '0',\n            heart int(11) DEFAULT '1',\n            PRIMARY KEY (id)\n          )\n        `;\n      await ctx.model.query(sql);\n\n      // aAtom\n      sql = `\n        ALTER TABLE aAtom\n          MODIFY COLUMN updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n          ADD COLUMN allowComment int(11) DEFAULT '1',\n          ADD COLUMN starCount int(11) DEFAULT '0',\n          ADD COLUMN commentCount int(11) DEFAULT '0',\n          ADD COLUMN attachmentCount int(11) DEFAULT '0',\n          ADD COLUMN readCount int(11) DEFAULT '0'\n                  `;\n      await ctx.model.query(sql);\n\n    }\n\n  }\n\n  return VersionUpdate4;\n};\n","module.exports = function(ctx) {\n\n  class VersionUpdate6 {\n\n    async run() {\n\n      // aUser\n      const sql = `\n        ALTER TABLE aUser\n          ADD COLUMN activated int(11) DEFAULT '0',\n          ADD COLUMN emailConfirmed int(11) DEFAULT '0',\n          ADD COLUMN mobileVerified int(11) DEFAULT '0'\n                  `;\n      await ctx.model.query(sql);\n\n    }\n\n  }\n\n  return VersionUpdate6;\n};\n","module.exports = function(ctx) {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class VersionUpdate8 {\n\n    async run(options) {\n\n      let sql;\n\n      // aFunctionScene\n      sql = `\n          CREATE TABLE aFunctionScene (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            sceneName varchar(50) DEFAULT NULL,\n            sceneMenu int(11) DEFAULT '0',\n            sceneSorting int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `;\n      await ctx.model.query(sql);\n\n      // aFunction: scene -> sceneId\n      sql = `\n        ALTER TABLE aFunction\n          CHANGE COLUMN scene sceneId int(11) DEFAULT '0'\n                  `;\n      await ctx.model.query(sql);\n\n\n      // aAtom: add field roleIdOwner\n      sql = `\n        ALTER TABLE aAtom\n          ADD COLUMN roleIdOwner int(11) DEFAULT '0'\n                  `;\n      await ctx.model.query(sql);\n\n      // aViewRoleRightAtomClass\n      sql = `\n        create view aViewRoleRightAtomClass as\n          select a.iid,a.roleId as roleIdWho,a.roleIdBase,b.id as roleRightId,b.atomClassId,b.action,b.scope from aRoleExpand a\n            inner join aRoleRight b on a.roleIdBase=b.roleId\n          `;\n      await ctx.model.query(sql);\n\n      // aViewUserRightAtomClassRole\n      sql = `\n        create view aViewUserRightAtomClassRole as\n          select a.iid,a.userId as userIdWho,b.atomClassId,b.action,c.roleId as roleIdWhom from aViewUserRoleExpand a\n            inner join aRoleRightRef b on a.roleIdBase=b.roleId\n            inner join aRoleRef c on b.roleIdScope=c.roleIdParent\n          `;\n      await ctx.model.query(sql);\n\n      // aViewUserRightAtomRole\n      sql = `\n        create view aViewUserRightAtomRole as\n          select a.iid, a.id as atomId,a.roleIdOwner as roleIdWhom,b.userIdWho,b.action from aAtom a,aViewUserRightAtomClassRole b\n            where a.deleted=0 and a.atomEnabled=1\n              and a.atomClassId=b.atomClassId\n              and a.roleIdOwner=b.roleIdWhom\n        `;\n      await ctx.model.query(sql);\n\n      // update exists atoms\n      await this._updateAtoms(options);\n    }\n\n    async _updateAtoms(options) {\n      // all instances\n      const instances = await ctx.bean.instance.list({ where: {} });\n      for (const instance of instances) {\n        await ctx.executeBean({\n          subdomain: instance.name,\n          beanModule: moduleInfo.relativeName,\n          beanFullName: `${moduleInfo.relativeName}.version.manager`,\n          context: options,\n          fn: 'update8Atoms',\n        });\n      }\n    }\n\n    async _updateAtomsInstance() {\n      // cache\n      const mapUserAtomClassRole = {};\n      // atoms\n      const atoms = await ctx.model.query('select id, atomClassId, userIdCreated from aAtom where iid=? and deleted=0',\n        [ ctx.instance.id ]);\n      for (const atom of atoms) {\n        const mapKey = `${atom.userIdCreated}:${atom.atomClassId}`;\n        let mapValue = mapUserAtomClassRole[mapKey];\n        if (mapValue === undefined) {\n          mapValue = mapUserAtomClassRole[mapKey] = await this._getRoleIdOwner(atom.atomClassId, atom.userIdCreated);\n        }\n        if (mapValue > 0) {\n          await ctx.model.query('update aAtom set roleIdOwner=? where id=?', [ mapValue, atom.id ]);\n        }\n      }\n    }\n\n    async _getRoleIdOwner(atomClassId, userId) {\n      const roles = await ctx.bean.atom.preferredRoles({\n        atomClass: { id: atomClassId },\n        user: { id: userId },\n      });\n      if (roles.length === 0) return 0;\n      return roles[0].roleIdWho;\n    }\n\n\n  }\n\n  return VersionUpdate8;\n};\n","module.exports = function(ctx) {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class VersionUpdate9 {\n\n    async run() {\n      await this.run_atom();\n      await this.run_categorytag();\n      await this.run_resource();\n      await this.run_function();\n    }\n\n    async run_atom() {\n\n      let sql;\n\n      // aAtom: atomEnabled->atomStage\n      sql = `\n        ALTER TABLE aAtom\n          CHANGE COLUMN atomEnabled atomStage int(11) DEFAULT '0'\n        `;\n      await ctx.model.query(sql);\n\n      // aAtom: atomFlow->atomFlowId\n      sql = `\n        ALTER TABLE aAtom\n          CHANGE COLUMN atomFlow atomFlowId int(11) DEFAULT '0'\n        `;\n      await ctx.model.query(sql);\n\n      // aAtom: add field atomClosed/atomIdDraft/atomIdArchive\n      sql = `\n        ALTER TABLE aAtom\n          ADD COLUMN atomClosed int(11) DEFAULT '0',\n          ADD COLUMN atomIdDraft int(11) DEFAULT '0',\n          ADD COLUMN atomIdArchive int(11) DEFAULT '0'\n        `;\n      await ctx.model.query(sql);\n\n      // aAtom: add field atomStatic/atomStaticKey/atomRevision\n      sql = `\n        ALTER TABLE aAtom\n          ADD COLUMN atomStatic int(11) DEFAULT '0',\n          ADD COLUMN atomStaticKey varchar(255) DEFAULT NULL,\n          ADD COLUMN atomRevision int(11) DEFAULT '0'\n        `;\n      await ctx.model.query(sql);\n\n      // aAtom: add field atomDisabled\n      sql = `\n        ALTER TABLE aAtom\n          ADD COLUMN atomDisabled int(11) DEFAULT '0'\n        `;\n      await ctx.model.query(sql);\n\n      // alter view: aViewUserRightAtom\n      await ctx.model.query('drop view aViewUserRightAtom');\n      sql = `\n          create view aViewUserRightAtom as\n            select a.iid, a.id as atomId,a.userIdCreated as userIdWhom,b.userIdWho,b.action from aAtom a,aViewUserRightAtomClassUser b\n              where a.deleted=0 and a.atomStage>0\n                and a.atomClassId=b.atomClassId\n                and a.userIdCreated=b.userIdWhom\n        `;\n      await ctx.model.query(sql);\n\n      // alter view: aViewRoleRightAtom\n      await ctx.model.query('drop view aViewRoleRightAtom');\n      sql = `\n          create view aViewRoleRightAtom as\n            select a.iid, a.id as atomId,a.userIdCreated as userIdWhom,b.roleIdWho,b.action from aAtom a,aViewRoleRightAtomClassUser b\n              where a.deleted=0 and a.atomStage>0\n                and a.atomClassId=b.atomClassId\n                and a.userIdCreated=b.userIdWhom\n        `;\n      await ctx.model.query(sql);\n\n      // alter view: aViewUserRightAtomRole\n      await ctx.model.query('drop view aViewUserRightAtomRole');\n      sql = `\n          create view aViewUserRightAtomRole as\n            select a.iid, a.id as atomId,a.roleIdOwner as roleIdWhom,b.userIdWho,b.action from aAtom a,aViewUserRightAtomClassRole b\n              where a.deleted=0 and a.atomStage>0\n                and a.atomClassId=b.atomClassId\n                and a.roleIdOwner=b.roleIdWhom\n        `;\n      await ctx.model.query(sql);\n\n      // aAtomAction: add field bulk\n      sql = `\n        ALTER TABLE aAtomAction\n          ADD COLUMN bulk int(11) DEFAULT '0'\n        `;\n      await ctx.model.query(sql);\n      //   update action:create as bulk\n      sql = `\n        update aAtomAction set bulk=1 where code=1\n        `;\n      await ctx.model.query(sql);\n\n    }\n\n    async run_categorytag() {\n\n      let sql;\n      // aAtom: add field atomLanguage\\atomCategoryId\n      sql = `\n        ALTER TABLE aAtom\n          ADD COLUMN atomLanguage varchar(50) DEFAULT NULL,\n          ADD COLUMN atomCategoryId int(11) DEFAULT '0',\n          ADD COLUMN atomTags JSON DEFAULT NULL\n        `;\n      await ctx.model.query(sql);\n\n      // create table: aCategory\n      sql = `\n          CREATE TABLE aCategory (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomClassId int(11) DEFAULT '0',\n            language varchar(50) DEFAULT NULL,\n            categoryName varchar(50) DEFAULT NULL,\n            categoryCatalog int(11) DEFAULT '0',\n            categoryHidden int(11) DEFAULT '0',\n            categorySorting int(11) DEFAULT '0',\n            categoryFlag varchar(255) DEFAULT NULL,\n            categoryIdParent int(11) DEFAULT '0',\n            categoryUrl varchar(255) DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n      await ctx.model.query(sql);\n\n      // create table: aTag\n      sql = `\n          CREATE TABLE aTag (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomClassId int(11) DEFAULT '0',\n            language varchar(50) DEFAULT NULL,\n            tagName varchar(50) DEFAULT NULL,\n            tagAtomCount int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `;\n      await ctx.model.query(sql);\n\n      // create table: aTagRef\n      sql = `\n          CREATE TABLE aTagRef (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            tagId int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `;\n      await ctx.model.query(sql);\n\n    }\n\n    async run_resource() {\n      let sql;\n\n      // create table: aResource\n      sql = `\n          CREATE TABLE aResource (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            description varchar(255) DEFAULT NULL,\n            resourceSorting int(11) DEFAULT '0',\n            resourceType varchar(50) DEFAULT NULL,\n            resourceConfig JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n      await ctx.model.query(sql);\n\n      sql = `\n          CREATE TABLE aResourceLocale (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            locale varchar(50) DEFAULT NULL,\n            atomNameLocale varchar(255) DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n      await ctx.model.query(sql);\n\n      sql = `\n          CREATE TABLE aResourceRole (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            atomId int(11) DEFAULT '0',\n            roleId int(11) DEFAULT '0',\n            PRIMARY KEY (id)\n          )\n        `;\n      await ctx.model.query(sql);\n\n      // aViewUserRightResource\n      sql = `\n          CREATE VIEW aViewUserRightResource as\n            select a.iid,a.userId as userIdWho,a.roleExpandId,a.roleId,a.roleIdBase,\n                   b.id as resourceRoleId,b.atomId as resourceAtomId\n              from aViewUserRoleExpand a\n                inner join aResourceRole b on a.roleIdBase=b.roleId\n            `;\n      await ctx.model.query(sql);\n\n    }\n\n    async run_function() {\n      // drop table: aFunction\n      await ctx.model.query('drop table aFunction');\n      // drop table: aFunctionLocale\n      await ctx.model.query('drop table aFunctionLocale');\n      // drop table: aFunctionScene\n      await ctx.model.query('drop table aFunctionScene');\n      // drop table: aFunctionStar\n      await ctx.model.query('drop table aFunctionStar');\n      // drop table: aRoleFunction\n      await ctx.model.query('drop table aRoleFunction');\n      // drop view: aViewUserRightFunction\n      await ctx.model.query('drop view aViewUserRightFunction');\n    }\n\n  }\n\n  return VersionUpdate9;\n};\n","const versionManager = require('./bean/version.manager.js');\nconst atomResource = require('./bean/atom.resource.js');\nconst localProcedure = require('./bean/local.procedure.js');\nconst broadcastAuthProviderChanged = require('./bean/broadcast.authProviderChanged.js');\nconst queueSchedule = require('./bean/queue.schedule.js');\nconst queueRoleBuild = require('./bean/queue.roleBuild.js');\nconst startupRegisterPassport = require('./bean/startup.registerPassport.js');\nconst startupInstallAuthProviders = require('./bean/startup.installAuthProviders.js');\nconst startupLoadSchedules = require('./bean/startup.loadSchedules.js');\nconst startupLoadAtomStatics = require('./bean/startup.loadAtomStatics.js');\nconst startupCheckResourceLocales = require('./bean/startup.checkResourceLocales.js');\nconst middlewareInner = require('./bean/middleware.inner.js');\nconst middlewareTest = require('./bean/middleware.test.js');\nconst middlewareTransaction = require('./bean/middleware.transaction.js');\nconst middlewareCors = require('./bean/middleware.cors.js');\nconst middlewareAuth = require('./bean/middleware.auth.js');\nconst middlewareRight = require('./bean/middleware.right.js');\nconst middlewareJsonp = require('./bean/middleware.jsonp.js');\nconst middlewareHttpLog = require('./bean/middleware.httpLog.js');\nconst beanAtom = require('./bean/bean.atom.js');\nconst beanAtomAction = require('./bean/bean.atomAction.js');\nconst beanAtomClass = require('./bean/bean.atomClass.js');\nconst beanAuth = require('./bean/bean.auth.js');\nconst beanBase = require('./bean/bean.base.js');\nconst beanResource = require('./bean/bean.resource.js');\nconst beanRole = require('./bean/bean.role.js');\nconst beanUser = require('./bean/bean.user.js');\nconst beanUtil = require('./bean/bean.util.js');\nconst beanCategory = require('./bean/bean.category.js');\nconst beanTag = require('./bean/bean.tag.js');\nconst statsStars = require('./bean/stats.stars.js');\nconst statsDrafts = require('./bean/stats.drafts.js');\n\nmodule.exports = app => {\n  const beans = {\n    // version\n    'version.manager': {\n      mode: 'app',\n      bean: versionManager,\n    },\n    // atom\n    'atom.resource': {\n      mode: 'app',\n      bean: atomResource,\n    },\n    // local\n    'local.procedure': {\n      mode: 'ctx',\n      bean: localProcedure,\n    },\n    // broadcast\n    'broadcast.authProviderChanged': {\n      mode: 'app',\n      bean: broadcastAuthProviderChanged,\n    },\n    // queue\n    'queue.schedule': {\n      mode: 'app',\n      bean: queueSchedule,\n    },\n    'queue.roleBuild': {\n      mode: 'app',\n      bean: queueRoleBuild,\n    },\n    // startup\n    'startup.registerPassport': {\n      mode: 'app',\n      bean: startupRegisterPassport,\n    },\n    'startup.installAuthProviders': {\n      mode: 'app',\n      bean: startupInstallAuthProviders,\n    },\n    'startup.loadSchedules': {\n      mode: 'app',\n      bean: startupLoadSchedules,\n    },\n    'startup.loadAtomStatics': {\n      mode: 'app',\n      bean: startupLoadAtomStatics,\n    },\n    'startup.checkResourceLocales': {\n      mode: 'app',\n      bean: startupCheckResourceLocales,\n    },\n    // middleware\n    'middleware.inner': {\n      mode: 'ctx',\n      bean: middlewareInner,\n    },\n    'middleware.test': {\n      mode: 'ctx',\n      bean: middlewareTest,\n    },\n    'middleware.transaction': {\n      mode: 'ctx',\n      bean: middlewareTransaction,\n    },\n    'middleware.cors': {\n      mode: 'ctx',\n      bean: middlewareCors,\n    },\n    'middleware.auth': {\n      mode: 'ctx',\n      bean: middlewareAuth,\n    },\n    'middleware.right': {\n      mode: 'ctx',\n      bean: middlewareRight,\n    },\n    'middleware.jsonp': {\n      mode: 'ctx',\n      bean: middlewareJsonp,\n    },\n    'middleware.httpLog': {\n      mode: 'ctx',\n      bean: middlewareHttpLog,\n    },\n    // global\n    atom: {\n      mode: 'ctx',\n      bean: beanAtom,\n      global: true,\n    },\n    atomAction: {\n      mode: 'ctx',\n      bean: beanAtomAction,\n      global: true,\n    },\n    atomClass: {\n      mode: 'ctx',\n      bean: beanAtomClass,\n      global: true,\n    },\n    auth: {\n      mode: 'ctx',\n      bean: beanAuth,\n      global: true,\n    },\n    base: {\n      mode: 'ctx',\n      bean: beanBase,\n      global: true,\n    },\n    resource: {\n      mode: 'ctx',\n      bean: beanResource,\n      global: true,\n    },\n    role: {\n      mode: 'ctx',\n      bean: beanRole,\n      global: true,\n    },\n    user: {\n      mode: 'ctx',\n      bean: beanUser,\n      global: true,\n    },\n    util: {\n      mode: 'ctx',\n      bean: beanUtil,\n      global: true,\n    },\n    category: {\n      mode: 'ctx',\n      bean: beanCategory,\n      global: true,\n    },\n    tag: {\n      mode: 'ctx',\n      bean: beanTag,\n      global: true,\n    },\n    // stats\n    'stats.stars': {\n      mode: 'ctx',\n      bean: statsStars,\n    },\n    'stats.drafts': {\n      mode: 'ctx',\n      bean: statsDrafts,\n    },\n  };\n  return beans;\n};\n","const require3 = require('require3');\nconst uuid = require3('uuid');\nconst ExcelJS = require3('exceljs');\n\nconst __atomBasicFields = [\n  'atomName', 'atomStatic', 'atomStaticKey', 'atomRevision',\n  'atomLanguage', 'atomCategoryId', 'atomTags', 'allowComment',\n];\n\nmodule.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class AtomBase extends app.meta.BeanBase {\n\n    async create({ atomClass, item, user }) {\n      // atomName\n      if (!item.atomName) {\n        // draftId\n        const sequence = this.ctx.bean.sequence.module(moduleInfo.relativeName);\n        const draftId = await sequence.next('draft');\n        item.atomName = `${this.ctx.text('Draft')}-${draftId}`;\n      }\n      // atomStaticKey\n      if (!item.atomStaticKey) {\n        item.atomStaticKey = uuid.v4().replace(/-/g, '');\n      }\n      // add\n      const atomId = await this.ctx.bean.atom._add({ atomClass, atom: item, user });\n      return { atomId };\n    }\n\n    async read({ atomClass, options, key, user }) {\n      // get\n      return await this.ctx.bean.atom._get({ atomClass, options, key, mode: 'full', user });\n    }\n\n    async select(/* {  atomClass, options, items, user }*/) {\n      // donothing\n    }\n\n    async delete({ atomClass, key, user }) {\n      // atomClass\n      const _atomClass = await this.ctx.bean.atomClass.atomClass(atomClass);\n      if (_atomClass.tag) {\n        const _atomOld = await this.ctx.bean.atom.modelAtom.get({ id: key.atomId });\n        if (_atomOld.atomTags) {\n          // stage\n          const atomStage = _atomOld.atomStage;\n          await this.ctx.bean.tag.deleteTagRefs({ atomId: key.atomId });\n          if (atomStage === 1) {\n            await this.ctx.bean.tag.setTagAtomCount({ tagsNew: null, tagsOld: _atomOld.atomTags });\n          }\n        }\n      }\n      // delete\n      await this.ctx.bean.atom._delete({\n        atom: { id: key.atomId },\n        user,\n      });\n    }\n\n    async write({ atomClass, target, key, item, options, user }) {\n      if (!item) return;\n      // force delete atomDisabled\n      delete item.atomDisabled;\n      // stage\n      const atomStage = item.atomStage;\n      // atomClass\n      const _atomClass = await this.ctx.bean.atomClass.atomClass(atomClass);\n      let _atomOld;\n      if (_atomClass.tag && item.atomTags !== undefined && atomStage === 1) {\n        _atomOld = await this.ctx.bean.atom.modelAtom.get({ id: key.atomId });\n      }\n      // validate\n      if (atomStage === 0 && !target) {\n        await this.ctx.bean.validation._validate({ atomClass, data: item, options });\n      }\n      // write atom\n      await this._writeAtom({ key, item, user, atomStage });\n      // tag\n      if (_atomClass.tag && item.atomTags !== undefined) {\n        await this.ctx.bean.tag.updateTagRefs({ atomId: key.atomId, atomTags: item.atomTags });\n        if (atomStage === 1) {\n          await this.ctx.bean.tag.setTagAtomCount({ tagsNew: item.atomTags, tagsOld: _atomOld.atomTags });\n        }\n      }\n    }\n\n    async _writeAtom({ key, item, user, atomStage }) {\n      // write atom\n      const atom = { };\n      for (const field of __atomBasicFields) {\n        if (item[field] !== undefined) atom[field] = item[field];\n      }\n      if (atomStage === 0) {\n        atom.updatedAt = new Date();\n      }\n      // update\n      atom.id = key.atomId;\n      await this.ctx.bean.atom._update({ atom, user });\n    }\n\n    async submit({ /* atomClass,*/ key, options, user }) {\n      const ignoreFlow = options && options.ignoreFlow;\n      const _atom = await this.ctx.bean.atom.read({ key, user });\n      if (_atom.atomStage > 0) this.ctx.throw(403);\n      // check atom flow\n      if (!ignoreFlow) {\n        const _nodeBaseBean = this.ctx.bean._newBean('a-flowtask.flow.node.startEventAtom');\n        const flowInstance = await _nodeBaseBean._match({ atom: _atom, userId: _atom.userIdUpdated });\n        if (flowInstance) {\n          // set atom flow\n          const atomFlowId = flowInstance.context._flowId;\n          await this.ctx.bean.atom.flow({ key, atom: { atomFlowId } });\n          // ok\n          return { flow: { id: atomFlowId } };\n        }\n      }\n      return await this.ctx.bean.atom._submitDirect({ key, item: _atom, options, user });\n    }\n\n    async enable({ /* atomClass,*/ key/* , user*/ }) {\n      await this.ctx.bean.atom.modelAtom.update({\n        id: key.atomId, atomDisabled: 0,\n      });\n    }\n\n    async disable({ /* atomClass,*/ key/* , user*/ }) {\n      await this.ctx.bean.atom.modelAtom.update({\n        id: key.atomId, atomDisabled: 1,\n      });\n    }\n\n    async copy(/* { atomClass, target, srcKey, srcItem, destKey, destItem, user }*/) {\n      // donothing\n    }\n\n    async exportBulk({ /* atomClass, options,*/ fields, items/* , user*/ }) {\n      // workbook\n      const workbook = new ExcelJS.Workbook();\n      workbook.creator = 'CabloyJS';\n      workbook.created = new Date();\n      // worksheet\n      const worksheet = workbook.addWorksheet('Sheet');\n      // columns\n      const columns = [];\n      for (const field of fields) {\n        columns.push({\n          header: this.ctx.text(field.title),\n          key: field.name,\n        });\n      }\n      worksheet.columns = columns;\n      // rows\n      const rows = [];\n      for (const item of items) {\n        const row = {};\n        for (const field of fields) {\n          row[field.name] = item[field.name];\n        }\n        rows.push(row);\n      }\n      worksheet.addRows(rows);\n      // write\n      const buffer = await workbook.xlsx.writeBuffer();\n      // meta\n      const meta = {\n        filename: `${this.ctx.bean.util.now()}.xlsx`,\n        encoding: '7bit',\n        mime: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n        fields: {\n          mode: 2,\n          flag: 'atom-bulk-export',\n        },\n      };\n      // ok\n      return { type: 'buffer', data: buffer, meta };\n    }\n\n    async checkRightAction({ atom, atomClass, action, stage, user, checkFlow }) {\n      return await this.ctx.bean.atom._checkRightAction({ atom, atomClass, action, stage, user, checkFlow });\n    }\n\n  }\n  return AtomBase;\n};\n","// eslint-disable-next-line\nmodule.exports = appInfo => {\n  const config = {};\n\n  // middlewares\n  config.middlewares = {\n    inner: {\n      bean: 'inner',\n      global: false,\n    },\n    test: {\n      bean: 'test',\n      global: false,\n    },\n    transaction: {\n      bean: 'transaction',\n      global: false,\n    },\n    cors: {\n      bean: 'cors',\n      global: true,\n      dependencies: 'instance',\n    },\n    auth: {\n      bean: 'auth',\n      global: true,\n      dependencies: 'instance',\n      ignore: /\\/version\\/(update|init|test)/,\n    },\n    right: {\n      bean: 'right',\n      global: true,\n      dependencies: 'auth',\n    },\n    jsonp: {\n      bean: 'jsonp',\n      global: false,\n      dependencies: 'instance',\n    },\n    httpLog: {\n      bean: 'httpLog',\n      global: false,\n      dependencies: 'instance',\n    },\n  };\n\n  // startups\n  config.startups = {\n    registerPassport: {\n      bean: 'registerPassport',\n    },\n    installAuthProviders: {\n      bean: 'installAuthProviders',\n      instance: true,\n    },\n    loadSchedules: {\n      bean: 'loadSchedules',\n      instance: true,\n      debounce: true,\n    },\n    loadAtomStatics: {\n      bean: 'loadAtomStatics',\n      instance: true,\n      debounce: true,\n    },\n    checkResourceLocales: {\n      bean: 'checkResourceLocales',\n      instance: true,\n      debounce: true,\n    },\n  };\n\n  // queues\n  config.queues = {\n    schedule: {\n      bean: 'schedule',\n    },\n    roleBuild: {\n      bean: 'roleBuild',\n    },\n  };\n\n  // broadcasts\n  config.broadcasts = {\n    authProviderChanged: {\n      bean: 'authProviderChanged',\n    },\n  };\n\n  // pageSize\n  config.pageSize = 20;\n\n  // locales\n  config.locales = {\n    'en-us': 'English',\n    'zh-cn': 'Chinese',\n  };\n\n  // anonymous\n  config.anonymous = {\n    maxAge: 365 * 24 * 3600 * 1000, // 365 天\n  };\n  // authenticated or rememberMe\n  config.authenticated = {\n    maxAge: 30 * 24 * 3600 * 1000, // 30 天\n  };\n  // checkUserName\n  config.checkUserName = true;\n  // account\n  config.account = {\n    needActivation: true,\n    activationWays: 'mobile,email',\n    activationProviders: {\n      mobile: 'a-authsms',\n      email: 'a-authsimple',\n    },\n    url: {\n      // url is specified by activation provider\n      //   emailConfirm: '/a/authsimple/emailConfirm',\n      //   mobileVerify: '',\n      //   passwordChange: '/a/authsimple/passwordChange',\n      //   passwordForgot: '/a/authsimple/passwordForgot',\n      //   passwordReset: '/a/authsimple/passwordReset',\n    },\n    //  default is 'activated', if need activating by mobile/email, then add to 'registered' first\n    activatedRoles: 'activated',\n  };\n\n  // public dir\n  config.publicDir = '';\n\n  // comment\n  config.comment = {\n    trim: {\n      limit: 100,\n      wordBreak: false,\n      preserveTags: false,\n    },\n  };\n\n  // httpLog\n  config.httpLog = true;\n\n  // auth\n  config.auth = {\n    avatar: {\n      timeout: 5000,\n      default: 'https://cabloy.com/plugins/cms-pluginbase/assets/images/avatar_user.png',\n    },\n  };\n\n  // user\n  config.user = {\n    privacyFields: 'createdAt,updatedAt,realName,locale,email,mobile,activated,emailConfirmed,mobileVerified',\n  };\n\n  return config;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  return {\n    systemRoles: [ 'root', 'anonymous', 'authenticated', 'template', 'system', 'registered', 'activated', 'superuser', 'organization', 'internal', 'external' ],\n    atom: {\n      stage: {\n        draft: 0,\n        archive: 1,\n        history: 2,\n      },\n      action: {\n        create: 1,\n        read: 2,\n        write: 3,\n        delete: 4,\n        clone: 5,\n        enable: 6,\n        disable: 7,\n\n        authorize: 25,\n\n        deleteBulk: 35,\n        exportBulk: 36,\n\n        save: 51,\n        submit: 52,\n        history: 53,\n        archive: 54,\n        draft: 55,\n        custom: 100, // custom action start from custom\n      },\n      actionMeta: {\n        create: {\n          title: 'Create',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          bulk: true,\n          select: false,\n          icon: { material: 'add' },\n        },\n        read: {\n          title: 'View',\n          actionModule: moduleInfo.relativeName,\n          actionPath: '/a/basefront/atom/item?mode=view&atomId={{atomId}}&itemId={{itemId}}',\n          enableOnStatic: true,\n          enableOnOpened: true,\n          icon: { material: 'visibility' },\n        },\n        write: {\n          title: 'Edit',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          enableOnStatic: false,\n          enableOnOpened: false,\n          icon: { material: 'edit' },\n        },\n        delete: {\n          title: 'Delete',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          enableOnStatic: false,\n          enableOnOpened: false,\n          icon: { material: 'delete' },\n        },\n        clone: {\n          title: 'Clone',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          enableOnStatic: true,\n          enableOnOpened: true,\n          icon: { material: 'content_copy' },\n        },\n        enable: {\n          title: 'Enable',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          enableOnStatic: true,\n          enableOnOpened: true,\n          stage: 'archive',\n          icon: { material: 'play_arrow' },\n        },\n        disable: {\n          title: 'Disable',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          enableOnStatic: true,\n          enableOnOpened: true,\n          stage: 'archive',\n          icon: { material: 'stop' },\n        },\n        authorize: {\n          title: 'Authorize',\n          actionModule: moduleInfo.relativeName,\n          actionPath: '/a/basefront/resource/authorize?atomId={{atomId}}&itemId={{itemId}}',\n          enableOnStatic: true,\n          enableOnOpened: true,\n          stage: 'archive',\n          icon: { material: 'groups' },\n        },\n        deleteBulk: {\n          title: 'Delete',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'actionBulk',\n          bulk: true,\n          select: true,\n          icon: { material: 'delete' },\n        },\n        exportBulk: {\n          title: 'Export',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'actionBulk',\n          bulk: true,\n          select: null,\n          icon: { material: 'cloud_download' },\n        },\n        save: {\n          title: 'Save',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          authorize: false,\n          icon: { material: 'save' },\n        },\n        submit: {\n          title: 'Submit',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          authorize: false,\n          icon: { material: 'done' },\n        },\n        history: {\n          title: 'History',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          authorize: false,\n          icon: { material: 'change_history' },\n        },\n        archive: {\n          title: 'Archive',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          authorize: false,\n          icon: { material: 'all_inbox' },\n        },\n        draft: {\n          title: 'Draft',\n          actionModule: moduleInfo.relativeName,\n          actionComponent: 'action',\n          authorize: false,\n          icon: { material: 'content_paste' },\n        },\n        custom: {\n          title: 'Custom',\n        },\n      },\n    },\n    function: {\n      scene: {\n      // default: 0,\n        create: 1,\n        list: 2,\n        // report: 20,\n        tools: 50,\n      // custom: 100,\n      },\n    },\n  };\n};\n","// error code should start from 1001\nmodule.exports = {\n  1001: 'Element Exists',\n  1002: 'Element does not Exist',\n  1003: 'Operation Failed',\n  1004: 'User does not Exist',\n  1005: 'User is Disabled',\n  1006: 'Agent user does not Exist',\n  1007: 'Incomplete Information',\n  1008: 'Should Delete Children first',\n  1009: 'The Auth should be Enabled',\n  1010: 'Only Valid for Archive Atom',\n  1011: 'Invalid Arguments',\n  1012: 'Cannot delete if has atoms',\n  1013: 'Cannot delete if has children',\n};\n","module.exports = {\n  CloneCopyText: 'Copy',\n  KeyForAtom: 'Key',\n  ViewLayout: 'View',\n  WorkFlow: 'Work Flow',\n};\n","module.exports = {\n  'Comment List': '评论列表',\n  'Delete Comment': '删除评论',\n  'Element Exists': '元素已存在',\n  'Element does not Exist': '元素不存在',\n  'Operation Failed': '操作失败',\n  'User does not Exist': '用户不存在',\n  'User is Disabled': '用户被禁用',\n  'Agent user does not Exist': '代理用户不存在',\n  'Incomplete Information': '信息不完整',\n  'Should Delete Children first': '应该先删除子角色',\n  'Cannot Contain __': '不能包含__',\n  'The Auth should be Enabled': '此认证需要被启用',\n  'Only Valid for Archive Atom': '只针对归档原子有效',\n  'Atom Flag': '原子标记',\n  'Atom Name': '原子名称',\n  'Modification Time': '修改时间',\n  'Created Time': '创建时间',\n  'Account Migration': '账户迁移',\n  'Invalid Arguments': '无效参数',\n  'Cannot delete if has atoms': '有原子时不允许删除',\n  'Cannot delete if has children': '有子元素时不允许删除',\n  'Create Resource': '新建资源',\n  'Resource List': '资源列表',\n  Draft: '草稿',\n  Drafts: '草稿',\n  Archive: '归档',\n  Archives: '归档',\n  History: '历史',\n  Histories: '历史',\n  Base: '基本',\n  English: '英文',\n  Chinese: '中文',\n  Create: '新建',\n  List: '列表',\n  Tools: '工具',\n  View: '查看',\n  Edit: '编辑',\n  Delete: '删除',\n  Clone: '克隆',\n  Export: '导出',\n  Exports: '导出',\n  Save: '保存',\n  Submit: '提交',\n  Atom: '原子',\n  AtomName: '原子名称',\n  Search: '搜索',\n  CloneCopyText: '副本',\n  Creator: '创建人',\n  Revision: '修订',\n  Version: '版本',\n  KeyForAtom: '关键字',\n  Content: '内容',\n  Enable: '启用',\n  Enabled: '已启用',\n  Disable: '禁用',\n  Disabled: '已禁用',\n  Default: '缺省',\n  Home: '首页',\n  Test: '测试',\n  Catalog: '目录',\n  Category: '目录',\n  Categories: '目录',\n  Tag: '标签',\n  Tags: '标签',\n  Url: '链接',\n  Resource: '资源',\n  Function: '功能',\n  Menu: '菜单',\n  Authorize: '授权',\n  General: '通用',\n  Stars: '星标',\n  Task: '任务',\n  Tasks: '任务',\n  Claimings: '待签收',\n  Handlings: '处理中',\n  Completeds: '已完成',\n  Flow: '流程',\n  Flows: '流程',\n  Initiateds: '发起的',\n  Participateds: '参与的',\n  Ends: '已结束',\n  Mine: '我的',\n  Attachments: '附件',\n  Comments: '评论',\n  Appearance: '外观',\n  Language: '语言',\n  Theme: '主题',\n  ViewLayout: '视图',\n  WorkFlow: '工作流',\n};\n","module.exports = {\n  'en-us': require('./locale/en-us.js'),\n  'zh-cn': require('./locale/zh-cn.js'),\n};\n","const mineAtomDrafts = require('./mines/mineAtomDrafts.js');\nconst mineAtomStars = require('./mines/mineAtomStars.js');\nconst mineAtomArchives = require('./mines/mineAtomArchives.js');\nconst mineWorkFlowTasks = require('./mines/mineWorkFlowTasks.js');\nconst mineWorkFlowFlows = require('./mines/mineWorkFlowFlows.js');\nconst mineTaskClaimings = require('./mines/mineTaskClaimings.js');\nconst mineTaskHandlings = require('./mines/mineTaskHandlings.js');\nconst mineTaskCompleteds = require('./mines/mineTaskCompleteds.js');\nconst mineFlowInitiateds = require('./mines/mineFlowInitiateds.js');\nconst mineFlowParticipateds = require('./mines/mineFlowParticipateds.js');\nconst mineFlowEnds = require('./mines/mineFlowEnds.js');\nconst mineMineAttachments = require('./mines/mineMineAttachments.js');\nconst mineMineComments = require('./mines/mineMineComments.js');\nconst mineMineExports = require('./mines/mineMineExports.js');\nconst mineAppearanceLanguage = require('./mines/mineAppearanceLanguage.js');\nconst mineAppearanceTheme = require('./mines/mineAppearanceTheme.js');\nconst mineAppearanceView = require('./mines/mineAppearanceView.js');\n\nmodule.exports = app => {\n  const resources = [\n    mineAtomDrafts(app),\n    mineAtomStars(app),\n    mineAtomArchives(app),\n    mineWorkFlowTasks(app),\n    mineWorkFlowFlows(app),\n    mineTaskClaimings(app),\n    mineTaskHandlings(app),\n    mineTaskCompleteds(app),\n    mineFlowInitiateds(app),\n    mineFlowParticipateds(app),\n    mineFlowEnds(app),\n    mineMineAttachments(app),\n    mineMineComments(app),\n    mineMineExports(app),\n    mineAppearanceLanguage(app),\n    mineAppearanceTheme(app),\n    mineAppearanceView(app),\n  ];\n  return resources;\n};\n","module.exports = app => {\n  // resource\n  const resource = {\n    atomName: 'Language',\n    atomStaticKey: 'mineAppearanceLanguage',\n    atomRevision: -1,\n    atomCategoryId: 'a-base:mine.Appearance',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionModule: 'a-user',\n      actionComponent: 'action',\n      name: 'appearanceLanguage',\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 1,\n  };\n  return resource;\n};\n","module.exports = app => {\n  const actionPath = '/a/user/theme';\n  // resource\n  const resource = {\n    atomName: 'Theme',\n    atomStaticKey: 'mineAppearanceTheme',\n    atomRevision: -1,\n    atomCategoryId: 'a-base:mine.Appearance',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 2,\n  };\n  return resource;\n};\n","module.exports = app => {\n  // resource\n  const resource = {\n    atomName: 'ViewLayout',\n    atomStaticKey: 'mineAppearanceView',\n    atomRevision: -1,\n    atomCategoryId: 'a-base:mine.Appearance',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionModule: 'a-user',\n      actionComponent: 'action',\n      name: 'appearanceView',\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 3,\n  };\n  return resource;\n};\n","module.exports = app => {\n  // actionPath\n  const options = {\n    stage: 'archive',\n    mine: 1,\n  };\n  const actionPath = `/a/basefront/atom/list?options=${encodeURIComponent(JSON.stringify(options))}`;\n  // resource\n  const resource = {\n    atomName: 'Archives',\n    atomStaticKey: 'mineAtomArchives',\n    atomRevision: 0,\n    atomCategoryId: 'a-base:mine.Atom',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 3,\n  };\n  return resource;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  // actionPath\n  const options = {\n    stage: 'draft',\n    mine: 1,\n  };\n  const actionPath = `/a/basefront/atom/list?options=${encodeURIComponent(JSON.stringify(options))}`;\n  // resource\n  const resource = {\n    atomName: 'Drafts',\n    atomStaticKey: 'mineAtomDrafts',\n    atomRevision: 0,\n    atomCategoryId: 'a-base:mine.Atom',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n      stats: {\n        params: {\n          module: moduleInfo.relativeName,\n          name: 'drafts',\n        },\n        color: 'orange',\n      },\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 1,\n  };\n  return resource;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  // actionPath\n  const options = {\n    stage: 'archive',\n    star: 1,\n  };\n  const actionPath = `/a/basefront/atom/list?options=${encodeURIComponent(JSON.stringify(options))}`;\n  // resource\n  const resource = {\n    atomName: 'Stars',\n    atomStaticKey: 'mineAtomStars',\n    atomRevision: 0,\n    atomCategoryId: 'a-base:mine.Atom',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n      stats: {\n        params: {\n          module: moduleInfo.relativeName,\n          name: 'stars',\n        },\n        color: 'orange',\n      },\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 2,\n  };\n  return resource;\n};\n","module.exports = app => {\n  // actionPath\n  const options = {\n    mode: 'history',\n    where: {\n      'a.flowStatus': 1,\n    },\n  };\n  const actionPath = `/a/flowtask/flow/list?options=${encodeURIComponent(JSON.stringify(options))}`;\n  // resource\n  const resource = {\n    atomName: 'Ends',\n    atomStaticKey: 'mineFlowEnds',\n    atomRevision: -1,\n    atomCategoryId: 'a-base:mine.Flow',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 3,\n  };\n  return resource;\n};\n","module.exports = app => {\n  // actionPath\n  const options = {\n    mode: 'mine',\n  };\n  const actionPath = `/a/flowtask/flow/list?options=${encodeURIComponent(JSON.stringify(options))}`;\n  // resource\n  const resource = {\n    atomName: 'Initiateds',\n    atomStaticKey: 'mineFlowInitiateds',\n    atomRevision: -1,\n    atomCategoryId: 'a-base:mine.Flow',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n      stats: {\n        params: {\n          module: 'a-flow',\n          name: 'flowInitiateds',\n        },\n        color: 'orange',\n      },\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 1,\n  };\n  return resource;\n};\n","module.exports = app => {\n  // actionPath\n  const options = {\n    mode: 'others',\n  };\n  const actionPath = `/a/flowtask/flow/list?options=${encodeURIComponent(JSON.stringify(options))}`;\n  // resource\n  const resource = {\n    atomName: 'Participateds',\n    atomStaticKey: 'mineFlowParticipateds',\n    atomRevision: -1,\n    atomCategoryId: 'a-base:mine.Flow',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 2,\n  };\n  return resource;\n};\n","module.exports = app => {\n  const actionPath = '/a/basefront/attachment/all?scene=mine';\n  // resource\n  const resource = {\n    atomName: 'Attachments',\n    atomStaticKey: 'mineMineAttachments',\n    atomRevision: 0,\n    atomCategoryId: 'a-base:mine.Mine',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 1,\n  };\n  return resource;\n};\n","module.exports = app => {\n  const actionPath = '/a/basefront/comment/all?scene=mine';\n  // resource\n  const resource = {\n    atomName: 'Comments',\n    atomStaticKey: 'mineMineComments',\n    atomRevision: 0,\n    atomCategoryId: 'a-base:mine.Mine',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 2,\n  };\n  return resource;\n};\n","module.exports = app => {\n  const actionPath = '/a/user/user/exports';\n  // resource\n  const resource = {\n    atomName: 'Exports',\n    atomStaticKey: 'mineMineExports',\n    atomRevision: 0,\n    atomCategoryId: 'a-base:mine.Mine',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 3,\n  };\n  return resource;\n};\n","module.exports = app => {\n  // actionPath\n  const options = {\n    mode: 'claimings',\n  };\n  const actionPath = `/a/flowtask/flowTask/list?options=${encodeURIComponent(JSON.stringify(options))}`;\n  // resource\n  const resource = {\n    atomName: 'Claimings',\n    atomStaticKey: 'mineTaskClaimings',\n    atomRevision: -1,\n    atomCategoryId: 'a-base:mine.Task',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n      stats: {\n        params: {\n          module: 'a-flowtask',\n          name: 'taskClaimings',\n        },\n        color: 'red',\n      },\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 1,\n  };\n  return resource;\n};\n","module.exports = app => {\n  // actionPath\n  const options = {\n    mode: 'completeds',\n  };\n  const actionPath = `/a/flowtask/flowTask/list?options=${encodeURIComponent(JSON.stringify(options))}`;\n  // resource\n  const resource = {\n    atomName: 'Completeds',\n    atomStaticKey: 'mineTaskCompleteds',\n    atomRevision: -1,\n    atomCategoryId: 'a-base:mine.Task',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 3,\n  };\n  return resource;\n};\n","module.exports = app => {\n  // actionPath\n  const options = {\n    mode: 'handlings',\n  };\n  const actionPath = `/a/flowtask/flowTask/list?options=${encodeURIComponent(JSON.stringify(options))}`;\n  // resource\n  const resource = {\n    atomName: 'Handlings',\n    atomStaticKey: 'mineTaskHandlings',\n    atomRevision: -1,\n    atomCategoryId: 'a-base:mine.Task',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n      stats: {\n        params: {\n          module: 'a-flowtask',\n          name: 'taskHandlings',\n        },\n        color: 'red',\n      },\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 2,\n  };\n  return resource;\n};\n","module.exports = app => {\n  // actionPath\n  const actionPath = '/a/flowtask/flow/tabs';\n  // resource\n  const resource = {\n    atomName: 'Flows',\n    atomStaticKey: 'mineWorkFlowFlows',\n    atomRevision: 0,\n    atomCategoryId: 'a-base:mine.WorkFlow',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n      stats: {\n        params: {\n          module: 'a-flow',\n          name: 'flowInitiateds',\n        },\n        color: 'orange',\n      },\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 2,\n  };\n  return resource;\n};\n","module.exports = app => {\n  // actionPath\n  const actionPath = '/a/flowtask/flowTask/tabs';\n  // resource\n  const resource = {\n    atomName: 'Tasks',\n    atomStaticKey: 'mineWorkFlowTasks',\n    atomRevision: 0,\n    atomCategoryId: 'a-base:mine.WorkFlow',\n    resourceType: 'a-base:mine',\n    resourceConfig: JSON.stringify({\n      actionPath,\n      stats: {\n        params: {\n          module: 'a-flowtask',\n          name: 'taskClaimingsHandlings',\n        },\n        color: 'red',\n      },\n    }),\n    resourceRoles: 'root',\n    resourceSorting: 1,\n  };\n  return resource;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const resourceMines = require('./mines.js')(app);\n  let resources = [\n    // function\n    {\n      atomName: 'Delete Comment',\n      atomStaticKey: 'deleteComment',\n      atomRevision: 0,\n      atomCategoryId: 'a-base:function.Tools',\n      resourceType: 'a-base:function',\n      resourceConfig: null,\n      resourceRoles: 'template.system',\n    },\n    // menu\n    {\n      atomName: 'Create Resource',\n      atomStaticKey: 'createResource',\n      atomRevision: 0,\n      atomCategoryId: 'a-base:menu.Create',\n      resourceType: 'a-base:menu',\n      resourceConfig: JSON.stringify({\n        module: moduleInfo.relativeName,\n        atomClassName: 'resource',\n        atomAction: 'create',\n      }),\n      resourceRoles: 'template.system',\n    },\n    {\n      atomName: 'Resource List',\n      atomStaticKey: 'listResource',\n      atomRevision: 0,\n      atomCategoryId: 'a-base:menu.List',\n      resourceType: 'a-base:menu',\n      resourceConfig: JSON.stringify({\n        module: moduleInfo.relativeName,\n        atomClassName: 'resource',\n        atomAction: 'read',\n      }),\n      resourceRoles: 'template.system',\n    },\n    {\n      atomName: 'Comment List',\n      atomStaticKey: 'listComment',\n      atomRevision: 0,\n      atomCategoryId: 'a-base:menu.Tools',\n      resourceType: 'a-base:menu',\n      resourceConfig: JSON.stringify({\n        actionPath: '/a/basefront/comment/all',\n      }),\n      resourceRoles: 'root',\n    },\n  ];\n  // mine\n  resources = resources.concat(resourceMines);\n  // ok\n  return resources;\n};\n","module.exports = app => {\n  const keywords = {};\n  keywords.exists = {\n    async: true,\n    type: 'string',\n    errors: true,\n    compile() {\n      return async function(data, path, rootData, name) {\n        const ctx = this;\n        const res = await ctx.bean.user.exists({ [name]: data });\n        if (res && res.id !== ctx.state.user.agent.id) {\n          const errors = [{ keyword: 'x-exists', params: [], message: ctx.text('Element Exists') }];\n          throw new app.meta.ajv.ValidationError(errors);\n        }\n        if (!res && data.indexOf('__') > -1) {\n          const errors = [{ keyword: 'x-exists', params: [], message: ctx.text('Cannot Contain __') }];\n          throw new app.meta.ajv.ValidationError(errors);\n        }\n        return true;\n      };\n    },\n  };\n  return keywords;\n};\n","module.exports = app => {\n  const schemas = {};\n  // user\n  schemas.user = {\n    type: 'object',\n    properties: {\n      userName: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Username',\n        notEmpty: true,\n        'x-exists': true,\n        ebReadOnly: true,\n      },\n      realName: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Realname',\n        notEmpty: true,\n      },\n      email: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Email',\n        // notEmpty: true,\n        // format: 'email',\n        'x-exists': true,\n        ebReadOnly: true,\n      },\n      mobile: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Mobile',\n        // notEmpty: true,\n        'x-exists': true,\n        ebReadOnly: true,\n      },\n      motto: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Motto',\n      },\n      locale: {\n        type: 'string',\n        ebType: 'select',\n        ebTitle: 'Locale',\n        ebOptionsUrl: '/a/base/base/locales',\n        ebReadOnly: true,\n      },\n    },\n  };\n\n  // category\n  schemas.category = {\n    type: 'object',\n    properties: {\n      categoryName: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Category Name',\n        notEmpty: true,\n      },\n      categoryHidden: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Hidden',\n        default: false,\n      },\n      categorySorting: {\n        type: 'number',\n        ebType: 'text',\n        ebTitle: 'Sorting',\n      },\n      categoryFlag: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Flag',\n      },\n      categoryCatalog: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Catalog',\n        ebReadOnly: true,\n        default: false,\n      },\n      language: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Language',\n        ebReadOnly: true,\n        // notEmpty: true,\n      },\n      categoryUrl: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Url',\n      },\n    },\n  };\n\n  // resource\n  schemas.resource = {\n    type: 'object',\n    properties: {\n      // title\n      groupTitle: {\n        type: 'null',\n        ebType: 'group-flatten',\n        ebTitle: 'Title',\n      },\n      atomName: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Name',\n        notEmpty: true,\n      },\n      // config\n      groupConfig: {\n        type: 'null',\n        ebType: 'group-flatten',\n        ebTitle: 'Config',\n      },\n      resourceConfig: {\n        type: [ 'string', 'null' ],\n        ebType: 'json',\n        ebTitle: 'Config',\n      },\n      // Basic Info\n      groupBasicInfo: {\n        type: 'null',\n        ebType: 'group-flatten',\n        ebTitle: 'Basic Info',\n      },\n      description: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Description',\n      },\n      atomCategoryId: {\n        type: 'number',\n        ebType: 'category',\n        ebTitle: 'Category',\n      },\n      atomTags: {\n        type: [ 'string', 'null' ],\n        ebType: 'tags',\n        ebTitle: 'Tags',\n      },\n      // Extra\n      groupExtra: {\n        type: 'null',\n        ebType: 'group-flatten',\n        ebTitle: 'Extra',\n      },\n      resourceType: {\n        type: 'string',\n        ebType: 'resourceType',\n        ebTitle: 'Resource Type',\n        ebOptionsBlankAuto: true,\n        notEmpty: true,\n      },\n      resourceSorting: {\n        type: 'number',\n        ebType: 'text',\n        ebTitle: 'Sorting',\n      },\n      atomStaticKey: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'KeyForAtom',\n        ebReadOnly: true,\n        notEmpty: true,\n      },\n    },\n  };\n\n  // resource search\n  schemas.resourceSearch = {\n    type: 'object',\n    properties: {\n    },\n  };\n\n  return schemas;\n};\n","module.exports = app => {\n\n  class AtomController extends app.Controller {\n\n    async preferredRoles() {\n      const res = await this.ctx.service.atom.preferredRoles({\n        atomClass: this.ctx.request.body.atomClass,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n    async create() {\n      const res = await this.ctx.service.atom.create({\n        atomClass: this.ctx.request.body.atomClass,\n        roleIdOwner: this.ctx.request.body.roleIdOwner,\n        item: this.ctx.request.body.item,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async read() {\n      const res = await this.ctx.service.atom.read({\n        key: this.ctx.request.body.key,\n        options: this.ctx.request.body.options,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    // options\n    //   where, orders, page, star, label\n    async select() {\n      const options = this.ctx.request.body.options;\n      options.page = this.ctx.bean.util.page(options.page);\n      const items = await this.ctx.service.atom.select({\n        atomClass: this.ctx.request.body.atomClass,\n        options,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.successMore(items, options.page.index, options.page.size);\n    }\n\n    async count() {\n      const options = this.ctx.request.body.options;\n      const count = await this.ctx.service.atom.count({\n        atomClass: this.ctx.request.body.atomClass,\n        options,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(count);\n    }\n\n    async write() {\n      await this.ctx.service.atom.write({\n        key: this.ctx.request.body.key,\n        item: this.ctx.request.body.item,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success();\n    }\n\n    async openDraft() {\n      const res = await this.ctx.service.atom.openDraft({\n        key: this.ctx.request.body.key,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async submit() {\n      const options = this.ctx.request.body.options || {};\n      if (!app.meta.isTest) {\n        options.ignoreFlow = false;\n      }\n      // submit\n      const res = await this.ctx.service.atom.submit({\n        key: this.ctx.request.body.key,\n        options,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async writeSubmit() {\n      // write\n      await this.ctx.service.atom.write({\n        key: this.ctx.request.body.key,\n        item: this.ctx.request.body.item,\n        user: this.ctx.state.user.op,\n      });\n      // submit\n      await this.submit();\n    }\n\n    async delete() {\n      await this.ctx.service.atom.delete({\n        key: this.ctx.request.body.key,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success();\n    }\n\n    async deleteBulk() {\n      const res = await this.ctx.service.atom.deleteBulk({\n        atomClass: this.ctx.request.body.atomClass,\n        keys: this.ctx.request.body.keys,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async clone() {\n      const res = await this.ctx.service.atom.clone({\n        key: this.ctx.request.body.key,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async enable() {\n      const res = await this.ctx.service.atom.enable({\n        key: this.ctx.request.body.key,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async disable() {\n      const res = await this.ctx.service.atom.disable({\n        key: this.ctx.request.body.key,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async exportBulk() {\n      const res = await this.ctx.service.atom.exportBulk({\n        atomClass: this.ctx.request.body.atomClass,\n        options: this.ctx.request.body.options,\n        fields: this.ctx.request.body.fields,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async star() {\n      const res = await this.ctx.service.atom.star({\n        key: this.ctx.request.body.key,\n        atom: this.ctx.request.body.atom,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async readCount() {\n      const res = await this.ctx.service.atom.readCount({\n        key: this.ctx.request.body.key,\n        atom: this.ctx.request.body.atom,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async stats() {\n      const res = await this.ctx.service.atom.stats({\n        atomIds: this.ctx.request.body.atomIds,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async labels() {\n      const res = await this.ctx.service.atom.labels({\n        key: this.ctx.request.body.key,\n        atom: this.ctx.request.body.atom,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async actions() {\n      const res = await this.ctx.service.atom.actions({\n        key: this.ctx.request.body.key,\n        basic: this.ctx.request.body.basic,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async actionsBulk() {\n      const res = await this.ctx.service.atom.actionsBulk({\n        atomClass: this.ctx.request.body.atomClass,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async checkRightAction() {\n      const res = await this.ctx.service.atom.checkRightAction({\n        key: this.ctx.request.body.key,\n        action: this.ctx.request.body.action,\n        stage: this.ctx.request.body.stage,\n        user: this.ctx.state.user.op,\n        checkFlow: this.ctx.request.body.checkFlow,\n      });\n      this.ctx.success(res);\n    }\n\n    async schema() {\n      const res = await this.ctx.service.atom.schema({\n        atomClass: this.ctx.request.body.atomClass,\n        schema: this.ctx.request.body.schema,\n      });\n      this.ctx.success(res);\n    }\n\n    async validator() {\n      const res = await this.ctx.service.atom.validator({\n        atomClass: this.ctx.request.body.atomClass,\n      });\n      this.ctx.success(res);\n    }\n\n  }\n  return AtomController;\n};\n\n","module.exports = app => {\n\n  class AtomActionController extends app.Controller {\n  }\n\n  return AtomActionController;\n};\n","module.exports = app => {\n\n  class AtomClassController extends app.Controller {\n\n    async validatorSearch() {\n      const res = await this.ctx.service.atomClass.validatorSearch({\n        atomClass: this.ctx.request.body.atomClass,\n      });\n      this.ctx.success(res);\n    }\n\n    async checkRightCreate() {\n      const res = await this.ctx.service.atomClass.checkRightCreate({\n        atomClass: this.ctx.request.body.atomClass,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async atomClass() {\n      const res = await this.ctx.service.atomClass.atomClass({\n        atomClass: this.ctx.request.body.atomClass,\n      });\n      this.ctx.success(res);\n    }\n\n  }\n\n  return AtomClassController;\n};\n","module.exports = app => {\n\n  class AuthController extends app.Controller {\n\n    // return current user auth info\n    //   { op:{id},agent:{id},provider}\n    async echo() {\n      const info = await this.ctx.bean.auth.echo();\n      this.ctx.success(info);\n    }\n\n    async check() {\n      const info = await this.ctx.bean.auth.check();\n      this.ctx.success(info);\n    }\n\n    async logout() {\n      const info = await this.ctx.bean.auth.logout();\n      this.ctx.success(info);\n    }\n\n  }\n\n  return AuthController;\n};\n","const require3 = require('require3');\nconst qr = require3('qr-image');\n\nmodule.exports = app => {\n\n  class BaseController extends app.Controller {\n\n    modules() {\n      const res = this.ctx.service.base.modules();\n      this.ctx.success(res);\n    }\n\n    locales() {\n      const res = this.ctx.service.base.locales();\n      this.ctx.success(res);\n    }\n\n    resourceTypes() {\n      const res = this.ctx.service.base.resourceTypes();\n      this.ctx.success(res);\n    }\n\n    atomClasses() {\n      const res = this.ctx.service.base.atomClasses();\n      this.ctx.success(res);\n    }\n\n    actions() {\n      const res = this.ctx.service.base.actions();\n      this.ctx.success(res);\n    }\n\n    themes() {\n      const res = this.ctx.service.base.themes();\n      this.ctx.success(res);\n    }\n\n    async performAction() {\n      // params\n      const params = JSON.parse(this.ctx.request.query.params);\n      // force innerAccess as false\n      params.innerAccess = false;\n      // performAction\n      const res = await this.ctx.performAction(params);\n      this.ctx.success(res);\n    }\n\n    async qrcode() {\n      const query = this.ctx.request.query;\n      const img = qr.image(query.text || '', {\n        type: query.type || 'png',\n        size: query.size || 10,\n        margin: query.margin || 4,\n        ec_level: query.ec_level || 'M',\n      });\n      // ok\n      this.ctx.status = 200;\n      this.ctx.type = 'image/png';\n      this.ctx.body = img;\n    }\n\n  }\n\n  return BaseController;\n};\n","module.exports = app => {\n\n  class CategoryController extends app.Controller {\n\n    async child() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const res = await this.ctx.service.category.child({\n        atomClass,\n        language: this.ctx.request.body.language,\n        categoryId: this.ctx.request.body.categoryId,\n        categoryName: this.ctx.request.body.categoryName,\n        categoryHidden: this.ctx.request.body.categoryHidden,\n        categoryFlag: this.ctx.request.body.categoryFlag,\n        setLocale: this.ctx.request.body.setLocale,\n      });\n      this.ctx.success(res);\n    }\n\n    async children() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const list = await this.ctx.service.category.children({\n        atomClass,\n        language: this.ctx.request.body.language,\n        categoryId: this.ctx.request.body.categoryId,\n        categoryName: this.ctx.request.body.categoryName,\n        categoryHidden: this.ctx.request.body.categoryHidden,\n        categoryFlag: this.ctx.request.body.categoryFlag,\n        setLocale: this.ctx.request.body.setLocale,\n      });\n      this.ctx.success({ list });\n    }\n\n    async add() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const res = await this.ctx.service.category.add({\n        atomClass,\n        data: this.ctx.request.body.data,\n      });\n      this.ctx.success(res);\n    }\n\n    async delete() {\n      // need not param:atomClass\n      const res = await this.ctx.service.category.delete({\n        categoryId: this.ctx.request.body.categoryId,\n      });\n      this.ctx.success(res);\n    }\n\n    async move() {\n      // need not param:atomClass\n      const res = await this.ctx.service.category.move({\n        categoryId: this.ctx.request.body.categoryId,\n        categoryIdParent: this.ctx.request.body.categoryIdParent,\n      });\n      this.ctx.success(res);\n    }\n\n    async item() {\n      // need not param:atomClass\n      const data = await this.ctx.service.category.item({\n        categoryId: this.ctx.request.body.categoryId,\n        setLocale: this.ctx.request.body.setLocale,\n      });\n      this.ctx.success(data);\n    }\n\n    async save() {\n      // need not param:atomClass\n      const res = await this.ctx.service.category.save({\n        categoryId: this.ctx.request.body.categoryId,\n        data: this.ctx.request.body.data,\n      });\n      this.ctx.success(res);\n    }\n\n    async tree() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const list = await this.ctx.service.category.tree({\n        atomClass,\n        language: this.ctx.request.body.language,\n        categoryId: this.ctx.request.body.categoryId,\n        categoryHidden: this.ctx.request.body.categoryHidden,\n        categoryFlag: this.ctx.request.body.categoryFlag,\n        setLocale: this.ctx.request.body.setLocale,\n      });\n      this.ctx.success({ list });\n    }\n\n    async relativeTop() {\n      // need not param:atomClass\n      const res = await this.ctx.service.category.relativeTop({\n        categoryId: this.ctx.request.body.categoryId,\n        setLocale: this.ctx.request.body.setLocale,\n      });\n      this.ctx.success(res);\n    }\n\n  }\n  return CategoryController;\n};\n\n","module.exports = app => {\n\n  class CommentController extends app.Controller {\n\n    async all() {\n      const options = this.ctx.request.body.options;\n      options.comment = 1;\n      const res = await this.ctx.performAction({\n        method: 'post',\n        url: '/a/base/atom/select',\n        body: {\n          atomClass: this.ctx.request.body.atomClass,\n          options,\n        },\n      });\n      this.ctx.success(res);\n    }\n\n    async list() {\n      const options = this.ctx.request.body.options;\n      options.page = this.ctx.bean.util.page(options.page);\n      const items = await this.ctx.service.comment.list({\n        key: this.ctx.request.body.key,\n        options,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.successMore(items, options.page.index, options.page.size);\n    }\n\n    async item() {\n      const res = await this.ctx.service.comment.item({\n        key: this.ctx.request.body.key,\n        data: this.ctx.request.body.data,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async save() {\n      const res = await this.ctx.service.comment.save({\n        key: this.ctx.request.body.key,\n        data: this.ctx.request.body.data,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async delete() {\n      const res = await this.ctx.service.comment.delete({\n        key: this.ctx.request.body.key,\n        data: this.ctx.request.body.data,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async heart() {\n      const res = await this.ctx.service.comment.heart({\n        key: this.ctx.request.body.key,\n        data: this.ctx.request.body.data,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n  }\n  return CommentController;\n};\n","module.exports = app => {\n\n  class JwtController extends app.Controller {\n\n    async create() {\n      const res = await this.ctx.service.jwt.create({\n        scene: this.ctx.request.body.scene,\n      });\n      this.ctx.success(res);\n    }\n\n  }\n  return JwtController;\n};\n\n","module.exports = app => {\n  class LayoutConfigController extends app.Controller {\n\n    async load() {\n      const res = await this.service.layoutConfig.load({\n        module: this.ctx.request.body.module,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async save() {\n      const res = await this.service.layoutConfig.save({\n        module: this.ctx.request.body.module,\n        data: this.ctx.request.body.data,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async saveKey() {\n      const res = await this.service.layoutConfig.saveKey({\n        module: this.ctx.request.body.module,\n        key: this.ctx.request.body.key,\n        value: this.ctx.request.body.value,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n  }\n  return LayoutConfigController;\n};\n","module.exports = app => {\n\n  class ResourceController extends app.Controller {\n\n    // options\n    //   where, orders, page, star, label, resourceType, locale\n    async select() {\n      const options = this.ctx.request.body.options || {};\n      options.page = this.ctx.bean.util.page(options.page, false); // false\n      const items = await this.ctx.service.resource.select({\n        options,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.successMore(items, options.page.index, options.page.size);\n    }\n\n    async check() {\n      const res = await this.ctx.service.resource.check({\n        atomStaticKeys: this.ctx.request.body.atomStaticKeys,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async resourceRoles() {\n      const list = await this.ctx.service.resource.resourceRoles({\n        key: this.ctx.request.body.key,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success({ list });\n    }\n\n    async resourceRoleRemove() {\n      const res = await this.ctx.service.resource.resourceRoleRemove({\n        key: this.ctx.request.body.key,\n        data: this.ctx.request.body.data,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async resourceRoleAdd() {\n      const res = await this.ctx.service.resource.resourceRoleAdd({\n        key: this.ctx.request.body.key,\n        data: this.ctx.request.body.data,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n  }\n\n  return ResourceController;\n};\n","module.exports = app => {\n\n  class TagController extends app.Controller {\n\n    async list() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const list = await this.ctx.service.tag.list({\n        atomClass,\n        options: this.ctx.request.body.options,\n      });\n      this.ctx.success({ list });\n    }\n\n    async add() {\n      const atomClass = this.ctx.request.body.atomClass;\n      const res = await this.ctx.service.tag.add({\n        atomClass,\n        data: this.ctx.request.body.data,\n      });\n      this.ctx.success(res);\n    }\n\n    async save() {\n      // need not param:atomClass\n      const res = await this.ctx.service.tag.save({\n        tagId: this.ctx.request.body.tagId,\n        data: this.ctx.request.body.data,\n      });\n      this.ctx.success(res);\n    }\n\n    async delete() {\n      // need not param:atomClass\n      const res = await this.ctx.service.tag.delete({\n        tagId: this.ctx.request.body.tagId,\n      });\n      this.ctx.success(res);\n    }\n\n  }\n  return TagController;\n};\n\n","module.exports = app => {\n\n  class UserController extends app.Controller {\n\n    async getLabels() {\n      const res = await this.ctx.service.user.getLabels({\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async setLabels() {\n      await this.ctx.service.user.setLabels({\n        labels: this.ctx.request.body.labels,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success();\n    }\n\n  }\n  return UserController;\n};\n\n","const atom = require('./controller/atom.js');\nconst atomAction = require('./controller/atomAction.js');\nconst atomClass = require('./controller/atomClass.js');\nconst auth = require('./controller/auth.js');\nconst base = require('./controller/base.js');\nconst comment = require('./controller/comment.js');\nconst resource = require('./controller/resource.js');\nconst jwt = require('./controller/jwt.js');\nconst layoutConfig = require('./controller/layoutConfig.js');\nconst user = require('./controller/user.js');\nconst category = require('./controller/category.js');\nconst tag = require('./controller/tag.js');\n\nmodule.exports = app => {\n  const controllers = {\n    atom,\n    atomAction,\n    atomClass,\n    auth,\n    base,\n    comment,\n    resource,\n    jwt,\n    layoutConfig,\n    user,\n    category,\n    tag,\n  };\n  return controllers;\n};\n","const config = require('./config/config.js');\nconst locales = require('./config/locales.js');\nconst errors = require('./config/errors.js');\nconst AtomBaseFn = require('./common/atomBase.js');\n\n// eslint-disable-next-line\nmodule.exports = app => {\n\n  // atomBase\n  app.meta.AtomBase = AtomBaseFn(app);\n\n  // beans\n  const beans = require('./beans.js')(app);\n  // routes\n  const routes = require('./routes.js')(app);\n  // controllers\n  const controllers = require('./controllers.js')(app);\n  // services\n  const services = require('./services.js')(app);\n  // models\n  const models = require('./models.js')(app);\n  // constants\n  const constants = require('./config/constants.js')(app);\n  // meta\n  const meta = require('./meta.js')(app);\n\n  return {\n    beans,\n    routes,\n    controllers,\n    services,\n    models,\n    config,\n    locales,\n    errors,\n    constants,\n    meta,\n  };\n\n};\n","module.exports = app => {\n  // const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  // keywords\n  const keywords = require('./config/validation/keywords.js')(app);\n  // schemas\n  const schemas = require('./config/validation/schemas.js')(app);\n  // static\n  const staticResources = require('./config/static/resources.js')(app);\n  // meta\n  const meta = {\n    base: {\n      atoms: {\n        resource: {\n          info: {\n            bean: 'resource',\n            title: 'Resource',\n            tableName: 'aResource',\n            tableNameModes: {\n            },\n            category: true,\n            tag: true,\n          },\n          actions: {\n            write: {\n              enableOnStatic: true,\n            },\n          },\n          validator: 'resource',\n          search: {\n            validator: 'resourceSearch',\n          },\n        },\n      },\n      resources: {\n        function: {\n          title: 'Function',\n          validator: null,\n        },\n        menu: {\n          title: 'Menu',\n        },\n        mine: {\n          title: 'Mine',\n        },\n      },\n      statics: {\n        'a-base.resource': {\n          items: staticResources,\n        },\n      },\n    },\n    sequence: {\n      providers: {\n        draft: {\n          bean: {\n            module: 'a-sequence',\n            name: 'simple',\n          },\n          start: 0,\n        },\n        userName: {\n          bean: {\n            module: 'a-sequence',\n            name: 'simple',\n          },\n          start: 0,\n        },\n      },\n    },\n    validation: {\n      validators: {\n        user: {\n          schemas: 'user',\n        },\n        category: {\n          schemas: 'category',\n        },\n        resource: {\n          schemas: 'resource',\n        },\n        resourceSearch: {\n          schemas: 'resourceSearch',\n        },\n      },\n      keywords: {\n        'x-exists': keywords.exists,\n      },\n      schemas: {\n        user: schemas.user,\n        category: schemas.category,\n        resource: schemas.resource,\n        resourceSearch: schemas.resourceSearch,\n      },\n    },\n    event: {\n      declarations: {\n        loginInfo: 'Login Info',\n        userVerify: 'User Verify',\n        accountMigration: 'Account Migration',\n      },\n    },\n    stats: {\n      providers: {\n        drafts: {\n          user: true,\n          bean: 'drafts',\n        },\n        stars: {\n          user: true,\n          bean: 'stars',\n        },\n      },\n    },\n  };\n  return meta;\n};\n","module.exports = app => {\n\n  class Atom extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aAtom', options: { disableDeleted: false } });\n    }\n\n  }\n\n  return Atom;\n};\n","module.exports = app => {\n\n  class AtomAction extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aAtomAction', options: { disableDeleted: false } });\n    }\n\n  }\n\n  return AtomAction;\n};\n","module.exports = app => {\n\n  class AtomClass extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aAtomClass', options: { disableDeleted: false } });\n    }\n\n  }\n\n  return AtomClass;\n};\n","module.exports = app => {\n\n  class AtomLabel extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aAtomLabel', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return AtomLabel;\n};\n","module.exports = app => {\n\n  class AtomLabelRef extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aAtomLabelRef', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return AtomLabelRef;\n};\n","module.exports = app => {\n\n  class AtomStar extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aAtomStar', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return AtomStar;\n};\n","module.exports = app => {\n\n  class Auth extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aAuth', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return Auth;\n};\n","module.exports = app => {\n\n  class AuthProvider extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aAuthProvider', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return AuthProvider;\n};\n","module.exports = app => {\n  class Category extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aCategory', options: { disableDeleted: false } });\n    }\n  }\n  return Category;\n};\n","module.exports = app => {\n\n  class Comment extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aComment', options: { disableDeleted: false } });\n    }\n\n  }\n\n  return Comment;\n};\n","module.exports = app => {\n\n  class CommentHeart extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aCommentHeart', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return CommentHeart;\n};\n","module.exports = app => {\n\n  class CommentView extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aViewComment', options: { disableDeleted: false } });\n    }\n\n  }\n\n  return CommentView;\n};\n","module.exports = app => {\n\n  class Label extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aLabel', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return Label;\n};\n","module.exports = app => {\n  class Resource extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aResource', options: { disableDeleted: false } });\n    }\n  }\n  return Resource;\n};\n","module.exports = app => {\n  class ResourceLocale extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aResourceLocale', options: { disableDeleted: true } });\n    }\n  }\n  return ResourceLocale;\n};\n","module.exports = app => {\n  class ResourceRole extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aResourceRole', options: { disableDeleted: true } });\n    }\n  }\n  return ResourceRole;\n};\n","module.exports = app => {\n\n  class Role extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aRole', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return Role;\n};\n","module.exports = app => {\n\n  class RoleInc extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aRoleInc', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return RoleInc;\n};\n","module.exports = app => {\n\n  class RoleIncRef extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aRoleIncRef', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return RoleIncRef;\n};\n","module.exports = app => {\n\n  class RoleRef extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aRoleRef', options: { disableDeleted: true } });\n    }\n\n    async getParent({ roleId, level = 1 }) {\n      const roleRef = await this.get({\n        roleId,\n        level,\n      });\n      return roleRef;\n    }\n\n  }\n\n  return RoleRef;\n};\n","module.exports = app => {\n\n  class RoleRight extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aRoleRight', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return RoleRight;\n};\n","module.exports = app => {\n\n  class RoleRightRef extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aRoleRightRef', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return RoleRightRef;\n};\n","module.exports = app => {\n  class Tag extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aTag', options: { disableDeleted: false } });\n    }\n  }\n  return Tag;\n};\n","module.exports = app => {\n  class TagRef extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aTagRef', options: { disableDeleted: true } });\n    }\n  }\n  return TagRef;\n};\n","module.exports = app => {\n\n  class User extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aUser', options: { disableDeleted: false } });\n    }\n\n  }\n\n  return User;\n};\n","module.exports = app => {\n\n  class UserAgent extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aUserAgent', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return UserAgent;\n};\n","module.exports = app => {\n\n  class UserRole extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aUserRole', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return UserRole;\n};\n","const atom = require('./model/atom.js');\nconst atomAction = require('./model/atomAction.js');\nconst atomClass = require('./model/atomClass.js');\nconst auth = require('./model/auth.js');\nconst authProvider = require('./model/authProvider.js');\nconst role = require('./model/role.js');\nconst roleInc = require('./model/roleInc.js');\nconst roleIncRef = require('./model/roleIncRef.js');\nconst roleRef = require('./model/roleRef.js');\nconst roleRight = require('./model/roleRight.js');\nconst roleRightRef = require('./model/roleRightRef.js');\nconst user = require('./model/user.js');\nconst userAgent = require('./model/userAgent.js');\nconst userRole = require('./model/userRole.js');\nconst label = require('./model/label.js');\nconst atomLabel = require('./model/atomLabel.js');\nconst atomLabelRef = require('./model/atomLabelRef.js');\nconst atomStar = require('./model/atomStar.js');\nconst comment = require('./model/comment.js');\nconst commentView = require('./model/commentView.js');\nconst commentHeart = require('./model/commentHeart.js');\nconst category = require('./model/category.js');\nconst tag = require('./model/tag.js');\nconst tagRef = require('./model/tagRef.js');\nconst resource = require('./model/resource.js');\nconst resourceLocale = require('./model/resourceLocale.js');\nconst resourceRole = require('./model/resourceRole.js');\n\n\nmodule.exports = app => {\n  const models = {\n    atom,\n    atomAction,\n    atomClass,\n    auth,\n    authProvider,\n    role,\n    roleInc,\n    roleIncRef,\n    roleRef,\n    roleRight,\n    roleRightRef,\n    user,\n    userAgent,\n    userRole,\n    label,\n    atomLabel,\n    atomLabelRef,\n    atomStar,\n    comment,\n    commentView,\n    commentHeart,\n    category,\n    tag,\n    tagRef,\n    resource,\n    resourceLocale,\n    resourceRole,\n  };\n  return models;\n};\n","module.exports = app => {\n  const routes = [\n    // base\n    { method: 'post', path: 'base/modules', controller: 'base' },\n    { method: 'post', path: 'base/locales', controller: 'base' },\n    { method: 'post', path: 'base/resourceTypes', controller: 'base' },\n    { method: 'post', path: 'base/atomClasses', controller: 'base' },\n    { method: 'post', path: 'base/actions', controller: 'base' },\n    { method: 'get', path: 'base/performAction', controller: 'base', middlewares: 'jsonp', meta: { auth: { enable: false } } },\n    { method: 'get', path: 'base/qrcode', controller: 'base', meta: { auth: { enable: false } } },\n    { method: 'post', path: 'base/themes', controller: 'base' },\n    // atom\n    { method: 'post', path: 'atom/preferredRoles', controller: 'atom' },\n    { method: 'post', path: 'atom/create', controller: 'atom', middlewares: 'transaction',\n      meta: { right: { type: 'atom', action: 1 } },\n    },\n    { method: 'post', path: 'atom/read', controller: 'atom',\n      meta: { right: { type: 'atom', action: 2 } },\n    },\n    { method: 'post', path: 'atom/select', controller: 'atom' },\n    { method: 'post', path: 'atom/count', controller: 'atom' },\n    { method: 'post', path: 'atom/write', controller: 'atom', middlewares: 'transaction',\n      meta: { right: { type: 'atom', action: 3, stage: 'draft' } },\n    },\n    { method: 'post', path: 'atom/openDraft', controller: 'atom', middlewares: 'transaction',\n      meta: { right: { type: 'atom', action: 3 } },\n    },\n    { method: 'post', path: 'atom/submit', controller: 'atom', middlewares: 'transaction',\n      meta: { right: { type: 'atom', action: 3, stage: 'draft' } },\n    },\n    { method: 'post', path: 'atom/writeSubmit', controller: 'atom', middlewares: 'transaction',\n      meta: { right: { type: 'atom', action: 3, stage: 'draft' } },\n    },\n    { method: 'post', path: 'atom/delete', controller: 'atom', middlewares: 'transaction',\n      meta: { right: { type: 'atom', action: 4 } },\n    },\n    { method: 'post', path: 'atom/clone', controller: 'atom', middlewares: 'transaction',\n      meta: { right: { type: 'atom', action: 5 } },\n    },\n    { method: 'post', path: 'atom/enable', controller: 'atom', middlewares: 'transaction',\n      meta: { right: { type: 'atom', action: 6 } },\n    },\n    { method: 'post', path: 'atom/disable', controller: 'atom', middlewares: 'transaction',\n      meta: { right: { type: 'atom', action: 7 } },\n    },\n    {\n      method: 'post', path: 'atom/deleteBulk', controller: 'atom', middlewares: 'transaction',\n      meta: { right: { type: 'atom', action: 35 } },\n    },\n    {\n      method: 'post', path: 'atom/exportBulk', controller: 'atom',\n      meta: { right: { type: 'atom', action: 36 } },\n    },\n    { method: 'post', path: 'atom/star', controller: 'atom',\n      meta: {\n        auth: { user: true },\n        right: { type: 'atom', action: 2 },\n      },\n    },\n    { method: 'post', path: 'atom/readCount', controller: 'atom',\n      meta: { right: { type: 'atom', action: 2, checkFlow: true } },\n    },\n    { method: 'post', path: 'atom/stats', controller: 'atom' },\n    { method: 'post', path: 'atom/labels', controller: 'atom',\n      meta: {\n        auth: { user: true },\n        right: { type: 'atom', action: 2 },\n      },\n    },\n    { method: 'post', path: 'atom/actions', controller: 'atom' },\n    { method: 'post', path: 'atom/actionsBulk', controller: 'atom' },\n    { method: 'post', path: 'atom/schema', controller: 'atom' },\n    { method: 'post', path: 'atom/validator', controller: 'atom' },\n    { method: 'post', path: 'atom/checkRightAction', controller: 'atom' },\n    // comment\n    { method: 'post', path: 'comment/all', controller: 'comment' },\n    { method: 'post', path: 'comment/list', controller: 'comment',\n      meta: { right: { type: 'atom', action: 2, checkFlow: true } },\n    },\n    { method: 'post', path: 'comment/item', controller: 'comment',\n      meta: { right: { type: 'atom', action: 2, checkFlow: true } },\n    },\n    { method: 'post', path: 'comment/save', controller: 'comment', middlewares: 'transaction',\n      meta: {\n        auth: { user: true },\n        right: { type: 'atom', action: 2, checkFlow: true },\n      },\n    },\n    { method: 'post', path: 'comment/delete', controller: 'comment', middlewares: 'transaction',\n      meta: {\n        auth: { user: true },\n        right: { type: 'atom', action: 2, checkFlow: true },\n      },\n    },\n    { method: 'post', path: 'comment/heart', controller: 'comment', middlewares: 'transaction',\n      meta: {\n        auth: { user: true },\n        right: { type: 'atom', action: 2, checkFlow: true },\n      },\n    },\n    // user\n    { method: 'post', path: 'user/getLabels', controller: 'user' },\n    { method: 'post', path: 'user/setLabels', controller: 'user' },\n    // resource\n    { method: 'post', path: 'resource/select', controller: 'resource' },\n    { method: 'post', path: 'resource/check', controller: 'resource' },\n    { method: 'post', path: 'resource/resourceRoles', controller: 'resource',\n      meta: { right: { type: 'atom', action: 25 } },\n    },\n    { method: 'post', path: 'resource/resourceRoleRemove', controller: 'resource',\n      meta: { right: { type: 'atom', action: 25 } },\n    },\n    { method: 'post', path: 'resource/resourceRoleAdd', controller: 'resource',\n      meta: { right: { type: 'atom', action: 25 } },\n    },\n    // atomClass\n    { method: 'post', path: 'atomClass/validatorSearch', controller: 'atomClass' },\n    { method: 'post', path: 'atomClass/checkRightCreate', controller: 'atomClass' },\n    { method: 'post', path: 'atomClass/atomClass', controller: 'atomClass' },\n    // auth\n    { method: 'post', path: 'auth/echo', controller: 'auth', meta: { auth: { enable: false } } },\n    { method: 'post', path: 'auth/check', controller: 'auth', meta: { auth: { user: true } } },\n    { method: 'post', path: 'auth/logout', controller: 'auth', meta: { auth: { enable: false } } },\n    // cors\n    { method: 'options', path: /.*/ },\n    // jwt\n    { method: 'post', path: 'jwt/create', controller: 'jwt' },\n    // layoutConfig\n    { method: 'post', path: 'layoutConfig/load', controller: 'layoutConfig' },\n    { method: 'post', path: 'layoutConfig/save', controller: 'layoutConfig' },\n    { method: 'post', path: 'layoutConfig/saveKey', controller: 'layoutConfig' },\n    // category\n    { method: 'post', path: 'category/child', controller: 'category' }, // not set function right\n    { method: 'post', path: 'category/children', controller: 'category' }, // not set function right\n    { method: 'post', path: 'category/add', controller: 'category', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'category/delete', controller: 'category', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'category/move', controller: 'category', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'category/item', controller: 'category', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'category/save', controller: 'category', middlewares: 'validate', meta: {\n      validate: { module: 'a-base', validator: 'category' },\n      right: { type: 'resource', module: 'a-settings', name: 'settings' },\n    } },\n    { method: 'post', path: 'category/tree', controller: 'category' }, // not set function right\n    { method: 'post', path: 'category/relativeTop', controller: 'category' }, // not set function right\n    // tag\n    { method: 'post', path: 'tag/list', controller: 'tag' },\n    { method: 'post', path: 'tag/add', controller: 'tag', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'tag/save', controller: 'tag', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n    { method: 'post', path: 'tag/delete', controller: 'tag', meta: { right: { type: 'resource', module: 'a-settings', name: 'settings' } } },\n\n  ];\n  return routes;\n};\n","module.exports = app => {\n\n  class Atom extends app.Service {\n\n    async preferredRoles({ atomClass, user }) {\n      return await this.ctx.bean.atom.preferredRoles({ atomClass, user });\n    }\n\n    async create({ atomClass, roleIdOwner, item, user }) {\n      return await this.ctx.bean.atom.create({ atomClass, roleIdOwner, item, user });\n    }\n\n    async read({ key, options, user }) {\n      return await this.ctx.bean.atom.read({ key, options, user });\n    }\n\n    async select({ atomClass, options, user }) {\n      return await this.ctx.bean.atom.select({ atomClass, options, user });\n    }\n\n    async count({ atomClass, options, user }) {\n      return await this.ctx.bean.atom.count({ atomClass, options, user });\n    }\n\n    async write({ key, item, user }) {\n      return await this.ctx.bean.atom.write({ key, item, user });\n    }\n\n    async openDraft({ key, user }) {\n      return await this.ctx.bean.atom.openDraft({ key, user });\n    }\n\n    async submit({ key, options, user }) {\n      return await this.ctx.bean.atom.submit({ key, options, user });\n    }\n\n    async delete({ key, user }) {\n      return await this.ctx.bean.atom.delete({ key, user });\n    }\n\n    async deleteBulk({ keys, user }) {\n      return await this.ctx.bean.atom.deleteBulk({ keys, user });\n    }\n\n    async clone({ key, user }) {\n      return await this.ctx.bean.atom.clone({ key, user });\n    }\n\n    async enable({ key, user }) {\n      return await this.ctx.bean.atom.enable({ key, user });\n    }\n\n    async disable({ key, user }) {\n      return await this.ctx.bean.atom.disable({ key, user });\n    }\n\n    async exportBulk({ atomClass, options, fields, user }) {\n      return await this.ctx.bean.atom.exportBulk({ atomClass, options, fields, user });\n    }\n\n    async star({ key, atom, user }) {\n      return await this.ctx.bean.atom.star({ key, atom, user });\n    }\n\n    async readCount({ key, atom, user }) {\n      return await this.ctx.bean.atom.readCount({ key, atom, user });\n    }\n\n    async stats({ atomIds, user }) {\n      return await this.ctx.bean.atom.stats({ atomIds, user });\n    }\n\n    async labels({ key, atom, user }) {\n      return await this.ctx.bean.atom.labels({ key, atom, user });\n    }\n\n    async actions({ key, basic, user }) {\n      return await this.ctx.bean.atom.actions({ key, basic, user });\n    }\n\n    async actionsBulk({ atomClass, user }) {\n      return await this.ctx.bean.atom.actionsBulk({ atomClass, user });\n    }\n\n    async checkRightAction({ key, action, stage, user, checkFlow }) {\n      return await this.ctx.bean.atom.checkRightAction({ atom: { id: key.atomId }, action, stage, user, checkFlow });\n    }\n\n    async schema({ atomClass, schema }) {\n      return await this.ctx.bean.atom.schema({ atomClass, schema });\n    }\n\n    async validator({ atomClass }) {\n      return await this.ctx.bean.atom.validator({ atomClass });\n    }\n\n  }\n\n  return Atom;\n};\n","module.exports = app => {\n\n  class AtomAction extends app.Service {\n  }\n\n  return AtomAction;\n};\n","module.exports = app => {\n\n  class AtomClass extends app.Service {\n\n    async validatorSearch({ atomClass }) {\n      return await this.ctx.bean.atomClass.validatorSearch({ atomClass });\n    }\n\n    async checkRightCreate({ atomClass, user }) {\n      return await this.ctx.bean.atom.checkRightCreate({ atomClass, user });\n    }\n\n    async atomClass({ atomClass }) {\n      return await this.ctx.bean.atomClass.get(atomClass);\n    }\n\n  }\n\n  return AtomClass;\n};\n","module.exports = app => {\n\n  class Auth extends app.Service {\n  }\n\n  return Auth;\n};\n","module.exports = app => {\n\n  class Base extends app.Service {\n\n    modules() {\n      return this.ctx.bean.base.modules();\n    }\n\n    locales() {\n      return this.ctx.bean.base.locales();\n    }\n\n    resourceTypes() {\n      return this.ctx.bean.base.resourceTypes();\n    }\n\n    atomClasses() {\n      return this.ctx.bean.base.atomClasses();\n    }\n\n    actions() {\n      return this.ctx.bean.base.actions();\n    }\n\n    themes() {\n      return this.ctx.bean.base.themes();\n    }\n\n  }\n\n  return Base;\n};\n","module.exports = app => {\n\n  class Category extends app.Service {\n\n    async child({ atomClass, language, categoryId, categoryName, categoryHidden, categoryFlag, setLocale }) {\n      return await this.ctx.bean.category.child({ atomClass, language, categoryId, categoryName, categoryHidden, categoryFlag, setLocale });\n    }\n\n    async children({ atomClass, language, categoryId, categoryName, categoryHidden, categoryFlag, setLocale }) {\n      return await this.ctx.bean.category.children({ atomClass, language, categoryId, categoryName, categoryHidden, categoryFlag, setLocale });\n    }\n\n    async add({ atomClass, data }) {\n      return await this.ctx.bean.category.add({ atomClass, data });\n    }\n\n    async delete({ categoryId }) {\n      return await this.ctx.bean.category.delete({ categoryId });\n    }\n\n    async move({ categoryId, categoryIdParent }) {\n      return await this.ctx.bean.category.move({ categoryId, categoryIdParent });\n    }\n\n    async item({ categoryId, setLocale }) {\n      return await this.ctx.bean.category.get({ categoryId, setLocale });\n    }\n\n    async save({ categoryId, data }) {\n      return await this.ctx.bean.category.save({ categoryId, data });\n    }\n\n    async tree({ atomClass, language, categoryId, categoryHidden, categoryFlag, setLocale }) {\n      return await this.ctx.bean.category.tree({ atomClass, language, categoryId, categoryHidden, categoryFlag, setLocale });\n    }\n\n    async relativeTop({ categoryId, setLocale }) {\n      return await this.ctx.bean.category.relativeTop({ categoryId, setLocale });\n    }\n\n  }\n\n  return Category;\n};\n","const require3 = require('require3');\nconst trimHtml = require3('@zhennann/trim-html');\nconst markdown = require3('@zhennann/markdown');\nconst markdonw_it_block = require3('@zhennann/markdown-it-block');\n\nmodule.exports = app => {\n\n  class Comment extends app.Service {\n\n    async list({ key, options, user }) {\n      const _options = {};\n      // where\n      _options.where = options.where || {};\n      _options.where.iid = this.ctx.instance.id;\n      _options.where.deleted = 0;\n      _options.where.atomId = key.atomId;\n      // orders\n      _options.orders = options.orders;\n      // page\n      if (options.page.size !== 0) {\n        _options.limit = options.page.size;\n        _options.offset = options.page.index;\n      }\n      // sql\n      const _where = this.ctx.model._where(_options.where);\n      const _orders = this.ctx.model._orders(_options.orders);\n      const _limit = this.ctx.model._limit(_options.limit, _options.offset);\n      const sql = `select a.*,(select d2.heart from aCommentHeart d2 where d2.iid=? and d2.commentId=a.id and d2.userId=?) as heart from aViewComment a\n         ${_where} ${_orders} ${_limit}`;\n      // select\n      return await this.ctx.model.query(sql, [ this.ctx.instance.id, user.id ]);\n    }\n\n    async item({ key, data: { commentId }, user }) {\n      const sql = `select a.*,(select d2.heart from aCommentHeart d2 where d2.iid=? and d2.commentId=a.id and d2.userId=?) as heart from aViewComment a\n         where a.iid=? and a.deleted=0 and a.id=?`;\n      // select\n      const list = await this.ctx.model.query(sql,\n        [ this.ctx.instance.id, user.id, this.ctx.instance.id, commentId ]\n      );\n      return list[0];\n    }\n\n    async save({ key, data, user }) {\n      if (!data.commentId) {\n        return await this.save_add({ key, data, user });\n      }\n      return await this.save_edit({ key, data, user });\n    }\n\n    async save_edit({ key, data: { commentId, content }, user }) {\n      // comment\n      const item = await this.ctx.model.commentView.get({ id: commentId });\n      if (key.atomId !== item.atomId || item.userId !== user.id) this.ctx.throw(403);\n      // html\n      const html = this._renderContent({\n        content,\n        replyContent: item.replyContent,\n        replyUserName: item.replyUserName,\n      });\n      // summary\n      const summary = this._trimHtml(html);\n      // update\n      await this.ctx.model.comment.update({\n        id: commentId,\n        content,\n        summary: summary.html,\n        html,\n        updatedAt: new Date(),\n      });\n      // ok\n      return {\n        action: 'update',\n        atomId: key.atomId,\n        commentId,\n      };\n    }\n\n    async save_add({ key, data: { replyId, content }, user }) {\n      // sorting\n      const list = await this.ctx.model.query(\n        'select max(sorting) as sorting from aComment where iid=? and deleted=0 and atomId=?',\n        [ this.ctx.instance.id, key.atomId ]);\n      const sorting = (list[0].sorting || 0) + 1;\n      // reply\n      let reply;\n      if (replyId) {\n        reply = await this.ctx.model.commentView.get({ id: replyId });\n      }\n      // replyContent\n      const replyContent = !reply ? '' :\n        this._fullContent({ content: reply.content, replyContent: reply.replyContent, replyUserName: reply.replyUserName });\n      // html\n      const html = this._renderContent({\n        content,\n        replyContent,\n        replyUserName: reply && reply.userName,\n      });\n      // summary\n      const summary = this._trimHtml(html);\n      // create\n      const res = await this.ctx.model.comment.insert({\n        atomId: key.atomId,\n        userId: user.id,\n        sorting,\n        heartCount: 0,\n        replyId,\n        replyUserId: reply ? reply.userId : 0,\n        replyContent,\n        content,\n        summary: summary.html,\n        html,\n      });\n      // commentCount\n      await this.ctx.bean.atom.comment({ key, atom: { comment: 1 }, user });\n      // ok\n      return {\n        action: 'create',\n        atomId: key.atomId,\n        commentId: res.insertId,\n      };\n    }\n\n    async delete({ key, data: { commentId }, user }) {\n      // comment\n      const item = await this.ctx.model.comment.get({ id: commentId });\n      // check right\n      let canDeleted = (key.atomId === item.atomId && item.userId === user.id);\n      if (!canDeleted) {\n        canDeleted = await this.ctx.bean.function.checkRightFunction({\n          function: { module: 'a-base', name: 'deleteComment' },\n          user,\n        });\n      }\n      if (!canDeleted) this.ctx.throw(403);\n      // delete hearts\n      await this.ctx.model.commentHeart.delete({ commentId });\n      // delete comment\n      await this.ctx.model.comment.delete({ id: commentId });\n      // commentCount\n      await this.ctx.bean.atom.comment({ key, atom: { comment: -1 }, user });\n      // ok\n      return {\n        action: 'delete',\n        atomId: key.atomId,\n        commentId,\n      };\n    }\n\n    async heart({ key, data: { commentId, heart }, user }) {\n      let diff = 0;\n      // check if exists\n      const _heart = await this.ctx.model.commentHeart.get({\n        userId: user.id,\n        atomId: key.atomId,\n        commentId,\n      });\n      if (_heart && !heart) {\n        diff = -1;\n        // delete\n        await this.ctx.model.commentHeart.delete({\n          id: _heart.id,\n        });\n      } else if (!_heart && heart) {\n        diff = 1;\n        // new\n        await this.ctx.model.commentHeart.insert({\n          userId: user.id,\n          atomId: key.atomId,\n          commentId,\n          heart: 1,\n        });\n      }\n      // get\n      const item = await this.ctx.model.comment.get({ id: commentId });\n      let heartCount = item.heartCount;\n      if (diff !== 0) {\n        heartCount += diff;\n        await this.ctx.model.comment.update({\n          id: commentId,\n          heartCount,\n        });\n      }\n      // ok\n      return {\n        action: 'heart',\n        atomId: key.atomId,\n        commentId,\n        heart, heartCount,\n      };\n    }\n\n    _fullContent({ content, replyContent, replyUserName }) {\n      if (!replyContent) return content;\n      return `${content}\n\n> \\`${replyUserName}\\`:\n\n::: comment-quot\n${replyContent}\n:::\n\n`;\n    }\n\n    _renderContent({ content, replyContent, replyUserName }) {\n      const _content = this._fullContent({ content, replyContent, replyUserName });\n      const md = markdown.create();\n      // block options\n      const blockOptions = {\n        utils: {\n          text: (...args) => {\n            return this.ctx.text(...args);\n          },\n        },\n      };\n      md.use(markdonw_it_block, blockOptions);\n      // render\n      return md.render(_content);\n    }\n\n    _trimHtml(html) {\n      return trimHtml(html, this.ctx.config.comment.trim);\n    }\n\n  }\n\n  return Comment;\n};\n","const require3 = require('require3');\nconst jsonwebtoken = require3('jsonwebtoken');\n\nmodule.exports = app => {\n\n  class Jwt extends app.Service {\n\n    async create({ scene = 'query' }) {\n      // check\n      if (!this.ctx.state.jwt) ctx.throw(403);\n      // token\n      const token = this.ctx.state.jwt.token;\n      // jwt payload\n      const payload = {\n        token,\n        exp: Date.now() + app.config.jwt.scene[scene].maxAge, // must use exp for safety\n      };\n      // jwt\n      const secret = app.config.jwt.secret || app.config.keys.split(',')[0];\n      const jwt = jsonwebtoken.sign(payload, secret);\n      return { jwt };\n    }\n\n  }\n\n  return Jwt;\n};\n","const require3 = require('require3');\nconst extend = require3('extend2');\n\nmodule.exports = app => {\n\n  class Settings extends app.Service {\n\n    async load({ module, user }) {\n      const name = `user-layoutConfig:${module}:${user.id}`;\n      return await this.ctx.bean.status.get(name);\n    }\n\n    async save({ module, data, user }) {\n      const name = `user-layoutConfig:${module}:${user.id}`;\n      await this.ctx.bean.status.set(name, data);\n    }\n\n    async saveKey({ module, key, value, user }) {\n      const layoutConfig = await this.load({ module, user });\n      const data = extend(true, {}, layoutConfig || {}, { [key]: value });\n      await this.save({ module, data, user });\n    }\n\n  }\n\n  return Settings;\n};\n","module.exports = app => {\n\n  class Resource extends app.Service {\n\n    async select({ options, user }) {\n      return await this.ctx.bean.resource.select({ options, user });\n    }\n\n    async check({ atomStaticKeys, user }) {\n      return await this.ctx.bean.resource.check({ atomStaticKeys, user });\n    }\n\n    async resourceRoles({ key, user }) {\n      return await this.ctx.bean.resource.resourceRoles({ key, user });\n    }\n\n    async resourceRoleRemove({ /* key,*/ data/* , user*/ }) {\n      return await this.ctx.bean.resource.deleteResourceRole({ id: data.resourceRoleId });\n    }\n\n    async resourceRoleAdd({ key, data/* , user*/ }) {\n      for (const roleId of data.roles) {\n        await this.ctx.bean.resource.addResourceRole({ atomId: key.atomId, roleId });\n      }\n    }\n\n  }\n\n  return Resource;\n};\n","module.exports = app => {\n\n  class Tag extends app.Service {\n\n    async list({ atomClass, options }) {\n      return await this.ctx.bean.tag.list({ atomClass, options });\n    }\n\n    async add({ atomClass, data }) {\n      return await this.ctx.bean.tag.add({ atomClass, data });\n    }\n\n    async delete({ tagId }) {\n      return await this.ctx.bean.tag.delete({ tagId });\n    }\n\n    async save({ tagId, data }) {\n      return await this.ctx.bean.tag.save({ tagId, data });\n    }\n\n  }\n\n  return Tag;\n};\n","module.exports = app => {\n\n  class User extends app.Service {\n\n    async getLabels({ user }) {\n      const res = await this.ctx.model.label.get({\n        userId: user.id,\n      });\n      return res ? JSON.parse(res.labels) : null;\n    }\n\n    async setLabels({ labels, user }) {\n      const labels2 = JSON.stringify(labels);\n      const res = await this.ctx.model.label.get({\n        userId: user.id,\n      });\n      if (!res) {\n        await this.ctx.model.label.insert({\n          userId: user.id,\n          labels: labels2,\n        });\n      } else {\n        await this.ctx.model.label.update({\n          id: res.id,\n          labels: labels2,\n        });\n      }\n    }\n\n  }\n\n  return User;\n};\n","const base = require('./service/base.js');\nconst user = require('./service/user.js');\nconst atom = require('./service/atom.js');\nconst atomClass = require('./service/atomClass.js');\nconst atomAction = require('./service/atomAction.js');\nconst auth = require('./service/auth.js');\nconst resource = require('./service/resource.js');\nconst comment = require('./service/comment.js');\nconst jwt = require('./service/jwt.js');\nconst layoutConfig = require('./service/layoutConfig.js');\nconst category = require('./service/category.js');\nconst tag = require('./service/tag.js');\n\nmodule.exports = app => {\n  const services = {\n    base,\n    user,\n    atom,\n    atomClass,\n    atomAction,\n    auth,\n    resource,\n    comment,\n    jwt,\n    layoutConfig,\n    category,\n    tag,\n  };\n  return services;\n};\n","module.exports = require(\"os\");;","module.exports = require(\"path\");;","module.exports = require(\"require3\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(9421);\n"],"sourceRoot":""}
