/*! For license information please see front.js.LICENSE.txt */
(()=>{var e={929:()=>{},2163:()=>{},5359:()=>{},6859:()=>{},1252:()=>{},6558:()=>{},1847:()=>{},6726:()=>{},6495:()=>{},9634:()=>{},9220:()=>{},1871:()=>{},5512:(e,t)=>{"use strict";var n,r,i,o,a,s,u,c,l,f,d,h,p,g,v,m,y,b,E,_,x,w,S,A,T;(t.UX||(t.UX={})).TextureCompressionBC="texture-compression-bc",(T=t.OB||(t.OB={})).ClampToEdge="clamp-to-edge",T.Repeat="repeat",T.MirrorRepeat="mirror-repeat",(A=t.$l||(t.$l={})).UniformBuffer="uniform-buffer",A.StorageBuffer="storage-buffer",A.ReadonlyStorageBuffer="readonly-storage-buffer",A.Sampler="sampler",A.ComparisonSampler="comparison-sampler",A.SampledTexture="sampled-texture",A.ReadonlyStorageTexture="readonly-storage-texture",A.WriteonlyStorageTexture="writeonly-storage-texture",(S=t.zi||(t.zi={})).Zero="zero",S.One="one",S.SrcColor="src-color",S.OneMinusSrcColor="one-minus-src-color",S.SrcAlpha="src-alpha",S.OneMinusSrcAlpha="one-minus-src-alpha",S.DstColor="dst-color",S.OneMinusDstColor="one-minus-dst-color",S.DstAlpha="dst-alpha",S.OneMinusDstAlpha="one-minus-dst-alpha",S.SrcAlphaSaturated="src-alpha-saturated",S.BlendColor="blend-color",S.OneMinusBlendColor="one-minus-blend-color",(w=t.db||(t.db={})).Add="add",w.Subtract="subtract",w.ReverseSubtract="reverse-subtract",w.Min="min",w.Max="max",(x=t.wb||(t.wb={})).Never="never",x.Less="less",x.Equal="equal",x.LessEqual="less-equal",x.Greater="greater",x.NotEqual="not-equal",x.GreaterEqual="greater-equal",x.Always="always",(_=t.Wf||(t.Wf={})).None="none",_.Front="front",_.Back="back",(E=t.X9||(t.X9={})).Nearest="nearest",E.Linear="linear",(b=t.zX||(t.zX={})).CCW="ccw",b.CW="cw",(y=t.iD||(t.iD={})).Uint16="uint16",y.Uint32="uint32",(m=t.V||(t.V={})).Vertex="vertex",m.Instance="instance",(t.Ws||(t.Ws={})).Load="load",(v=t.YV||(t.YV={})).PointList="point-list",v.LineList="line-list",v.LineStrip="line-strip",v.TriangleList="triangle-list",v.TriangleStrip="triangle-strip",(g=t.xS||(t.xS={})).Keep="keep",g.Zero="zero",g.Replace="replace",g.Invert="invert",g.IncrementClamp="increment-clamp",g.DecrementClamp="decrement-clamp",g.IncrementWrap="increment-wrap",g.DecrementWrap="decrement-wrap",(p=t.EG||(t.EG={})).Store="store",p.Clear="clear",(h=t.kd||(t.kd={})).E1d="1d",h.E2d="2d",h.E3d="3d",(d=t.EV||(t.EV={})).R8Unorm="r8unorm",d.R8Snorm="r8snorm",d.R8Uint="r8uint",d.R8Sint="r8sint",d.R16Uint="r16uint",d.R16Sint="r16sint",d.R16Float="r16float",d.RG8Unorm="rg8unorm",d.RG8Snorm="rg8snorm",d.RG8Uint="rg8uint",d.RG8Sint="rg8sint",d.R32Uint="r32uint",d.R32Sint="r32sint",d.R32Float="r32float",d.RG16Uint="rg16uint",d.RG16Sint="rg16sint",d.RG16Float="rg16float",d.RGBA8Unorm="rgba8unorm",d.RGBA8UnormSRGB="rgba8unorm-srgb",d.RGBA8Snorm="rgba8snorm",d.RGBA8Uint="rgba8uint",d.RGBA8Sint="rgba8sint",d.BGRA8Unorm="bgra8unorm",d.BGRA8UnormSRGB="bgra8unorm-srgb",d.RGB10A2Unorm="rgb10a2unorm",d.RG11B10Float="rg11b10float",d.RG32Uint="rg32uint",d.RG32Sint="rg32sint",d.RG32Float="rg32float",d.RGBA16Uint="rgba16uint",d.RGBA16Sint="rgba16sint",d.RGBA16Float="rgba16float",d.RGBA32Uint="rgba32uint",d.RGBA32Sint="rgba32sint",d.RGBA32Float="rgba32float",d.Depth32Float="depth32float",d.Depth24Plus="depth24plus",d.Depth24PlusStencil8="depth24plus-stencil8",(f=t.Ek||(t.Ek={})).Float="float",f.Sint="sint",f.Uint="uint",(l=t.p_||(t.p_={})).E1d="1d",l.E2d="2d",l.E2dArray="2d-array",l.Cube="cube",l.CubeArray="cube-array",l.E3d="3d",(c=t.gB||(t.gB={})).Uchar2="uchar2",c.Uchar4="uchar4",c.Char2="char2",c.Char4="char4",c.Uchar2Norm="uchar2norm",c.Uchar4Norm="uchar4norm",c.Char2Norm="char2norm",c.Char4Norm="char4norm",c.Ushort2="ushort2",c.Ushort4="ushort4",c.Short2="short2",c.Short4="short4",c.Ushort2Norm="ushort2norm",c.Ushort4Norm="ushort4norm",c.Short2Norm="short2norm",c.Short4Norm="short4norm",c.Half2="half2",c.Half4="half4",c.Float="float",c.Float2="float2",c.Float3="float3",c.Float4="float4",c.Uint="uint",c.Uint2="uint2",c.Uint3="uint3",c.Uint4="uint4",c.Int="int",c.Int2="int2",c.Int3="int3",c.Int4="int4",(u=t.H7||(t.H7={})).All="all",u.StencilOnly="stencil-only",u.DepthOnly="depth-only",(s=t.mj||(t.mj={})).Error="error",s.Warning="warning",s.Info="info",(t.xL||(t.xL={})).Occlusion="occlusion",(a=t.FB||(t.FB={}))[a.MapRead=1]="MapRead",a[a.MapWrite=2]="MapWrite",a[a.CopySrc=4]="CopySrc",a[a.CopyDst=8]="CopyDst",a[a.Index=16]="Index",a[a.Vertex=32]="Vertex",a[a.Uniform=64]="Uniform",a[a.Storage=128]="Storage",a[a.Indirect=256]="Indirect",a[a.QueryResolve=512]="QueryResolve",(o=t.Yw||(t.Yw={}))[o.Red=1]="Red",o[o.Green=2]="Green",o[o.Blue=4]="Blue",o[o.Alpha=8]="Alpha",o[o.All=15]="All",(i=t.$X||(t.$X={}))[i.Vertex=1]="Vertex",i[i.Fragment=2]="Fragment",i[i.Compute=4]="Compute",(r=t.v2||(t.v2={}))[r.CopySrc=1]="CopySrc",r[r.CopyDst=2]="CopyDst",r[r.Sampled=4]="Sampled",r[r.Storage=8]="Storage",r[r.OutputAttachment=16]="OutputAttachment",(n=t.gc||(t.gc={}))[n.Read=1]="Read",n[n.Write=2]="Write"},6418:(e,t,n)=>{"use strict";n.d(t,{Z:()=>BE});var r={};n.r(r),n.d(r,{components:()=>at,dfs:()=>ut,dijkstra:()=>dt,dijkstraAll:()=>ht,findCycles:()=>gt,floydWarshall:()=>kt,isAcyclic:()=>Tt,postorder:()=>It,preorder:()=>Nt,prim:()=>ot,tarjan:()=>pt,topsort:()=>At});var i={};n.r(i),n.d(i,{CircularLayout:()=>Pe,ComboCombinedLayout:()=>EE,ComboForceLayout:()=>bE,ConcentricLayout:()=>Ul,DagreCompoundLayout:()=>cl,DagreLayout:()=>mr,ERLayout:()=>GE,Force2Layout:()=>F,ForceAtlas2Layout:()=>SE,ForceLayout:()=>Me,FruchtermanGPULayout:()=>vE,FruchtermanLayout:()=>Bl,GForceGPULayout:()=>yE,GForceLayout:()=>C,GridLayout:()=>N,Layout:()=>LE,Layouts:()=>UE,MDSLayout:()=>zl,RadialLayout:()=>Ll,RandomLayout:()=>D,getLayoutByName:()=>I,registerLayout:()=>A,unRegisterLayout:()=>T});class o{constructor(){this.nodes=[],this.edges=[],this.combos=[],this.comboEdges=[],this.hiddenNodes=[],this.hiddenEdges=[],this.hiddenCombos=[],this.vedges=[],this.positions=[],this.destroyed=!1,this.onLayoutEnd=()=>{}}layout(e){return this.init(e),this.execute(!0)}init(e){this.nodes=e.nodes||[],this.edges=e.edges||[],this.combos=e.combos||[],this.comboEdges=e.comboEdges||[],this.hiddenNodes=e.hiddenNodes||[],this.hiddenEdges=e.hiddenEdges||[],this.hiddenCombos=e.hiddenCombos||[],this.vedges=e.vedges||[]}execute(e){}executeWithWorker(){}getDefaultCfg(){return{}}updateCfg(e){e&&Object.assign(this,e)}getType(){return"base"}destroy(){this.nodes=null,this.edges=null,this.combos=null,this.positions=null,this.destroyed=!0}}const a=e=>"string"==typeof e,s=(Object.create(null),Array.isArray),u=e=>"number"==typeof e,c=e=>Number.isNaN(Number(e)),l=e=>null!==e&&"object"==typeof e,f=e=>{if(null===e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array){const t=[];return e.forEach((e=>{t.push(e)})),t.map((e=>f(e)))}if("object"==typeof e&&Object.keys(e).length){const t=Object.assign({},e);return Object.keys(t).forEach((e=>{t[e]=f(t[e])})),t}return e},d=(e,t)=>{const n=e[t];return l(n)?n.cell:n},h=(e,t,n)=>{const r=[];for(let t=0;t<e;t++)r[t]={in:0,out:0,all:0};return n?(n.forEach((e=>{const n=d(e,"source"),i=d(e,"target");n&&r[t[n]]&&(r[t[n]].out+=1,r[t[n]].all+=1),i&&r[t[i]]&&(r[t[i]].in+=1,r[t[i]].all+=1)})),r):r},p=e=>{const t=[],n=e.length;for(let r=0;r<n;r+=1){t[r]=[];for(let i=0;i<n;i+=1)r===i?t[r][i]=0:0!==e[r][i]&&e[r][i]?t[r][i]=e[r][i]:t[r][i]=1/0}for(let e=0;e<n;e+=1)for(let r=0;r<n;r+=1)for(let i=0;i<n;i+=1)t[r][i]>t[r][e]+t[e][i]&&(t[r][i]=t[r][e]+t[e][i]);return t},g=(e,t)=>{const{nodes:n,edges:r}=e,i=[],o={};if(!n)throw new Error("invalid nodes data!");return n&&n.forEach(((e,t)=>{o[e.id]=t,i.push([])})),null==r||r.forEach((e=>{const n=d(e,"source"),r=d(e,"target"),a=o[n],s=o[r];void 0!==a&&void 0!==s&&(i[a][s]=1,t||(i[s][a]=1))})),i},v=(e,t)=>{if(e&&e.children)for(let n=e.children.length-1;n>=0;n--)if(!v(e.children[n],t))return;return!!t(e)},m=(e,t)=>{"function"==typeof t&&v(e,t)},y=e=>{const t={x:0,y:0};e.forEach((e=>{t.x+=e.x||0,t.y+=e.y||0}));const n=e.length||1;return{x:t.x/n,y:t.y/n}},b=(e,t,n)=>{var r,i;return"source"===e?(null===(r=null==n?void 0:n.find((e=>e.target===t.id)))||void 0===r?void 0:r.source)||{}:(null===(i=null==n?void 0:n.find((e=>e.source===t.id)))||void 0===i?void 0:i.target)||{}},E=(e,t,n)=>{let r=[];switch(e){case"source":r=null==n?void 0:n.filter((e=>e.source===t.id)).map((e=>e.target));break;case"target":r=null==n?void 0:n.filter((e=>e.target===t.id)).map((e=>e.source));break;case"both":r=null==n?void 0:n.filter((e=>e.source===t.id)).map((e=>e.target)).concat(null==n?void 0:n.filter((e=>e.target===t.id)).map((e=>e.source)))}const i=new Set(r);return Array.from(i)},_=e=>"function"==typeof e,x=(e,t,n)=>{let r;return r=n||(u(e)?()=>e:()=>t),r},w=(e,t,n=!0)=>t||0===t?_(t)?t:u(t)?()=>t:s(t)?()=>{if(n){const n=Math.max(...t);return isNaN(n)?e:n}return t}:l(t)?()=>{if(n){const n=Math.max(t.width,t.height);return isNaN(n)?e:n}return[t.width,t.height]}:()=>e:t=>t.size?s(t.size)?t.size[0]>t.size[1]?t.size[0]:t.size[1]:l(t.size)?t.size.width>t.size.height?t.size.width:t.size.height:t.size:e,S=new Map,A=(e,t)=>{if(S.get(e)&&console.warn(`The layout with the name ${e} exists already, it will be overridden`),l(t)){class n extends o{constructor(e){super();const n=this,r={},i=n.getDefaultCfg();Object.assign(r,i,t,e),Object.keys(r).forEach((e=>{const t=r[e];n[e]=t}))}}S.set(e,n)}else S.set(e,t);return S.get(e)},T=e=>{S.has(e)&&S.delete(e)},I=e=>S.has(e)?S.get(e):null;class N extends o{constructor(e){super(),this.begin=[0,0],this.preventOverlap=!0,this.preventOverlapPadding=10,this.condense=!1,this.sortBy="degree",this.nodes=[],this.edges=[],this.width=300,this.height=300,this.row=0,this.col=0,this.cellWidth=0,this.cellHeight=0,this.cellUsed={},this.id2manPos={},this.onLayoutEnd=()=>{},this.updateCfg(e)}getDefaultCfg(){return{begin:[0,0],preventOverlap:!0,preventOverlapPadding:10,condense:!1,rows:void 0,cols:void 0,position:void 0,sortBy:"degree",nodeSize:30}}execute(){const e=this,{nodes:t,edges:n,begin:r}=e,i=t.length;if(0===i)return e.onLayoutEnd&&e.onLayoutEnd(),{nodes:t,edges:n};if(1===i)return t[0].x=r[0],t[0].y=r[1],e.onLayoutEnd&&e.onLayoutEnd(),{nodes:t,edges:n};let{sortBy:o,width:u,height:l}=e;const{condense:f,preventOverlapPadding:d,preventOverlap:p,nodeSpacing:g,nodeSize:v}=e,m=[];t.forEach((e=>{m.push(e)}));const y={};if(m.forEach(((e,t)=>{y[e.id]=t})),("degree"===o||!a(o)||void 0===m[0][o])&&(o="degree",c(t[0].degree))){const e=h(m.length,y,n);m.forEach(((t,n)=>{t.degree=e[n].all}))}m.sort(((e,t)=>t[o]-e[o])),u||"undefined"==typeof window||(u=window.innerWidth),l||"undefined"==typeof window||(l=window.innerHeight);const b=e.rows,E=null!=e.cols?e.cols:e.columns;if(e.cells=i,null!=b&&null!=E?(e.rows=b,e.cols=E):null!=b&&null==E?(e.rows=b,e.cols=Math.ceil(e.cells/e.rows)):null==b&&null!=E?(e.cols=E,e.rows=Math.ceil(e.cells/e.cols)):(e.splits=Math.sqrt(e.cells*e.height/e.width),e.rows=Math.round(e.splits),e.cols=Math.round(e.width/e.height*e.splits)),e.rows=Math.max(e.rows,1),e.cols=Math.max(e.cols,1),e.cols*e.rows>e.cells){const t=e.small(),n=e.large();(t-1)*n>=e.cells?e.small(t-1):(n-1)*t>=e.cells&&e.large(n-1)}else for(;e.cols*e.rows<e.cells;){const t=e.small(),n=e.large();(n+1)*t>=e.cells?e.large(n+1):e.small(t+1)}if(e.cellWidth=u/e.cols,e.cellHeight=l/e.rows,f&&(e.cellWidth=0,e.cellHeight=0),p||g){const t=w(10,g),n=w(30,v,!1);m.forEach((r=>{r.x&&r.y||(r.x=0,r.y=0);const i=n(r)||30;let o,a;s(i)?(o=i[0],a=i[1]):(o=i,a=i);const u=void 0!==t?t(r):d,c=o+u,l=a+u;e.cellWidth=Math.max(e.cellWidth,c),e.cellHeight=Math.max(e.cellHeight,l)}))}e.cellUsed={},e.row=0,e.col=0,e.id2manPos={};for(let t=0;t<m.length;t++){const n=m[t];let r;if(e.position&&(r=e.position(n)),r&&(void 0!==r.row||void 0!==r.col)){const t={row:r.row,col:r.col};if(void 0===t.col)for(t.col=0;e.used(t.row,t.col);)t.col++;else if(void 0===t.row)for(t.row=0;e.used(t.row,t.col);)t.row++;e.id2manPos[n.id]=t,e.use(t.row,t.col)}e.getPos(n)}return e.onLayoutEnd&&e.onLayoutEnd(),{edges:n,nodes:m}}small(e){const t=this;let n;const r=t.rows||5,i=t.cols||5;return null==e?n=Math.min(r,i):Math.min(r,i)===t.rows?t.rows=e:t.cols=e,n}large(e){const t=this;let n;const r=t.rows||5,i=t.cols||5;return null==e?n=Math.max(r,i):Math.max(r,i)===t.rows?t.rows=e:t.cols=e,n}used(e,t){return this.cellUsed[`c-${e}-${t}`]||!1}use(e,t){this.cellUsed[`c-${e}-${t}`]=!0}moveToNextCell(){const e=this,t=e.cols||5;e.col++,e.col>=t&&(e.col=0,e.row++)}getPos(e){const t=this,{begin:n,cellWidth:r,cellHeight:i}=t;let o,a;const s=t.id2manPos[e.id];if(s)o=s.col*r+r/2+n[0],a=s.row*i+i/2+n[1];else{for(;t.used(t.row,t.col);)t.moveToNextCell();o=t.col*r+r/2+n[0],a=t.row*i+i/2+n[1],t.use(t.row,t.col),t.moveToNextCell()}e.x=o,e.y=a}getType(){return"grid"}}class D extends o{constructor(e){super(),this.center=[0,0],this.width=300,this.height=300,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.updateCfg(e)}getDefaultCfg(){return{center:[0,0],width:300,height:300}}execute(){const e=this,t=e.nodes,n=e.center;return e.width||"undefined"==typeof window||(e.width=window.innerWidth),e.height||"undefined"==typeof window||(e.height=window.innerHeight),t&&t.forEach((t=>{t.x=.9*(Math.random()-.5)*e.width+n[0],t.y=.9*(Math.random()-.5)*e.height+n[1]})),e.onLayoutEnd&&e.onLayoutEnd(),{nodes:t,edges:this.edges}}getType(){return"random"}}const k=(e,t)=>{let n;return n=e?u(e)?t=>e:e:e=>t||1,n};class C extends o{constructor(e){super(),this.maxIteration=500,this.workerEnabled=!1,this.edgeStrength=200,this.nodeStrength=1e3,this.coulombDisScale=.005,this.damping=.9,this.maxSpeed=1e3,this.minMovement=.5,this.interval=.02,this.factor=1,this.linkDistance=1,this.gravity=10,this.preventOverlap=!0,this.collideStrength=1,this.tick=()=>{},this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.animate=!0,this.updateCfg(e)}getDefaultCfg(){return{maxIteration:500,gravity:10,enableTick:!0,animate:!0}}execute(){var e,t;const n=this,r=n.nodes;if(void 0!==n.timeInterval&&"undefined"!=typeof window&&window.clearInterval(n.timeInterval),!r||0===r.length)return void(null===(e=n.onLayoutEnd)||void 0===e||e.call(n));n.width||"undefined"==typeof window||(n.width=window.innerWidth),n.height||"undefined"==typeof window||(n.height=window.innerHeight),n.center||(n.center=[n.width/2,n.height/2]);const i=n.center;if(1===r.length)return r[0].x=i[0],r[0].y=i[1],void(null===(t=n.onLayoutEnd)||void 0===t||t.call(n));const o={},a={};r.forEach(((e,t)=>{u(e.x)||(e.x=Math.random()*n.width),u(e.y)||(e.y=Math.random()*n.height),o[e.id]=e,a[e.id]=t})),n.nodeMap=o,n.nodeIdxMap=a,n.linkDistance=k(n.linkDistance,1),n.nodeStrength=k(n.nodeStrength,1),n.edgeStrength=k(n.edgeStrength,1);const c=n.nodeSize;let f;if(n.preventOverlap){const e=n.nodeSpacing;let t;t=u(e)?()=>e:_(e)?e:()=>0,f=c?s(c)?e=>Math.max(c[0],c[1])+t(e):e=>c+t(e):e=>e.size?s(e.size)?Math.max(e.size[0],e.size[1])+t(e):l(e.size)?Math.max(e.size.width,e.size.height)+t(e):e.size+t(e):10+t(e)}n.nodeSize=f;const d=n.edges;n.degrees=h(r.length,n.nodeIdxMap,d),n.getMass||(n.getMass=e=>e.mass||n.degrees[n.nodeIdxMap[e.id]].all||1),n.run()}run(){var e;const t=this,{maxIteration:n,nodes:r,workerEnabled:i,minMovement:o,animate:a}=t;if(r)if(i||!a){for(let e=0;e<n;e++){const n=t.runOneStep(e);if(t.reachMoveThreshold(r,n,o))break}null===(e=t.onLayoutEnd)||void 0===e||e.call(t)}else{if("undefined"==typeof window)return;let e=0;this.timeInterval=window.setInterval((()=>{var i,a;if(!r)return;const s=t.runOneStep(e)||[];t.reachMoveThreshold(r,s,o)&&(null===(i=t.onLayoutEnd)||void 0===i||i.call(t),window.clearInterval(t.timeInterval)),e++,e>=n&&(null===(a=t.onLayoutEnd)||void 0===a||a.call(t),window.clearInterval(t.timeInterval))}),0)}}reachMoveThreshold(e,t,n){let r=0;return e.forEach(((e,n)=>{const i=e.x-t[n].x,o=e.y-t[n].y;r+=Math.sqrt(i*i+o*o)})),r/=e.length,r<n}runOneStep(e){var t;const n=this,{nodes:r,edges:i}=n,o=[],a=[];if(!r)return;r.forEach(((e,t)=>{o[2*t]=0,o[2*t+1]=0,a[2*t]=0,a[2*t+1]=0})),n.calRepulsive(o,r),i&&n.calAttractive(o,i),n.calGravity(o,r);const s=Math.max(.02,n.interval-.002*e);n.updateVelocity(o,a,s,r);const u=[];return r.forEach((e=>{u.push({x:e.x,y:e.y})})),n.updatePosition(a,s,r),null===(t=n.tick)||void 0===t||t.call(n),u}calRepulsive(e,t){const n=this,{getMass:r,factor:i,coulombDisScale:o,preventOverlap:a,collideStrength:s=1}=n,u=n.nodeStrength,c=n.nodeSize;t.forEach(((n,l)=>{const f=r?r(n):1;t.forEach(((t,d)=>{if(l>=d)return;let h=n.x-t.x,p=n.y-t.y;0===h&&0===p&&(h=.01*Math.random(),p=.01*Math.random());const g=h*h+p*p,v=Math.sqrt(g),m=(v+.1)*o,y=h/v,b=p/v,E=.5*(u(n)+u(t))*i/(m*m),_=r?r(t):1;if(e[2*l]+=y*E,e[2*l+1]+=b*E,e[2*d]-=y*E,e[2*d+1]-=b*E,a&&(c(n)+c(t))/2>v){const r=s*(u(n)+u(t))*.5/g;e[2*l]+=y*r/f,e[2*l+1]+=b*r/f,e[2*d]-=y*r/_,e[2*d+1]-=b*r/_}}))}))}calAttractive(e,t){const n=this,{nodeMap:r,nodeIdxMap:i,linkDistance:o,edgeStrength:a}=n,s=n.nodeSize,u=n.getMass;t.forEach(((t,n)=>{const c=d(t,"source"),l=d(t,"target"),f=r[c],h=r[l];let p=h.x-f.x,g=h.y-f.y;0===p&&0===g&&(p=.01*Math.random(),g=.01*Math.random());const v=Math.sqrt(p*p+g*g),m=p/v,y=g/v,b=((o(t,f,h)||1+(s(f)+s(h)||0)/2)-v)*a(t),E=i[c],_=i[l],x=u?u(f):1,w=u?u(h):1;e[2*E]-=m*b/x,e[2*E+1]-=y*b/x,e[2*_]+=m*b/w,e[2*_+1]+=y*b/w}))}calGravity(e,t){const n=this,r=n.center,i=n.gravity,o=n.degrees,a=t.length;for(let s=0;s<a;s++){const a=t[s];let c=a.x-r[0],l=a.y-r[1],f=i;if(n.getCenter){const e=n.getCenter(a,o[s].all);e&&u(e[0])&&u(e[1])&&u(e[2])&&(c=a.x-e[0],l=a.y-e[1],f=e[2])}f&&(e[2*s]-=f*c,e[2*s+1]-=f*l)}}updateVelocity(e,t,n,r){const i=this,o=n*i.damping;r.forEach(((n,r)=>{let a=e[2*r]*o||.01,s=e[2*r+1]*o||.01;const u=Math.sqrt(a*a+s*s);if(u>i.maxSpeed){const e=i.maxSpeed/u;a*=e,s*=e}t[2*r]=a,t[2*r+1]=s}))}updatePosition(e,t,n){n.forEach(((n,r)=>{if(u(n.fx)&&u(n.fy))return n.x=n.fx,void(n.y=n.fy);const i=e[2*r]*t,o=e[2*r+1]*t;n.x+=i,n.y+=o}))}stop(){this.timeInterval&&"undefined"!=typeof window&&window.clearInterval(this.timeInterval)}destroy(){const e=this;e.stop(),e.tick=null,e.nodes=null,e.edges=null,e.destroyed=!0}getType(){return"gForce"}}function M(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,o,a,s,u,c,l,f,d,h=e._root,p={data:r},g=e._x0,v=e._y0,m=e._x1,y=e._y1;if(!h)return e._root=p,e;for(;h.length;)if((c=t>=(o=(g+m)/2))?g=o:m=o,(l=n>=(a=(v+y)/2))?v=a:y=a,i=h,!(h=h[f=l<<1|c]))return i[f]=p,e;if(s=+e._x.call(null,h.data),u=+e._y.call(null,h.data),t===s&&n===u)return p.next=h,i?i[f]=p:e._root=p,e;do{i=i?i[f]=new Array(4):e._root=new Array(4),(c=t>=(o=(g+m)/2))?g=o:m=o,(l=n>=(a=(v+y)/2))?v=a:y=a}while((f=l<<1|c)==(d=(u>=a)<<1|s>=o));return i[d]=h,i[f]=p,e}function O(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function R(e){return e[0]}function P(e){return e[1]}function G(e,t,n){var r=new L(null==t?R:t,null==n?P:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function L(e,t,n,r,i,o){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function U(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var z=G.prototype=L.prototype;z.copy=function(){var e,t,n=new L(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=U(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=U(t));return n},z.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return M(this.cover(t,n),t,n,e)},z.addAll=function(e){var t,n,r,i,o=e.length,a=new Array(o),s=new Array(o),u=1/0,c=1/0,l=-1/0,f=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(a[n]=r,s[n]=i,r<u&&(u=r),r>l&&(l=r),i<c&&(c=i),i>f&&(f=i));if(u>l||c>f)return this;for(this.cover(u,c).cover(l,f),n=0;n<o;++n)M(this,a[n],s[n],e[n]);return this},z.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,o=(r=Math.floor(t))+1;else{for(var a,s,u=i-n||1,c=this._root;n>e||e>=i||r>t||t>=o;)switch(s=(t<r)<<1|e<n,(a=new Array(4))[s]=c,c=a,u*=2,s){case 0:i=n+u,o=r+u;break;case 1:n=i-u,o=r+u;break;case 2:i=n+u,r=o-u;break;case 3:n=i-u,r=o-u}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this},z.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},z.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},z.find=function(e,t,n){var r,i,o,a,s,u,c,l=this._x0,f=this._y0,d=this._x1,h=this._y1,p=[],g=this._root;for(g&&p.push(new O(g,l,f,d,h)),null==n?n=1/0:(l=e-n,f=t-n,d=e+n,h=t+n,n*=n);u=p.pop();)if(!(!(g=u.node)||(i=u.x0)>d||(o=u.y0)>h||(a=u.x1)<l||(s=u.y1)<f))if(g.length){var v=(i+a)/2,m=(o+s)/2;p.push(new O(g[3],v,m,a,s),new O(g[2],i,m,v,s),new O(g[1],v,o,a,m),new O(g[0],i,o,v,m)),(c=(t>=m)<<1|e>=v)&&(u=p[p.length-1],p[p.length-1]=p[p.length-1-c],p[p.length-1-c]=u)}else{var y=e-+this._x.call(null,g.data),b=t-+this._y.call(null,g.data),E=y*y+b*b;if(E<n){var _=Math.sqrt(n=E);l=e-_,f=t-_,d=e+_,h=t+_,r=g.data}}return r},z.remove=function(e){if(isNaN(o=+this._x.call(null,e))||isNaN(a=+this._y.call(null,e)))return this;var t,n,r,i,o,a,s,u,c,l,f,d,h=this._root,p=this._x0,g=this._y0,v=this._x1,m=this._y1;if(!h)return this;if(h.length)for(;;){if((c=o>=(s=(p+v)/2))?p=s:v=s,(l=a>=(u=(g+m)/2))?g=u:m=u,t=h,!(h=h[f=l<<1|c]))return this;if(!h.length)break;(t[f+1&3]||t[f+2&3]||t[f+3&3])&&(n=t,d=f)}for(;h.data!==e;)if(r=h,!(h=h.next))return this;return(i=h.next)&&delete h.next,r?(i?r.next=i:delete r.next,this):t?(i?t[f]=i:delete t[f],(h=t[0]||t[1]||t[2]||t[3])&&h===(t[3]||t[2]||t[1]||t[0])&&!h.length&&(n?n[d]=h:this._root=h),this):(this._root=i,this)},z.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},z.root=function(){return this._root},z.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},z.visit=function(e){var t,n,r,i,o,a,s=[],u=this._root;for(u&&s.push(new O(u,this._x0,this._y0,this._x1,this._y1));t=s.pop();)if(!e(u=t.node,r=t.x0,i=t.y0,o=t.x1,a=t.y1)&&u.length){var c=(r+o)/2,l=(i+a)/2;(n=u[3])&&s.push(new O(n,c,l,o,a)),(n=u[2])&&s.push(new O(n,r,l,c,a)),(n=u[1])&&s.push(new O(n,c,i,o,l)),(n=u[0])&&s.push(new O(n,r,i,c,l))}return this},z.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new O(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var o,a=t.x0,s=t.y0,u=t.x1,c=t.y1,l=(a+u)/2,f=(s+c)/2;(o=i[0])&&n.push(new O(o,a,s,l,f)),(o=i[1])&&n.push(new O(o,l,s,u,f)),(o=i[2])&&n.push(new O(o,a,f,l,c)),(o=i[3])&&n.push(new O(o,l,f,u,c))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},z.x=function(e){return arguments.length?(this._x=e,this):this._x},z.y=function(e){return arguments.length?(this._y=e,this):this._y};function B(e){let t=0,n=0,r=0;if(e.length){for(let i=0;i<4;i++){const o=e[i];o&&o.weight&&(t+=o.weight,n+=o.x*o.weight,r+=o.y*o.weight)}e.x=n/t,e.y=r/t,e.weight=t}else{const t=e;e.x=t.data.x,e.y=t.data.y,e.weight=t.data.weight}}const j=(e,t)=>{let n;return n=e?u(e)?t=>e:e:e=>t||1,n};class F extends o{constructor(e){super(),this.maxIteration=1e3,this.workerEnabled=!1,this.edgeStrength=200,this.nodeStrength=1e3,this.coulombDisScale=.005,this.damping=.9,this.maxSpeed=500,this.minMovement=.4,this.interval=.02,this.factor=1,this.linkDistance=200,this.gravity=0,this.clusterNodeStrength=20,this.preventOverlap=!0,this.distanceThresholdMode="mean",this.tick=()=>{},this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.judgingDistance=0,this.centripetalOptions={leaf:2,single:2,others:1,center:e=>({x:this.width/2,y:this.height/2})};const{getMass:t}=e;this.propsGetMass=t,this.updateCfg(e)}getCentripetalOptions(){const{leafCluster:e,clustering:t,nodeClusterBy:n,nodes:r,nodeMap:i,clusterNodeStrength:o}=this,a=e=>"function"==typeof o?o(e):o;let s,u={};if(e){s=this.getSameTypeLeafMap()||{};const e=Array.from(new Set(null==r?void 0:r.map((e=>e[n]))))||[];u={single:100,leaf:(t,n,r)=>{const{relativeLeafNodes:i,sameTypeLeafNodes:o}=s[t.id]||{};return(null==o?void 0:o.length)===(null==i?void 0:i.length)||1===(null==e?void 0:e.length)?1:a(t)},others:1,center:(e,t,n)=>{var r;const{degree:i}=(null===(r=e.data)||void 0===r?void 0:r.layout)||{};if(!i)return{x:100,y:100};let o;if(1===i){const{sameTypeLeafNodes:t=[]}=s[e.id]||{};1===t.length?o=void 0:t.length>1&&(o=y(t))}else o=void 0;return{x:null==o?void 0:o.x,y:null==o?void 0:o.y}}}}if(t){s||(s=this.getSameTypeLeafMap());const e=Array.from(new Set(r.map(((e,t)=>e[n])))).filter((e=>void 0!==e)),t={};e.forEach((e=>{const o=r.filter((t=>t[n]===e)).map((e=>i[e.id]));t[e]=y(o)})),u={single:e=>a(e),leaf:e=>a(e),others:e=>a(e),center:(e,r,i)=>{const o=t[e[n]];return{x:null==o?void 0:o.x,y:null==o?void 0:o.y}}}}this.centripetalOptions=Object.assign(Object.assign({},this.centripetalOptions),u);const{leaf:c,single:l,others:f}=this.centripetalOptions;c&&"function"!=typeof c&&(this.centripetalOptions.leaf=()=>c),l&&"function"!=typeof l&&(this.centripetalOptions.single=()=>l),f&&"function"!=typeof f&&(this.centripetalOptions.others=()=>f)}updateCfg(e){e&&Object.assign(this,e)}getDefaultCfg(){return{maxIteration:500,gravity:10,enableTick:!0,animate:!0}}execute(){const e=this;e.stop();const{nodes:t,edges:n,defSpringLen:r}=e;if(e.judgingDistance=0,!t||0===t.length)return void e.onLayoutEnd([]);e.width||"undefined"==typeof window||(e.width=window.innerWidth),e.height||"undefined"==typeof window||(e.height=window.innerHeight),e.center||(e.center=[e.width/2,e.height/2]);const i=e.center;if(1===t.length)return t[0].x=i[0],t[0].y=i[1],void e.onLayoutEnd([Object.assign({},t[0])]);e.degreesMap=((e,t)=>{const n={};return e.forEach((e=>{n[e.id]={in:0,out:0,all:0}})),t?(t.forEach((e=>{const t=d(e,"source"),r=d(e,"target");t&&(n[t].out+=1,n[t].all+=1),r&&(n[r].in+=1,n[r].all+=1)})),n):n})(t,n),e.propsGetMass?e.getMass=e.propsGetMass:e.getMass=t=>{let n=1;u(t.mass)&&(n=t.mass);const r=e.degreesMap[t.id].all;return!r||r<5?n:5*r*n};const o=e.nodeSize;let a;if(e.preventOverlap){const t=e.nodeSpacing;let n;n=u(t)?()=>t:_(t)?t:()=>0,a=o?s(o)?e=>Math.max(o[0],o[1])+n(e):e=>o+n(e):e=>e.size?s(e.size)?Math.max(e.size[0],e.size[1])+n(e):l(e.size)?Math.max(e.size.width,e.size.height)+n(e):e.size+n(e):10+n(e)}e.nodeSize=a,e.linkDistance=j(e.linkDistance,1),e.nodeStrength=j(e.nodeStrength,1),e.edgeStrength=j(e.edgeStrength,1);const c={},f={};t.forEach(((t,n)=>{u(t.x)||(t.x=Math.random()*e.width),u(t.y)||(t.y=Math.random()*e.height);const r=e.degreesMap[t.id];c[t.id]=Object.assign(Object.assign({},t),{data:Object.assign(Object.assign({},t.data),{size:e.nodeSize(t)||30,layout:{inDegree:r.in,outDegree:r.out,degree:r.all,tDegree:r.in,sDegree:r.out,force:{mass:e.getMass(t),nodeStrength:e.nodeStrength(t)}}})}),f[t.id]=n})),e.nodeMap=c,e.nodeIdxMap=f,e.edgeInfos=[],null==n||n.forEach((t=>{const n=c[t.source],i=c[t.target];n&&i?e.edgeInfos.push({edgeStrength:e.edgeStrength(t),linkDistance:r?r(Object.assign(Object.assign({},t),{source:n,target:i}),n,i):e.linkDistance(t,n,i)||1+(o(n)+o(n)||0)/2}):elf.edgeInfos.push({})})),this.getCentripetalOptions(),e.onLayoutEnd=e.onLayoutEnd||(()=>{}),e.run()}run(){const e=this,{maxIteration:t,nodes:n,workerEnabled:r,minMovement:i,animate:o,nodeMap:a}=e;if(!n)return;const s=[];n.forEach(((e,t)=>{s[2*t]=0,s[2*t+1]=0}));const u=t;if(r||!o){let t=0;for(let n=0;(e.judgingDistance>i||n<1)&&n<u;n++)t=n,e.runOneStep(n,s);e.onLayoutEnd(Object.values(a))}else{if("undefined"==typeof window)return;let t=0;this.timeInterval=window.setInterval((()=>{n&&(e.runOneStep(t,s),t++,(t>=u||e.judgingDistance<i)&&(e.onLayoutEnd(Object.values(a)),window.clearInterval(e.timeInterval)))}),0)}}runOneStep(e,t){var n;const r=this,{nodes:i,edges:o,nodeMap:a,monitor:s}=r,u=[];if(!(null==i?void 0:i.length))return;r.calRepulsive(u),o&&r.calAttractive(u),r.calGravity(u);const c=r.interval;r.updateVelocity(u,t,c),r.updatePosition(t,c),null===(n=r.tick)||void 0===n||n.call(r),s&&s({energy:this.calTotalEnergy(u),nodes:i,edges:o,iterations:e})}calTotalEnergy(e){const{nodes:t,nodeMap:n}=this;if(!(null==t?void 0:t.length))return 0;let r=0;return t.forEach(((t,i)=>{const o=e[2*i],a=e[2*i+1],s=o*o+a*a,{mass:u=1}=n[t.id].data.layout.force;r+=u*s*.5})),r}calRepulsive(e){const{nodes:t,nodeMap:n,factor:r,coulombDisScale:i}=this;this.nodeSize,function(e,t,n,r,i){const o=n/r,a=e.map(((e,n)=>{const r=t[e.id],{data:i,x:a,y:s,size:u}=r,{nodeStrength:c}=i.layout.force;return{x:a,y:s,size:u,index:n,vx:0,vy:0,weight:o*c}})),s=G(a,(e=>e.x),(e=>e.y)).visitAfter(B);a.forEach((e=>{!function(e,t){t.visit(((t,n,r,i,o)=>((e,t,n,r,i,o)=>{const a=o.x-e.x||.1,s=o.y-e.y||.1,u=r-t,c=a*a+s*s,l=Math.sqrt(c)*c;if(u*u*.81<c){const t=e.weight/l;return o.vx+=a*t,o.vy+=s*t,!0}if(e.length)return!1;if(e.data!==o){const t=e.data.weight/l;o.vx+=a*t,o.vy+=s*t}})(t,n,0,i,0,e)))}(e,s)})),a.map(((n,r)=>{const o=t[e[r].id],{mass:a=1}=o.data.layout.force;i[2*r]=n.vx/a,i[2*r+1]=n.vy/a}))}(t,n,r,i*i,e)}calAttractive(e){const{edges:t,nodeMap:n,nodeIdxMap:r,edgeInfos:i}=this;this.nodeSize,t.forEach(((t,o)=>{const a=d(t,"source"),s=d(t,"target"),u=n[a],c=n[s];if(!u||!c)return;let l=c.x-u.x,f=c.y-u.y;l||f||(l=.01*Math.random(),f=.01*Math.random());const h=Math.sqrt(l*l+f*f),p=l/h,g=f/h,{linkDistance:v=200,edgeStrength:m=200}=i[o]||{},y=(v-h)*m,b=1/(u.data.layout.force.mass||1),E=1/(c.data.layout.force.mass||1),_=p*y,x=g*y,w=2*r[a],S=2*r[s];e[w]-=_*b,e[w+1]-=x*b,e[S]+=_*E,e[S+1]+=x*E}))}calGravity(e){var t;const n=this,{nodes:r,edges:i=[],nodeMap:o,width:a,height:s,center:c,gravity:l,degreesMap:f,centripetalOptions:d}=n;if(!r)return;const h=r.length;for(let p=0;p<h;p++){const h=2*p,g=o[r[p].id],{mass:v=1}=g.data.layout.force;let m=0,y=0,b=l;const{in:E,out:_,all:x}=f[g.id],w=null===(t=n.getCenter)||void 0===t?void 0:t.call(n,g,x);if(w){const[e,t,n]=w;m=g.x-e,y=g.y-t,b=n}else m=g.x-c[0],y=g.y-c[1];if(b&&(e[h]-=b*m/v,e[h+1]-=b*y/v),d){const{leaf:t,single:n,others:o,center:c}=d,{x:l,y:f,centerStrength:p}=(null==c?void 0:c(g,r,i,a,s))||{x:0,y:0,centerStrength:0};if(!u(l)||!u(f))continue;const m=(g.x-l)/v,y=(g.y-f)/v;if(p&&(e[h]-=p*m,e[h+1]-=p*y),0===x){const t=n(g);if(!t)continue;e[h]-=t*m,e[h+1]-=t*y;continue}if(0===E||0===_){const n=t(g,r,i);if(!n)continue;e[h]-=n*m,e[h+1]-=n*y;continue}const b=o(g);if(!b)continue;e[h]-=b*m,e[h+1]-=b*y}}}updateVelocity(e,t,n){const{nodes:r,damping:i,maxSpeed:o}=this;(null==r?void 0:r.length)&&r.forEach(((r,a)=>{let s=(t[2*a]+e[2*a]*n)*i||.01,u=(t[2*a+1]+e[2*a+1]*n)*i||.01;const c=Math.sqrt(s*s+u*u);if(c>o){const e=o/c;s*=e,u*=e}t[2*a]=s,t[2*a+1]=u}))}updatePosition(e,t){const n=this,{nodes:r,distanceThresholdMode:i,nodeMap:o}=n;if(!(null==r?void 0:r.length))return void(this.judgingDistance=0);let a=0;"max"===i?n.judgingDistance=-1/0:"min"===i&&(n.judgingDistance=1/0),r.forEach(((r,s)=>{const c=o[r.id];if(u(r.fx)&&u(r.fy))return r.x=r.fx,r.y=r.fy,c.x=r.x,void(c.y=r.y);const l=e[2*s]*t,f=e[2*s+1]*t;r.x+=l,r.y+=f,c.x=r.x,c.y=r.y;const d=Math.sqrt(l*l+f*f);switch(i){case"max":n.judgingDistance<d&&(n.judgingDistance=d);break;case"min":n.judgingDistance>d&&(n.judgingDistance=d);break;default:a+=d}})),i&&"mean"!==i||(n.judgingDistance=a/r.length)}stop(){this.timeInterval&&"undefined"!=typeof window&&window.clearInterval(this.timeInterval)}destroy(){const e=this;e.stop(),e.tick=null,e.nodes=null,e.edges=null,e.destroyed=!0}getType(){return"force2"}getSameTypeLeafMap(){const{nodeClusterBy:e,nodes:t,edges:n,nodeMap:r,degreesMap:i}=this;if(!(null==t?void 0:t.length))return;const o={};return t.forEach(((t,a)=>{1===i[t.id].all&&(o[t.id]=((e,t,n,r,i,o)=>{const{in:a,out:s}=i[t.id];let u=t,c=[];0===a?(u=b("source",t,n),c=E("both",u,n).map((e=>o[e]))):0===s&&(u=b("target",t,n),c=E("both",u,n).map((e=>o[e]))),c=c.filter((e=>i[e.id]&&(0===i[e.id].in||0===i[e.id].out)));const l=((e,t,n,r,i)=>{const o=n[t]||"";let a=(null==r?void 0:r.filter((e=>e[t]===o)))||[];return a=a.filter((e=>{var t,n;return 0===(null===(t=i[e.id])||void 0===t?void 0:t.in)||0===(null===(n=i[e.id])||void 0===n?void 0:n.out)})),a})(0,r,t,c,i);return{coreNode:u,relativeLeafNodes:c,sameTypeLeafNodes:l}})(0,t,n,e,i,r))})),o}}function V(e){return function(){return e}}function W(e){return 1e-6*(e()-.5)}var H={value:()=>{}};function X(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new q(r)}function q(e){this._=e}function Y(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function K(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function $(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=H,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}q.prototype=X.prototype={constructor:q,on:function(e,t){var n,r=this._,i=Y(e+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++o<a;)if(n=(e=i[o]).type)r[n]=$(r[n],e.name,t);else if(null==t)for(n in r)r[n]=$(r[n],e.name,null);return this}for(;++o<a;)if((n=(e=i[o]).type)&&(n=K(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new q(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=0,n=(r=this._[e]).length;o<n;++o)r[o].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,o=r.length;i<o;++i)r[i].value.apply(t,n)}};const Z=X;var J,Q,ee=0,te=0,ne=0,re=0,ie=0,oe=0,ae="object"==typeof performance&&performance.now?performance:Date,se="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function ue(){return ie||(se(ce),ie=ae.now()+oe)}function ce(){ie=0}function le(){this._call=this._time=this._next=null}function fe(e,t,n){var r=new le;return r.restart(e,t,n),r}function de(){ie=(re=ae.now())+oe,ee=te=0;try{!function(){ue(),++ee;for(var e,t=J;t;)(e=ie-t._time)>=0&&t._call.call(null,e),t=t._next;--ee}()}finally{ee=0,function(){for(var e,t,n=J,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:J=t);Q=e,pe(r)}(),ie=0}}function he(){var e=ae.now(),t=e-re;t>1e3&&(oe-=t,re=e)}function pe(e){ee||(te&&(te=clearTimeout(te)),e-ie>24?(e<1/0&&(te=setTimeout(de,e-ae.now()-oe)),ne&&(ne=clearInterval(ne))):(ne||(re=ae.now(),ne=setInterval(he,1e3)),ee=1,se(de)))}le.prototype=fe.prototype={constructor:le,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?ue():+n)+(null==t?0:+t),this._next||Q===this||(Q?Q._next=this:J=this,Q=this),this._call=e,this._time=n,pe()},stop:function(){this._call&&(this._call=null,this._time=1/0,pe())}};const ge=4294967296;function ve(e){return e.x}function me(e){return e.y}var ye=Math.PI*(3-Math.sqrt(5));function be(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,s=new Map,u=fe(f),c=Z("tick","end"),l=function(){let e=1;return()=>(e=(1664525*e+1013904223)%ge)/ge}();function f(){d(),c.call("tick",t),n<r&&(u.stop(),c.call("end",t))}function d(r){var u,c,l=e.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(n+=(o-n)*i,s.forEach((function(e){e(n)})),u=0;u<l;++u)null==(c=e[u]).fx?c.x+=c.vx*=a:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=a:(c.y=c.fy,c.vy=0);return t}function h(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+n),o=n*ye;t.x=i*Math.cos(o),t.y=i*Math.sin(o)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,l),t}return null==e&&(e=[]),h(),t={tick:d,restart:function(){return u.restart(f),t},stop:function(){return u.stop(),t},nodes:function(n){return arguments.length?(e=n,h(),s.forEach(p),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(o=+e,t):o},velocityDecay:function(e){return arguments.length?(a=1-e,t):1-a},randomSource:function(e){return arguments.length?(l=e,s.forEach(p),t):l},force:function(e,n){return arguments.length>1?(null==n?s.delete(e):s.set(e,p(n)),t):s.get(e)},find:function(t,n,r){var i,o,a,s,u,c=0,l=e.length;for(null==r?r=1/0:r*=r,c=0;c<l;++c)(a=(i=t-(s=e[c]).x)*i+(o=n-s.y)*o)<r&&(u=s,r=a);return u},on:function(e,n){return arguments.length>1?(c.on(e,n),t):c.on(e)}}}function Ee(){var e,t,n,r,i,o=V(-30),a=1,s=1/0,u=.81;function c(n){var i,o=e.length,a=G(e,ve,me).visitAfter(f);for(r=n,i=0;i<o;++i)t=e[i],a.visit(d)}function l(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)n=e[t],i[n.index]=+o(n,t,e)}}function f(e){var t,n,r,o,a,s=0,u=0;if(e.length){for(r=o=a=0;a<4;++a)(t=e[a])&&(n=Math.abs(t.value))&&(s+=t.value,u+=n,r+=n*t.x,o+=n*t.y);e.x=r/u,e.y=o/u}else{(t=e).x=t.data.x,t.y=t.data.y;do{s+=i[t.data.index]}while(t=t.next)}e.value=s}function d(e,o,c,l){if(!e.value)return!0;var f=e.x-t.x,d=e.y-t.y,h=l-o,p=f*f+d*d;if(h*h/u<p)return p<s&&(0===f&&(p+=(f=W(n))*f),0===d&&(p+=(d=W(n))*d),p<a&&(p=Math.sqrt(a*p)),t.vx+=f*e.value*r/p,t.vy+=d*e.value*r/p),!0;if(!(e.length||p>=s)){(e.data!==t||e.next)&&(0===f&&(p+=(f=W(n))*f),0===d&&(p+=(d=W(n))*d),p<a&&(p=Math.sqrt(a*p)));do{e.data!==t&&(h=i[e.data.index]*r/p,t.vx+=f*h,t.vy+=d*h)}while(e=e.next)}}return c.initialize=function(t,r){e=t,n=r,l()},c.strength=function(e){return arguments.length?(o="function"==typeof e?e:V(+e),l(),c):o},c.distanceMin=function(e){return arguments.length?(a=e*e,c):Math.sqrt(a)},c.distanceMax=function(e){return arguments.length?(s=e*e,c):Math.sqrt(s)},c.theta=function(e){return arguments.length?(u=e*e,c):Math.sqrt(u)},c}function _e(e,t){var n,r=1;function i(){var i,o,a=n.length,s=0,u=0;for(i=0;i<a;++i)s+=(o=n[i]).x,u+=o.y;for(s=(s/a-e)*r,u=(u/a-t)*r,i=0;i<a;++i)(o=n[i]).x-=s,o.y-=u}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i}function xe(e){return e.index}function we(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function Se(e){var t,n,r,i,o,a,s=xe,u=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},c=V(30),l=1;function f(r){for(var i=0,s=e.length;i<l;++i)for(var u,c,f,d,h,p,g,v=0;v<s;++v)c=(u=e[v]).source,d=(f=u.target).x+f.vx-c.x-c.vx||W(a),h=f.y+f.vy-c.y-c.vy||W(a),d*=p=((p=Math.sqrt(d*d+h*h))-n[v])/p*r*t[v],h*=p,f.vx-=d*(g=o[v]),f.vy-=h*g,c.vx+=d*(g=1-g),c.vy+=h*g}function d(){if(r){var a,u,c=r.length,l=e.length,f=new Map(r.map(((e,t)=>[s(e,t,r),e])));for(a=0,i=new Array(c);a<l;++a)(u=e[a]).index=a,"object"!=typeof u.source&&(u.source=we(f,u.source)),"object"!=typeof u.target&&(u.target=we(f,u.target)),i[u.source.index]=(i[u.source.index]||0)+1,i[u.target.index]=(i[u.target.index]||0)+1;for(a=0,o=new Array(l);a<l;++a)u=e[a],o[a]=i[u.source.index]/(i[u.source.index]+i[u.target.index]);t=new Array(l),h(),n=new Array(l),p()}}function h(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+u(e[n],n,e)}function p(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+c(e[t],t,e)}return null==e&&(e=[]),f.initialize=function(e,t){r=e,a=t,d()},f.links=function(t){return arguments.length?(e=t,d(),f):e},f.id=function(e){return arguments.length?(s=e,f):s},f.iterations=function(e){return arguments.length?(l=+e,f):l},f.strength=function(e){return arguments.length?(u="function"==typeof e?e:V(+e),h(),f):u},f.distance=function(e){return arguments.length?(c="function"==typeof e?e:V(+e),p(),f):c},f}function Ae(e){return e.x+e.vx}function Te(e){return e.y+e.vy}function Ie(e){var t,n,r,i=1,o=1;function a(){for(var e,a,u,c,l,f,d,h=t.length,p=0;p<o;++p)for(a=G(t,Ae,Te).visitAfter(s),e=0;e<h;++e)u=t[e],f=n[u.index],d=f*f,c=u.x+u.vx,l=u.y+u.vy,a.visit(g);function g(e,t,n,o,a){var s=e.data,h=e.r,p=f+h;if(!s)return t>c+p||o<c-p||n>l+p||a<l-p;if(s.index>u.index){var g=c-s.x-s.vx,v=l-s.y-s.vy,m=g*g+v*v;m<p*p&&(0===g&&(m+=(g=W(r))*g),0===v&&(m+=(v=W(r))*v),m=(p-(m=Math.sqrt(m)))/m*i,u.vx+=(g*=m)*(p=(h*=h)/(d+h)),u.vy+=(v*=m)*p,s.vx-=g*(p=1-p),s.vy-=v*p)}}}function s(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function u(){if(t){var r,i,o=t.length;for(n=new Array(o),r=0;r<o;++r)i=t[r],n[i.index]=+e(i,r,t)}}return"function"!=typeof e&&(e=V(null==e?1:+e)),a.initialize=function(e,n){t=e,r=n,u()},a.iterations=function(e){return arguments.length?(o=+e,a):o},a.strength=function(e){return arguments.length?(i=+e,a):i},a.radius=function(t){return arguments.length?(e="function"==typeof t?t:V(+t),u(),a):e},a}function Ne(e){var t,n,r,i=V(.1);function o(e){for(var i,o=0,a=t.length;o<a;++o)(i=t[o]).vx+=(r[o]-i.x)*n[o]*e}function a(){if(t){var o,a=t.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+e(t[o],o,t))?0:+i(t[o],o,t)}}return"function"!=typeof e&&(e=V(null==e?0:+e)),o.initialize=function(e){t=e,a()},o.strength=function(e){return arguments.length?(i="function"==typeof e?e:V(+e),a(),o):i},o.x=function(t){return arguments.length?(e="function"==typeof t?t:V(+t),a(),o):e},o}function De(e){var t,n,r,i=V(.1);function o(e){for(var i,o=0,a=t.length;o<a;++o)(i=t[o]).vy+=(r[o]-i.y)*n[o]*e}function a(){if(t){var o,a=t.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+e(t[o],o,t))?0:+i(t[o],o,t)}}return"function"!=typeof e&&(e=V(null==e?0:+e)),o.initialize=function(e){t=e,a()},o.strength=function(e){return arguments.length?(i="function"==typeof e?e:V(+e),a(),o):i},o.y=function(t){return arguments.length?(e="function"==typeof t?t:V(+t),a(),o):e},o}const ke="GPU_LAYOUT_END",Ce={gForce:!0,force2:!0,fruchterman:!0,forceAtlas2:!0,force:!0,"graphin-force":!0};class Me extends o{constructor(e){super(),this.center=[0,0],this.nodeStrength=null,this.edgeStrength=null,this.preventOverlap=!1,this.clusterNodeStrength=null,this.clusterEdgeStrength=null,this.clusterEdgeDistance=null,this.clusterNodeSize=null,this.clusterFociStrength=null,this.linkDistance=50,this.alphaDecay=.028,this.alphaMin=.001,this.alpha=.3,this.collideStrength=1,this.workerEnabled=!1,this.tick=()=>{},this.onLayoutEnd=()=>{},this.ticking=void 0,e&&this.updateCfg(e)}getDefaultCfg(){return{center:[0,0],nodeStrength:null,edgeStrength:null,preventOverlap:!1,nodeSize:void 0,nodeSpacing:void 0,linkDistance:50,forceSimulation:null,alphaDecay:.028,alphaMin:.001,alpha:.3,collideStrength:1,clustering:!1,clusterNodeStrength:-1,clusterEdgeStrength:.1,clusterEdgeDistance:100,clusterFociStrength:.8,clusterNodeSize:10,tick(){},onLayoutEnd(){},workerEnabled:!1}}init(e){const t=this;t.nodes=e.nodes||[];const n=e.edges||[];t.edges=n.map((e=>{const t={},n=["targetNode","sourceNode","startPoint","endPoint"];return Object.keys(e).forEach((r=>{n.indexOf(r)>-1||(t[r]=e[r])})),t})),t.ticking=!1}execute(e){const t=this,n=t.nodes,r=t.edges;if(t.ticking)return;let i=t.forceSimulation;const o=t.alphaMin,a=t.alphaDecay,s=t.alpha;if(i){if(e)if(t.clustering&&t.clusterForce&&(t.clusterForce.nodes(n),t.clusterForce.links(r)),i.nodes(n),r&&t.edgeForce)t.edgeForce.links(r);else if(r&&!t.edgeForce){const e=Se().id((e=>e.id)).links(r);t.edgeStrength&&e.strength(t.edgeStrength),t.linkDistance&&e.distance(t.linkDistance),t.edgeForce=e,i.force("link",e)}t.preventOverlap&&t.overlapProcess(i),i.alpha(s).restart(),this.ticking=!0}else try{const e=Ee();if(t.nodeStrength&&e.strength(t.nodeStrength),i=be().nodes(n),t.clustering){const e=function(){function e(e){return()=>e}let t,n=e=>e.cluster,r=e(1),i=e(-1),o=e(100),a=e(.1),s=[0,0],u=[],c={},l=[],f=100,h=100,p={none:{x:0,y:0}},g=[],v="force",m=!0,y=.1;function b(e){if(!m)return b;t.tick(),_();for(let t,r=0,i=u.length,o=e*y;r<i;++r)t=u[r],t.vx+=(p[n(t)].x-t.x)*o,t.vy+=(p[n(t)].y-t.y)*o}function E(){u&&function(){if(!u||!u.length)return;if(void 0===n(u[0]))throw Error("Couldnt find the grouping attribute for the nodes. Make sure to set it up with forceInABox.groupBy('clusterAttr') before calling .links()");const e=function(){const e=[],t=[],i={};let o=[],a={},s=[];return a=function(e){const t={};return e.forEach((e=>{const r=n(e);t[r]||(t[r]={count:0,sumforceNodeSize:0})})),e.forEach((e=>{const i=n(e),o=r(e),a=t[i];a.count=a.count+1,a.sumforceNodeSize=a.sumforceNodeSize+Math.PI*(o*o)*1.3,t[i]=a})),t}(u),s=function(e){const t={},r=[];return e.forEach((e=>{const r=function(e){const t=d(e,"source"),r=d(e,"target"),i=n(c[t]),o=n(c[r]);return i<=o?`${i}~${o}`:`${o}~${i}`}(e);let i=0;void 0!==t[r]&&(i=t[r]),i+=1,t[r]=i})),Object.entries(t).forEach((([e,t])=>{const n=e.split("~")[0],i=e.split("~")[1];void 0!==n&&void 0!==i&&r.push({source:n,target:i,count:t})})),r}(l),o=Object.keys(a),o.forEach(((t,n)=>{const r=a[t];e.push({id:t,size:r.count,r:Math.sqrt(r.sumforceNodeSize/Math.PI)}),i[t]=n})),s.forEach((e=>{const n=d(e,"source"),r=d(e,"target"),o=i[n],a=i[r];void 0!==o&&void 0!==a&&t.push({source:o,target:a,count:e.count})})),{nodes:e,links:t}}();t=be(e.nodes).force("x",Ne(f).strength(.1)).force("y",De(h).strength(.1)).force("collide",Ie((e=>e.r)).iterations(4)).force("charge",Ee().strength(i)).force("links",Se(e.nodes.length?e.links:[]).distance(o).strength(a)),g=t.nodes(),_()}()}function _(){return p={none:{x:0,y:0}},g.forEach((e=>{p[e.id]={x:e.x-s[0],y:e.y-s[1]}})),p}function x(e){c={},e.forEach((e=>{c[e.id]=e}))}return b.initialize=e=>{u=e,E()},b.template=function(e){return arguments.length?(v=e,E(),b):v},b.groupBy=function(e){return arguments.length?"string"==typeof e?(n=t=>t[e],b):(n=e,b):n},b.enableGrouping=function(e){return arguments.length?(m=e,b):m},b.strength=function(e){return arguments.length?(y=e,b):y},b.centerX=function(e){return arguments.length?(f=e,b):f},b.centerY=function(e){return arguments.length?(h=e,b):h},b.nodes=function(e){return arguments.length?(x(e||[]),u=e||[],b):u},b.links=function(e){return arguments.length?(l=e||[],E(),b):l},b.forceNodeSize=function(t){return arguments.length?(r="function"==typeof t?t:e(+t),E(),b):r},b.nodeSize=b.forceNodeSize,b.forceCharge=function(t){return arguments.length?(i="function"==typeof t?t:e(+t),E(),b):i},b.forceLinkDistance=function(t){return arguments.length?(o="function"==typeof t?t:e(+t),E(),b):o},b.forceLinkStrength=function(t){return arguments.length?(a="function"==typeof t?t:e(+t),E(),b):a},b.offset=function(e){return arguments.length?(s=e,b):s},b.getFocis=_,b}();e.centerX(t.center[0]).centerY(t.center[1]).template("force").strength(t.clusterFociStrength),r&&e.links(r),n&&e.nodes(n),e.forceLinkDistance(t.clusterEdgeDistance).forceLinkStrength(t.clusterEdgeStrength).forceCharge(t.clusterNodeStrength).forceNodeSize(t.clusterNodeSize),t.clusterForce=e,i.force("group",e)}if(i.force("center",_e(t.center[0],t.center[1])).force("charge",e).alpha(s).alphaDecay(a).alphaMin(o),t.preventOverlap&&t.overlapProcess(i),r){const e=Se().id((e=>e.id)).links(r);t.edgeStrength&&e.strength(t.edgeStrength),t.linkDistance&&e.distance(t.linkDistance),t.edgeForce=e,i.force("link",e)}if(t.workerEnabled&&!Oe()&&(t.workerEnabled=!1,console.warn("workerEnabled option is only supported when running in web worker.")),t.workerEnabled){i.stop();const e=function(e){const t=e.alphaMin(),n=e.alphaTarget(),r=e.alpha(),i=Math.log((t-n)/(r-n))/Math.log(1-e.alphaDecay());return Math.ceil(i)}(i);for(let t=1;t<=e;t++)i.tick(),postMessage({nodes:n,currentTick:t,totalTicks:e,type:"LAYOUT_TICK"},void 0);t.ticking=!1}else i.on("tick",(()=>{t.tick()})).on("end",(()=>{t.ticking=!1,t.onLayoutEnd&&t.onLayoutEnd()})),t.ticking=!0;t.forceSimulation=i,t.ticking=!0}catch(e){t.ticking=!1,console.warn(e)}}overlapProcess(e){const t=this,n=t.nodeSize,r=t.nodeSpacing;let i,o;const a=t.collideStrength;if(o=u(r)?()=>r:_(r)?r:()=>0,n)if(_(n))i=e=>n(e)+o(e);else if(s(n)){const e=(n[0]>n[1]?n[0]:n[1])/2;i=t=>e+o(t)}else if(u(n)){const e=n/2;i=t=>e+o(t)}else i=()=>10;else i=e=>e.size?s(e.size)?(e.size[0]>e.size[1]?e.size[0]:e.size[1])/2+o(e):l(e.size)?(e.size.width>e.size.height?e.size.width:e.size.height)/2+o(e):e.size/2+o(e):10+o(e);e.force("collisionForce",Ie(i).strength(a))}updateCfg(e){const t=this;t.ticking&&(t.forceSimulation.stop(),t.ticking=!1),t.forceSimulation=null,Object.assign(t,e)}destroy(){const e=this;e.ticking&&(e.forceSimulation.stop(),e.ticking=!1),e.nodes=null,e.edges=null,e.destroyed=!0}}function Oe(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}function Re(e,t){const n=e.degree,r=t.degree;return n<r?-1:n>r?1:0}class Pe extends o{constructor(e){super(),this.radius=null,this.nodeSize=void 0,this.startRadius=null,this.endRadius=null,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0,this.divisions=1,this.ordering=null,this.angleRatio=1,this.nodes=[],this.edges=[],this.nodeMap={},this.degrees=[],this.width=300,this.height=300,this.updateCfg(e)}getDefaultCfg(){return{radius:null,startRadius:null,endRadius:null,startAngle:0,endAngle:2*Math.PI,clockwise:!0,divisions:1,ordering:null,angleRatio:1}}execute(){var e;const t=this,n=t.nodes,r=t.edges,i=n.length;if(0===i)return void(t.onLayoutEnd&&t.onLayoutEnd());t.width||"undefined"==typeof window||(t.width=window.innerWidth),t.height||"undefined"==typeof window||(t.height=window.innerHeight),t.center||(t.center=[t.width/2,t.height/2]);const o=t.center;if(1===i)return n[0].x=o[0],n[0].y=o[1],void(t.onLayoutEnd&&t.onLayoutEnd());let{radius:a,startRadius:s,endRadius:u}=t;const{divisions:c,startAngle:l,endAngle:f,angleRatio:d,ordering:p,clockwise:g,nodeSpacing:v,nodeSize:m}=t,y=(f-l)/i,b={};n.forEach(((e,t)=>{b[e.id]=t})),t.nodeMap=b;const E=h(n.length,b,r);if(t.degrees=E,v){const e=w(10,v),t=w(10,m);let r=-1/0;n.forEach((e=>{const n=t(e);r<n&&(r=n)}));let i=0;n.forEach(((t,n)=>{i+=0===n?r||10:(e(t)||0)+(r||10)})),a=i/(2*Math.PI)}else a||s||u?!s&&u?s=u:s&&!u&&(u=s):a=t.height>t.width?t.width/2:t.height/2;const _=y*d;let x=[];x="topology"===p?t.topologyOrdering():"topology-directed"===p?t.topologyOrdering(!0):"degree"===p?t.degreeOrdering():n;const S=Math.ceil(i/c);for(let e=0;e<i;++e){let t=a;t||null===s||null===u||(t=s+e*(u-s)/(i-1)),t||(t=10+100*e/(i-1));let n=l+e%S*_+2*Math.PI/c*Math.floor(e/S);g||(n=f-e%S*_-2*Math.PI/c*Math.floor(e/S)),x[e].x=o[0]+Math.cos(n)*t,x[e].y=o[1]+Math.sin(n)*t,x[e].weight=E[e].all}return null===(e=t.onLayoutEnd)||void 0===e||e.call(t),{nodes:x,edges:this.edges}}topologyOrdering(e=!1){const t=this,n=t.degrees,r=t.edges,i=t.nodes,o=f(i),a=t.nodeMap,s=[o[0]],u=[i[0]],c=[],l=i.length;c[0]=!0,function(e,t,n,r){e.forEach(((t,n)=>{e[n].children=[],e[n].parent=[]})),r?t.forEach((t=>{const r=d(t,"source"),i=d(t,"target");let o=0;r&&(o=n[r]);let a=0;i&&(a=n[i]);const s=e[o].children,u=e[a].parent;s.push(e[a].id),u.push(e[o].id)})):t.forEach((t=>{const r=d(t,"source"),i=d(t,"target");let o=0;r&&(o=n[r]);let a=0;i&&(a=n[i]);const s=e[o].children,u=e[a].children;s.push(e[a].id),u.push(e[o].id)}))}(o,r,a,e);let h=0;return o.forEach(((e,t)=>{if(0!==t)if(t!==l-1&&n[t].all===n[t+1].all&&!function(e,t,n){const r=n.length;for(let i=0;i<r;i++){const r=d(n[i],"source"),o=d(n[i],"target");if(e.id===r&&t.id===o||t.id===r&&e.id===o)return!0}return!1}(s[h],e,r)||c[t]){const e=s[h].children;let r=!1;for(let l=0;l<e.length;l++){const f=a[e[l]];if(n[f].all===n[t].all&&!c[f]){s.push(o[f]),u.push(i[a[o[f].id]]),c[f]=!0,r=!0;break}}let f=0;for(;!r&&(c[f]||(s.push(o[f]),u.push(i[a[o[f].id]]),c[f]=!0,r=!0),f++,f!==l););}else s.push(e),u.push(i[a[e.id]]),c[t]=!0,h++})),u}degreeOrdering(){const e=this.nodes,t=[],n=this.degrees;return e.forEach(((e,r)=>{e.degree=n[r].all,t.push(e)})),t.sort(Re),t}getType(){return"circular"}}const Ge=(e,t)=>{if("next"!==e&&"prev"!==e)return t},Le=e=>{e.prev.next=e.next,e.next.prev=e.prev,delete e.next,delete e.prev};class Ue{constructor(){const e={};e.prev=e,e.next=e.prev,this.shortcut=e}dequeue(){const e=this.shortcut,t=e.prev;if(t&&t!==e)return Le(t),t}enqueue(e){const t=this.shortcut;e.prev&&e.next&&Le(e),e.next=t.next,t.next.prev=e,t.next=e,e.prev=t}toString(){const e=[],t=this.shortcut;let n=t.prev;for(;n!==t;)e.push(JSON.stringify(n,Ge)),n=null==n?void 0:n.prev;return`[${e.join(", ")}]`}}var ze;function Be(e,t){var n=e.get(t)||0;e.set(t,n+1)}function je(e,t){var n=e.get(t);void 0!==n&&((n-=1)>0?e.set(t,n):e.delete(t))}function Fe(e,t,n,r){var i=String(t),o=String(n);if(!e&&i>o){var a=i;i=o,o=a}return i+ze.EDGE_KEY_DELIM+o+ze.EDGE_KEY_DELIM+(void 0===r?ze.DEFAULT_EDGE_NAME:r)}function Ve(e,t,n,r){var i=String(t),o=String(n),a={v:t,w:n};if(!e&&i>o){var s=a.v;a.v=a.w,a.w=s}return void 0!==r&&(a.name=r),a}function We(e,t){return Fe(e,t.v,t.w,t.name)}function He(e){return"function"==typeof e}!function(e){e.DEFAULT_EDGE_NAME="\0",e.GRAPH_NODE="\0",e.EDGE_KEY_DELIM=""}(ze||(ze={}));var Xe=function(e){return e.nodes().map((function(t){var n={id:t,value:e.node(t),parent:e.parent(t)};return void 0===n.value&&delete n.value,void 0===n.parent&&delete n.parent,n}))},qe=function(e){return e.edges().map((function(t){var n=e.edge(t),r={v:t.v,w:t.w,value:n,name:t.name};return void 0===r.name&&delete r.name,void 0===r.value&&delete r.value,r}))},Ye=function(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:Xe(e),edges:qe(e),value:e.graph()};return void 0===t.value&&delete t.value,t};function Ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(n),!0).forEach((function(t){Ze(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ze(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var et={compound:!1,multigraph:!1,directed:!0},tt=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Je(this,e),this.directed=!0,this.multigraph=!1,this.compound=!1,this.GRAPH_NODE=ze.GRAPH_NODE,this.label=void 0,this.nodeCountNum=0,this.edgeCountNum=0,this.defaultNodeLabelFn=function(){},this.defaultEdgeLabelFn=function(){},this.parentMap=void 0,this.childrenMap=void 0,this.nodesLabelMap=new Map,this.inEdgesMap=new Map,this.outEdgesMap=new Map,this.predecessorsMap=new Map,this.successorsMap=new Map,this.edgesMap=new Map,this.edgesLabelsMap=new Map,this.isDirected=function(){return t.directed},this.isMultigraph=function(){return t.multigraph},this.isCompound=function(){return t.compound},this.setGraph=function(e){return t.label=e,t},this.graph=function(){return t.label},this.setDefaultNodeLabel=function(e){return He(e)?t.defaultNodeLabelFn=e:t.defaultNodeLabelFn=function(){return e},t},this.nodeCount=function(){return t.nodeCountNum},this.node=function(e){return t.nodesLabelMap.get(e)},this.nodes=function(){return Array.from(t.nodesLabelMap.keys())},this.sources=function(){return t.nodes().filter((function(e){var n;return!(null===(n=t.inEdgesMap.get(e))||void 0===n?void 0:n.size)}))},this.sinks=function(){return t.nodes().filter((function(e){var n;return!(null===(n=t.outEdgesMap.get(e))||void 0===n?void 0:n.size)}))},this.setNodes=function(e,n){return e.map((function(e){return t.setNode(e,n)})),t},this.hasNode=function(e){return t.nodesLabelMap.has(e)},this.checkCompound=function(){if(!t.isCompound())throw new Error("Cannot construct parent-children relations in a non-compound graph")},this.parent=function(e){if(t.isCompound()){var n,r=null===(n=t.parentMap)||void 0===n?void 0:n.get(e);if(r!==t.GRAPH_NODE)return r}},this.removeFromParentsChildList=function(e){var n=t.parentMap.get(e);t.childrenMap.get(n).delete(e)},this.setParent=function(e,n){var r,i;t.checkCompound();for(var o=void 0===n?t.GRAPH_NODE:n,a=t.parent(o);a;){if(e===a)throw new Error("Setting "+n+" as parent of "+e+" would create a cycle");a=t.parent(a)}n&&t.setNode(n),t.setNode(e),t.removeFromParentsChildList(e),null===(r=t.parentMap)||void 0===r||r.set(e,o);var s=t.childrenMap.get(o);return s.set(e,!0),null===(i=t.childrenMap)||void 0===i||i.set(o,s),t},this.children=function(e){var n=void 0===e?t.GRAPH_NODE:e;if(t.isCompound()){var r,i=null===(r=t.childrenMap)||void 0===r?void 0:r.get(n);return i?Array.from(i.keys()):void 0}return n===t.GRAPH_NODE?t.nodes():e&&t.hasNode(e)?[]:void 0},this.predecessors=function(e){var n=t.predecessorsMap.get(e);return n?Array.from(n.keys()):void 0},this.successors=function(e){var n=t.successorsMap.get(e);return n?Array.from(n.keys()):void 0},this.neighbors=function(e){var n;if(t.hasNode(e))return Array.from(new Set(null===(n=t.predecessors(e))||void 0===n?void 0:n.concat(t.successors(e))))},this.isLeaf=function(e){var n,r;return t.isDirected()?!(null===(r=t.successors(e))||void 0===r?void 0:r.length):!(null===(n=t.neighbors(e))||void 0===n?void 0:n.length)},this.filterNodes=function(n){var r=t.directed,i=t.multigraph,o=t.compound,a=new e({directed:r,multigraph:i,compound:o});return a.setGraph(t.graph()),t.nodes().forEach((function(e){n(e)&&a.setNode(e,t.node(e))})),t.edges().forEach((function(e){a.hasNode(e.v)&&a.hasNode(e.w)&&a.setEdgeObj(e,t.edge(e))})),o&&a.nodes().forEach((function(e){a.setParent(e,function(e){for(var n=t.parent(e);void 0!==n&&!a.hasNode(n);)n=t.parent(n);return n}(e))})),a},this.setDefaultEdgeLabel=function(e){return He(e)?t.defaultEdgeLabelFn=e:t.defaultEdgeLabelFn=function(){return e},t},this.edgeCount=function(){return t.edgeCountNum},this.setEdgeObj=function(e,n){return t.setEdge(e.v,e.w,n,e.name)},this.setPath=function(e,n){return e.reduce((function(e,r){return t.setEdge(e,r,n),r})),t},this.edgeFromArgs=function(e,n,r){return t.edge({v:e,w:n,name:r})},this.edge=function(e){return t.edgesLabelsMap.get(We(t.isDirected(),e))},this.hasEdge=function(e,n,r){return t.edgesLabelsMap.has(We(t.isDirected(),{v:e,w:n,name:r}))},this.removeEdgeObj=function(e){var n=e.v,r=e.w,i=e.name;return t.removeEdge(n,r,i)},this.edges=function(){return Array.from(t.edgesMap.values())},this.inEdges=function(e,n){var r=t.inEdgesMap.get(e);if(r)return Array.from(r.values()).filter((function(e){return!n||e.v===n}))},this.outEdges=function(e,n){var r=t.outEdgesMap.get(e);if(r)return Array.from(r.values()).filter((function(e){return!n||e.w===n}))},this.nodeEdges=function(e,n){var r;if(t.hasNode(e))return null===(r=t.inEdges(e,n))||void 0===r?void 0:r.concat(t.outEdges(e,n))},this.toJSON=function(){return Ye(t)},this.nodeInDegree=function(e){var n=t.inEdgesMap.get(e);return n?n.size:0},this.nodeOutDegree=function(e){var n=t.outEdgesMap.get(e);return n?n.size:0},this.nodeDegree=function(e){return t.nodeInDegree(e)+t.nodeOutDegree(e)},this.source=function(e){return e.v},this.target=function(e){return e.w};var r=$e($e({},et),n);this.compound=r.compound,this.directed=r.directed,this.multigraph=r.multigraph,this.compound&&(this.parentMap=new Map,this.childrenMap=new Map)}var t,n;return t=e,n=[{key:"setNode",value:function(e,t){var n,r=this.nodesLabelMap,i=this.defaultNodeLabelFn,o=this.isCompound,a=this.parentMap,s=this.childrenMap,u=this.inEdgesMap,c=this.outEdgesMap,l=this.predecessorsMap,f=this.successorsMap;return r.has(e)?(void 0!==t&&r.set(e,t),this):(r.set(e,t||i(e)),o()&&(null==a||a.set(e,this.GRAPH_NODE),null==s||s.set(e,new Map),(null==s?void 0:s.has(this.GRAPH_NODE))||null==s||s.set(this.GRAPH_NODE,new Map),null==s||null===(n=s.get(this.GRAPH_NODE))||void 0===n||n.set(e,!0)),[u,c,l,f].forEach((function(t){return t.set(e,new Map)})),this.nodeCountNum+=1,this)}},{key:"removeNode",value:function(e){var t=this;if(this.hasNode(e)){var n,r,i,o=function(e){t.removeEdge(e.v,e.w,e.name)},a=this.inEdgesMap,s=this.outEdgesMap,u=this.predecessorsMap,c=this.successorsMap,l=this.nodesLabelMap;this.isCompound()&&(this.removeFromParentsChildList(e),null===(n=this.parentMap)||void 0===n||n.delete(e),null===(r=this.children(e))||void 0===r||r.forEach((function(e){return t.setParent(e)})),null===(i=this.childrenMap)||void 0===i||i.delete(e));var f=a.get(e),d=s.get(e);Array.from(f.values()).forEach((function(e){return o(e)})),Array.from(d.values()).forEach((function(e){return o(e)})),l.delete(e),a.delete(e),s.delete(e),u.delete(e),c.delete(e),this.nodeCountNum-=1}return this}},{key:"setEdge",value:function(e,t,n,r){var i,o,a=Ve(this.isDirected(),e,t,r),s=We(this.isDirected(),a),u=a.v,c=a.w;if(this.edgesLabelsMap.has(s))return this.edgesLabelsMap.set(s,n),this;if(void 0!==r&&!this.isMultigraph())throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(u),this.setNode(c),this.edgesLabelsMap.set(s,n||this.defaultEdgeLabelFn(u,c,r)),Object.freeze(a),this.edgesMap.set(s,a);var l=this.predecessorsMap.get(c),f=this.successorsMap.get(u);return Be(l,u),Be(f,c),null===(i=this.inEdgesMap.get(c))||void 0===i||i.set(s,a),null===(o=this.outEdgesMap.get(u))||void 0===o||o.set(s,a),this.edgeCountNum+=1,this}},{key:"removeEdge",value:function(e,t,n){var r=Fe(this.isDirected(),e,t,n);if(this.edgesMap.get(r)){var i=Ve(this.isDirected(),e,t,n),o=i.v,a=i.w;this.edgesLabelsMap.delete(r),this.edgesMap.delete(r);var s=this.predecessorsMap.get(a),u=this.successorsMap.get(o);je(s,o),je(u,a),this.inEdgesMap.get(a).delete(r),this.outEdgesMap.get(o).delete(r),this.edgeCountNum-=1}return this}}],n&&Qe(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rt(e,t,n){return t&&nt(e.prototype,t),n&&nt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}tt.fromJSON=function(e){var t=new tt(e.options);return void 0!==e.value&&t.setGraph(e.value),e.nodes.forEach((function(e){t.setNode(e.id,e.value),e.parent&&t.setParent(e.id,e.parent)})),e.edges.forEach((function(e){t.setEdge(e.v,e.w,e.value,e.name)})),t};var it=rt((function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.arr=[],this.keyIndice=new Map,this.size=function(){return t.arr.length},this.keys=function(){return t.arr.map((function(e){return e.key}))},this.has=function(e){return t.keyIndice.has(e)},this.priority=function(e){var n=t.keyIndice.get(e);if(void 0!==n)return t.arr[n].priority},this.swap=function(e,n){var r=t.arr,i=t.keyIndice,o=[r[e],r[n]],a=o[0],s=o[1];r[e]=s,r[n]=a,i.set(a.key,n),i.set(s.key,e)},this.innerDecrease=function(e){for(var n,r=t.arr,i=r[e].priority,o=e;0!==o;){var a;if((null===(a=r[n=o>>1])||void 0===a?void 0:a.priority)<i)break;t.swap(o,n),o=n}},this.heapify=function(e){var n=t.arr,r=e<<1,i=r+1,o=e;r<n.length&&(o=n[r].priority<n[o].priority?r:o,i<n.length&&(o=n[i].priority<n[o].priority?i:o),o!==e&&(t.swap(e,o),t.heapify(o)))},this.min=function(){if(0===t.size())throw new Error("Queue underflow");return t.arr[0].key},this.add=function(e,n){var r=t.keyIndice,i=t.arr;if(!r.has(e)){var o=i.length;return r.set(e,o),i.push({key:e,priority:n}),t.innerDecrease(o),!0}return!1},this.removeMin=function(){t.swap(0,t.arr.length-1);var e=t.arr.pop();return t.keyIndice.delete(e.key),t.heapify(0),e.key},this.decrease=function(e,n){if(!t.has(e))throw new Error("There's no key named ".concat(e));var r=t.keyIndice.get(e);if(n>t.arr[r].priority)throw new Error("New priority is greater than current priority.Key: ".concat(e," Old: + ").concat(t.arr[r].priority," New: ").concat(n));t.arr[r].priority=n,t.innerDecrease(r)}}));const ot=function(e,t){var n,r=new tt,i=new Map,o=new it;function a(e){var r=e.v===n?e.w:e.v,a=o.priority(r);if(void 0!==a){var s=t(e);s<a&&(i.set(r,n),o.decrease(r,s))}}if(0===e.nodeCount())return r;e.nodes().forEach((function(e){o.add(e,Number.POSITIVE_INFINITY),r.setNode(e)})),o.decrease(e.nodes()[0],0);for(var s=!1;o.size()>0;){var u;if(n=o.removeMin(),i.has(n))r.setEdge(n,i.get(n));else{if(s)throw new Error("Input graph is not connected: "+e.graph());s=!0}null===(u=e.nodeEdges(n))||void 0===u||u.forEach(a)}return r},at=function(e){var t=new Set,n=[];return e.nodes().forEach((function(r){for(var i=[],o=[r];o.length>0;){var a,s,u=o.pop();t.has(u)||(t.add(u),i.push(u),null===(a=e.successors(u))||void 0===a||a.forEach((function(e){return o.push(e)})),null===(s=e.predecessors(u))||void 0===s||s.forEach((function(e){return o.push(e)})))}i.length&&n.push(i)})),n};var st=function e(t,n,r,i,o,a){i.includes(n)||(i.push(n),r||a.push(n),o(n).forEach((function(n){return e(t,n,r,i,o,a)})),r&&a.push(n))};const ut=function(e,t,n){var r=Array.isArray(t)?t:[t],i=function(t){return e.isDirected()?e.successors(t):e.neighbors(t)},o=[],a=[];return r.forEach((function(t){if(!e.hasNode(t))throw new Error("Graph does not have node: "+t);st(e,t,"post"===n,a,i,o)})),o};function ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var lt=function(){return 1},ft=function(e,t,n,r){var i,o,a=new Map,s=new it,u=function(e){var t=e.v!==i?e.v:e.w,r=a.get(t),u=n(e),c=o.distance+u;if(u<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+e+" Weight: "+u);c<r.distance&&(r.distance=c,r.predecessor=i,s.decrease(t,c))};for(e.nodes().forEach((function(e){var n=e===t?0:Number.POSITIVE_INFINITY;a.set(e,{distance:n}),s.add(e,n)}));s.size()>0&&(i=s.removeMin(),!(o=a.get(i))||o.distance!==Number.POSITIVE_INFINITY);)r(i).forEach(u);var c={};return Array.from(a.entries()).forEach((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ct(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ct(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],r=t[1];return c[String(n)]=r,c})),c};const dt=function(e,t,n,r){return ft(e,t,n||lt,r||function(t){return e.outEdges(t)})},ht=function(e,t,n){var r={};return e.nodes().forEach((function(i){return r[String(i)]=dt(e,i,t,n),r})),r},pt=function(e){var t=0,n=[],r=new Map,i=[];function o(a){var s,u={onStack:!0,lowlink:t,index:t};if(r.set(a,u),t+=1,n.push(a),null===(s=e.successors(a))||void 0===s||s.forEach((function(e){var t;if(r.has(e)){if(null===(t=r.get(e))||void 0===t?void 0:t.onStack){var n=r.get(e);u.lowlink=Math.min(u.lowlink,n.index)}}else{o(e);var i=r.get(e);u.lowlink=Math.min(u.lowlink,i.lowlink)}})),u.lowlink===u.index){var c,l=[];do{c=n.pop(),r.get(c).onStack=!1,l.push(c)}while(a!==c);i.push(l)}}return e.nodes().forEach((function(e){r.has(e)||o(e)})),i},gt=function(e){return pt(e).filter((function(t){return t.length>1||1===t.length&&e.hasEdge(t[0],t[0])}))};function vt(e){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vt(e)}function mt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yt(e,t){if(t&&("object"===vt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function bt(e){var t="function"==typeof Map?new Map:void 0;return bt=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return Et(e,arguments,wt(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),xt(r,e)},bt(e)}function Et(e,t,n){return Et=_t()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&xt(i,n.prototype),i},Et.apply(null,arguments)}function _t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function xt(e,t){return xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},xt(e,t)}function wt(e){return wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},wt(e)}var St=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xt(e,t)}(o,e);var t,n,r,i=(t=o,n=_t(),function(){var e,r=wt(t);if(n){var i=wt(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return yt(this,e)});function o(){return mt(this,o),i.apply(this,arguments)}return r=o,Object.defineProperty(r,"prototype",{writable:!1}),r}(bt(Error));const At=function(e){var t=new Set,n=new Set,r=[];if(e.sinks().forEach((function i(o){if(n.has(o))throw new St;var a;t.has(o)||(n.add(o),t.add(o),null===(a=e.predecessors(o))||void 0===a||a.forEach(i),n.delete(o),r.push(o))})),t.size!==e.nodeCount())throw new St;return r},Tt=function(e){try{At(e)}catch(e){if(e instanceof St)return!1;throw e}return!0},It=function(e,t){return ut(e,t,"post")},Nt=function(e,t){return ut(e,t,"pre")};var Dt=function(){return 1};const kt=function(e,t,n){return function(e,t,n){var r={},i=e.nodes();return i.forEach((function(e){var o=String(e);r[o]={},r[o][o]={distance:0},i.forEach((function(t){e!==t&&(r[o][String(t)]={distance:Number.POSITIVE_INFINITY})})),n(e).forEach((function(n){var i=n.v===e?n.w:n.v,a=t(n);r[o][String(i)]={distance:a,predecessor:e}}))})),i.forEach((function(e){var t=String(e),n=r[t];i.forEach((function(e){var o=String(e),a=r[o];i.forEach((function(e){var r=String(e),i=a[t],o=n[r],s=a[r],u=i.distance+o.distance;u<s.distance&&(s.distance=u,s.predecessor=o.predecessor)}))}))})),r}(e,t||Dt,n||function(t){return e.outEdges(t)})};class Ct extends Ue{}class Mt extends tt{}const Ot=()=>1,Rt=(e,t,n,r,i)=>{var o,a;const s=[];return null===(o=e.inEdges(r.v))||void 0===o||o.forEach((r=>{const o=e.edge(r),a=e.node(r.v);i&&s.push({v:r.v,w:r.w,in:0,out:0}),void 0===a.out&&(a.out=0),a.out-=o,Pt(t,n,a)})),null===(a=e.outEdges(r.v))||void 0===a||a.forEach((r=>{const i=e.edge(r),o=r.w,a=e.node(o);void 0===a.in&&(a.in=0),a.in-=i,Pt(t,n,a)})),e.removeNode(r.v),i?s:void 0},Pt=(e,t,n)=>{n.out?n.in?e[n.out-n.in+t].enqueue(n):e[e.length-1].enqueue(n):e[0].enqueue(n)},Gt=(e,t)=>{var n;if(e.nodeCount()<=1)return[];const r=((e,t)=>{const n=new Mt;let r=0,i=0;e.nodes().forEach((e=>{n.setNode(e,{v:e,in:0,out:0})})),e.edges().forEach((e=>{const o=n.edge(e)||0,a=(null==t?void 0:t(e))||1,s=o+a;n.setEdge(e.v,e.w,s),i=Math.max(i,n.node(e.v).out+=a),r=Math.max(r,n.node(e.w).in+=a)}));const o=[],a=i+r+3;for(let e=0;e<a;e++)o.push(new Ct);const s=r+1;return n.nodes().forEach((e=>{Pt(o,s,n.node(e))})),{buckets:o,zeroIdx:s,graph:n}})(e,t||Ot);return null===(n=((e,t,n)=>{let r=[];const i=t[t.length-1],o=t[0];let a;for(;e.nodeCount();){for(;a=o.dequeue();)Rt(e,t,n,a);for(;a=i.dequeue();)Rt(e,t,n,a);if(e.nodeCount())for(let i=t.length-2;i>0;--i)if(a=t[i].dequeue(),a){r=r.concat(Rt(e,t,n,a,!0));break}}return r})(r.graph,r.buckets,r.zeroIdx).map((t=>e.outEdges(t.v,t.w))))||void 0===n?void 0:n.flat()};class Lt extends tt{}const Ut=(e,t,n,r)=>{let i;do{i=`${r}${Math.random()}`}while(e.hasNode(i));return n.dummy=t,e.setNode(i,n),i},zt=e=>{const t=new Lt({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach((n=>{var r;(null===(r=e.children(n))||void 0===r?void 0:r.length)||t.setNode(n,e.node(n))})),e.edges().forEach((n=>{t.setEdgeObj(n,e.edge(n))})),t},Bt=(e,t)=>{const n=Number(e.x),r=Number(e.y),i=Number(t.x)-n,o=Number(t.y)-r;let a,s,u=Number(e.width)/2,c=Number(e.height)/2;return i||o?(Math.abs(o)*u>Math.abs(i)*c?(o<0&&(c=-c),a=c*i/o,s=c):(i<0&&(u=-u),a=u,s=u*o/i),{x:n+a,y:r+s}):{x:0,y:0}},jt=e=>{const t=[],n=Vt(e)+1;for(let e=0;e<n;e++)t.push([]);e.nodes().forEach((n=>{const r=e.node(n).rank;void 0!==r&&t[r]&&t[r].push(n)}));for(let r=0;r<n;r++)t[r]=t[r].sort(((t,n)=>{var r,i,o,a;return o=null===(r=e.node(t))||void 0===r?void 0:r.order,a=null===(i=e.node(n))||void 0===i?void 0:i.order,Number(o)-Number(a)}));return t},Ft=(e,t,n,r)=>{const i={width:0,height:0};return u(n)&&u(r)&&(i.rank=n,i.order=r),Ut(e,"border",i,t)},Vt=e=>{let t;return e.nodes().forEach((n=>{var r;const i=null===(r=e.node(n))||void 0===r?void 0:r.rank;void 0!==i&&(void 0===t||i>t)&&(t=i)})),t||(t=0),t},Wt=(e,t)=>{const n=Date.now();try{return t()}finally{console.log(`${e} time: ${Date.now()-n}ms`)}},Ht=(e,t)=>t(),Xt=(e,t)=>e.reduce(((e,n)=>t(e)>t(n)?n:e)),qt=e=>{e.graph().dummyChains=[],e.edges().forEach((t=>((e,t)=>{let n=t.v,r=e.node(n).rank;const i=t.w,o=e.node(i).rank,a=t.name,s=e.edge(t),u=s.labelRank;if(o===r+1)return;e.removeEdgeObj(t);const c=e.graph();let l,f,d;for(d=0,++r;r<o;++d,++r)s.points=[],f={edgeLabel:s,width:0,height:0,edgeObj:t,rank:r},l=Ut(e,"edge",f,"_d"),r===u&&(f.width=s.width,f.height=s.height,f.dummy="edge-label",f.labelpos=s.labelpos),e.setEdge(n,l,{weight:s.weight},a),0===d&&(c.dummyChains||(c.dummyChains=[]),c.dummyChains.push(l)),n=l;e.setEdge(n,i,{weight:s.weight},a)})(e,t)))},Yt=e=>{var t;const n={},r=t=>{var i;const o=e.node(t);if(n[t])return o.rank;let a;return n[t]=!0,null===(i=e.outEdges(t))||void 0===i||i.forEach((t=>{const n=r(t.w)-e.edge(t).minlen;n&&(void 0===a||n<a)&&(a=n)})),a||(a=0),o.rank=a,a};null===(t=e.sources())||void 0===t||t.forEach((e=>r(e)))},Kt=(e,t)=>e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen,$t=(e,t)=>{const n=r=>{t.nodeEdges(r).forEach((i=>{const o=i.v,a=r===o?i.w:o;e.hasNode(a)||Kt(t,i)||(e.setNode(a,{}),e.setEdge(r,a,{}),n(a))}))};return e.nodes().forEach(n),e.nodeCount()},Zt=(e,t)=>{const n=r=>{var i;null===(i=t.nodeEdges(r))||void 0===i||i.forEach((i=>{const o=i.v,a=r===o?i.w:o;e.hasNode(a)||void 0===t.node(a).layer&&Kt(t,i)||(e.setNode(a,{}),e.setEdge(r,a,{}),n(a))}))};return e.nodes().forEach(n),e.nodeCount()},Jt=(e,t)=>Xt(t.edges(),(n=>e.hasNode(n.v)!==e.hasNode(n.w)?Kt(t,n):1/0)),Qt=(e,t,n)=>{e.nodes().forEach((e=>{t.node(e).rank||(t.node(e).rank=0),t.node(e).rank+=n}))},{preorder:en,postorder:tn}=r,nn=(e,t)=>{let n=tn(e,e.nodes());n=null==n?void 0:n.slice(0,(null==n?void 0:n.length)-1),null==n||n.forEach((n=>{rn(e,t,n)}))},rn=(e,t,n)=>{const r=e.node(n).parent;e.edgeFromArgs(n,r).cutvalue=on(e,t,n)},on=(e,t,n)=>{var r;const i=e.node(n).parent;let o=!0,a=t.edgeFromArgs(n,i),s=0;return a||(o=!1,a=t.edgeFromArgs(i,n)),s=a.weight,null===(r=t.nodeEdges(n))||void 0===r||r.forEach((r=>{const a=r.v===n,u=a?r.w:r.v;if(u!==i){const i=a===o,c=t.edge(r).weight;if(s+=i?c:-c,dn(e,n,u)){const t=e.edgeFromArgs(n,u).cutvalue;s+=i?-t:t}}})),s},an=(e,t=e.nodes()[0])=>{sn(e,{},1,t)},sn=(e,t,n,r,i)=>{var o;const a=n;let s=n;const u=e.node(r);return t[r]=!0,null===(o=e.neighbors(r))||void 0===o||o.forEach((n=>{t[n]||(s=sn(e,t,s,n,r))})),u.low=a,u.lim=s++,i?u.parent=i:delete u.parent,s},un=e=>e.edges().find((t=>e.edge(t).cutvalue<0)),cn=(e,t,n)=>{let r=n.v,i=n.w;t.hasEdge(r,i)||(r=n.w,i=n.v);const o=e.node(r),a=e.node(i);let s=o,u=!1;o.lim>a.lim&&(s=a,u=!0);const c=t.edges().filter((t=>u===hn(e,e.node(t.v),s)&&u!==hn(e,e.node(t.w),s)));return Xt(c,(e=>Kt(t,e)))},ln=(e,t,n,r)=>{const i=n.v,o=n.w;e.removeEdge(i,o),e.setEdge(r.v,r.w,{}),an(e),nn(e,t),fn(e,t)},fn=(e,t)=>{const n=e.nodes().find((e=>{var n;return!(null===(n=t.node(e))||void 0===n?void 0:n.parent)}));let r=en(e,n);r=null==r?void 0:r.slice(1),null==r||r.forEach((n=>{const r=e.node(n).parent;let i=t.edgeFromArgs(n,r),o=!1;i||(i=t.edgeFromArgs(r,n),o=!0),t.node(n).rank=t.node(r).rank+(o?i.minlen:-i.minlen)}))},dn=(e,t,n)=>e.hasEdge(t,n),hn=(e,t,n)=>n.low<=t.lim&&t.lim<=n.lim,pn=e=>{const t=(e=>{const t=(new Lt).setGraph(e.graph());return e.nodes().forEach((n=>{t.setNode(n,e.node(n))})),e.edges().forEach((n=>{const r=t.edgeFromArgs(n.v,n.w)||{weight:0,minlen:1},i=e.edge(n);t.setEdge(n.v,n.w,{weight:r.weight+i.weight,minlen:Math.max(r.minlen,i.minlen)})})),t})(e);Yt(t);const n=(e=>{const t=new Lt({directed:!1}),n=e.nodes()[0],r=e.nodeCount();let i,o;for(t.setNode(n,{});$t(t,e)<r;)i=Jt(t,e),o=t.hasNode(i.v)?Kt(e,i):-Kt(e,i),Qt(t,e,o);return t})(t);let r,i;for(an(n),nn(n,t);r=un(n);)i=cn(n,t,r),ln(n,t,r,i)},gn=Yt,vn=e=>{(e=>{var t;const n={};let r;const i=t=>{var o;const a=e.node(t);if(n[t])return a.rank;let s;return n[t]=!0,null===(o=e.outEdges(t))||void 0===o||o.forEach((t=>{const n=i(t.w)-e.edge(t).minlen;n&&(void 0===s||n<s)&&(s=n)})),s||(s=0),(void 0===r||s<r)&&(r=s),a.rank=s,s};null===(t=e.sources())||void 0===t||t.forEach((e=>i(e))),void 0===r&&(r=0);const o={},a=(t,n)=>{var r;const i=e.node(t),s=isNaN(i.layer)?n:i.layer;(void 0===i.rank||i.rank<s)&&(i.rank=s),o[t]||(o[t]=!0,null===(r=e.outEdges(t))||void 0===r||r.map((t=>{a(t.w,s+e.edge(t).minlen)})))};e.nodes().forEach((t=>{const n=e.node(t);isNaN(n.layer)?n.rank-=r:a(t,n.layer)}))})(e),(e=>{const t=new Lt({directed:!1}),n=e.nodes()[0],r=e.nodeCount();let i,o;for(t.setNode(n,{});Zt(t,e)<r;)i=Jt(t,e),o=t.hasNode(i.v)?Kt(e,i):-Kt(e,i),Qt(t,e,o)})(e)},mn=e=>{switch(e.graph().ranker){case"network-simplex":(e=>{pn(e)})(e);break;case"tight-tree":default:vn(e);break;case"longest-path":gn(e)}},yn=(e,t,n,r,i,o,a)=>{const s=e.children(a);if(!(null==s?void 0:s.length))return void(a!==t&&e.setEdge(t,a,{weight:0,minlen:n}));const u=Ft(e,"_bt"),c=Ft(e,"_bb"),l=e.node(a);e.setParent(u,a),l.borderTop=u,e.setParent(c,a),l.borderBottom=c,null==s||s.forEach((s=>{yn(e,t,n,r,i,o,s);const l=e.node(s),f=l.borderTop?l.borderTop:s,d=l.borderBottom?l.borderBottom:s,h=l.borderTop?r:2*r,p=f!==d?1:i-o[a]+1;e.setEdge(u,f,{minlen:p,weight:h,nestingEdge:!0}),e.setEdge(d,c,{minlen:p,weight:h,nestingEdge:!0})})),e.parent(a)||e.setEdge(t,u,{weight:0,minlen:i+o[a]})},bn=(e,t,n,r,i,o)=>{const a={rank:o,borderType:t,width:0,height:0},s=i[t][o-1],u=Ut(e,"border",a,n);i[t][o]=u,e.setParent(u,r),s&&e.setEdge(s,u,{weight:1})},En=e=>{e.nodes().forEach((t=>{_n(e.node(t))})),e.edges().forEach((t=>{_n(e.edge(t))}))},_n=e=>{const t=e.width;e.width=e.height,e.height=t},xn=e=>{(null==e?void 0:e.y)&&(e.y=-e.y)},wn=e=>{const t=e.x;e.x=e.y,e.y=t},Sn=e=>{var t;const n=null===(t=e.graph().rankdir)||void 0===t?void 0:t.toLowerCase();"bt"!==n&&"rl"!==n||(e=>{e.nodes().forEach((t=>{xn(e.node(t))})),e.edges().forEach((t=>{var n;const r=e.edge(t);null===(n=r.points)||void 0===n||n.forEach((e=>xn(e))),r.hasOwnProperty("y")&&xn(r)}))})(e),"lr"!==n&&"rl"!==n||((e=>{e.nodes().forEach((t=>{wn(e.node(t))})),e.edges().forEach((t=>{var n;const r=e.edge(t);null===(n=r.points)||void 0===n||n.forEach((e=>wn(e))),r.hasOwnProperty("x")&&wn(r)}))})(e),En(e))},An=e=>{const t={},n=e.nodes().filter((t=>{var n;return!(null===(n=e.children(t))||void 0===n?void 0:n.length)})),r=n.map((t=>e.node(t).rank)),i=Math.max(...r),o=[];for(let e=0;e<i+1;e++)o.push([]);const a=n=>{var r;if(t.hasOwnProperty(n))return;t[n]=!0;const i=e.node(n);isNaN(i.rank)||o[i.rank].push(n),null===(r=e.successors(n))||void 0===r||r.forEach((e=>a(e)))},s=n.sort(((t,n)=>e.node(t).rank-e.node(n).rank)),u=s.filter((t=>void 0!==e.node(t).fixorder)),c=u.sort(((t,n)=>e.node(t).fixorder-e.node(n).fixorder));return null==c||c.forEach((n=>{isNaN(e.node(n).rank)||o[e.node(n).rank].push(n),t[n]=!0})),null==s||s.forEach(a),o},Tn=(e,t,n)=>{const r=(a=n,s=n.map(((e,t)=>t)),null==a?void 0:a.reduce(((e,t,n)=>(e[t]=s[n],e)),{})),i=t.map((t=>{var n;const i=null===(n=e.outEdges(t))||void 0===n?void 0:n.map((t=>({pos:r[t.w]||0,weight:e.edge(t).weight})));return null==i?void 0:i.sort(((e,t)=>e.pos-t.pos))})),o=i.flat().filter((e=>void 0!==e));var a,s;let u=1;for(;u<n.length;)u<<=1;const c=2*u-1;u-=1;const l=Array(c).fill(0,0,c);let f=0;return null==o||o.forEach((e=>{if(e){let t=e.pos+u;l[t]+=e.weight;let n=0;for(;t>0;)t%2&&(n+=l[t+1]),t=t-1>>1,l[t]+=e.weight;f+=e.weight*n}})),f},In=(e,t)=>{let n=0;for(let r=1;r<(null==t?void 0:t.length);r+=1)n+=Tn(e,t[r-1],t[r]);return n},Nn=(e,t,n)=>{const r=(e=>{let t;for(;e.hasNode(t=`_root${Math.random()}`););return t})(e),i=new Lt({compound:!0}).setGraph({root:r}).setDefaultNodeLabel((t=>e.node(t)));return e.nodes().forEach((o=>{var a;const s=e.node(o),u=e.parent(o);(s.rank===t||s.minRank<=t&&t<=s.maxRank)&&(i.setNode(o),i.setParent(o,u||r),null===(a=e[n](o))||void 0===a||a.forEach((t=>{const n=t.v===o?t.w:t.v,r=i.edgeFromArgs(n,o),a=void 0!==r?r.weight:0;i.setEdge(n,o,{weight:e.edge(t).weight+a})})),s.hasOwnProperty("minRank")&&i.setNode(o,{borderLeft:s.borderLeft[t],borderRight:s.borderRight[t]}))})),i},Dn=(e,t)=>{var n;let r=0,i=0;e.weight&&(r+=e.barycenter*e.weight,i+=e.weight),t.weight&&(r+=t.barycenter*t.weight,i+=t.weight),e.vs=null===(n=t.vs)||void 0===n?void 0:n.concat(e.vs),e.barycenter=r/i,e.weight=i,e.i=Math.min(t.i,e.i),t.merged=!0},kn=(e,t)=>{var n,r,i;const o={};null==e||e.forEach(((e,t)=>{o[e.v]={i:t,indegree:0,in:[],out:[],vs:[e.v]};const n=o[e.v];void 0!==e.barycenter&&(n.barycenter=e.barycenter,n.weight=e.weight)})),null===(n=t.edges())||void 0===n||n.forEach((e=>{const t=o[e.v],n=o[e.w];void 0!==t&&void 0!==n&&(n.indegree++,t.out.push(o[e.w]))}));return(e=>{var t,n;const r=[];for(;null==e?void 0:e.length;){const i=e.pop();r.push(i),null===(t=i.in.reverse())||void 0===t||t.forEach((e=>{return(t=i,e=>{e.merged||(void 0===e.barycenter||void 0===t.barycenter||e.barycenter>=t.barycenter)&&Dn(t,e)})(e);var t})),null===(n=i.out)||void 0===n||n.forEach((t=>{return(n=i,t=>{t.in.push(n),0==--t.indegree&&e.push(t)})(t);var n}))}const i=r.filter((e=>!e.merged)),o=["vs","i","barycenter","weight"];return i.map((e=>{const t={};return null==o||o.forEach((n=>{void 0!==e[n]&&(t[n]=e[n])})),t}))})(null===(i=(r=Object.values(o)).filter)||void 0===i?void 0:i.call(r,(e=>!e.indegree)))},Cn=(e,t,n)=>{let r,i=n;for(;t.length&&(r=t[t.length-1]).i<=i;)t.pop(),null==e||e.push(r.vs),i++;return i},Mn=(e,t,n)=>{const r=((e,t)=>{const n={lhs:[],rhs:[]};return null==e||e.forEach((e=>{var t;(t=e).hasOwnProperty("fixorder")&&!isNaN(t.fixorder)||t.hasOwnProperty("barycenter")?n.lhs.push(e):n.rhs.push(e)})),n})(e),i=r.lhs,o=r.rhs.sort(((e,t)=>-e.i- -t.i)),a=[];let s=0,u=0,c=0;null==i||i.sort(((e,t)=>(n,r)=>{if(void 0!==n.fixorder&&void 0!==r.fixorder)return n.fixorder-r.fixorder;if(n.barycenter<r.barycenter)return-1;if(n.barycenter>r.barycenter)return 1;if(t&&void 0!==n.order&&void 0!==r.order){if(n.order<r.order)return-1;if(n.order>r.order)return 1}return e?r.i-n.i:n.i-r.i})(!!t,!!n)),c=Cn(a,o,c),null==i||i.forEach((e=>{var t;c+=null===(t=e.vs)||void 0===t?void 0:t.length,a.push(e.vs),s+=e.barycenter*e.weight,u+=e.weight,c=Cn(a,o,c)}));const l={vs:a.flat()};return u&&(l.barycenter=s/u,l.weight=u),l},On=(e,t,n,r,i)=>{var o,a,s,u;let c=e.children(t);const l=e.node(t),f=l?l.borderLeft:void 0,d=l?l.borderRight:void 0,h={};f&&(c=null==c?void 0:c.filter((e=>e!==f&&e!==d)));const p=((e,t)=>t.map((t=>{const n=e.inEdges(t);if(!(null==n?void 0:n.length))return{v:t};{const r={sum:0,weight:0};return null==n||n.forEach((t=>{const n=e.edge(t),i=e.node(t.v);r.sum+=n.weight*i.order,r.weight+=n.weight})),{v:t,barycenter:r.sum/r.weight,weight:r.weight}}})))(e,c||[]);null==p||p.forEach((t=>{var i;if(null===(i=e.children(t.v))||void 0===i?void 0:i.length){const i=On(e,t.v,n,r);h[t.v]=i,i.hasOwnProperty("barycenter")&&Pn(t,i)}}));const g=kn(p,n);Rn(g,h),null===(o=g.filter((e=>e.vs.length>0)))||void 0===o||o.forEach((t=>{const n=e.node(t.vs[0]);n&&(t.fixorder=n.fixorder,t.order=n.order)}));const v=Mn(g,r,i);if(f&&(v.vs=[f,v.vs,d].flat(),null===(a=e.predecessors(f))||void 0===a?void 0:a.length)){const t=e.node((null===(s=e.predecessors(f))||void 0===s?void 0:s[0])||""),n=e.node((null===(u=e.predecessors(d))||void 0===u?void 0:u[0])||"");v.hasOwnProperty("barycenter")||(v.barycenter=0,v.weight=0),v.barycenter=(v.barycenter*v.weight+t.order+n.order)/(v.weight+2),v.weight+=2}return v},Rn=(e,t)=>{null==e||e.forEach((e=>{var n;const r=null===(n=e.vs)||void 0===n?void 0:n.map((e=>t[e]?t[e].vs:e));e.vs=r.flat()}))},Pn=(e,t)=>{void 0!==e.barycenter?(e.barycenter=(e.barycenter*e.weight+t.barycenter*t.weight)/(e.weight+t.weight),e.weight+=t.weight):(e.barycenter=t.barycenter,e.weight=t.weight)},Gn=On,Ln=(e,t,n)=>t.map((t=>Nn(e,t,n))),Un=(e,t,n)=>{const r=new Lt;null==e||e.forEach((e=>{var i;const o=e.graph().root,a=Gn(e,o,r,t,n);for(let t=0;t<(null===(i=a.vs)||void 0===i?void 0:i.length);t++){const n=e.node(a.vs[t]);n&&(n.order=t)}((e,t,n)=>{const r={};let i;null==n||n.forEach((n=>{let o,a,s=e.parent(n);for(;s;){if(o=e.parent(s),o?(a=r[o],r[o]=s):(a=i,i=s),a&&a!==s)return void t.setEdge(a,s);s=o}}))})(e,r,a.vs)}))},zn=(e,t)=>{null==t||t.forEach((t=>{null==t||t.forEach(((t,n)=>{e.node(t).order=n}))}))};class Bn extends tt{}const jn=(e,t)=>{var n,r;if(null===(n=e.node(t))||void 0===n?void 0:n.dummy)return null===(r=e.predecessors(t))||void 0===r?void 0:r.find((t=>e.node(t).dummy))},Fn=(e,t,n)=>{let r=t,i=n;if(r>i){const e=r;r=i,i=e}let o=e[r];o||(e[r]=o={}),o[i]=!0},Vn=(e,t,n)=>{let r=t,i=n;return r>n&&(r=n,i=t),!!e[r]},Wn=(e,t,n,r)=>{const i=new Bn,o=e.graph(),a=Hn(o.nodesep,o.edgesep,r);return null==t||t.forEach((t=>{let r;null==t||t.forEach((t=>{const o=n[t];if(i.setNode(o),r){const s=n[r],u=i.edgeFromArgs(s,o);i.setEdge(s,o,Math.max(a(e,t,r),u||0))}r=t}))})),i};const Hn=(e,t,n)=>(r,i,o)=>{const a=r.node(i),s=r.node(o);let u,c=0;if(c+=a.width/2,a.hasOwnProperty("labelpos"))switch((a.labelpos||"").toLowerCase()){case"l":u=-a.width/2;break;case"r":u=a.width/2}if(u&&(c+=n?u:-u),u=0,c+=(a.dummy?t:e)/2,c+=(s.dummy?t:e)/2,c+=s.width/2,s.labelpos)switch((s.labelpos||"").toLowerCase()){case"l":u=s.width/2;break;case"r":u=-s.width/2}return u&&(c+=n?u:-u),u=0,c},Xn=(e,t)=>e.node(t).width||0,qn=e=>{var t;const n=zt(e);(e=>{const t=jt(e),n=e.graph().ranksep;let r=0;null==t||t.forEach((t=>{const i=t.map((t=>e.node(t).height)),o=Math.max(...i,0);null==t||t.forEach((t=>{e.node(t).y=r+o/2})),r+=o+n}))})(n);const r=(e=>{const t=jt(e),n=Object.assign(((e,t)=>{const n={};return(null==t?void 0:t.length)&&t.reduce(((t,r)=>{let i=0,o=0;const a=t.length,s=null==r?void 0:r[(null==r?void 0:r.length)-1];return null==r||r.forEach(((t,u)=>{var c;const l=jn(e,t),f=l?e.node(l).order:a;(l||t===s)&&(null===(c=r.slice(o,u+1))||void 0===c||c.forEach((t=>{var r;null===(r=e.predecessors(t))||void 0===r||r.forEach((r=>{var o;const a=e.node(r),s=a.order;!(s<i||f<s)||a.dummy&&(null===(o=e.node(t))||void 0===o?void 0:o.dummy)||Fn(n,r,t)}))})),o=u+1,i=f)})),r})),n})(e,t),((e,t)=>{const n={},r=(t,r,i,o,a)=>{let s;const u=[];for(let e=r;e<i;e++)u.push(e);u.forEach((r=>{var i,u;s=t[r],(null===(i=e.node(s))||void 0===i?void 0:i.dummy)&&(null===(u=e.predecessors(s))||void 0===u||u.forEach((t=>{const r=e.node(t);r.dummy&&(r.order<o||r.order>a)&&Fn(n,t,s)})))}))};return(null==t?void 0:t.length)&&t.reduce(((t,n)=>{let i,o=-1,a=0;return null==n||n.forEach(((s,u)=>{var c;if("border"===(null===(c=e.node(s))||void 0===c?void 0:c.dummy)){const t=e.predecessors(s)||[];t.length&&(i=e.node(t[0]).order,r(n,a,u,o,i),a=u,o=i)}r(n,a,n.length,i,t.length)})),n})),n})(e,t)),r={};let i=[];["u","d"].forEach((o=>{i="u"===o?t:Object.values(t).reverse(),["l","r"].forEach((t=>{"r"===t&&(i=i.map((e=>Object.values(e).reverse())));const a=("u"===o?e.predecessors:e.successors).bind(e),s=((e,t,n,r)=>{const i={},o={},a={};return null==t||t.forEach((e=>{null==e||e.forEach(((e,t)=>{i[e]=e,o[e]=e,a[e]=t}))})),null==t||t.forEach((e=>{let t=-1;null==e||e.forEach((e=>{let s=r(e);if(s.length){s=s.sort(((e,t)=>a[e]-a[t]));const r=(s.length-1)/2;for(let u=Math.floor(r),c=Math.ceil(r);u<=c;++u){const r=s[u];o[e]===e&&t<a[r]&&!Vn(n,e,r)&&(o[r]=e,o[e]=i[e]=i[r],t=a[r])}}}))})),{root:i,align:o}})(0,i,n,a),u=((e,t,n,r,i)=>{var o;const a={},s=Wn(e,t,n,i),u=i?"borderLeft":"borderRight",c=(e,t)=>{let n=s.nodes(),r=n.pop();const i={};for(;r;)i[r]?e(r):(i[r]=!0,n.push(r),n=n.concat(t(r))),r=n.pop()};return c((e=>{a[e]=(s.inEdges(e)||[]).reduce(((e,t)=>Math.max(e,(a[t.v]||0)+s.edge(t))),0)}),s.predecessors.bind(s)),c((t=>{const n=(s.outEdges(t)||[]).reduce(((e,t)=>Math.min(e,(a[t.w]||0)-s.edge(t))),Number.POSITIVE_INFINITY),r=e.node(t);n!==Number.POSITIVE_INFINITY&&r.borderType!==u&&(a[t]=Math.max(a[t],n))}),s.successors.bind(s)),null===(o=Object.values(r))||void 0===o||o.forEach((e=>{a[e]=a[n[e]]})),a})(e,i,s.root,s.align,"r"===t);"r"===t&&Object.keys(u).forEach((e=>u[e]=-u[e])),r[o+t]=u}))}));const o=((e,t)=>Xt(Object.values(t),(t=>{var n;let r=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;return null===(n=Object.keys(t))||void 0===n||n.forEach((n=>{const o=t[n],a=Xn(e,n)/2;r=Math.max(o+a,r),i=Math.min(o-a,i)})),r-i})))(e,r);return o&&function(e,t){const n=Object.values(t),r=Math.min(...n),i=Math.max(...n);["u","d"].forEach((n=>{["l","r"].forEach((o=>{const a=n+o,s=e[a];let u;if(s===t)return;const c=Object.values(s);u="l"===o?r-Math.min(...c):i-Math.max(...c),u&&(e[a]={},Object.keys(s).forEach((t=>{e[a][t]=s[t]+u})))}))}))}(r,o),((e,t)=>{const n={};return Object.keys(e.ul).forEach((r=>{if(t)n[r]=e[t.toLowerCase()][r];else{const t=Object.values(e).map((e=>e[r]));n[r]=(t[0]+t[1])/2}})),n})(r,e.graph().align)})(n);null===(t=Object.keys(r))||void 0===t||t.forEach((e=>{n.node(e).x=r[e]}))},Yn=(e,t,n)=>{t("    removeSelfEdges",(()=>{fr(e)})),t("    acyclic",(()=>{(e=>{const t="greedy"===e.graph().acyclicer?Gt(e,(e=>t=>{var n;return(null===(n=e.edge(t))||void 0===n?void 0:n.weight)||1})(e)):(e=>{const t=[],n={},r={},i=o=>{var a;r[o]||(r[o]=!0,n[o]=!0,null===(a=e.outEdges(o))||void 0===a||a.forEach((e=>{n[e.w]?t.push(e):i(e.w)})),delete n[o])};return e.nodes().forEach(i),t})(e);null==t||t.forEach((t=>{const n=e.edge(t);e.removeEdgeObj(t),n.forwardName=t.name,n.reversed=!0,e.setEdge(t.w,t.v,n,`rev-${Math.random()}`)}))})(e)})),t("    nestingGraph.run",(()=>{(e=>{var t;const n=Ut(e,"root",{},"_root"),r=(e=>{var t;const n={},r=(t,i)=>{const o=e.children(t);null==o||o.forEach((e=>r(e,i+1))),n[t]=i};return null===(t=e.children())||void 0===t||t.forEach((e=>r(e,1))),n})(e);let i=Math.max(...Object.values(r));Math.abs(i)===1/0&&(i=1);const o=i-1,a=2*o+1;e.graph().nestingRoot=n,e.edges().forEach((t=>{e.edge(t).minlen*=a}));const s=(e=>{let t=0;return e.edges().forEach((n=>{t+=e.edge(n).weight})),t})(e)+1;null===(t=e.children())||void 0===t||t.forEach((t=>{yn(e,n,a,s,o,r,t)})),e.graph().nodeRankFactor=a})(e)})),t("    rank",(()=>{mn(zt(e))})),t("    injectEdgeLabelProxies",(()=>{rr(e)})),t("    removeEmptyRanks",(()=>{(e=>{const t=e.nodes(),n=t.filter((t=>{var n;return void 0!==(null===(n=e.node(t))||void 0===n?void 0:n.rank)})).map((t=>e.node(t).rank)),r=Math.min(...n),i=[];t.forEach((t=>{var n;const o=((null===(n=e.node(t))||void 0===n?void 0:n.rank)||0)-r;i[o]||(i[o]=[]),i[o].push(t)}));let o=0;const a=e.graph().nodeRankFactor||0;for(let t=0;t<i.length;t++){const n=i[t];void 0===n?t%a!=0&&(o-=1):o&&(null==n||n.forEach((t=>{const n=e.node(t);n&&(n.rank=n.rank||0,n.rank+=o)})))}})(e)})),t("    nestingGraph.cleanup",(()=>{(e=>{const t=e.graph();t.nestingRoot&&e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach((t=>{e.edge(t).nestingEdge&&e.removeEdgeObj(t)}))})(e)})),t("    normalizeRanks",(()=>{(e=>{const t=e.nodes().filter((t=>{var n;return void 0!==(null===(n=e.node(t))||void 0===n?void 0:n.rank)})).map((t=>e.node(t).rank)),n=Math.min(...t);e.nodes().forEach((t=>{const r=e.node(t);r.hasOwnProperty("rank")&&n!==1/0&&(r.rank-=n)}))})(e)})),t("    assignRankMinMax",(()=>{ir(e)})),t("    removeEdgeLabelProxies",(()=>{or(e)})),t("    normalize.run",(()=>{qt(e)})),t("    parentDummyChains",(()=>{(e=>{var t;const n=(e=>{var t;const n={};let r=0;const i=t=>{var o;const a=r;null===(o=e.children(t))||void 0===o||o.forEach(i),n[t]={low:a,lim:r++}};return null===(t=e.children())||void 0===t||t.forEach(i),n})(e);null===(t=e.graph().dummyChains)||void 0===t||t.forEach((t=>{var r,i;let o=t,a=e.node(o);const s=a.edgeObj;if(!s)return;const u=((e,t,n,r)=>{const i=[],o=[],a=Math.min(t[n].low,t[r].low),s=Math.max(t[n].lim,t[r].lim);let u,c;u=n;do{u=e.parent(u),i.push(u)}while(u&&(t[u].low>a||s>t[u].lim));for(c=u,u=r;u&&u!==c;)o.push(u),u=e.parent(u);return{lca:c,path:i.concat(o.reverse())}})(e,n,s.v,s.w),c=u.path,l=u.lca;let f=0,d=c[f],h=!0;for(;o!==s.w;){if(a=e.node(o),h){for(;d!==l&&(null===(r=e.node(d))||void 0===r?void 0:r.maxRank)<a.rank;)f++,d=c[f];d===l&&(h=!1)}if(!h){for(;f<c.length-1&&(null===(i=e.node(c[f+1]))||void 0===i?void 0:i.minRank)<=a.rank;)f++;d=c[f]}e.setParent(o,d),o=e.successors(o)[0]}}))})(e)})),t("    addBorderSegments",(()=>{(e=>{var t;const n=t=>{const r=e.children(t),i=e.node(t);if((null==r?void 0:r.length)&&r.forEach((e=>n(e))),i.hasOwnProperty("minRank")){i.borderLeft=[],i.borderRight=[];for(let n=i.minRank,r=i.maxRank+1;n<r;n+=1)bn(e,"borderLeft","_bl",t,i,n),bn(e,"borderRight","_br",t,i,n)}};null===(t=e.children())||void 0===t||t.forEach((e=>n(e)))})(e)})),n&&n.keepNodeOrder&&t("    initDataOrder",(()=>{((e,t)=>{const n=e.nodes().filter((t=>{var n;return!(null===(n=e.children(t))||void 0===n?void 0:n.length)})),r=n.map((t=>e.node(t).rank)),i=Math.max(...r),o=Array(i+1).fill([]);null==t||t.forEach((t=>{const n=e.node(t);n&&!(null==n?void 0:n.dummy)&&(isNaN(n.rank)||(n.fixorder=o[n.rank].length,o[n.rank].push(t)))}))})(e,n.nodeOrder)})),t("    order",(()=>{(e=>{const t=Vt(e),n=[],r=[];for(let e=1;e<t+1;e++)n.push(e);for(let e=t-1;e>-1;e--)r.push(e);const i=Ln(e,n,"inEdges"),o=Ln(e,r,"outEdges");let a=An(e);zn(e,a);let s,u=Number.POSITIVE_INFINITY;for(let t=0,n=0;n<4;++t,++n){Un(t%2?i:o,t%4>=2),a=jt(e);const r=In(e,a);r<u&&(n=0,s=f(a),u=r)}a=An(e),zn(e,a);for(let t=0,n=0;n<4;++t,++n){Un(t%2?i:o,t%4>=2,!0),a=jt(e);const r=In(e,a);r<u&&(n=0,s=f(a),u=r)}zn(e,s)})(e)})),t("    insertSelfEdges",(()=>{dr(e)})),t("    adjustCoordinateSystem",(()=>{(e=>{var t;const n=null===(t=e.graph().rankdir)||void 0===t?void 0:t.toLowerCase();"lr"!==n&&"rl"!==n||En(e)})(e)})),t("    position",(()=>{qn(e)})),t("    positionSelfEdges",(()=>{hr(e)})),t("    removeBorderNodes",(()=>{lr(e)})),t("    normalize.undo",(()=>{(e=>{var t;null===(t=e.graph().dummyChains)||void 0===t||t.forEach((t=>{let n=e.node(t);const r=n.edgeLabel;let i;n.edgeObj&&e.setEdgeObj(n.edgeObj,r);let o=t;for(;n.dummy;)i=e.successors(o)[0],e.removeNode(o),r.points.push({x:n.x,y:n.y}),"edge-label"===n.dummy&&(r.x=n.x,r.y=n.y,r.width=n.width,r.height=n.height),o=i,n=e.node(o)}))})(e)})),t("    fixupEdgeLabelCoords",(()=>{ur(e)})),t("    undoCoordinateSystem",(()=>{Sn(e)})),t("    translateGraph",(()=>{ar(e)})),t("    assignNodeIntersects",(()=>{sr(e)})),t("    reversePoints",(()=>{cr(e)})),t("    acyclic.undo",(()=>{(e=>{e.edges().forEach((t=>{const n=e.edge(t);if(n.reversed){e.removeEdgeObj(t);const r=n.forwardName;delete n.reversed,delete n.forwardName,e.setEdge(t.w,t.v,n,r)}}))})(e)}))},Kn=["nodesep","edgesep","ranksep","marginx","marginy"],$n={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},Zn=["acyclicer","ranker","rankdir","align"],Jn=["width","height","layer","fixorder"],Qn={width:0,height:0},er=["minlen","weight","width","height","labeloffset"],tr={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},nr=["labelpos"],rr=e=>{e.edges().forEach((t=>{const n=e.edge(t);if(n.width&&n.height){const n=e.node(t.v),r={e:t,rank:(e.node(t.w).rank-n.rank)/2+n.rank};Ut(e,"edge-proxy",r,"_ep")}}))},ir=e=>{let t=0;e.nodes().forEach((n=>{var r,i;const o=e.node(n);o.borderTop&&(o.minRank=null===(r=e.node(o.borderTop))||void 0===r?void 0:r.rank,o.maxRank=null===(i=e.node(o.borderBottom))||void 0===i?void 0:i.rank,t=Math.max(t,o.maxRank||-1/0))})),e.graph().maxRank=t},or=e=>{e.nodes().forEach((t=>{const n=e.node(t);"edge-proxy"===n.dummy&&(e.edge(n.e).labelRank=n.rank,e.removeNode(t))}))},ar=e=>{let t,n,r=0,i=0;const o=e.graph(),a=o.marginx||0,s=o.marginy||0,u=e=>{if(!e)return;const o=e.x,a=e.y,s=e.width,u=e.height;isNaN(o)||isNaN(s)||(void 0===t&&(t=o-s/2),t=Math.min(t,o-s/2),r=Math.max(r,o+s/2)),isNaN(a)||isNaN(u)||(void 0===n&&(n=a-u/2),n=Math.min(n,a-u/2),i=Math.max(i,a+u/2))};e.nodes().forEach((t=>{u(e.node(t))})),e.edges().forEach((t=>{const n=e.edge(t);(null==n?void 0:n.hasOwnProperty("x"))&&u(n)})),t-=a,n-=s,e.nodes().forEach((r=>{const i=e.node(r);i&&(i.x-=t,i.y-=n)})),e.edges().forEach((r=>{var i;const o=e.edge(r);null===(i=o.points)||void 0===i||i.forEach((e=>{e.x-=t,e.y-=n})),o.hasOwnProperty("x")&&(o.x-=t),o.hasOwnProperty("y")&&(o.y-=n)})),o.width=r-t+a,o.height=i-n+s},sr=e=>{e.edges().forEach((t=>{const n=e.edge(t),r=e.node(t.v),i=e.node(t.w);let o,a;n.points?(o=n.points[0],a=n.points[n.points.length-1]):(n.points=[],o=i,a=r),n.points.unshift(Bt(r,o)),n.points.push(Bt(i,a))}))},ur=e=>{e.edges().forEach((t=>{const n=e.edge(t);if(null==n?void 0:n.hasOwnProperty("x"))switch("l"!==n.labelpos&&"r"!==n.labelpos||(n.width-=n.labeloffset),n.labelpos){case"l":n.x-=n.width/2+n.labeloffset;break;case"r":n.x+=n.width/2+n.labeloffset}}))},cr=e=>{e.edges().forEach((t=>{var n;const r=e.edge(t);r.reversed&&(null===(n=r.points)||void 0===n||n.reverse())}))},lr=e=>{e.nodes().forEach((t=>{var n,r,i;if(null===(n=e.children(t))||void 0===n?void 0:n.length){const n=e.node(t),o=e.node(n.borderTop),a=e.node(n.borderBottom),s=e.node(n.borderLeft[(null===(r=n.borderLeft)||void 0===r?void 0:r.length)-1]),u=e.node(n.borderRight[(null===(i=n.borderRight)||void 0===i?void 0:i.length)-1]);n.width=Math.abs((null==u?void 0:u.x)-(null==s?void 0:s.x))||10,n.height=Math.abs((null==a?void 0:a.y)-(null==o?void 0:o.y))||10,n.x=((null==s?void 0:s.x)||0)+n.width/2,n.y=((null==o?void 0:o.y)||0)+n.height/2}})),e.nodes().forEach((t=>{var n;"border"===(null===(n=e.node(t))||void 0===n?void 0:n.dummy)&&e.removeNode(t)}))},fr=e=>{e.edges().forEach((t=>{if(t.v===t.w){const n=e.node(t.v);n.selfEdges||(n.selfEdges=[]),n.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdgeObj(t)}}))},dr=e=>{const t=jt(e);null==t||t.forEach((t=>{let n=0;null==t||t.forEach(((t,r)=>{var i;const o=e.node(t);o.order=r+n,null===(i=o.selfEdges)||void 0===i||i.forEach((t=>{Ut(e,"selfedge",{width:t.label.width,height:t.label.height,rank:o.rank,order:r+ ++n,e:t.e,label:t.label},"_se")})),delete o.selfEdges}))}))},hr=e=>{e.nodes().forEach((t=>{const n=e.node(t);if("selfedge"===n.dummy){const r=e.node(n.e.v),i=r.x+r.width/2,o=r.y,a=n.x-i,s=r.height/2;e.setEdgeObj(n.e,n.label),e.removeNode(t),n.label.points=[{x:i+2*a/3,y:o-s},{x:i+5*a/6,y:o-s},{y:o,x:i+a},{x:i+5*a/6,y:o+s},{x:i+2*a/3,y:o+s}],n.label.x=n.x,n.label.y=n.y}}))},pr=(e,t)=>{const n={};return null==t||t.forEach((t=>{void 0!==e[t]&&(n[t]=+e[t])})),n},gr=(e={})=>{const t={};return Object.keys(e).forEach((n=>{t[n.toLowerCase()]=e[n]})),t},vr=(e,t)=>{const n=t&&t.debugTiming?Wt:Ht;n("layout",(()=>{t&&!t.keepNodeOrder&&t.prevGraph&&n("  inheritOrder",(()=>{var n,r;n=e,r=t.prevGraph,n.nodes().forEach((e=>{const t=n.node(e),i=r.node(e);void 0!==i?(t.fixorder=i._order,delete i._order):delete t.fixorder}))}));const r=n("  buildLayoutGraph",(()=>(e=>{const t=new Lt({multigraph:!0,compound:!0}),n=gr(e.graph()),r={};return null==Zn||Zn.forEach((e=>{void 0!==n[e]&&(r[e]=n[e])})),t.setGraph(Object.assign({},$n,pr(n,Kn),r)),e.nodes().forEach((n=>{const r=gr(e.node(n)),i=Object.assign(Object.assign({},Qn),r),o=pr(i,Jn);t.setNode(n,o),t.setParent(n,e.parent(n))})),e.edges().forEach((n=>{const r=gr(e.edge(n)),i={};null==nr||nr.forEach((e=>{void 0!==r[e]&&(i[e]=r[e])})),t.setEdgeObj(n,Object.assign({},tr,pr(r,er),i))})),t})(e)));t&&!1===t.edgeLabelSpace||n("  makeSpaceForEdgeLabels",(()=>{(e=>{const t=e.graph();t.ranksep||(t.ranksep=0),t.ranksep/=2,e.nodes().forEach((t=>{const n=e.node(t);isNaN(n.layer)||n.layer||(n.layer=0)})),e.edges().forEach((n=>{var r;const i=e.edge(n);i.minlen*=2,"c"!==(null===(r=i.labelpos)||void 0===r?void 0:r.toLowerCase())&&("TB"===t.rankdir||"BT"===t.rankdir?i.width+=i.labeloffset:i.height+=i.labeloffset)}))})(r)}));try{n("  runLayout",(()=>{Yn(r,n,t)}))}catch(e){if("Not possible to find intersection inside of the rectangle"===e.message)return void console.error("The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:\n",e);throw e}n("  updateInputGraph",(()=>{((e,t)=>{e.nodes().forEach((n=>{var r;const i=e.node(n);if(i){const e=t.node(n);i.x=e.x,i.y=e.y,i._order=e.order,i._rank=e.rank,(null===(r=t.children(n))||void 0===r?void 0:r.length)&&(i.width=e.width,i.height=e.height)}})),e.edges().forEach((n=>{const r=e.edge(n),i=t.edge(n);r.points=i?i.points:[],i&&i.hasOwnProperty("x")&&(r.x=i.x,r.y=i.y)})),e.graph().width=t.graph().width,e.graph().height=t.graph().height})(e,r)}))}))};class mr extends o{constructor(e){super(),this.rankdir="TB",this.nodesep=50,this.ranksep=50,this.controlPoints=!1,this.sortByCombo=!1,this.edgeLabelSpace=!0,this.radial=!1,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.layoutNode=e=>{const{nodes:t}=this,n=t.find((t=>t.id===e));return!n||!1!==n.layout},this.updateCfg(e)}getDefaultCfg(){return{rankdir:"TB",align:void 0,nodeSize:void 0,nodesepFunc:void 0,ranksepFunc:void 0,nodesep:50,ranksep:50,controlPoints:!1,radial:!1,focusNode:null}}execute(){var e,t,n;const r=this,{nodes:i,nodeSize:o,rankdir:c,combos:f,begin:h,radial:p,comboEdges:g=[],vedges:v=[]}=r;if(!i)return;const m=r.edges||[],y=new Lt({multigraph:!0,compound:!0}),b={};let E;i.forEach((e=>{e.comboId&&(b[e.comboId]=b[e.comboId]||[],b[e.comboId].push(e.id))})),E=o?s(o)?()=>o:()=>[o,o]:e=>e.size?s(e.size)?e.size:l(e.size)?[e.size.width||40,e.size.height||40]:[e.size,e.size]:[40,40];const _=x(r.ranksep,50,r.ranksepFunc),w=x(r.nodesep,50,r.nodesepFunc);let S=w,A=_;"LR"!==c&&"RL"!==c||(S=_,A=w),y.setDefaultEdgeLabel((()=>({}))),y.setGraph(r);const T={};let I;this.sortByCombo&&f&&f.forEach((e=>{if(T[e.id]=e,e.collapsed){const t=E(e),n=A(e),r=S(e),i=t[0]+2*r,o=t[1]+2*n;y.setNode(e.id,{width:i,height:o})}e.parentId&&(T[e.parentId]||y.setNode(e.parentId,{}),y.setParent(e.id,e.parentId))})),i.filter((e=>!1!==e.layout)).forEach((e=>{const t=E(e),n=A(e),r=S(e),i=t[0]+2*r,o=t[1]+2*n,a=e.layer;u(a)?y.setNode(e.id,{width:i,height:o,layer:a}):y.setNode(e.id,{width:i,height:o}),this.sortByCombo&&e.comboId&&(T[e.comboId]||(T[e.comboId]={id:e.comboId},y.setNode(e.comboId,{})),y.setParent(e.id,e.comboId))})),m.forEach((e=>{const t=d(e,"source"),n=d(e,"target");this.layoutNode(t)&&this.layoutNode(n)&&y.setEdge(t,n,{weight:e.weight||1})})),null===(e=null==g?void 0:g.concat(v||[]))||void 0===e||e.forEach((e=>{var t,n;const{source:r,target:i}=e,o=(null===(t=T[r])||void 0===t?void 0:t.collapsed)?[r]:b[r]||[r],a=(null===(n=T[i])||void 0===n?void 0:n.collapsed)?[i]:b[i]||[i];o.forEach((t=>{a.forEach((n=>{y.setEdge(t,n,{weight:e.weight||1})}))}))})),(null===(t=r.preset)||void 0===t?void 0:t.nodes)&&(I=new Lt({multigraph:!0,compound:!0}),r.preset.nodes.forEach((e=>{null==I||I.setNode(e.id,e)}))),vr(y,{prevGraph:I,edgeLabelSpace:r.edgeLabelSpace,keepNodeOrder:Boolean(!!r.nodeOrder),nodeOrder:r.nodeOrder});const N=[0,0];if(h){let e=1/0,t=1/0;y.nodes().forEach((n=>{const r=y.node(n);e>r.x&&(e=r.x),t>r.y&&(t=r.y)})),y.edges().forEach((n=>{var r;null===(r=y.edge(n).points)||void 0===r||r.forEach((n=>{e>n.x&&(e=n.x),t>n.y&&(t=n.y)}))})),N[0]=h[0]-e,N[1]=h[1]-t}if(p){const{focusNode:e,ranksep:t,getRadialPos:o}=this,s=a(e)?e:null==e?void 0:e.id,u=s?null===(n=y.node(s))||void 0===n?void 0:n._rank:0,l=[],f="LR"===c||"RL"===c,h=f?"y":"x",p=f?"height":"width";let g=1/0,v=-1/0;y.nodes().forEach((e=>{const t=y.node(e),n=i.findIndex((t=>t.id===e));if(!i[n])return;const r=w(i[n]);if(0===u)l[t._rank]||(l[t._rank]={nodes:[],totalWidth:0,maxSize:-1/0}),l[t._rank].nodes.push(e),l[t._rank].totalWidth+=2*r+t[p],l[t._rank].maxSize<Math.max(t.width,t.height)&&(l[t._rank].maxSize=Math.max(t.width,t.height));else{const n=t._rank-u;if(0===n)l[n]||(l[n]={nodes:[],totalWidth:0,maxSize:-1/0}),l[n].nodes.push(e),l[n].totalWidth+=2*r+t[p],l[n].maxSize<Math.max(t.width,t.height)&&(l[n].maxSize=Math.max(t.width,t.height));else{const i=Math.abs(n);l[i]||(l[i]={left:[],right:[],totalWidth:0,maxSize:-1/0}),l[i].totalWidth+=2*r+t[p],l[i].maxSize<Math.max(t.width,t.height)&&(l[i].maxSize=Math.max(t.width,t.height)),n<0?l[i].left.push(e):l[i].right.push(e)}}const o=t[h]-t[p]/2-r,a=t[h]+t[p]/2+r;o<g&&(g=o),a>v&&(v=a)}));let b=t||50;const E={},x=(v-g)/.9,S=[.5*(g+v-x),.5*(g+v+x)],A=(e,t,n=-1/0,r=[0,1])=>{let a=n;return e.forEach((e=>{const n=y.node(e);E[e]=t;const{x:s,y:u}=o(n[h],S,x,t,r),c=i.findIndex((t=>t.id===e));if(!i[c])return;i[c].x=s+N[0],i[c].y=u+N[1],i[c]._order=n._order;const l=_(i[c]);a<l&&(a=l)})),a};let T=!0;l.forEach((e=>{var t,n,r,o,a,s,c;if(!(null===(t=null==e?void 0:e.nodes)||void 0===t?void 0:t.length)&&!(null===(n=null==e?void 0:e.left)||void 0===n?void 0:n.length)&&!(null===(r=null==e?void 0:e.right)||void 0===r?void 0:r.length))return;if(T&&1===e.nodes.length){const t=i.findIndex((t=>t.id===e.nodes[0]));if(t<=-1)return;return i[t].x=N[0],i[t].y=N[1],E[e.nodes[0]]=0,b=_(i[t]),void(T=!1)}b=Math.max(b,e.totalWidth/(2*Math.PI));let l=-1/0;if(0===u||(null===(o=e.nodes)||void 0===o?void 0:o.length))l=A(e.nodes,b,l,[0,1]);else{const t=(null===(a=e.left)||void 0===a?void 0:a.length)/((null===(s=e.left)||void 0===s?void 0:s.length)+(null===(c=e.right)||void 0===c?void 0:c.length));l=A(e.left,b,l,[0,t]),l=A(e.right,b,l,[t+.05,1])}b+=l,T=!1,e.maxSize})),y.edges().forEach((e=>{var t,n,i;const a=y.edge(e),s=m.findIndex((t=>{const n=d(t,"source"),r=d(t,"target");return n===e.v&&r===e.w}));if(!(s<=-1)&&r.edgeLabelSpace&&r.controlPoints&&"loop"!==m[s].type){const r="x"===h?"y":"x",u=null===(t=null==a?void 0:a.points)||void 0===t?void 0:t.slice(1,a.points.length-1),c=[],l=null===(n=y.node(e.v))||void 0===n?void 0:n[r],f=l-(null===(i=y.node(e.w))||void 0===i?void 0:i[r]),d=E[e.v],p=d-E[e.w];null==u||u.forEach((e=>{const t=(e[r]-l)/f*p+d,n=o(e[h],S,x,t);c.push({x:n.x+N[0],y:n.y+N[1]})})),m[s].controlPoints=c}}))}else y.nodes().forEach((e=>{const t=y.node(e);if(!t)return;let n=i.find((t=>t.id===e));n||(n=null==f?void 0:f.find((t=>t.id===e))),n&&(n.x=t.x+N[0],n.y=t.y+N[1],n._order=t._order)})),y.edges().forEach((e=>{var t;const n=y.edge(e),i=m.findIndex((t=>{const n=d(t,"source"),r=d(t,"target");return n===e.v&&r===e.w}));i<=-1||r.edgeLabelSpace&&r.controlPoints&&"loop"!==m[i].type&&(m[i].controlPoints=null===(t=null==n?void 0:n.points)||void 0===t?void 0:t.slice(1,n.points.length-1),m[i].controlPoints.forEach((e=>{e.x+=N[0],e.y+=N[1]})))}));return r.onLayoutEnd&&r.onLayoutEnd(),{nodes:i,edges:m}}getRadialPos(e,t,n,r,i=[0,1]){let o=(e-t[0])/n;o=o*(i[1]-i[0])+i[0];const a=2*o*Math.PI;return{x:Math.cos(a)*r,y:Math.sin(a)*r}}getType(){return"dagre"}}const yr={graph:{meta:{rankDir:"TB",nodeSep:50,rankSep:50,edgeSep:5,align:void 0}},subScene:{meta:{paddingTop:20,paddingBottom:20,paddingLeft:20,paddingRight:20,labelHeight:20}},nodeSize:{meta:{width:100,maxLabelWidth:0,height:20},node:{width:80,height:20,labelOffset:10,maxLabelWidth:40},bridge:{width:5,height:5,radius:2,labelOffset:0}}};function br(e={},t=yr){var n,r,i,o;const a=JSON.parse(JSON.stringify(t)),s=(null===(n=null==e?void 0:e.graph)||void 0===n?void 0:n.meta)||{},u=(null===(r=null==e?void 0:e.subScene)||void 0===r?void 0:r.meta)||{},c=(null===(i=null==e?void 0:e.nodeSize)||void 0===i?void 0:i.meta)||{},l=(null===(o=null==e?void 0:e.nodeSize)||void 0===o?void 0:o.node)||{},f=a.nodeSize.bridge;return{graph:{meta:Object.assign(a.graph.meta,s)},subScene:{meta:Object.assign(a.subScene.meta,u)},nodeSize:{meta:Object.assign(a.nodeSize.meta,c),node:Object.assign(a.nodeSize.node,l),bridge:f}}}function Er(e){return`◬${e}◬`}const _r=Er("ROOT"),xr=Er("BRIDGE_GRAPH");var wr,Sr,Ar,Tr;!function(e){e[e.META=0]="META",e[e.NODE=1]="NODE",e[e.BRIDGE=2]="BRIDGE"}(wr||(wr={})),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE",e[e.UNSPECIFIED=2]="UNSPECIFIED"}(Sr||(Sr={})),function(e){e[e.META=0]="META",e[e.CORE=1]="CORE",e[e.BRIDGE=2]="BRIDGE"}(Ar||(Ar={})),function(e){e[e.META=0]="META",e[e.OP=1]="OP",e[e.SERIES=2]="SERIES"}(Tr||(Tr={}));var Ir="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};function Nr(e,t){return e(t={exports:{}},t.exports),t.exports}var Dr=function(e,t){return e===t||e!=e&&t!=t},kr=function(e,t){for(var n=e.length;n--;)if(Dr(e[n][0],t))return n;return-1},Cr=Array.prototype.splice;function Mr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Mr.prototype.clear=function(){this.__data__=[],this.size=0},Mr.prototype.delete=function(e){var t=this.__data__,n=kr(t,e);return!(n<0||(n==t.length-1?t.pop():Cr.call(t,n,1),--this.size,0))},Mr.prototype.get=function(e){var t=this.__data__,n=kr(t,e);return n<0?void 0:t[n][1]},Mr.prototype.has=function(e){return kr(this.__data__,e)>-1},Mr.prototype.set=function(e,t){var n=this.__data__,r=kr(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};var Or,Rr=Mr,Pr="object"==typeof Ir&&Ir&&Ir.Object===Object&&Ir,Gr="object"==typeof self&&self&&self.Object===Object&&self,Lr=Pr||Gr||Function("return this")(),Ur=Lr.Symbol,zr=Object.prototype,Br=zr.hasOwnProperty,jr=zr.toString,Fr=Ur?Ur.toStringTag:void 0,Vr=Object.prototype.toString,Wr=Ur?Ur.toStringTag:void 0,Hr=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Wr&&Wr in Object(e)?function(e){var t=Br.call(e,Fr),n=e[Fr];try{e[Fr]=void 0;var r=!0}catch(e){}var i=jr.call(e);return r&&(t?e[Fr]=n:delete e[Fr]),i}(e):function(e){return Vr.call(e)}(e)},Xr=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},qr=function(e){if(!Xr(e))return!1;var t=Hr(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Yr=Lr["__core-js_shared__"],Kr=(Or=/[^.]+$/.exec(Yr&&Yr.keys&&Yr.keys.IE_PROTO||""))?"Symbol(src)_1."+Or:"",$r=Function.prototype.toString,Zr=function(e){if(null!=e){try{return $r.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Jr=/^\[object .+?Constructor\]$/,Qr=Function.prototype,ei=Object.prototype,ti=Qr.toString,ni=ei.hasOwnProperty,ri=RegExp("^"+ti.call(ni).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ii=function(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!Xr(e)||function(e){return!!Kr&&Kr in e}(e))&&(qr(e)?ri:Jr).test(Zr(e))}(n)?n:void 0},oi=ii(Lr,"Map"),ai=ii(Object,"create"),si=Object.prototype.hasOwnProperty,ui=Object.prototype.hasOwnProperty;function ci(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ci.prototype.clear=function(){this.__data__=ai?ai(null):{},this.size=0},ci.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ci.prototype.get=function(e){var t=this.__data__;if(ai){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return si.call(t,e)?t[e]:void 0},ci.prototype.has=function(e){var t=this.__data__;return ai?void 0!==t[e]:ui.call(t,e)},ci.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ai&&void 0===t?"__lodash_hash_undefined__":t,this};var li=ci,fi=function(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map};function di(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}di.prototype.clear=function(){this.size=0,this.__data__={hash:new li,map:new(oi||Rr),string:new li}},di.prototype.delete=function(e){var t=fi(this,e).delete(e);return this.size-=t?1:0,t},di.prototype.get=function(e){return fi(this,e).get(e)},di.prototype.has=function(e){return fi(this,e).has(e)},di.prototype.set=function(e,t){var n=fi(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};var hi=di;function pi(e){var t=this.__data__=new Rr(e);this.size=t.size}pi.prototype.clear=function(){this.__data__=new Rr,this.size=0},pi.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},pi.prototype.get=function(e){return this.__data__.get(e)},pi.prototype.has=function(e){return this.__data__.has(e)},pi.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Rr){var r=n.__data__;if(!oi||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new hi(r)}return n.set(e,t),this.size=n.size,this};var gi=pi,vi=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},mi=function(){try{var e=ii(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),yi=function(e,t,n){"__proto__"==t&&mi?mi(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},bi=Object.prototype.hasOwnProperty,Ei=function(e,t,n){var r=e[t];bi.call(e,t)&&Dr(r,n)&&(void 0!==n||t in e)||yi(e,t,n)},_i=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],u=r?r(n[s],e[s],s,n,e):void 0;void 0===u&&(u=e[s]),i?yi(n,s,u):Ei(n,s,u)}return n},xi=function(e){return null!=e&&"object"==typeof e},wi=function(e){return xi(e)&&"[object Arguments]"==Hr(e)},Si=Object.prototype,Ai=Si.hasOwnProperty,Ti=Si.propertyIsEnumerable,Ii=wi(function(){return arguments}())?wi:function(e){return xi(e)&&Ai.call(e,"callee")&&!Ti.call(e,"callee")},Ni=Array.isArray,Di=function(){return!1},ki=Nr((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?Lr.Buffer:void 0,o=(i?i.isBuffer:void 0)||Di;e.exports=o})),Ci=/^(?:0|[1-9]\d*)$/,Mi=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Ci.test(e))&&e>-1&&e%1==0&&e<t},Oi=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Ri={};Ri["[object Float32Array]"]=Ri["[object Float64Array]"]=Ri["[object Int8Array]"]=Ri["[object Int16Array]"]=Ri["[object Int32Array]"]=Ri["[object Uint8Array]"]=Ri["[object Uint8ClampedArray]"]=Ri["[object Uint16Array]"]=Ri["[object Uint32Array]"]=!0,Ri["[object Arguments]"]=Ri["[object Array]"]=Ri["[object ArrayBuffer]"]=Ri["[object Boolean]"]=Ri["[object DataView]"]=Ri["[object Date]"]=Ri["[object Error]"]=Ri["[object Function]"]=Ri["[object Map]"]=Ri["[object Number]"]=Ri["[object Object]"]=Ri["[object RegExp]"]=Ri["[object Set]"]=Ri["[object String]"]=Ri["[object WeakMap]"]=!1;var Pi=function(e){return function(t){return e(t)}},Gi=Nr((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n&&Pr.process,o=function(){try{return r&&r.require&&r.require("util").types||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=o})),Li=Gi&&Gi.isTypedArray,Ui=Li?Pi(Li):function(e){return xi(e)&&Oi(e.length)&&!!Ri[Hr(e)]},zi=Object.prototype.hasOwnProperty,Bi=function(e,t){var n=Ni(e),r=!n&&Ii(e),i=!n&&!r&&ki(e),o=!n&&!r&&!i&&Ui(e),a=n||r||i||o,s=a?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],u=s.length;for(var c in e)!t&&!zi.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Mi(c,u))||s.push(c);return s},ji=Object.prototype,Fi=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ji)},Vi=function(e,t){return function(n){return e(t(n))}},Wi=Vi(Object.keys,Object),Hi=Object.prototype.hasOwnProperty,Xi=function(e){if(!Fi(e))return Wi(e);var t=[];for(var n in Object(e))Hi.call(e,n)&&"constructor"!=n&&t.push(n);return t},qi=function(e){return null!=e&&Oi(e.length)&&!qr(e)},Yi=function(e){return qi(e)?Bi(e):Xi(e)},Ki=Object.prototype.hasOwnProperty,$i=function(e){return qi(e)?Bi(e,!0):function(e){if(!Xr(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=Fi(e),n=[];for(var r in e)("constructor"!=r||!t&&Ki.call(e,r))&&n.push(r);return n}(e)},Zi=Nr((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?Lr.Buffer:void 0,o=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=o?o(n):new e.constructor(n);return e.copy(r),r}})),Ji=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},Qi=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o},eo=function(){return[]},to=Object.prototype.propertyIsEnumerable,no=Object.getOwnPropertySymbols,ro=no?function(e){return null==e?[]:(e=Object(e),Qi(no(e),(function(t){return to.call(e,t)})))}:eo,io=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},oo=Vi(Object.getPrototypeOf,Object),ao=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)io(t,ro(e)),e=oo(e);return t}:eo,so=function(e,t,n){var r=t(e);return Ni(e)?r:io(r,n(e))},uo=function(e){return so(e,Yi,ro)},co=function(e){return so(e,$i,ao)},lo=ii(Lr,"DataView"),fo=ii(Lr,"Promise"),ho=ii(Lr,"Set"),po=ii(Lr,"WeakMap"),go=Zr(lo),vo=Zr(oi),mo=Zr(fo),yo=Zr(ho),bo=Zr(po),Eo=Hr;(lo&&"[object DataView]"!=Eo(new lo(new ArrayBuffer(1)))||oi&&"[object Map]"!=Eo(new oi)||fo&&"[object Promise]"!=Eo(fo.resolve())||ho&&"[object Set]"!=Eo(new ho)||po&&"[object WeakMap]"!=Eo(new po))&&(Eo=function(e){var t=Hr(e),n="[object Object]"==t?e.constructor:void 0,r=n?Zr(n):"";if(r)switch(r){case go:return"[object DataView]";case vo:return"[object Map]";case mo:return"[object Promise]";case yo:return"[object Set]";case bo:return"[object WeakMap]"}return t});var _o=Eo,xo=Object.prototype.hasOwnProperty,wo=Lr.Uint8Array,So=function(e){var t=new e.constructor(e.byteLength);return new wo(t).set(new wo(e)),t},Ao=/\w*$/,To=Ur?Ur.prototype:void 0,Io=To?To.valueOf:void 0,No=function(e,t){var n=t?So(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)},Do=Object.create,ko=function(){function e(){}return function(t){if(!Xr(t))return{};if(Do)return Do(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),Co=function(e){return"function"!=typeof e.constructor||Fi(e)?{}:ko(oo(e))},Mo=Gi&&Gi.isMap,Oo=Mo?Pi(Mo):function(e){return xi(e)&&"[object Map]"==_o(e)},Ro=Gi&&Gi.isSet,Po=Ro?Pi(Ro):function(e){return xi(e)&&"[object Set]"==_o(e)},Go={};Go["[object Arguments]"]=Go["[object Array]"]=Go["[object ArrayBuffer]"]=Go["[object DataView]"]=Go["[object Boolean]"]=Go["[object Date]"]=Go["[object Float32Array]"]=Go["[object Float64Array]"]=Go["[object Int8Array]"]=Go["[object Int16Array]"]=Go["[object Int32Array]"]=Go["[object Map]"]=Go["[object Number]"]=Go["[object Object]"]=Go["[object RegExp]"]=Go["[object Set]"]=Go["[object String]"]=Go["[object Symbol]"]=Go["[object Uint8Array]"]=Go["[object Uint8ClampedArray]"]=Go["[object Uint16Array]"]=Go["[object Uint32Array]"]=!0,Go["[object Error]"]=Go["[object Function]"]=Go["[object WeakMap]"]=!1;var Lo=function e(t,n,r,i,o,a){var s,u=1&n,c=2&n,l=4&n;if(r&&(s=o?r(t,i,o,a):r(t)),void 0!==s)return s;if(!Xr(t))return t;var f=Ni(t);if(f){if(s=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&xo.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(t),!u)return Ji(t,s)}else{var d=_o(t),h="[object Function]"==d||"[object GeneratorFunction]"==d;if(ki(t))return Zi(t,u);if("[object Object]"==d||"[object Arguments]"==d||h&&!o){if(s=c||h?{}:Co(t),!u)return c?function(e,t){return _i(e,ao(e),t)}(t,function(e,t){return e&&_i(t,$i(t),e)}(s,t)):function(e,t){return _i(e,ro(e),t)}(t,function(e,t){return e&&_i(t,Yi(t),e)}(s,t))}else{if(!Go[d])return o?t:{};s=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return So(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return function(e,t){var n=t?So(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return No(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,Ao.exec(e));return t.lastIndex=e.lastIndex,t}(e);case"[object Symbol]":return function(e){return Io?Object(Io.call(e)):{}}(e)}}(t,d,u)}}a||(a=new gi);var p=a.get(t);if(p)return p;a.set(t,s),Po(t)?t.forEach((function(i){s.add(e(i,n,r,i,t,a))})):Oo(t)&&t.forEach((function(i,o){s.set(o,e(i,n,r,o,t,a))}));var g=f?void 0:(l?c?co:uo:c?$i:Yi)(t);return vi(g||t,(function(i,o){g&&(i=t[o=i]),Ei(s,o,e(i,n,r,o,t,a))})),s},Uo=function(e){return function(){return e}},zo=function(e,t,n){for(var r=-1,i=Object(e),o=n(e),a=o.length;a--;){var s=o[++r];if(!1===t(i[s],s,i))break}return e},Bo=function(e,t){return e&&zo(e,t,Yi)},jo=function(e,t){return function(t,n){if(null==t)return t;if(!qi(t))return e(t,n);for(var r=t.length,i=-1,o=Object(t);++i<r&&!1!==n(o[i],i,o););return t}}(Bo),Fo=function(e){return e},Vo=function(e){return"function"==typeof e?e:Fo},Wo=function(e,t){return(Ni(e)?vi:jo)(e,Vo(t))},Ho=Wo,Xo=function(e,t){var n=[];return jo(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n};function qo(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new hi;++t<n;)this.add(e[t])}qo.prototype.add=qo.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},qo.prototype.has=function(e){return this.__data__.has(e)};var Yo=qo,Ko=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},$o=function(e,t){return e.has(t)},Zo=function(e,t,n,r,i,o){var a=1&n,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var c=o.get(e),l=o.get(t);if(c&&l)return c==t&&l==e;var f=-1,d=!0,h=2&n?new Yo:void 0;for(o.set(e,t),o.set(t,e);++f<s;){var p=e[f],g=t[f];if(r)var v=a?r(g,p,f,t,e,o):r(p,g,f,e,t,o);if(void 0!==v){if(v)continue;d=!1;break}if(h){if(!Ko(t,(function(e,t){if(!$o(h,t)&&(p===e||i(p,e,n,r,o)))return h.push(t)}))){d=!1;break}}else if(p!==g&&!i(p,g,n,r,o)){d=!1;break}}return o.delete(e),o.delete(t),d},Jo=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},Qo=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},ea=Ur?Ur.prototype:void 0,ta=ea?ea.valueOf:void 0,na=function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new wo(e),new wo(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Dr(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=Jo;case"[object Set]":var u=1&r;if(s||(s=Qo),e.size!=t.size&&!u)return!1;var c=a.get(e);if(c)return c==t;r|=2,a.set(e,t);var l=Zo(s(e),s(t),r,i,o,a);return a.delete(e),l;case"[object Symbol]":if(ta)return ta.call(e)==ta.call(t)}return!1},ra=Object.prototype.hasOwnProperty,ia=Object.prototype.hasOwnProperty,oa=function e(t,n,r,i,o){return t===n||(null==t||null==n||!xi(t)&&!xi(n)?t!=t&&n!=n:function(e,t,n,r,i,o){var a=Ni(e),s=Ni(t),u=a?"[object Array]":_o(e),c=s?"[object Array]":_o(t),l="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),f="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),d=u==c;if(d&&ki(e)){if(!ki(t))return!1;a=!0,l=!1}if(d&&!l)return o||(o=new gi),a||Ui(e)?Zo(e,t,n,r,i,o):na(e,t,u,n,r,i,o);if(!(1&n)){var h=l&&ia.call(e,"__wrapped__"),p=f&&ia.call(t,"__wrapped__");if(h||p){var g=h?e.value():e,v=p?t.value():t;return o||(o=new gi),i(g,v,n,r,o)}}return!!d&&(o||(o=new gi),function(e,t,n,r,i,o){var a=1&n,s=uo(e),u=s.length;if(u!=uo(t).length&&!a)return!1;for(var c=u;c--;){var l=s[c];if(!(a?l in t:ra.call(t,l)))return!1}var f=o.get(e),d=o.get(t);if(f&&d)return f==t&&d==e;var h=!0;o.set(e,t),o.set(t,e);for(var p=a;++c<u;){var g=e[l=s[c]],v=t[l];if(r)var m=a?r(v,g,l,t,e,o):r(g,v,l,e,t,o);if(!(void 0===m?g===v||i(g,v,n,r,o):m)){h=!1;break}p||(p="constructor"==l)}if(h&&!p){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(h=!1)}return o.delete(e),o.delete(t),h}(e,t,n,r,i,o))}(t,n,r,i,e,o))},aa=function(e){return e==e&&!Xr(e)},sa=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},ua=function(e){return"symbol"==typeof e||xi(e)&&"[object Symbol]"==Hr(e)},ca=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,la=/^\w*$/,fa=function(e,t){if(Ni(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ua(e))||la.test(e)||!ca.test(e)||null!=t&&e in Object(t)};function da(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(da.Cache||hi),n}da.Cache=hi;var ha,pa=da,ga=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,va=/\\(\\)?/g,ma=function(e){var t=pa((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ga,(function(e,n,r,i){t.push(r?i.replace(va,"$1"):n||e)})),t}),(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}(),ya=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i},ba=Ur?Ur.prototype:void 0,Ea=ba?ba.toString:void 0,_a=function e(t){if("string"==typeof t)return t;if(Ni(t))return ya(t,e)+"";if(ua(t))return Ea?Ea.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n},xa=function(e){return null==e?"":_a(e)},wa=function(e,t){return Ni(e)?e:fa(e,t)?[e]:ma(xa(e))},Sa=function(e){if("string"==typeof e||ua(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},Aa=function(e,t){for(var n=0,r=(t=wa(t,e)).length;null!=e&&n<r;)e=e[Sa(t[n++])];return n&&n==r?e:void 0},Ta=function(e,t){return null!=e&&t in Object(e)},Ia=function(e,t,n){for(var r=-1,i=(t=wa(t,e)).length,o=!1;++r<i;){var a=Sa(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&Oi(i)&&Mi(a,i)&&(Ni(e)||Ii(e))},Na=function(e,t){return null!=e&&Ia(e,t,Ta)},Da=function(e){return function(t){return null==t?void 0:t[e]}},ka=function(e){return"function"==typeof e?e:null==e?Fo:"object"==typeof e?Ni(e)?function(e,t){return fa(e)&&aa(t)?sa(Sa(e),t):function(n){var r=function(e,t,n){var r=null==e?void 0:Aa(e,t);return void 0===r?void 0:r}(n,e);return void 0===r&&r===t?Na(n,e):oa(t,r,3)}}(e[0],e[1]):function(e){var t=function(e){for(var t=Yi(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,aa(i)]}return t}(e);return 1==t.length&&t[0][2]?sa(t[0][0],t[0][1]):function(n){return n===e||function(e,t,n,r){var i=n.length,o=i;if(null==e)return!o;for(e=Object(e);i--;){var a=n[i];if(a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<o;){var s=(a=n[i])[0],u=e[s],c=a[1];if(a[2]){if(void 0===u&&!(s in e))return!1}else{var l,f=new gi;if(!(void 0===l?oa(c,u,3,r,f):l))return!1}}return!0}(n,0,t)}}(e):function(e){return fa(e)?Da(Sa(e)):function(e){return function(t){return Aa(t,e)}}(e)}(e)},Ca=function(e,t){return(Ni(e)?Qi:Xo)(e,ka(t))},Ma=Object.prototype.hasOwnProperty,Oa=function(e,t){return null!=e&&Ma.call(e,t)},Ra=function(e,t){return null!=e&&Ia(e,t,Oa)},Pa=Object.prototype.hasOwnProperty,Ga=function(e){return void 0===e},La=function(e,t){var n=-1,r=qi(e)?Array(e.length):[];return jo(e,(function(e,i,o){r[++n]=t(e,i,o)})),r},Ua=function(e,t){return(Ni(e)?ya:La)(e,ka(t))},za=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n},Ba=function(e,t,n,r,i){return i(e,(function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)})),n},ja=function(e,t,n){var r=Ni(e)?za:Ba,i=arguments.length<3;return r(e,ka(t),n,i,jo)},Fa=Da("length"),Va=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),Wa="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ha="\\ud83c[\\udffb-\\udfff]",Xa="[^\\ud800-\\udfff]",qa="(?:\\ud83c[\\udde6-\\uddff]){2}",Ya="[\\ud800-\\udbff][\\udc00-\\udfff]",Ka="(?:"+Wa+"|"+Ha+")?",$a="[\\ufe0e\\ufe0f]?"+Ka+"(?:\\u200d(?:"+[Xa,qa,Ya].join("|")+")[\\ufe0e\\ufe0f]?"+Ka+")*",Za="(?:"+[Xa+Wa+"?",Wa,qa,Ya,"[\\ud800-\\udfff]"].join("|")+")",Ja=RegExp(Ha+"(?="+Ha+")|"+Za+$a,"g"),Qa=Ur?Ur.isConcatSpreadable:void 0,es=function(e){return Ni(e)||Ii(e)||!!(Qa&&e&&e[Qa])},ts=function e(t,n,r,i,o){var a=-1,s=t.length;for(r||(r=es),o||(o=[]);++a<s;){var u=t[a];n>0&&r(u)?n>1?e(u,n-1,r,i,o):io(o,u):i||(o[o.length]=u)}return o},ns=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},rs=Math.max,is=function(e,t,n){return t=rs(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=rs(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),ns(e,this,s)}},os=mi?function(e,t){return mi(e,"toString",{configurable:!0,enumerable:!1,value:Uo(t),writable:!0})}:Fo,as=Date.now,ss=function(e){var t=0,n=0;return function(){var r=as(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(os),us=function(e,t){return ss(is(e,t,Fo),e+"")},cs=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1},ls=function(e){return e!=e},fs=function(e,t){return!(null==e||!e.length)&&function(e,t,n){return t==t?function(e,t,n){for(var r=-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}(e,t):cs(e,ls,0)}(e,t)>-1},ds=ho&&1/Qo(new ho([,-0]))[1]==1/0?function(e){return new ho(e)}:function(){},hs=function(e){return xi(e)&&qi(e)},ps=us((function(e){return function(e,t,n){var r=-1,i=fs,o=e.length,a=!0,s=[],u=s;if(o>=200){var c=ds(e);if(c)return Qo(c);a=!1,i=$o,u=new Yo}else u=s;e:for(;++r<o;){var l=e[r],f=l;if(l=0!==l?l:0,a&&f==f){for(var d=u.length;d--;)if(u[d]===f)continue e;s.push(l)}else i(u,f,n)||(u!==s&&u.push(f),s.push(l))}return s}(ts(e,1,hs,!0))})),gs=function(e){return null==e?[]:function(e,t){return ya(t,(function(t){return e[t]}))}(e,Yi(e))};try{ha={clone:function(e){return Lo(e,4)},constant:Uo,each:Ho,filter:Ca,has:Ra,isArray:Ni,isEmpty:function(e){if(null==e)return!0;if(qi(e)&&(Ni(e)||"string"==typeof e||"function"==typeof e.splice||ki(e)||Ui(e)||Ii(e)))return!e.length;var t=_o(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(Fi(e))return!Xi(e).length;for(var n in e)if(Pa.call(e,n))return!1;return!0},isFunction:qr,isUndefined:Ga,keys:Yi,map:Ua,reduce:ja,size:function(e){if(null==e)return 0;if(qi(e))return function(e){return"string"==typeof e||!Ni(e)&&xi(e)&&"[object String]"==Hr(e)}(e)?function(e){return function(e){return Va.test(e)}(e)?function(e){for(var t=Ja.lastIndex=0;Ja.test(e);)++t;return t}(e):Fa(e)}(e):e.length;var t=_o(e);return"[object Map]"==t||"[object Set]"==t?e.size:Xi(e).length},transform:function(e,t,n){var r=Ni(e),i=r||ki(e)||Ui(e);if(t=ka(t),null==n){var o=e&&e.constructor;n=i?r?new o:[]:Xr(e)&&qr(o)?ko(oo(e)):{}}return(i?vi:Bo)(e,(function(e,r,i){return t(n,e,r,i)})),n},union:ps,values:gs}}catch(yr){}ha||(ha=window._);var vs=ha,ms=ys;function ys(e){this._isDirected=!vs.has(e,"directed")||e.directed,this._isMultigraph=!!vs.has(e,"multigraph")&&e.multigraph,this._isCompound=!!vs.has(e,"compound")&&e.compound,this._label=void 0,this._defaultNodeLabelFn=vs.constant(void 0),this._defaultEdgeLabelFn=vs.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children["\0"]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function bs(e,t){e[t]?e[t]++:e[t]=1}function Es(e,t){--e[t]||delete e[t]}function _s(e,t,n,r){var i=""+t,o=""+n;if(!e&&i>o){var a=i;i=o,o=a}return i+""+o+""+(vs.isUndefined(r)?"\0":r)}function xs(e,t,n,r){var i=""+t,o=""+n;if(!e&&i>o){var a=i;i=o,o=a}var s={v:i,w:o};return r&&(s.name=r),s}function ws(e,t){return _s(e,t.v,t.w,t.name)}ys.prototype._nodeCount=0,ys.prototype._edgeCount=0,ys.prototype.isDirected=function(){return this._isDirected},ys.prototype.isMultigraph=function(){return this._isMultigraph},ys.prototype.isCompound=function(){return this._isCompound},ys.prototype.setGraph=function(e){return this._label=e,this},ys.prototype.graph=function(){return this._label},ys.prototype.setDefaultNodeLabel=function(e){return vs.isFunction(e)||(e=vs.constant(e)),this._defaultNodeLabelFn=e,this},ys.prototype.nodeCount=function(){return this._nodeCount},ys.prototype.nodes=function(){return vs.keys(this._nodes)},ys.prototype.sources=function(){var e=this;return vs.filter(this.nodes(),(function(t){return vs.isEmpty(e._in[t])}))},ys.prototype.sinks=function(){var e=this;return vs.filter(this.nodes(),(function(t){return vs.isEmpty(e._out[t])}))},ys.prototype.setNodes=function(e,t){var n=arguments,r=this;return vs.each(e,(function(e){n.length>1?r.setNode(e,t):r.setNode(e)})),this},ys.prototype.setNode=function(e,t){return vs.has(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=t),this):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]="\0",this._children[e]={},this._children["\0"][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)},ys.prototype.node=function(e){return this._nodes[e]},ys.prototype.hasNode=function(e){return vs.has(this._nodes,e)},ys.prototype.removeNode=function(e){var t=this;if(vs.has(this._nodes,e)){var n=function(e){t.removeEdge(t._edgeObjs[e])};delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],vs.each(this.children(e),(function(e){t.setParent(e)})),delete this._children[e]),vs.each(vs.keys(this._in[e]),n),delete this._in[e],delete this._preds[e],vs.each(vs.keys(this._out[e]),n),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this},ys.prototype.setParent=function(e,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(vs.isUndefined(t))t="\0";else{for(var n=t+="";!vs.isUndefined(n);n=this.parent(n))if(n===e)throw new Error("Setting "+t+" as parent of "+e+" would create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this},ys.prototype._removeFromParentsChildList=function(e){delete this._children[this._parent[e]][e]},ys.prototype.parent=function(e){if(this._isCompound){var t=this._parent[e];if("\0"!==t)return t}},ys.prototype.children=function(e){if(vs.isUndefined(e)&&(e="\0"),this._isCompound){var t=this._children[e];if(t)return vs.keys(t)}else{if("\0"===e)return this.nodes();if(this.hasNode(e))return[]}},ys.prototype.predecessors=function(e){var t=this._preds[e];if(t)return vs.keys(t)},ys.prototype.successors=function(e){var t=this._sucs[e];if(t)return vs.keys(t)},ys.prototype.neighbors=function(e){var t=this.predecessors(e);if(t)return vs.union(t,this.successors(e))},ys.prototype.isLeaf=function(e){return 0===(this.isDirected()?this.successors(e):this.neighbors(e)).length},ys.prototype.filterNodes=function(e){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph());var n=this;vs.each(this._nodes,(function(n,r){e(r)&&t.setNode(r,n)})),vs.each(this._edgeObjs,(function(e){t.hasNode(e.v)&&t.hasNode(e.w)&&t.setEdge(e,n.edge(e))}));var r={};function i(e){var o=n.parent(e);return void 0===o||t.hasNode(o)?(r[e]=o,o):o in r?r[o]:i(o)}return this._isCompound&&vs.each(t.nodes(),(function(e){t.setParent(e,i(e))})),t},ys.prototype.setDefaultEdgeLabel=function(e){return vs.isFunction(e)||(e=vs.constant(e)),this._defaultEdgeLabelFn=e,this},ys.prototype.edgeCount=function(){return this._edgeCount},ys.prototype.edges=function(){return vs.values(this._edgeObjs)},ys.prototype.setPath=function(e,t){var n=this,r=arguments;return vs.reduce(e,(function(e,i){return r.length>1?n.setEdge(e,i,t):n.setEdge(e,i),i})),this},ys.prototype.setEdge=function(){var e,t,n,r,i=!1,o=arguments[0];"object"==typeof o&&null!==o&&"v"in o?(e=o.v,t=o.w,n=o.name,2===arguments.length&&(r=arguments[1],i=!0)):(e=o,t=arguments[1],n=arguments[3],arguments.length>2&&(r=arguments[2],i=!0)),e=""+e,t=""+t,vs.isUndefined(n)||(n=""+n);var a=_s(this._isDirected,e,t,n);if(vs.has(this._edgeLabels,a))return i&&(this._edgeLabels[a]=r),this;if(!vs.isUndefined(n)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(t),this._edgeLabels[a]=i?r:this._defaultEdgeLabelFn(e,t,n);var s=xs(this._isDirected,e,t,n);return e=s.v,t=s.w,Object.freeze(s),this._edgeObjs[a]=s,bs(this._preds[t],e),bs(this._sucs[e],t),this._in[t][a]=s,this._out[e][a]=s,this._edgeCount++,this},ys.prototype.edge=function(e,t,n){var r=1===arguments.length?ws(this._isDirected,arguments[0]):_s(this._isDirected,e,t,n);return this._edgeLabels[r]},ys.prototype.hasEdge=function(e,t,n){var r=1===arguments.length?ws(this._isDirected,arguments[0]):_s(this._isDirected,e,t,n);return vs.has(this._edgeLabels,r)},ys.prototype.removeEdge=function(e,t,n){var r=1===arguments.length?ws(this._isDirected,arguments[0]):_s(this._isDirected,e,t,n),i=this._edgeObjs[r];return i&&(e=i.v,t=i.w,delete this._edgeLabels[r],delete this._edgeObjs[r],Es(this._preds[t],e),Es(this._sucs[e],t),delete this._in[t][r],delete this._out[e][r],this._edgeCount--),this},ys.prototype.inEdges=function(e,t){var n=this._in[e];if(n){var r=vs.values(n);return t?vs.filter(r,(function(e){return e.v===t})):r}},ys.prototype.outEdges=function(e,t){var n=this._out[e];if(n){var r=vs.values(n);return t?vs.filter(r,(function(e){return e.w===t})):r}},ys.prototype.nodeEdges=function(e,t){var n=this.inEdges(e,t);if(n)return n.concat(this.outEdges(e,t))};var Ss={Graph:ms,version:"2.1.8"},As={write:function(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:Ts(e),edges:Is(e)};return vs.isUndefined(e.graph())||(t.value=vs.clone(e.graph())),t},read:function(e){var t=new ms(e.options).setGraph(e.value);return vs.each(e.nodes,(function(e){t.setNode(e.v,e.value),e.parent&&t.setParent(e.v,e.parent)})),vs.each(e.edges,(function(e){t.setEdge({v:e.v,w:e.w,name:e.name},e.value)})),t}};function Ts(e){return vs.map(e.nodes(),(function(t){var n=e.node(t),r=e.parent(t),i={v:t};return vs.isUndefined(n)||(i.value=n),vs.isUndefined(r)||(i.parent=r),i}))}function Is(e){return vs.map(e.edges(),(function(t){var n=e.edge(t),r={v:t.v,w:t.w};return vs.isUndefined(t.name)||(r.name=t.name),vs.isUndefined(n)||(r.value=n),r}))}var Ns=Ds;function Ds(){this._arr=[],this._keyIndices={}}Ds.prototype.size=function(){return this._arr.length},Ds.prototype.keys=function(){return this._arr.map((function(e){return e.key}))},Ds.prototype.has=function(e){return vs.has(this._keyIndices,e)},Ds.prototype.priority=function(e){var t=this._keyIndices[e];if(void 0!==t)return this._arr[t].priority},Ds.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},Ds.prototype.add=function(e,t){var n=this._keyIndices;if(e=String(e),!vs.has(n,e)){var r=this._arr,i=r.length;return n[e]=i,r.push({key:e,priority:t}),this._decrease(i),!0}return!1},Ds.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key},Ds.prototype.decrease=function(e,t){var n=this._keyIndices[e];if(t>this._arr[n].priority)throw new Error("New priority is greater than current priority. Key: "+e+" Old: "+this._arr[n].priority+" New: "+t);this._arr[n].priority=t,this._decrease(n)},Ds.prototype._heapify=function(e){var t=this._arr,n=2*e,r=n+1,i=e;n<t.length&&(i=t[n].priority<t[i].priority?n:i,r<t.length&&(i=t[r].priority<t[i].priority?r:i),i!==e&&(this._swap(e,i),this._heapify(i)))},Ds.prototype._decrease=function(e){for(var t,n=this._arr,r=n[e].priority;0!==e&&!(n[t=e>>1].priority<r);)this._swap(e,t),e=t},Ds.prototype._swap=function(e,t){var n=this._arr,r=this._keyIndices,i=n[e],o=n[t];n[e]=o,n[t]=i,r[o.key]=e,r[i.key]=t};var ks=function(e,t,n,r){return function(e,t,n,r){var i,o,a={},s=new Ns,u=function(e){var t=e.v!==i?e.v:e.w,r=a[t],u=n(e),c=o.distance+u;if(u<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+e+" Weight: "+u);c<r.distance&&(r.distance=c,r.predecessor=i,s.decrease(t,c))};for(e.nodes().forEach((function(e){var n=e===t?0:Number.POSITIVE_INFINITY;a[e]={distance:n},s.add(e,n)}));s.size()>0&&(i=s.removeMin(),(o=a[i]).distance!==Number.POSITIVE_INFINITY);)r(i).forEach(u);return a}(e,String(t),n||Cs,r||function(t){return e.outEdges(t)})},Cs=vs.constant(1),Ms=function(e){var t=0,n=[],r={},i=[];function o(a){var s=r[a]={onStack:!0,lowlink:t,index:t++};if(n.push(a),e.successors(a).forEach((function(e){vs.has(r,e)?r[e].onStack&&(s.lowlink=Math.min(s.lowlink,r[e].index)):(o(e),s.lowlink=Math.min(s.lowlink,r[e].lowlink))})),s.lowlink===s.index){var u,c=[];do{u=n.pop(),r[u].onStack=!1,c.push(u)}while(a!==u);i.push(c)}}return e.nodes().forEach((function(e){vs.has(r,e)||o(e)})),i},Os=vs.constant(1),Rs=Ps;function Ps(e){var t={},n={},r=[];if(vs.each(e.sinks(),(function i(o){if(vs.has(n,o))throw new Gs;vs.has(t,o)||(n[o]=!0,t[o]=!0,vs.each(e.predecessors(o),i),delete n[o],r.push(o))})),vs.size(t)!==e.nodeCount())throw new Gs;return r}function Gs(){}Ps.CycleException=Gs,Gs.prototype=new Error;var Ls=function(e,t,n){vs.isArray(t)||(t=[t]);var r=(e.isDirected()?e.successors:e.neighbors).bind(e),i=[],o={};return vs.each(t,(function(t){if(!e.hasNode(t))throw new Error("Graph does not have node: "+t);Us(e,t,"post"===n,o,r,i)})),i};function Us(e,t,n,r,i,o){vs.has(r,t)||(r[t]=!0,n||o.push(t),vs.each(i(t),(function(t){Us(e,t,n,r,i,o)})),n&&o.push(t))}var zs,Bs={Graph:Ss.Graph,json:As,alg:{components:function(e){var t,n={},r=[];function i(r){vs.has(n,r)||(n[r]=!0,t.push(r),vs.each(e.successors(r),i),vs.each(e.predecessors(r),i))}return vs.each(e.nodes(),(function(e){t=[],i(e),t.length&&r.push(t)})),r},dijkstra:ks,dijkstraAll:function(e,t,n){return vs.transform(e.nodes(),(function(r,i){r[i]=ks(e,i,t,n)}),{})},findCycles:function(e){return vs.filter(Ms(e),(function(t){return t.length>1||1===t.length&&e.hasEdge(t[0],t[0])}))},floydWarshall:function(e,t,n){return function(e,t,n){var r={},i=e.nodes();return i.forEach((function(e){r[e]={},r[e][e]={distance:0},i.forEach((function(t){e!==t&&(r[e][t]={distance:Number.POSITIVE_INFINITY})})),n(e).forEach((function(n){var i=n.v===e?n.w:n.v,o=t(n);r[e][i]={distance:o,predecessor:e}}))})),i.forEach((function(e){var t=r[e];i.forEach((function(n){var o=r[n];i.forEach((function(n){var r=o[e],i=t[n],a=o[n],s=r.distance+i.distance;s<a.distance&&(a.distance=s,a.predecessor=i.predecessor)}))}))})),r}(e,t||Os,n||function(t){return e.outEdges(t)})},isAcyclic:function(e){try{Rs(e)}catch(e){if(e instanceof Rs.CycleException)return!1;throw e}return!0},postorder:function(e,t){return Ls(e,t,"post")},preorder:function(e,t){return Ls(e,t,"pre")},prim:function(e,t){var n,r=new ms,i={},o=new Ns;function a(e){var r=e.v===n?e.w:e.v,a=o.priority(r);if(void 0!==a){var s=t(e);s<a&&(i[r]=n,o.decrease(r,s))}}if(0===e.nodeCount())return r;vs.each(e.nodes(),(function(e){o.add(e,Number.POSITIVE_INFINITY),r.setNode(e)})),o.decrease(e.nodes()[0],0);for(var s=!1;o.size()>0;){if(n=o.removeMin(),vs.has(i,n))r.setEdge(n,i[n]);else{if(s)throw new Error("Input graph is not connected: "+e);s=!0}e.nodeEdges(n).forEach(a)}return r},tarjan:Ms,topsort:Rs},version:Ss.version};try{zs=Bs}catch(yr){}zs||(zs=window.graphlib);var js,Fs=zs,Vs=function(e,t,n){if(!Xr(n))return!1;var r=typeof t;return!!("number"==r?qi(n)&&Mi(t,n.length):"string"==r&&t in n)&&Dr(n[t],e)},Ws=Object.prototype,Hs=Ws.hasOwnProperty,Xs=us((function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Vs(t[0],t[1],i)&&(r=1);++n<r;)for(var o=t[n],a=$i(o),s=-1,u=a.length;++s<u;){var c=a[s],l=e[c];(void 0===l||Dr(l,Ws[c])&&!Hs.call(e,c))&&(e[c]=o[c])}return e})),qs=/^\s+|\s+$/g,Ys=/^[-+]0x[0-9a-f]+$/i,Ks=/^0b[01]+$/i,$s=/^0o[0-7]+$/i,Zs=parseInt,Js=function(e){return e?1/0===(e=function(e){if("number"==typeof e)return e;if(ua(e))return NaN;if(Xr(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Xr(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(qs,"");var n=Ks.test(e);return n||$s.test(e)?Zs(e.slice(2),n?2:8):Ys.test(e)?NaN:+e}(e))||-1/0===e?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0},Qs=Math.max,eu=function(e,t,n){var r=Object(e);if(!qi(e)){var i=ka(t);e=Yi(e),t=function(e){return i(r[e],e,r)}}var o=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:function(e){var t=Js(e),n=t%1;return t==t?n?t-n:t:0}(n);return i<0&&(i=Qs(r+i,0)),cs(e,ka(t),i)}(e,t,n);return o>-1?r[i?e[o]:o]:void 0},tu=function(e){return null!=e&&e.length?ts(e,1):[]},nu=function(e,t,n){for(var r=-1,i=e.length;++r<i;){var o=e[r],a=t(o);if(null!=a&&(void 0===s?a==a&&!ua(a):n(a,s)))var s=a,u=o}return u},ru=function(e,t){return e>t},iu=function(e,t,n){(void 0!==n&&!Dr(e[t],n)||void 0===n&&!(t in e))&&yi(e,t,n)},ou=Function.prototype,au=Object.prototype,su=ou.toString,uu=au.hasOwnProperty,cu=su.call(Object),lu=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},fu=function e(t,n,r,i,o){t!==n&&zo(n,(function(a,s){if(o||(o=new gi),Xr(a))!function(e,t,n,r,i,o,a){var s=lu(e,n),u=lu(t,n),c=a.get(u);if(c)iu(e,n,c);else{var l=o?o(s,u,n+"",e,t,a):void 0,f=void 0===l;if(f){var d=Ni(u),h=!d&&ki(u),p=!d&&!h&&Ui(u);l=u,d||h||p?Ni(s)?l=s:hs(s)?l=Ji(s):h?(f=!1,l=Zi(u,!0)):p?(f=!1,l=No(u,!0)):l=[]:function(e){if(!xi(e)||"[object Object]"!=Hr(e))return!1;var t=oo(e);if(null===t)return!0;var n=uu.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&su.call(n)==cu}(u)||Ii(u)?(l=s,Ii(s)?l=function(e){return _i(e,$i(e))}(s):Xr(s)&&!qr(s)||(l=Co(u))):f=!1}f&&(a.set(u,l),i(l,u,r,o,a),a.delete(u)),iu(e,n,l)}}(t,n,s,r,e,i,o);else{var u=i?i(lu(t,s),a,s+"",t,n,o):void 0;void 0===u&&(u=a),iu(t,s,u)}}),$i)},du=function(e){return us((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&Vs(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r)}return t}))}((function(e,t,n){fu(e,t,n)})),hu=function(e,t){return e<t},pu=function(e,t,n,r){if(!Xr(e))return e;for(var i=-1,o=(t=wa(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var u=Sa(t[i]),c=n;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(i!=a){var l=s[u];void 0===(c=r?r(l,u,s):void 0)&&(c=Xr(l)?l:Mi(t[i+1])?[]:{})}Ei(s,u,c),s=s[u]}return e},gu=function(e){return ss(is(e,void 0,tu),e+"")}((function(e,t){return null==e?{}:function(e,t){return function(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var a=t[r],s=Aa(e,a);n(0,a)&&pu(o,wa(a,e),s)}return o}(e,t,(function(t,n){return Na(e,n)}))}(e,t)})),vu=Math.ceil,mu=Math.max,yu=function(e,t){if(e!==t){var n=void 0!==e,r=null===e,i=e==e,o=ua(e),a=void 0!==t,s=null===t,u=t==t,c=ua(t);if(!s&&!c&&!o&&e>t||o&&a&&u&&!s&&!c||r&&a&&u||!n&&u||!i)return 1;if(!r&&!o&&!c&&e<t||c&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!u)return-1}return 0},bu=us((function(e,t){if(null==e)return[];var n=t.length;return n>1&&Vs(e,t[0],t[1])?t=[]:n>2&&Vs(t[0],t[1],t[2])&&(t=[t[0]]),function(e,t,n){t=t.length?ya(t,(function(e){return Ni(e)?function(t){return Aa(t,1===e.length?e[0]:e)}:e})):[Fo];var r=-1;t=ya(t,Pi(ka));var i=La(e,(function(e,n,i){return{criteria:ya(t,(function(t){return t(e)})),index:++r,value:e}}));return function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(i,(function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;++r<a;){var u=yu(i[r],o[r]);if(u)return r>=s?u:u*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)}))}(e,ts(t,1),[])})),Eu=0;try{js={cloneDeep:function(e){return Lo(e,5)},constant:Uo,defaults:Xs,each:Ho,filter:Ca,find:eu,flatten:tu,forEach:Wo,forIn:function(e,t){return null==e?e:zo(e,Vo(t),$i)},has:Ra,isUndefined:Ga,last:function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0},map:Ua,mapValues:function(e,t){var n={};return t=ka(t),Bo(e,(function(e,r,i){yi(n,r,t(e,r,i))})),n},max:function(e){return e&&e.length?nu(e,Fo,ru):void 0},merge:du,min:function(e){return e&&e.length?nu(e,Fo,hu):void 0},minBy:function(e,t){return e&&e.length?nu(e,ka(t),hu):void 0},now:function(){return Lr.Date.now()},pick:gu,range:function(e,t,n){return n&&"number"!=typeof n&&Vs(e,t,n)&&(t=n=void 0),e=Js(e),void 0===t?(t=e,e=0):t=Js(t),function(e,t,n,r){for(var i=-1,o=mu(vu((t-e)/(n||1)),0),a=Array(o);o--;)a[++i]=e,e+=n;return a}(e,t,n=void 0===n?e<t?1:-1:Js(n))},reduce:ja,sortBy:bu,uniqueId:function(e){var t=++Eu;return xa(e)+t},values:gs,zipObject:function(e,t){return function(e,t,n){for(var r=-1,i=e.length,o=t.length,a={};++r<i;){var s=r<o?t[r]:void 0;n(a,e[r],s)}return a}(e||[],t||[],Ei)}}}catch(yr){}js||(js=window._);var _u=js,xu=wu;function wu(){var e={};e._next=e._prev=e,this._sentinel=e}function Su(e){e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev}function Au(e,t){if("_next"!==e&&"_prev"!==e)return t}wu.prototype.dequeue=function(){var e=this._sentinel,t=e._prev;if(t!==e)return Su(t),t},wu.prototype.enqueue=function(e){var t=this._sentinel;e._prev&&e._next&&Su(e),e._next=t._next,t._next._prev=e,t._next=e,e._prev=t},wu.prototype.toString=function(){for(var e=[],t=this._sentinel,n=t._prev;n!==t;)e.push(JSON.stringify(n,Au)),n=n._prev;return"["+e.join(", ")+"]"};var Tu=Fs.Graph,Iu=_u.constant(1);function Nu(e,t,n,r,i){var o=i?[]:void 0;return _u.forEach(e.inEdges(r.v),(function(r){var a=e.edge(r),s=e.node(r.v);i&&o.push({v:r.v,w:r.w}),s.out-=a,Du(t,n,s)})),_u.forEach(e.outEdges(r.v),(function(r){var i=e.edge(r),o=r.w,a=e.node(o);a.in-=i,Du(t,n,a)})),e.removeNode(r.v),o}function Du(e,t,n){n.out?n.in?e[n.out-n.in+t].enqueue(n):e[e.length-1].enqueue(n):e[0].enqueue(n)}var ku=Fs.Graph,Cu={addDummyNode:Mu,simplify:function(e){var t=(new ku).setGraph(e.graph());return _u.forEach(e.nodes(),(function(n){t.setNode(n,e.node(n))})),_u.forEach(e.edges(),(function(n){var r=t.edge(n.v,n.w)||{weight:0,minlen:1},i=e.edge(n);t.setEdge(n.v,n.w,{weight:r.weight+i.weight,minlen:Math.max(r.minlen,i.minlen)})})),t},asNonCompoundGraph:function(e){var t=new ku({multigraph:e.isMultigraph()}).setGraph(e.graph());return _u.forEach(e.nodes(),(function(n){e.children(n).length||t.setNode(n,e.node(n))})),_u.forEach(e.edges(),(function(n){t.setEdge(n,e.edge(n))})),t},successorWeights:function(e){var t=_u.map(e.nodes(),(function(t){var n={};return _u.forEach(e.outEdges(t),(function(t){n[t.w]=(n[t.w]||0)+e.edge(t).weight})),n}));return _u.zipObject(e.nodes(),t)},predecessorWeights:function(e){var t=_u.map(e.nodes(),(function(t){var n={};return _u.forEach(e.inEdges(t),(function(t){n[t.v]=(n[t.v]||0)+e.edge(t).weight})),n}));return _u.zipObject(e.nodes(),t)},intersectRect:function(e,t){var n,r,i=e.x,o=e.y,a=t.x-i,s=t.y-o,u=e.width/2,c=e.height/2;if(!a&&!s)throw new Error("Not possible to find intersection inside of the rectangle");return Math.abs(s)*u>Math.abs(a)*c?(s<0&&(c=-c),n=c*a/s,r=c):(a<0&&(u=-u),n=u,r=u*s/a),{x:i+n,y:o+r}},buildLayerMatrix:function(e){var t=_u.map(_u.range(Ou(e)+1),(function(){return[]}));return _u.forEach(e.nodes(),(function(n){var r=e.node(n),i=r.rank;_u.isUndefined(i)||(t[i][r.order]=n)})),t},normalizeRanks:function(e){var t=_u.min(_u.map(e.nodes(),(function(t){return e.node(t).rank})));_u.forEach(e.nodes(),(function(n){var r=e.node(n);_u.has(r,"rank")&&(r.rank-=t)}))},removeEmptyRanks:function(e){var t=_u.min(_u.map(e.nodes(),(function(t){return e.node(t).rank}))),n=[];_u.forEach(e.nodes(),(function(r){var i=e.node(r).rank-t;n[i]||(n[i]=[]),n[i].push(r)}));var r=0,i=e.graph().nodeRankFactor;_u.forEach(n,(function(t,n){_u.isUndefined(t)&&n%i!=0?--r:r&&_u.forEach(t,(function(t){e.node(t).rank+=r}))}))},addBorderNode:function(e,t,n,r){var i={width:0,height:0};return arguments.length>=4&&(i.rank=n,i.order=r),Mu(e,"border",i,t)},maxRank:Ou,partition:function(e,t){var n={lhs:[],rhs:[]};return _u.forEach(e,(function(e){t(e)?n.lhs.push(e):n.rhs.push(e)})),n},time:function(e,t){var n=_u.now();try{return t()}finally{console.log(e+" time: "+(_u.now()-n)+"ms")}},notime:function(e,t){return t()}};function Mu(e,t,n,r){var i;do{i=_u.uniqueId(r)}while(e.hasNode(i));return n.dummy=t,e.setNode(i,n),i}function Ou(e){return _u.max(_u.map(e.nodes(),(function(t){var n=e.node(t).rank;if(!_u.isUndefined(n))return n})))}var Ru=function(e){var t={};_u.forEach(e.sources(),(function n(r){var i=e.node(r);if(_u.has(t,r))return i.rank;t[r]=!0;var o=_u.min(_u.map(e.outEdges(r),(function(t){return n(t.w)-e.edge(t).minlen})));return o!==Number.POSITIVE_INFINITY&&null!=o||(o=0),i.rank=o}))},Pu=function(e,t){return e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen},Gu=Fs.Graph,Lu=Pu,Uu=function(e){var t,n,r=new Gu({directed:!1}),i=e.nodes()[0],o=e.nodeCount();for(r.setNode(i,{});zu(r,e)<o;)t=Bu(r,e),n=r.hasNode(t.v)?Lu(e,t):-Lu(e,t),ju(r,e,n);return r};function zu(e,t){return _u.forEach(e.nodes(),(function n(r){_u.forEach(t.nodeEdges(r),(function(i){var o=i.v,a=r===o?i.w:o;e.hasNode(a)||Lu(t,i)||(e.setNode(a,{}),e.setEdge(r,a,{}),n(a))}))})),e.nodeCount()}function Bu(e,t){return _u.minBy(t.edges(),(function(n){if(e.hasNode(n.v)!==e.hasNode(n.w))return Lu(t,n)}))}function ju(e,t,n){_u.forEach(e.nodes(),(function(e){t.node(e).rank+=n}))}var Fu=Pu,Vu=Ru,Wu=Fs.alg.preorder,Hu=Fs.alg.postorder,Xu=Cu.simplify,qu=Yu;function Yu(e){e=Xu(e),Vu(e);var t,n=Uu(e);for(Zu(n),Ku(n,e);t=Qu(n);)tc(n,e,t,ec(n,e,t))}function Ku(e,t){var n=Hu(e,e.nodes());n=n.slice(0,n.length-1),_u.forEach(n,(function(n){!function(e,t,n){var r=e.node(n).parent;e.edge(n,r).cutvalue=$u(e,t,n)}(e,t,n)}))}function $u(e,t,n){var r=e.node(n).parent,i=!0,o=t.edge(n,r),a=0;return o||(i=!1,o=t.edge(r,n)),a=o.weight,_u.forEach(t.nodeEdges(n),(function(o){var s,u,c=o.v===n,l=c?o.w:o.v;if(l!==r){var f=c===i,d=t.edge(o).weight;if(a+=f?d:-d,s=n,u=l,e.hasEdge(s,u)){var h=e.edge(n,l).cutvalue;a+=f?-h:h}}})),a}function Zu(e,t){arguments.length<2&&(t=e.nodes()[0]),Ju(e,{},1,t)}function Ju(e,t,n,r,i){var o=n,a=e.node(r);return t[r]=!0,_u.forEach(e.neighbors(r),(function(i){_u.has(t,i)||(n=Ju(e,t,n,i,r))})),a.low=o,a.lim=n++,i?a.parent=i:delete a.parent,n}function Qu(e){return _u.find(e.edges(),(function(t){return e.edge(t).cutvalue<0}))}function ec(e,t,n){var r=n.v,i=n.w;t.hasEdge(r,i)||(r=n.w,i=n.v);var o=e.node(r),a=e.node(i),s=o,u=!1;o.lim>a.lim&&(s=a,u=!0);var c=_u.filter(t.edges(),(function(t){return u===nc(0,e.node(t.v),s)&&u!==nc(0,e.node(t.w),s)}));return _u.minBy(c,(function(e){return Fu(t,e)}))}function tc(e,t,n,r){var i=n.v,o=n.w;e.removeEdge(i,o),e.setEdge(r.v,r.w,{}),Zu(e),Ku(e,t),function(e,t){var n=_u.find(e.nodes(),(function(e){return!t.node(e).parent})),r=Wu(e,n);r=r.slice(1),_u.forEach(r,(function(n){var r=e.node(n).parent,i=t.edge(n,r),o=!1;i||(i=t.edge(r,n),o=!0),t.node(n).rank=t.node(r).rank+(o?i.minlen:-i.minlen)}))}(e,t)}function nc(e,t,n){return n.low<=t.lim&&t.lim<=n.lim}Yu.initLowLimValues=Zu,Yu.initCutValues=Ku,Yu.calcCutValue=$u,Yu.leaveEdge=Qu,Yu.enterEdge=ec,Yu.exchangeEdges=tc;var rc=Ru,ic=rc;var oc=function(e){var t=Cu.addDummyNode(e,"root",{},"_root"),n=function(e){var t={};function n(r,i){var o=e.children(r);o&&o.length&&_u.forEach(o,(function(e){n(e,i+1)})),t[r]=i}return _u.forEach(e.children(),(function(e){n(e,1)})),t}(e),r=_u.max(_u.values(n))-1,i=2*r+1;e.graph().nestingRoot=t,_u.forEach(e.edges(),(function(t){e.edge(t).minlen*=i}));var o=function(e){return _u.reduce(e.edges(),(function(t,n){return t+e.edge(n).weight}),0)}(e)+1;_u.forEach(e.children(),(function(a){ac(e,t,i,o,r,n,a)})),e.graph().nodeRankFactor=i};function ac(e,t,n,r,i,o,a){var s=e.children(a);if(s.length){var u=Cu.addBorderNode(e,"_bt"),c=Cu.addBorderNode(e,"_bb"),l=e.node(a);e.setParent(u,a),l.borderTop=u,e.setParent(c,a),l.borderBottom=c,_u.forEach(s,(function(s){ac(e,t,n,r,i,o,s);var l=e.node(s),f=l.borderTop?l.borderTop:s,d=l.borderBottom?l.borderBottom:s,h=l.borderTop?r:2*r,p=f!==d?1:i-o[a]+1;e.setEdge(u,f,{weight:h,minlen:p,nestingEdge:!0}),e.setEdge(d,c,{weight:h,minlen:p,nestingEdge:!0})})),e.parent(a)||e.setEdge(t,u,{weight:0,minlen:i+o[a]})}else a!==t&&e.setEdge(t,a,{weight:0,minlen:n})}function sc(e,t,n,r,i,o){var a={width:0,height:0,rank:o,borderType:t},s=i[t][o-1],u=Cu.addDummyNode(e,"border",a,n);i[t][o]=u,e.setParent(u,r),s&&e.setEdge(s,u,{weight:1})}function uc(e){_u.forEach(e.nodes(),(function(t){cc(e.node(t))})),_u.forEach(e.edges(),(function(t){cc(e.edge(t))}))}function cc(e){var t=e.width;e.width=e.height,e.height=t}function lc(e){e.y=-e.y}function fc(e){var t=e.x;e.x=e.y,e.y=t}var dc=function(e,t){for(var n=0,r=1;r<t.length;++r)n+=hc(e,t[r-1],t[r]);return n};function hc(e,t,n){for(var r=_u.zipObject(n,_u.map(n,(function(e,t){return t}))),i=_u.flatten(_u.map(t,(function(t){return _u.sortBy(_u.map(e.outEdges(t),(function(t){return{pos:r[t.w],weight:e.edge(t).weight}})),"pos")})),!0),o=1;o<n.length;)o<<=1;var a=2*o-1;o-=1;var s=_u.map(new Array(a),(function(){return 0})),u=0;return _u.forEach(i.forEach((function(e){var t=e.pos+o;s[t]+=e.weight;for(var n=0;t>0;)t%2&&(n+=s[t+1]),s[t=t-1>>1]+=e.weight;u+=e.weight*n}))),u}function pc(e,t,n){for(var r;t.length&&(r=_u.last(t)).i<=n;)t.pop(),e.push(r.vs),n++;return n}var gc=function e(t,n,r,i){var o=t.children(n),a=t.node(n),s=a?a.borderLeft:void 0,u=a?a.borderRight:void 0,c={};s&&(o=_u.filter(o,(function(e){return e!==s&&e!==u})));var l=function(e,t){return _u.map(t,(function(t){var n=e.inEdges(t);if(n.length){var r=_u.reduce(n,(function(t,n){var r=e.edge(n),i=e.node(n.v);return{sum:t.sum+r.weight*i.order,weight:t.weight+r.weight}}),{sum:0,weight:0});return{v:t,barycenter:r.sum/r.weight,weight:r.weight}}return{v:t}}))}(t,o);_u.forEach(l,(function(n){if(t.children(n.v).length){var o=e(t,n.v,r,i);c[n.v]=o,_u.has(o,"barycenter")&&(a=n,s=o,_u.isUndefined(a.barycenter)?(a.barycenter=s.barycenter,a.weight=s.weight):(a.barycenter=(a.barycenter*a.weight+s.barycenter*s.weight)/(a.weight+s.weight),a.weight+=s.weight))}var a,s}));var f=function(e,t){var n={};return _u.forEach(e,(function(e,t){var r=n[e.v]={indegree:0,in:[],out:[],vs:[e.v],i:t};_u.isUndefined(e.barycenter)||(r.barycenter=e.barycenter,r.weight=e.weight)})),_u.forEach(t.edges(),(function(e){var t=n[e.v],r=n[e.w];_u.isUndefined(t)||_u.isUndefined(r)||(r.indegree++,t.out.push(n[e.w]))})),function(e){var t=[];function n(e){return function(t){t.merged||(_u.isUndefined(t.barycenter)||_u.isUndefined(e.barycenter)||t.barycenter>=e.barycenter)&&function(e,t){var n=0,r=0;e.weight&&(n+=e.barycenter*e.weight,r+=e.weight),t.weight&&(n+=t.barycenter*t.weight,r+=t.weight),e.vs=t.vs.concat(e.vs),e.barycenter=n/r,e.weight=r,e.i=Math.min(t.i,e.i),t.merged=!0}(e,t)}}function r(t){return function(n){n.in.push(t),0==--n.indegree&&e.push(n)}}for(;e.length;){var i=e.pop();t.push(i),_u.forEach(i.in.reverse(),n(i)),_u.forEach(i.out,r(i))}return _u.map(_u.filter(t,(function(e){return!e.merged})),(function(e){return _u.pick(e,["vs","i","barycenter","weight"])}))}(_u.filter(n,(function(e){return!e.indegree})))}(l,r);!function(e,t){_u.forEach(e,(function(e){e.vs=_u.flatten(e.vs.map((function(e){return t[e]?t[e].vs:e})),!0)}))}(f,c);var d=function(e,t){var n,r=Cu.partition(e,(function(e){return _u.has(e,"barycenter")})),i=r.lhs,o=_u.sortBy(r.rhs,(function(e){return-e.i})),a=[],s=0,u=0,c=0;i.sort((n=!!t,function(e,t){return e.barycenter<t.barycenter?-1:e.barycenter>t.barycenter?1:n?t.i-e.i:e.i-t.i})),c=pc(a,o,c),_u.forEach(i,(function(e){c+=e.vs.length,a.push(e.vs),s+=e.barycenter*e.weight,u+=e.weight,c=pc(a,o,c)}));var l={vs:_u.flatten(a,!0)};return u&&(l.barycenter=s/u,l.weight=u),l}(f,i);if(s&&(d.vs=_u.flatten([s,d.vs,u],!0),t.predecessors(s).length)){var h=t.node(t.predecessors(s)[0]),p=t.node(t.predecessors(u)[0]);_u.has(d,"barycenter")||(d.barycenter=0,d.weight=0),d.barycenter=(d.barycenter*d.weight+h.order+p.order)/(d.weight+2),d.weight+=2}return d},vc=Fs.Graph,mc=Fs.Graph;function yc(e,t,n){return _u.map(t,(function(t){return function(e,t,n){var r=function(e){for(var t;e.hasNode(t=_u.uniqueId("_root")););return t}(e),i=new vc({compound:!0}).setGraph({root:r}).setDefaultNodeLabel((function(t){return e.node(t)}));return _u.forEach(e.nodes(),(function(o){var a=e.node(o),s=e.parent(o);(a.rank===t||a.minRank<=t&&t<=a.maxRank)&&(i.setNode(o),i.setParent(o,s||r),_u.forEach(e[n](o),(function(t){var n=t.v===o?t.w:t.v,r=i.edge(n,o),a=_u.isUndefined(r)?0:r.weight;i.setEdge(n,o,{weight:e.edge(t).weight+a})})),_u.has(a,"minRank")&&i.setNode(o,{borderLeft:a.borderLeft[t],borderRight:a.borderRight[t]}))})),i}(e,t,n)}))}function bc(e,t){var n=new mc;_u.forEach(e,(function(e){var r=e.graph().root,i=gc(e,r,n,t);_u.forEach(i.vs,(function(t,n){e.node(t).order=n})),function(e,t,n){var r,i={};_u.forEach(n,(function(n){for(var o,a,s=e.parent(n);s;){if((o=e.parent(s))?(a=i[o],i[o]=s):(a=r,r=s),a&&a!==s)return void t.setEdge(a,s);s=o}}))}(e,n,i.vs)}))}function Ec(e,t){_u.forEach(t,(function(t){_u.forEach(t,(function(t,n){e.node(t).order=n}))}))}var _c=Fs.Graph;function xc(e,t,n){if(t>n){var r=t;t=n,n=r}var i=e[t];i||(e[t]=i={}),i[n]=!0}function wc(e,t,n){if(t>n){var r=t;t=n,n=r}return _u.has(e[t],n)}var Sc=Cu.normalizeRanks,Ac=Cu.removeEmptyRanks,Tc=Cu,Ic=Fs.Graph,Nc=["nodesep","edgesep","ranksep","marginx","marginy"],Dc={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},kc=["acyclicer","ranker","rankdir","align"],Cc=["width","height"],Mc={width:0,height:0},Oc=["minlen","weight","width","height","labeloffset"],Rc={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},Pc=["labelpos"];function Gc(e,t){return _u.mapValues(_u.pick(e,t),Number)}function Lc(e){var t={};return _u.forEach(e,(function(e,n){t[n.toLowerCase()]=e})),t}var Uc=Fs.Graph,zc={graphlib:Fs,layout:function(e,t){var n=t&&t.debugTiming?Tc.time:Tc.notime;n("layout",(function(){var t=n("  buildLayoutGraph",(function(){return function(e){var t=new Ic({multigraph:!0,compound:!0}),n=Lc(e.graph());return t.setGraph(_u.merge({},Dc,Gc(n,Nc),_u.pick(n,kc))),_u.forEach(e.nodes(),(function(n){var r=Lc(e.node(n));t.setNode(n,_u.defaults(Gc(r,Cc),Mc)),t.setParent(n,e.parent(n))})),_u.forEach(e.edges(),(function(n){var r=Lc(e.edge(n));t.setEdge(n,_u.merge({},Rc,Gc(r,Oc),_u.pick(r,Pc)))})),t}(e)}));n("  runLayout",(function(){!function(e,t){t("    makeSpaceForEdgeLabels",(function(){!function(e){var t=e.graph();t.ranksep/=2,_u.forEach(e.edges(),(function(n){var r=e.edge(n);r.minlen*=2,"c"!==r.labelpos.toLowerCase()&&("TB"===t.rankdir||"BT"===t.rankdir?r.width+=r.labeloffset:r.height+=r.labeloffset)}))}(e)})),t("    removeSelfEdges",(function(){!function(e){_u.forEach(e.edges(),(function(t){if(t.v===t.w){var n=e.node(t.v);n.selfEdges||(n.selfEdges=[]),n.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdge(t)}}))}(e)})),t("    acyclic",(function(){!function(e){var t="greedy"===e.graph().acyclicer?function(e,t){if(e.nodeCount()<=1)return[];var n=function(e,t){var n=new Tu,r=0,i=0;_u.forEach(e.nodes(),(function(e){n.setNode(e,{v:e,in:0,out:0})})),_u.forEach(e.edges(),(function(e){var o=n.edge(e.v,e.w)||0,a=t(e),s=o+a;n.setEdge(e.v,e.w,s),i=Math.max(i,n.node(e.v).out+=a),r=Math.max(r,n.node(e.w).in+=a)}));var o=_u.range(i+r+3).map((function(){return new xu})),a=r+1;return _u.forEach(n.nodes(),(function(e){Du(o,a,n.node(e))})),{graph:n,buckets:o,zeroIdx:a}}(e,t||Iu),r=function(e,t,n){for(var r,i=[],o=t[t.length-1],a=t[0];e.nodeCount();){for(;r=a.dequeue();)Nu(e,t,n,r);for(;r=o.dequeue();)Nu(e,t,n,r);if(e.nodeCount())for(var s=t.length-2;s>0;--s)if(r=t[s].dequeue()){i=i.concat(Nu(e,t,n,r,!0));break}}return i}(n.graph,n.buckets,n.zeroIdx);return _u.flatten(_u.map(r,(function(t){return e.outEdges(t.v,t.w)})),!0)}(e,function(e){return function(t){return e.edge(t).weight}}(e)):function(e){var t=[],n={},r={};return _u.forEach(e.nodes(),(function i(o){_u.has(r,o)||(r[o]=!0,n[o]=!0,_u.forEach(e.outEdges(o),(function(e){_u.has(n,e.w)?t.push(e):i(e.w)})),delete n[o])})),t}(e);_u.forEach(t,(function(t){var n=e.edge(t);e.removeEdge(t),n.forwardName=t.name,n.reversed=!0,e.setEdge(t.w,t.v,n,_u.uniqueId("rev"))}))}(e)})),t("    nestingGraph.run",(function(){oc(e)})),t("    rank",(function(){!function(e){switch(e.graph().ranker){case"network-simplex":default:!function(e){qu(e)}(e);break;case"tight-tree":!function(e){rc(e),Uu(e)}(e);break;case"longest-path":ic(e)}}(Tc.asNonCompoundGraph(e))})),t("    injectEdgeLabelProxies",(function(){!function(e){_u.forEach(e.edges(),(function(t){var n=e.edge(t);if(n.width&&n.height){var r=e.node(t.v),i={rank:(e.node(t.w).rank-r.rank)/2+r.rank,e:t};Tc.addDummyNode(e,"edge-proxy",i,"_ep")}}))}(e)})),t("    removeEmptyRanks",(function(){Ac(e)})),t("    nestingGraph.cleanup",(function(){!function(e){var t=e.graph();e.removeNode(t.nestingRoot),delete t.nestingRoot,_u.forEach(e.edges(),(function(t){e.edge(t).nestingEdge&&e.removeEdge(t)}))}(e)})),t("    normalizeRanks",(function(){Sc(e)})),t("    assignRankMinMax",(function(){!function(e){var t=0;_u.forEach(e.nodes(),(function(n){var r=e.node(n);r.borderTop&&(r.minRank=e.node(r.borderTop).rank,r.maxRank=e.node(r.borderBottom).rank,t=_u.max(t,r.maxRank))})),e.graph().maxRank=t}(e)})),t("    removeEdgeLabelProxies",(function(){!function(e){_u.forEach(e.nodes(),(function(t){var n=e.node(t);"edge-proxy"===n.dummy&&(e.edge(n.e).labelRank=n.rank,e.removeNode(t))}))}(e)})),t("    normalize.run",(function(){!function(e){e.graph().dummyChains=[],_u.forEach(e.edges(),(function(t){!function(e,t){var n,r,i,o=t.v,a=e.node(o).rank,s=t.w,u=e.node(s).rank,c=t.name,l=e.edge(t),f=l.labelRank;if(u!==a+1){for(e.removeEdge(t),i=0,++a;a<u;++i,++a)l.points=[],r={width:0,height:0,edgeLabel:l,edgeObj:t,rank:a},n=Cu.addDummyNode(e,"edge",r,"_d"),a===f&&(r.width=l.width,r.height=l.height,r.dummy="edge-label",r.labelpos=l.labelpos),e.setEdge(o,n,{weight:l.weight},c),0===i&&e.graph().dummyChains.push(n),o=n;e.setEdge(o,s,{weight:l.weight},c)}}(e,t)}))}(e)})),t("    parentDummyChains",(function(){!function(e){var t=function(e){var t={},n=0;return _u.forEach(e.children(),(function r(i){var o=n;_u.forEach(e.children(i),r),t[i]={low:o,lim:n++}})),t}(e);_u.forEach(e.graph().dummyChains,(function(n){for(var r=e.node(n),i=r.edgeObj,o=function(e,t,n,r){var i,o,a=[],s=[],u=Math.min(t[n].low,t[r].low),c=Math.max(t[n].lim,t[r].lim);i=n;do{i=e.parent(i),a.push(i)}while(i&&(t[i].low>u||c>t[i].lim));for(o=i,i=r;(i=e.parent(i))!==o;)s.push(i);return{path:a.concat(s.reverse()),lca:o}}(e,t,i.v,i.w),a=o.path,s=o.lca,u=0,c=a[u],l=!0;n!==i.w;){if(r=e.node(n),l){for(;(c=a[u])!==s&&e.node(c).maxRank<r.rank;)u++;c===s&&(l=!1)}if(!l){for(;u<a.length-1&&e.node(c=a[u+1]).minRank<=r.rank;)u++;c=a[u]}e.setParent(n,c),n=e.successors(n)[0]}}))}(e)})),t("    addBorderSegments",(function(){!function(e){_u.forEach(e.children(),(function t(n){var r=e.children(n),i=e.node(n);if(r.length&&_u.forEach(r,t),_u.has(i,"minRank")){i.borderLeft=[],i.borderRight=[];for(var o=i.minRank,a=i.maxRank+1;o<a;++o)sc(e,"borderLeft","_bl",n,i,o),sc(e,"borderRight","_br",n,i,o)}}))}(e)})),t("    order",(function(){!function(e){var t=Cu.maxRank(e),n=yc(e,_u.range(1,t+1),"inEdges"),r=yc(e,_u.range(t-1,-1,-1),"outEdges"),i=function(e){var t={},n=_u.filter(e.nodes(),(function(t){return!e.children(t).length})),r=_u.max(_u.map(n,(function(t){return e.node(t).rank}))),i=_u.map(_u.range(r+1),(function(){return[]})),o=_u.sortBy(n,(function(t){return e.node(t).rank}));return _u.forEach(o,(function n(r){if(!_u.has(t,r)){t[r]=!0;var o=e.node(r);i[o.rank].push(r),_u.forEach(e.successors(r),n)}})),i}(e);Ec(e,i);for(var o,a=Number.POSITIVE_INFINITY,s=0,u=0;u<4;++s,++u){bc(s%2?n:r,s%4>=2),i=Cu.buildLayerMatrix(e);var c=dc(e,i);c<a&&(u=0,o=_u.cloneDeep(i),a=c)}Ec(e,o)}(e)})),t("    insertSelfEdges",(function(){!function(e){var t=Tc.buildLayerMatrix(e);_u.forEach(t,(function(t){var n=0;_u.forEach(t,(function(t,r){var i=e.node(t);i.order=r+n,_u.forEach(i.selfEdges,(function(t){Tc.addDummyNode(e,"selfedge",{width:t.label.width,height:t.label.height,rank:i.rank,order:r+ ++n,e:t.e,label:t.label},"_se")})),delete i.selfEdges}))}))}(e)})),t("    adjustCoordinateSystem",(function(){!function(e){var t=e.graph().rankdir.toLowerCase();"lr"!==t&&"rl"!==t||uc(e)}(e)})),t("    position",(function(){!function(e){(function(e){var t=Cu.buildLayerMatrix(e),n=e.graph().ranksep,r=0;_u.forEach(t,(function(t){var i=_u.max(_u.map(t,(function(t){return e.node(t).height})));_u.forEach(t,(function(t){e.node(t).y=r+i/2})),r+=i+n}))})(e=Cu.asNonCompoundGraph(e)),_u.forEach(function(e){var t,n=Cu.buildLayerMatrix(e),r=_u.merge(function(e,t){var n={};return _u.reduce(t,(function(t,r){var i=0,o=0,a=t.length,s=_u.last(r);return _u.forEach(r,(function(t,u){var c=function(e,t){if(e.node(t).dummy)return _u.find(e.predecessors(t),(function(t){return e.node(t).dummy}))}(e,t),l=c?e.node(c).order:a;(c||t===s)&&(_u.forEach(r.slice(o,u+1),(function(t){_u.forEach(e.predecessors(t),(function(r){var o=e.node(r),a=o.order;!(a<i||l<a)||o.dummy&&e.node(t).dummy||xc(n,r,t)}))})),o=u+1,i=l)})),r})),n}(e,n),function(e,t){var n={};function r(t,r,i,o,a){var s;_u.forEach(_u.range(r,i),(function(r){s=t[r],e.node(s).dummy&&_u.forEach(e.predecessors(s),(function(t){var r=e.node(t);r.dummy&&(r.order<o||r.order>a)&&xc(n,t,s)}))}))}return _u.reduce(t,(function(t,n){var i,o=-1,a=0;return _u.forEach(n,(function(s,u){if("border"===e.node(s).dummy){var c=e.predecessors(s);c.length&&(i=e.node(c[0]).order,r(n,a,u,o,i),a=u,o=i)}r(n,a,n.length,i,t.length)})),n})),n}(e,n)),i={};_u.forEach(["u","d"],(function(o){t="u"===o?n:_u.values(n).reverse(),_u.forEach(["l","r"],(function(n){"r"===n&&(t=_u.map(t,(function(e){return _u.values(e).reverse()})));var a=("u"===o?e.predecessors:e.successors).bind(e),s=function(e,t,n,r){var i={},o={},a={};return _u.forEach(t,(function(e){_u.forEach(e,(function(e,t){i[e]=e,o[e]=e,a[e]=t}))})),_u.forEach(t,(function(e){var t=-1;_u.forEach(e,(function(e){var s=r(e);if(s.length)for(var u=((s=_u.sortBy(s,(function(e){return a[e]}))).length-1)/2,c=Math.floor(u),l=Math.ceil(u);c<=l;++c){var f=s[c];o[e]===e&&t<a[f]&&!wc(n,e,f)&&(o[f]=e,o[e]=i[e]=i[f],t=a[f])}}))})),{root:i,align:o}}(0,t,r,a),u=function(e,t,n,r,i){var o={},a=function(e,t,n,r){var i=new _c,o=e.graph(),a=function(e,t,n){return function(r,i,o){var a,s=r.node(i),u=r.node(o),c=0;if(c+=s.width/2,_u.has(s,"labelpos"))switch(s.labelpos.toLowerCase()){case"l":a=-s.width/2;break;case"r":a=s.width/2}if(a&&(c+=n?a:-a),a=0,c+=(s.dummy?t:e)/2,c+=(u.dummy?t:e)/2,c+=u.width/2,_u.has(u,"labelpos"))switch(u.labelpos.toLowerCase()){case"l":a=u.width/2;break;case"r":a=-u.width/2}return a&&(c+=n?a:-a),a=0,c}}(o.nodesep,o.edgesep,r);return _u.forEach(t,(function(t){var r;_u.forEach(t,(function(t){var o=n[t];if(i.setNode(o),r){var s=n[r],u=i.edge(s,o);i.setEdge(s,o,Math.max(a(e,t,r),u||0))}r=t}))})),i}(e,t,n,i),s=i?"borderLeft":"borderRight";function u(e,t){for(var n=a.nodes(),r=n.pop(),i={};r;)i[r]?e(r):(i[r]=!0,n.push(r),n=n.concat(t(r))),r=n.pop()}return u((function(e){o[e]=a.inEdges(e).reduce((function(e,t){return Math.max(e,o[t.v]+a.edge(t))}),0)}),a.predecessors.bind(a)),u((function(t){var n=a.outEdges(t).reduce((function(e,t){return Math.min(e,o[t.w]-a.edge(t))}),Number.POSITIVE_INFINITY),r=e.node(t);n!==Number.POSITIVE_INFINITY&&r.borderType!==s&&(o[t]=Math.max(o[t],n))}),a.successors.bind(a)),_u.forEach(r,(function(e){o[e]=o[n[e]]})),o}(e,t,s.root,s.align,"r"===n);"r"===n&&(u=_u.mapValues(u,(function(e){return-e}))),i[o+n]=u}))}));var o=function(e,t){return _u.minBy(_u.values(t),(function(t){var n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;return _u.forIn(t,(function(t,i){var o=function(e,t){return e.node(t).width}(e,i)/2;n=Math.max(t+o,n),r=Math.min(t-o,r)})),n-r}))}(e,i);return function(e,t){var n=_u.values(t),r=_u.min(n),i=_u.max(n);_u.forEach(["u","d"],(function(n){_u.forEach(["l","r"],(function(o){var a,s=n+o,u=e[s];if(u!==t){var c=_u.values(u);(a="l"===o?r-_u.min(c):i-_u.max(c))&&(e[s]=_u.mapValues(u,(function(e){return e+a})))}}))}))}(i,o),function(e,t){return _u.mapValues(e.ul,(function(n,r){if(t)return e[t.toLowerCase()][r];var i=_u.sortBy(_u.map(e,r));return(i[1]+i[2])/2}))}(i,e.graph().align)}(e),(function(t,n){e.node(n).x=t}))}(e)})),t("    positionSelfEdges",(function(){!function(e){_u.forEach(e.nodes(),(function(t){var n=e.node(t);if("selfedge"===n.dummy){var r=e.node(n.e.v),i=r.x+r.width/2,o=r.y,a=n.x-i,s=r.height/2;e.setEdge(n.e,n.label),e.removeNode(t),n.label.points=[{x:i+2*a/3,y:o-s},{x:i+5*a/6,y:o-s},{x:i+a,y:o},{x:i+5*a/6,y:o+s},{x:i+2*a/3,y:o+s}],n.label.x=n.x,n.label.y=n.y}}))}(e)})),t("    removeBorderNodes",(function(){!function(e){_u.forEach(e.nodes(),(function(t){if(e.children(t).length){var n=e.node(t),r=e.node(n.borderTop),i=e.node(n.borderBottom),o=e.node(_u.last(n.borderLeft)),a=e.node(_u.last(n.borderRight));n.width=Math.abs(a.x-o.x),n.height=Math.abs(i.y-r.y),n.x=o.x+n.width/2,n.y=r.y+n.height/2}})),_u.forEach(e.nodes(),(function(t){"border"===e.node(t).dummy&&e.removeNode(t)}))}(e)})),t("    normalize.undo",(function(){!function(e){_u.forEach(e.graph().dummyChains,(function(t){var n,r=e.node(t),i=r.edgeLabel;for(e.setEdge(r.edgeObj,i);r.dummy;)n=e.successors(t)[0],e.removeNode(t),i.points.push({x:r.x,y:r.y}),"edge-label"===r.dummy&&(i.x=r.x,i.y=r.y,i.width=r.width,i.height=r.height),t=n,r=e.node(t)}))}(e)})),t("    fixupEdgeLabelCoords",(function(){!function(e){_u.forEach(e.edges(),(function(t){var n=e.edge(t);if(_u.has(n,"x"))switch("l"!==n.labelpos&&"r"!==n.labelpos||(n.width-=n.labeloffset),n.labelpos){case"l":n.x-=n.width/2+n.labeloffset;break;case"r":n.x+=n.width/2+n.labeloffset}}))}(e)})),t("    undoCoordinateSystem",(function(){!function(e){var t=e.graph().rankdir.toLowerCase();"bt"!==t&&"rl"!==t||function(e){_u.forEach(e.nodes(),(function(t){lc(e.node(t))})),_u.forEach(e.edges(),(function(t){var n=e.edge(t);_u.forEach(n.points,lc),_u.has(n,"y")&&lc(n)}))}(e),"lr"!==t&&"rl"!==t||(function(e){_u.forEach(e.nodes(),(function(t){fc(e.node(t))})),_u.forEach(e.edges(),(function(t){var n=e.edge(t);_u.forEach(n.points,fc),_u.has(n,"x")&&fc(n)}))}(e),uc(e))}(e)})),t("    translateGraph",(function(){!function(e){var t=Number.POSITIVE_INFINITY,n=0,r=Number.POSITIVE_INFINITY,i=0,o=e.graph(),a=o.marginx||0,s=o.marginy||0;function u(e){var o=e.x,a=e.y,s=e.width,u=e.height;t=Math.min(t,o-s/2),n=Math.max(n,o+s/2),r=Math.min(r,a-u/2),i=Math.max(i,a+u/2)}_u.forEach(e.nodes(),(function(t){u(e.node(t))})),_u.forEach(e.edges(),(function(t){var n=e.edge(t);_u.has(n,"x")&&u(n)})),t-=a,r-=s,_u.forEach(e.nodes(),(function(n){var i=e.node(n);i.x-=t,i.y-=r})),_u.forEach(e.edges(),(function(n){var i=e.edge(n);_u.forEach(i.points,(function(e){e.x-=t,e.y-=r})),_u.has(i,"x")&&(i.x-=t),_u.has(i,"y")&&(i.y-=r)})),o.width=n-t+a,o.height=i-r+s}(e)})),t("    assignNodeIntersects",(function(){!function(e){_u.forEach(e.edges(),(function(t){var n,r,i=e.edge(t),o=e.node(t.v),a=e.node(t.w);i.points?(n=i.points[0],r=i.points[i.points.length-1]):(i.points=[],n=a,r=o),i.points.unshift(Tc.intersectRect(o,n)),i.points.push(Tc.intersectRect(a,r))}))}(e)})),t("    reversePoints",(function(){!function(e){_u.forEach(e.edges(),(function(t){var n=e.edge(t);n.reversed&&n.points.reverse()}))}(e)})),t("    acyclic.undo",(function(){!function(e){_u.forEach(e.edges(),(function(t){var n=e.edge(t);if(n.reversed){e.removeEdge(t);var r=n.forwardName;delete n.reversed,delete n.forwardName,e.setEdge(t.w,t.v,n,r)}}))}(e)}))}(t,n)})),n("  updateInputGraph",(function(){!function(e,t){_u.forEach(e.nodes(),(function(n){var r=e.node(n),i=t.node(n);r&&(r.x=i.x,r.y=i.y,t.children(n).length&&(r.width=i.width,r.height=i.height))})),_u.forEach(e.edges(),(function(n){var r=e.edge(n),i=t.edge(n);r.points=i.points,_u.has(i,"x")&&(r.x=i.x,r.y=i.y)})),e.graph().width=t.graph().width,e.graph().height=t.graph().height}(e,t)}))}))},debug:{debugOrdering:function(e){var t=Cu.buildLayerMatrix(e),n=new Uc({compound:!0,multigraph:!0}).setGraph({});return _u.forEach(e.nodes(),(function(t){n.setNode(t,{label:t}),n.setParent(t,"layer"+e.node(t).rank)})),_u.forEach(e.edges(),(function(e){n.setEdge(e.v,e.w,{},e.name)})),_u.forEach(t,(function(e,t){var r="layer"+t;n.setNode(r,{rank:"same"}),_u.reduce(e,(function(e,t){return n.setEdge(e,t,{style:"invis"}),t}))})),n}},util:{time:Cu.time,notime:Cu.notime},version:"0.8.5"},Bc=zc.graphlib,jc=zc.layout;class Fc{constructor(e){this.cardinality=1,this.include=Sr.UNSPECIFIED,this.isGroupNode=!1,this.parentNode=null,this.type=wr.NODE,this.name=e.name,this.attr=e.attr||{},this.inputs=e.inputs,this.path=e.path||[],this.width=e.width,this.height=e.height}}class Vc{constructor(){this.nodes={},this.edges=[],this.nodes={},this.edges=[]}}class Wc{constructor(e,t={}){this.attr=null,this.bridgeGraph=null,this.cardinality=0,this.depth=1,this.include=Sr.UNSPECIFIED,this.isGroupNode=!0,this.parentNode=null,this.type=wr.META,this.path=[],this.name=e,this.metaGraph=Yc(e,Ar.META,t)}getFirstChild(){return this.metaGraph.node(this.metaGraph.nodes()[0])}getChildren(){return this.metaGraph.nodes().map((e=>this.metaGraph.node(e)))}leaves(){let e,t=[],n=[this];for(;n.length;){let r=n.shift();r.isGroupNode?(e=r.metaGraph,e.nodes().forEach((t=>n.push(e.node(t))))):t.push(r.name)}return t}}class Hc{constructor(e,t){this.v=e,this.w=t,this.baseEdgeList=[],this.inbound=null,this.name=null}addBaseEdge(e,t){this.baseEdgeList.push(e)}}function Xc(e,t={}){return new Wc(e,t)}function qc(e,t){return new Hc(e,t)}function Yc(e,t,n){const r=n||{},i=new Bc.Graph(r);return i.setGraph({name:e,rankdir:r.rankdir,type:t,align:r.align}),i}class Kc{constructor(e={}){this.graphOptions=e,this.index={},this.graphOptions.compound=!0,this.root=Xc(_r,this.graphOptions),this.index[_r]=this.root}getNodeMap(){return this.index}node(e){return this.index[e]}setNode(e,t){this.index[e]=t}getBridgeGraph(e){const t=this.index[e];if(!t)throw Error("Could not find node in hierarchy: "+e);if(!("metaGraph"in t))return null;const n=t;if(n.bridgeGraph)return n.bridgeGraph;const r=Yc(xr,Ar.BRIDGE,this.graphOptions);if(n.bridgeGraph=r,!t.parentNode||!("metaGraph"in t.parentNode))return r;const i=t.parentNode;return[i.metaGraph,this.getBridgeGraph(i.name)].forEach((t=>{t.edges().filter((t=>t.v===e||t.w===e)).forEach((n=>{const i=n.w===e;t.edge(n).baseEdgeList.forEach((t=>{const[o,a]=i?[t.w,n.v]:[t.v,n.w],s=this.getChildName(e,o),u={v:i?a:s,w:i?s:a};let c=r.edge(u);c||(c=qc(u.v,u.w),c.inbound=i,r.setEdge(u.v,u.w,c)),c.addBaseEdge(t,this)}))}))})),r}getChildName(e,t){let n=this.index[t];for(;n;){if(n.parentNode&&n.parentNode.name===e)return n.name;n=n.parentNode}throw Error("Could not find immediate child for descendant: "+t)}getPredecessors(e){const t=this.index[e];if(!t)throw Error("Could not find node with name: "+e);return this.getOneWayEdges(t,!0)}getSuccessors(e){const t=this.index[e];if(!t)throw Error("Could not find node with name: "+e);return this.getOneWayEdges(t,!1)}getOneWayEdges(e,t){const n=[];if(!e.parentNode||!e.parentNode.isGroupNode)return n;const r=e.parentNode,i=r.metaGraph,o=this.getBridgeGraph(r.name);return $c(i,e,t,n),$c(o,e,t,n),n}}function $c(e,t,n,r){(n?e.inEdges(t.name):e.outEdges(t.name)).forEach((t=>{const n=e.edge(t);r.push(n)}))}class Zc{constructor(e){this.hierarchy=e,this.index={},this.hasSubHierarchy={},this.root=new el(this.hierarchy.root,this.hierarchy.graphOptions),this.index[e.root.name]=this.root,this.buildSubHierarchy(e.root.name),this.root.expanded=!0}getRenderInfoNodes(){return Object.values(this.index)}getSubHierarchy(){return this.hasSubHierarchy}buildSubHierarchy(e){if(e in this.hasSubHierarchy)return;this.hasSubHierarchy[e]=!0;const t=this.index[e];if(t.node.type!==wr.META)return;const n=t,r=n.node.metaGraph,i=n.coreGraph;r.nodes().forEach((e=>{const t=this.getOrCreateRenderNodeByName(e);i.setNode(e,t)})),r.edges().forEach((e=>{const t=r.edge(e),n=new Qc(t);i.setEdge(e.v,e.w,n)}));const o=n.node.parentNode;if(!o)return;const a=this.getRenderNodeByName(o.name),s=(e,...t)=>t.concat([e?"IN":"OUT"]).join("~~"),u=this.hierarchy.getBridgeGraph(e);u.edges().forEach((t=>{const n=u.edge(t),c=!!r.node(t.w),[l,f]=c?[t.w,t.v]:[t.v,t.w],d=t=>{const n=c?{v:t,w:e}:{v:e,w:t};return a.coreGraph.edge(n)};let h=d(f);h||(h=d(s(c,f,o.name)));const p=s(c,e),g=s(c,f,e);let v=i.node(g);if(!v){let e=i.node(p);if(!e){const t={name:p,type:wr.BRIDGE,isGroupNode:!1,cardinality:0,parentNode:null,include:Sr.UNSPECIFIED,inbound:c,attr:{}};e=new Jc(t),this.index[p]=e,i.setNode(p,e)}const t={name:g,type:wr.BRIDGE,isGroupNode:!1,cardinality:1,parentNode:null,include:Sr.UNSPECIFIED,inbound:c,attr:{}};v=new Jc(t),this.index[g]=v,i.setNode(g,v),i.setParent(g,p),e.node.cardinality++}const m=new Qc(n);m.adjoiningMetaEdge=h,c?i.setEdge(g,l,m):i.setEdge(l,g,m)}))}getOrCreateRenderNodeByName(e){if(!e)return null;if(e in this.index)return this.index[e];const t=this.getNodeByName(e);return t?(this.index[e]=t.isGroupNode?new el(t,this.hierarchy.graphOptions):new Jc(t),this.index[e]):null}getRenderNodeByName(e){return this.index[e]}getNodeByName(e){return this.hierarchy.node(e)}}class Jc{constructor(e){this.node=e,this.expanded=!1,this.x=0,this.y=0,this.coreBox={width:0,height:0},this.outboxWidth=0,this.labelOffset=0,this.radius=0,this.labelHeight=0,this.paddingTop=0,this.paddingLeft=0,this.paddingRight=0,this.paddingBottom=0,this.width=e.width||0,this.height=e.height||0,this.displayName=e.name,this.attr=e.attr}}class Qc{constructor(e){this.metaEdge=e,this.adjoiningMetaEdge=null,this.weight=1,this.points=[]}}class el extends Jc{constructor(e,t){super(e);const n=e.metaGraph.graph();t.compound=!0,this.coreGraph=Yc(n.name,Ar.CORE,t)}}function tl(e,t){e.node.isGroupNode&&function(e,t){const n=br(t);e.coreGraph.nodes().map((t=>e.coreGraph.node(t))).forEach((e=>{var r,i,o,a,s,u;const{height:c,width:l}=e;switch(e.node.type){case wr.NODE:Object.assign(e,n.nodeSize.node),e.height=c||n.nodeSize.node.height,e.width=l||n.nodeSize.node.width;break;case wr.BRIDGE:Object.assign(e,n.nodeSize.bridge);break;case wr.META:e.expanded?tl(e,t):(Object.assign(e,n.nodeSize.meta),e.height=n.nodeSize.meta.height,e.width=n.nodeSize.meta.width);break;default:throw Error("Unrecognized node type: "+e.node.type)}if(!e.expanded){const n=e.attr;!function(e,t=!1){if(e.coreBox.width=e.width,e.coreBox.height=e.height,!t){const t=`${e.displayName}`.length,n=3;e.width=Math.max(e.coreBox.width,t*n)}}(e,t&&(0===e.node.type&&!!(null===(i=null===(r=null==t?void 0:t.nodeSize)||void 0===r?void 0:r.meta)||void 0===i?void 0:i.width)||1===e.node.type&&(!!(null===(a=null===(o=null==t?void 0:t.nodeSize)||void 0===o?void 0:o.node)||void 0===a?void 0:a.width)||!!n.width)||2===e.node.type&&!!(null===(u=null===(s=null==t?void 0:t.nodeSize)||void 0===s?void 0:s.bridge)||void 0===u?void 0:u.width)))}}))}(e,t),e.node.type===wr.META&&function(e,t){const n=br(t),r=n.subScene.meta;Object.assign(e,r);const{nodeSep:i,rankSep:o,edgeSep:a,align:s}=n.graph.meta,u={nodesep:i,ranksep:o,edgesep:a,align:s};Object.assign(e.coreBox,function(e,t){const{ranksep:n,nodesep:r,edgesep:i,align:o}=t;Object.assign(e.graph(),{ranksep:n,nodesep:r,edgesep:i,align:o});const a=[];if(e.nodes().forEach((t=>{e.node(t).node.type!==wr.BRIDGE&&a.push(t)})),!a.length)return{width:0,height:0};jc(e);let s=1/0,u=1/0,c=-1/0,l=-1/0;return a.forEach((t=>{const n=e.node(t),r=.5*n.width,i=n.x-r,o=n.x+r;s=i<s?i:s,c=o>c?o:c;const a=.5*n.height,f=n.y-a,d=n.y+a;u=f<u?f:u,l=d>l?d:l})),e.edges().forEach((t=>{const n=e.edge(t),r=e.node(n.metaEdge.v),i=e.node(n.metaEdge.w);if(3===n.points.length&&function(e){let t=nl(e[0],e[1]);for(let n=1;n<e.length-1;n++){const r=nl(e[n],e[n+1]);if(Math.abs(r-t)>1)return!1;t=r}return!0}(n.points)){if(null!=r){const e=r.expanded?r.x:rl(r);n.points[0].x=e}if(null!=i){const e=i.expanded?i.x:rl(i);n.points[2].x=e}n.points=[n.points[0],n.points[1]]}const o=n.points[n.points.length-2];null!=i&&(n.points[n.points.length-1]=il(o,i));const a=n.points[1];null!=r&&(n.points[0]=il(a,r)),n.points.forEach((e=>{s=e.x<s?e.x:s,c=e.x>c?e.x:c,u=e.y<u?e.y:u,l=e.y>l?e.y:l}))})),e.nodes().forEach((t=>{const n=e.node(t);n.x-=s,n.y-=u})),e.edges().forEach((t=>{e.edge(t).points.forEach((e=>{e.x-=s,e.y-=u}))})),{width:c-s,height:l-u}}(e.coreGraph,u));let c=0;e.coreGraph.nodeCount()>0&&c++;const l=c<=1?0:c;e.coreBox.width+=l+l,e.coreBox.height=r.labelHeight+e.coreBox.height,e.width=e.coreBox.width+r.paddingLeft+r.paddingRight,e.height=e.paddingTop+e.coreBox.height+e.paddingBottom}(e,t)}function nl(e,t){const n=t.x-e.x,r=t.y-e.y;return 180*Math.atan(r/n)/Math.PI}function rl(e){return e.expanded?e.x:e.x-e.width/2+0+e.coreBox.width/2}function il(e,t){const n=t.expanded?t.x:rl(t),r=t.y,i=e.x-n,o=e.y-r;let a,s,u=t.expanded?t.width:t.coreBox.width,c=t.expanded?t.height:t.coreBox.height;return Math.abs(o)*u/2>Math.abs(i)*c/2?(o<0&&(c=-c),a=0===o?0:c/2*i/o,s=c/2):(i<0&&(u=-u),a=u/2,s=0===i?0:u/2*o/i),{x:n+a,y:r+s}}function ol(e,t,n,r){var i,o;let a=[];const s=(null===(i=n.find((t=>t.id===e)))||void 0===i?void 0:i.path)||[],u=(null===(o=n.find((e=>e.id===t)))||void 0===o?void 0:o.path)||[],c=[_r,...s].slice(0,s.length).reverse(),l=[_r,...u].slice(0,u.length);return c.forEach((i=>{const o=n.find((e=>e.id===i));a=a.concat(o.edges.filter((n=>n.baseEdgeList.some((n=>n.v===((null==r?void 0:r.v)||e)&&n.w===((null==r?void 0:r.w)||t))))))})),l.filter((e=>!c.includes(e))).forEach((i=>{const o=n.find((e=>e.id===i));a=a.concat(o.edges.filter((n=>n.baseEdgeList.some((n=>n.v===((null==r?void 0:r.v)||e)&&n.w===((null==r?void 0:r.w)||t))))))})),a}function al(e){const t=e.coreGraph.nodes().map((t=>e.coreGraph.node(t)));return Object.assign(Object.assign({},sl(e)),{expanded:e.expanded,nodes:e.expanded?(n=t,n.map((e=>e.node.type===wr.META?al(e):sl(e)))):[],edges:e.expanded?ul(e):[]});var n}function sl(e){return{id:e.node.name,name:e.node.name,type:e.node.type,cardinality:e.node.cardinality,attr:e.attr,parentNodeName:e.node.parentNode?e.node.parentNode.name:null,coreBox:Object.assign({},e.coreBox),x:e.x,y:e.y,width:e.width,height:e.height,radius:e.radius,labelHeight:e.labelHeight,labelOffset:e.labelOffset,outboxWidth:e.outboxWidth,paddingLeft:e.paddingLeft,paddingTop:e.paddingTop,paddingRight:e.paddingRight,paddingBottom:e.paddingBottom,path:e.node.path}}function ul(e){return e.coreGraph.edges().map((t=>({renderInfoEdge:e.coreGraph.edge(t),edge:t}))).filter((({renderInfoEdge:e})=>e.metaEdge)).map((({edge:t,renderInfoEdge:n})=>{const r=function(e,t){const n=t.points.map((e=>Object.assign({},e)));if(t.adjoiningMetaEdge){const r=t.adjoiningMetaEdge.points,i=t.metaEdge.inbound,o=i?r[r.length-1]:r[0],a=n[i?0:n.length-1],s=e.x-e.width/2,u=e.y-e.height/2,c=o.x-s,l=o.y-u,f=-e.paddingLeft,d=-(e.paddingTop+e.labelHeight);a.x=c+f,a.y=l+d}return n}(e,n);return{adjoiningEdge:n.adjoiningMetaEdge?{w:n.adjoiningMetaEdge.metaEdge.w,v:n.adjoiningMetaEdge.metaEdge.v}:null,inbound:n.metaEdge.inbound,w:t.w,v:t.v,points:r,weight:n.weight,baseEdgeList:n.metaEdge.baseEdgeList,parentNodeName:e.node.name}}))}class cl extends o{constructor(e){super(),this.rankdir="TB",this.nodesep=50,this.edgesep=5,this.ranksep=50,this.controlPoints=!0,this.anchorPoint=!0,this.nodes=[],this.edges=[],this.combos=[],this.onLayoutEnd=()=>{},this.updateCfg(e)}getDefaultCfg(){return{rankdir:"TB",align:void 0,begin:void 0,nodeSize:void 0,nodesep:50,ranksep:50,controlPoints:!0,anchorPoint:!0}}init(e){const t=e.hiddenNodes||[],n=e.hiddenEdges||[],r=e.hiddenCombos||[];this.nodes=this.getDataByOrder((e.nodes||[]).concat(t)),this.edges=this.getDataByOrder((e.edges||[]).concat(n)),this.combos=(e.combos||[]).concat(r.map((e=>Object.assign(Object.assign({},e),{collapsed:!0}))))}execute(){const e=this,{nodes:t,edges:n}=e;if(!t)return;const{graphDef:r,graphOption:i,graphSettings:o}=e.getLayoutConfig(),a=function(e,t=!1){const n=JSON.parse(JSON.stringify(e)),r={nodes:[n],edges:[...n.edges]};return n.nodes.forEach((function e(t){(0===t.type||1===t.type)&&r.nodes.push(t),0===t.type&&(r.edges=r.edges.concat(t.edges)),Array.isArray(t.nodes)&&t.nodes.forEach(e)})),t&&r.nodes.forEach((e=>{const t=r.nodes.find((t=>t.id===e.parentNodeName));if(t){const n=t.x-t.width/2+t.paddingLeft,r=t.y-t.height/2+t.labelHeight+t.paddingTop;t.id!==_r&&(e.x+=n,e.y+=r),0===e.type&&e.edges.forEach((t=>{t.points.forEach((t=>{t.x+=e.x-e.width/2+e.paddingLeft,t.y+=e.y-e.height/2+e.labelHeight+e.paddingTop}))}))}})),r}(function(e,t,n){var r,i,o,a;const s=e.nodes.filter(((e,t,n)=>n.findIndex((t=>t.id===e.id))!==t)).map((e=>e.id));if(s.length)throw new Error(`Duplicated ids found: ${s.join(", ")}`);const u=function(e){const t={nodes:[]},n=e.compound,r=Object.keys(n||{}),i=new Map,o=(e,t=[])=>{if(i.has(e))return i.get(e);for(let i=0;i<r.length;i++){let a=r[i];if(n&&-1!==n[a].indexOf(e))return t.unshift(a),o(a,t)}return 0===t.length&&i.set(e,t),t},a=t=>e.edges.filter((e=>e.w===t)).map((e=>({name:e.v})));return e.nodes.forEach((e=>{const n=e.id,r=[...o(n),n];let i=a(n);t.nodes.push({name:n,path:r,inputs:i,width:e.width,height:e.height,attr:Object.assign({},e)})})),t}(e),c=function(e,t){const n=(e,t)=>{for(let n of t.values())if(n.includes(e))return!0;return!1},r=(e,t=[])=>{if(0===Object.keys(e).length)return[...new Set(t)];const i=new Map(Object.keys(e).map((t=>[t,e[t]]))),o={};for(let[e,r]of i)n(e,i)?o[e]=r:t=t.concat(e,r);return r(o,t)};return r(e).filter((e=>t.includes(e)))}(e.compound||{},(null==t?void 0:t.expanded)||[]),l=function(e,t){return function(e){return new Zc(e)}(function(e,t){const{rankDirection:n,align:r}=t,i=new Kc({rankdir:n,align:r});return function(e,t){Object.keys(t.nodes).forEach((n=>{const r=t.nodes[n],i=r.path;let o=e.root;o.depth=Math.max(i.length,o.depth);for(let t=0;t<i.length&&(o.depth=Math.max(o.depth,i.length-t),o.cardinality+=r.cardinality,t!==i.length-1);t++){const n=i[t];let a=e.node(n);a||(a=Xc(n,e.graphOptions),a.path=r.path.slice(0,t+1),a.parentNode=o,e.setNode(n,a),o.metaGraph.setNode(n,a)),o=a}e.setNode(r.name,r),r.parentNode=o,o.metaGraph.setNode(r.name,r)}))}(i,e),function(e,t){const n=e.getNodeMap();let r=[],i=[];const o=(e,t)=>{let n=0;for(;e;)t[n++]=e.name,e=e.parentNode;return n-1};t.edges.forEach((a=>{r=[],i=[];let s=o(t.nodes[a.v],r),u=o(t.nodes[a.w],i);for(;r[s]===i[u];)if(s--,u--,s<0||u<0)throw Error("No difference found between ancestor paths.");const c=n[r[s+1]],l=r[s],f=i[u];let d=c.metaGraph.edge(l,f);d||(d=qc(l,f),c.metaGraph.setEdge(l,f,d)),d.addBaseEdge(a,e)}))}(i,e),i}(function(e){const t=new Vc;return e.nodes.map((e=>new Fc(e))).forEach((e=>{t.nodes[e.name]=e,e.inputs.forEach((n=>{!function(e,t,n){n.name!==t.name&&e.edges.push(Object.assign(Object.assign({},n.attr),{v:n.name,w:t.name}))}(t,e,n)}))})),t}(e),t))}(u,{rankDirection:(null===(i=null===(r=null==n?void 0:n.graph)||void 0===r?void 0:r.meta)||void 0===i?void 0:i.rankDir)||(null==t?void 0:t.rankDirection)||yr.graph.meta.rankDir,align:(null===(a=null===(o=null==n?void 0:n.graph)||void 0===o?void 0:o.meta)||void 0===a?void 0:a.align)||yr.graph.meta.align});return function(e,t){t.forEach((t=>{const n=e.getRenderInfoNodes().find((e=>e.displayName===t));let r=n&&n.node&&n.node.name||"";const i=e.getRenderNodeByName(r);if(!i)throw new Error(`No nodes found: ${r}`);i.expanded=!0,e.buildSubHierarchy(r)}))}(l,c),tl(l.root,n),al(l.root)}(r,i,o),!0);return this.updatePosition(a),e.onLayoutEnd&&e.onLayoutEnd(),{nodes:t,edges:n}}getNodePath(e){const{nodes:t,combos:n}=this,r=t.find((t=>t.id===e)),i=(e,t=[])=>{const r=n.find((t=>t.id===e));return r?(t.unshift(e),r.parentId?i(r.parentId,t):t):t};return r&&r.comboId?i(r.comboId,[e]):[e]}getLayoutConfig(){var e,t,n;const r=this,{nodes:i,edges:o,combos:a,nodeSize:u,rankdir:c,align:f,edgesep:d,nodesep:h,ranksep:p,settings:g}=r,v=(a||[]).reduce(((e,t)=>{const n=i.filter((e=>e.comboId===t.id)).map((e=>e.id)),r=(a||[]).filter((e=>e.parentId===t.id)).map((e=>e.id));return(n.length||r.length)&&(e[t.id]=[...n,...r]),e}),{});let m;m=u?s(u)?()=>u:()=>[u,u]:e=>e&&e.size?s(e.size)?e.size:l(e.size)?[e.size.width||40,e.size.height||40]:[e.size,e.size]:[40,40];const[y,b]=(e=>e&&e.size?s(e.size)?e.size:[e.size,e.size]:[80,40])(null==a?void 0:a[0]),E=null===(t=null===(e=r.graphSettings)||void 0===e?void 0:e.subScene)||void 0===t?void 0:t.meta,[_,x,w,S]=(null===(n=a.find((e=>!e.collapsed)))||void 0===n?void 0:n.padding)||[20,20,20,20],A={compound:v,nodes:[...(i||[]).map((e=>{const t=m(e),n=t[0],r=t[1];return Object.assign(Object.assign({},e),{width:n,height:r})}))],edges:[...(o||[]).map((e=>Object.assign(Object.assign({},e),{v:e.source,w:e.target})))]},T={expanded:(a||[]).filter((e=>!e.collapsed)).map((e=>e.id))},I={graph:{meta:{align:f,rankDir:c,nodeSep:h,edgeSep:d,rankSep:p}},subScene:{meta:{paddingTop:_||(null==E?void 0:E.paddingTop)||20,paddingRight:x||(null==E?void 0:E.paddingRight)||20,paddingBottom:w||(null==E?void 0:E.paddingBottom)||20,paddingLeft:S||(null==E?void 0:E.paddingLeft)||20,labelHeight:0}},nodeSize:{meta:{width:y,height:b}}},N=br(g,Object.assign({},br(I,yr)));return r.graphSettings=N,{graphDef:A,graphOption:T,graphSettings:N}}updatePosition(e){const{nodes:t,edges:n}=e;this.updateNodePosition(t,n),this.updateEdgePosition(t,n)}getBegin(e,t){const{begin:n}=this,r=[0,0];if(n){let i=1/0,o=1/0;e.forEach((e=>{i>e.x&&(i=e.x),o>e.y&&(o=e.y)})),t.forEach((e=>{e.points.forEach((e=>{i>e.x&&(i=e.x),o>e.y&&(o=e.y)}))})),r[0]=n[0]-i,r[1]=n[1]-o}return r}updateNodePosition(e,t){const{combos:n,nodes:r,edges:i,anchorPoint:o,graphSettings:a}=this,s=this.getBegin(e,t);e.forEach((e=>{var u;const{x:c,y:l,id:f,type:d,coreBox:h}=e;if(d===Tr.META&&f!==_r){const t=n.findIndex((e=>e.id===f)),r=null===(u=null==a?void 0:a.subScene)||void 0===u?void 0:u.meta;n[t].offsetX=c+s[0],n[t].offsetY=l+s[1],n[t].fixSize=[h.width,h.height],n[t].fixCollapseSize=[h.width,h.height],e.expanded?n[t].padding=[null==r?void 0:r.paddingTop,null==r?void 0:r.paddingRight,null==r?void 0:r.paddingBottom,null==r?void 0:r.paddingLeft]:n[t].padding=[0,0,0,0]}else if(d===Tr.OP){const n=r.findIndex((e=>e.id===f));if(r[n].x=c+s[0],r[n].y=l+s[1],o){const o=[],a=t.filter((e=>e.v===f)),s=t.filter((e=>e.w===f));a.length>0&&a.forEach((t=>{const n=t.points[0],r=(n.x-c)/e.width+.5,a=(n.y-l)/e.height+.5;o.push([r,a]),t.baseEdgeList.forEach((e=>{const t=i.find((t=>t.source===e.v&&t.target===e.w));t&&(t.sourceAnchor=o.length-1)}))})),s.length>0&&s.forEach((t=>{const n=t.points[t.points.length-1],r=(n.x-c)/e.width+.5,a=(n.y-l)/e.height+.5;o.push([r,a]),t.baseEdgeList.forEach((e=>{const t=i.find((t=>t.source===e.v&&t.target===e.w));t&&(t.targetAnchor=o.length-1)}))})),r[n].anchorPoints=o.length>0?o:r[n].anchorPoints||[]}}}))}updateEdgePosition(e,t){const n=this,{combos:r,edges:i,controlPoints:o}=n,a=this.getBegin(e,t);o&&(r.forEach((e=>{e.inEdges=[],e.outEdges=[]})),i.forEach((t=>{var i,o,s,u;let c=e.find((e=>e.id===t.source)),l=e.find((e=>e.id===t.target)),f=[],d=[];if(c&&l)d=ol(null==c?void 0:c.id,null==l?void 0:l.id,e);else if(!c||!l){const r=n.getNodePath(t.source),i=n.getNodePath(t.target),o=r.reverse().slice(c?0:1).find((t=>e.find((e=>e.id===t)))),a=i.reverse().slice(l?0:1).find((t=>e.find((e=>e.id===t))));c=e.find((e=>e.id===o)),l=e.find((e=>e.id===a)),d=ol(null==c?void 0:c.id,null==l?void 0:l.id,e,{v:t.source,w:t.target})}if(f=d.reduce(((e,t)=>[...e,...t.points.map((e=>Object.assign(Object.assign({},e),{x:e.x+a[0],y:e.y+a[1]})))]),[]),f=f.slice(1,-1),t.controlPoints=f,(null==l?void 0:l.type)===wr.META){const e=r.findIndex((e=>e.id===(null==l?void 0:l.id)));if(!r[e]||(null===(i=r[e].inEdges)||void 0===i?void 0:i.some((e=>e.source===c.id&&e.target===l.id))))return;null===(o=r[e].inEdges)||void 0===o||o.push({source:c.id,target:l.id,controlPoints:f})}if((null==c?void 0:c.type)===wr.META){const e=r.findIndex((e=>e.id===(null==c?void 0:c.id)));if(!r[e]||(null===(s=r[e].outEdges)||void 0===s?void 0:s.some((e=>e.source===c.id&&e.target===l.id))))return;null===(u=r[e].outEdges)||void 0===u||u.push({source:c.id,target:l.id,controlPoints:f})}})))}getType(){return"dagreCompound"}getDataByOrder(e){return e.every((e=>void 0!==e.layoutOrder))||e.forEach(((e,t)=>{e.layoutOrder=t})),e.sort(((e,t)=>e.layoutOrder-t.layoutOrder))}}const ll=Object.prototype.toString;function fl(e){return ll.call(e).endsWith("Array]")}function dl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!fl(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");var n=t.fromIndex,r=void 0===n?0:n,i=t.toIndex,o=void 0===i?e.length:i;if(r<0||r>=e.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=r||o>e.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=e[r],s=r+1;s<o;s++)e[s]>a&&(a=e[s]);return a}function hl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!fl(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");var n=t.fromIndex,r=void 0===n?0:n,i=t.toIndex,o=void 0===i?e.length:i;if(r<0||r>=e.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=r||o>e.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=e[r],s=r+1;s<o;s++)e[s]<a&&(a=e[s]);return a}function pl(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!fl(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");if(void 0!==n.output){if(!fl(n.output))throw new TypeError("output option must be an array if specified");t=n.output}else t=new Array(e.length);var r=hl(e),i=dl(e);if(r===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var o=n.min,a=void 0===o?n.autoMinMax?r:0:o,s=n.max,u=void 0===s?n.autoMinMax?i:1:s;if(a>=u)throw new RangeError("min option must be smaller than max option");for(var c=(u-a)/(i-r),l=0;l<e.length;l++)t[l]=(e[l]-r)*c+a;return t}const gl=" ".repeat(2),vl=" ".repeat(4);function ml(e,t={}){const{maxRows:n=15,maxColumns:r=10,maxNumSize:i=8,padMinus:o="auto"}=t;return`${e.constructor.name} {\n${gl}[\n${vl}${function(e,t,n,r,i){const{rows:o,columns:a}=e,s=Math.min(o,t),u=Math.min(a,n),c=[];if("auto"===i){i=!1;e:for(let t=0;t<s;t++)for(let n=0;n<u;n++)if(e.get(t,n)<0){i=!0;break e}}for(let t=0;t<s;t++){let n=[];for(let o=0;o<u;o++)n.push(yl(e.get(t,o),r,i));c.push(`${n.join(" ")}`)}return u!==a&&(c[c.length-1]+=` ... ${a-n} more columns`),s!==o&&c.push(`... ${o-t} more rows`),c.join(`\n${vl}`)}(e,n,r,i,o)}\n${gl}]\n${gl}rows: ${e.rows}\n${gl}columns: ${e.columns}\n}`}function yl(e,t,n){return(e>=0&&n?` ${bl(e,t-1)}`:bl(e,t)).padEnd(t)}function bl(e,t){let n=e.toString();if(n.length<=t)return n;let r=e.toFixed(t);if(r.length>t&&(r=e.toFixed(Math.max(0,t-(r.length-t)))),r.length<=t&&!r.startsWith("0.000")&&!r.startsWith("-0.000"))return r;let i=e.toExponential(t);return i.length>t&&(i=e.toExponential(Math.max(0,t-(i.length-t)))),i.slice(0)}function El(e,t,n){let r=n?e.rows:e.rows-1;if(t<0||t>r)throw new RangeError("Row index out of range")}function _l(e,t,n){let r=n?e.columns:e.columns-1;if(t<0||t>r)throw new RangeError("Column index out of range")}function xl(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function wl(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function Sl(e,t,n,r,i){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(Tl("startRow",t),Tl("endRow",n),Tl("startColumn",r),Tl("endColumn",i),t>n||r>i||t<0||t>=e.rows||n<0||n>=e.rows||r<0||r>=e.columns||i<0||i>=e.columns)throw new RangeError("Submatrix indices are out of range")}function Al(e,t=0){let n=[];for(let r=0;r<e;r++)n.push(t);return n}function Tl(e,t){if("number"!=typeof t)throw new TypeError(`${e} must be a number`)}function Il(e){if(e.isEmpty())throw new Error("Empty matrix has no elements to index")}class Nl{static from1DArray(e,t,n){if(e*t!==n.length)throw new RangeError("data length does not match given dimensions");let r=new kl(e,t);for(let i=0;i<e;i++)for(let e=0;e<t;e++)r.set(i,e,n[i*t+e]);return r}static rowVector(e){let t=new kl(1,e.length);for(let n=0;n<e.length;n++)t.set(0,n,e[n]);return t}static columnVector(e){let t=new kl(e.length,1);for(let n=0;n<e.length;n++)t.set(n,0,e[n]);return t}static zeros(e,t){return new kl(e,t)}static ones(e,t){return new kl(e,t).fill(1)}static rand(e,t,n={}){if("object"!=typeof n)throw new TypeError("options must be an object");const{random:r=Math.random}=n;let i=new kl(e,t);for(let n=0;n<e;n++)for(let e=0;e<t;e++)i.set(n,e,r());return i}static randInt(e,t,n={}){if("object"!=typeof n)throw new TypeError("options must be an object");const{min:r=0,max:i=1e3,random:o=Math.random}=n;if(!Number.isInteger(r))throw new TypeError("min must be an integer");if(!Number.isInteger(i))throw new TypeError("max must be an integer");if(r>=i)throw new RangeError("min must be smaller than max");let a=i-r,s=new kl(e,t);for(let n=0;n<e;n++)for(let e=0;e<t;e++){let t=r+Math.round(o()*a);s.set(n,e,t)}return s}static eye(e,t,n){void 0===t&&(t=e),void 0===n&&(n=1);let r=Math.min(e,t),i=this.zeros(e,t);for(let e=0;e<r;e++)i.set(e,e,n);return i}static diag(e,t,n){let r=e.length;void 0===t&&(t=r),void 0===n&&(n=t);let i=Math.min(r,t,n),o=this.zeros(t,n);for(let t=0;t<i;t++)o.set(t,t,e[t]);return o}static min(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);let n=e.rows,r=e.columns,i=new kl(n,r);for(let o=0;o<n;o++)for(let n=0;n<r;n++)i.set(o,n,Math.min(e.get(o,n),t.get(o,n)));return i}static max(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);let n=e.rows,r=e.columns,i=new this(n,r);for(let o=0;o<n;o++)for(let n=0;n<r;n++)i.set(o,n,Math.max(e.get(o,n),t.get(o,n)));return i}static checkMatrix(e){return Nl.isMatrix(e)?e:new kl(e)}static isMatrix(e){return null!=e&&"Matrix"===e.klass}get size(){return this.rows*this.columns}apply(e){if("function"!=typeof e)throw new TypeError("callback must be a function");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e.call(this,t,n);return this}to1DArray(){let e=[];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e.push(this.get(t,n));return e}to2DArray(){let e=[];for(let t=0;t<this.rows;t++){e.push([]);for(let n=0;n<this.columns;n++)e[t].push(this.get(t,n))}return e}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let t=0;t<=e;t++)if(this.get(e,t)!==this.get(t,e))return!1;return!0}return!1}isEchelonForm(){let e=0,t=0,n=-1,r=!0,i=!1;for(;e<this.rows&&r;){for(t=0,i=!1;t<this.columns&&!1===i;)0===this.get(e,t)?t++:1===this.get(e,t)&&t>n?(i=!0,n=t):(r=!1,i=!0);e++}return r}isReducedEchelonForm(){let e=0,t=0,n=-1,r=!0,i=!1;for(;e<this.rows&&r;){for(t=0,i=!1;t<this.columns&&!1===i;)0===this.get(e,t)?t++:1===this.get(e,t)&&t>n?(i=!0,n=t):(r=!1,i=!0);for(let n=t+1;n<this.rows;n++)0!==this.get(e,n)&&(r=!1);e++}return r}echelonForm(){let e=this.clone(),t=0,n=0;for(;t<e.rows&&n<e.columns;){let r=t;for(let i=t;i<e.rows;i++)e.get(i,n)>e.get(r,n)&&(r=i);if(0===e.get(r,n))n++;else{e.swapRows(t,r);let i=e.get(t,n);for(let r=n;r<e.columns;r++)e.set(t,r,e.get(t,r)/i);for(let r=t+1;r<e.rows;r++){let i=e.get(r,n)/e.get(t,n);e.set(r,n,0);for(let o=n+1;o<e.columns;o++)e.set(r,o,e.get(r,o)-e.get(t,o)*i)}t++,n++}}return e}reducedEchelonForm(){let e=this.echelonForm(),t=e.columns,n=e.rows,r=n-1;for(;r>=0;)if(0===e.maxRow(r))r--;else{let i=0,o=!1;for(;i<n&&!1===o;)1===e.get(r,i)?o=!0:i++;for(let n=0;n<r;n++){let o=e.get(n,i);for(let a=i;a<t;a++){let t=e.get(n,a)-o*e.get(r,a);e.set(n,a,t)}}r--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if("object"!=typeof e)throw new TypeError("options must be an object");const{rows:t=1,columns:n=1}=e;if(!Number.isInteger(t)||t<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let r=new kl(this.rows*t,this.columns*n);for(let e=0;e<t;e++)for(let t=0;t<n;t++)r.setSubMatrix(this,this.rows*e,this.columns*t);return r}fill(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,e);return this}neg(){return this.mulS(-1)}getRow(e){El(this,e);let t=[];for(let n=0;n<this.columns;n++)t.push(this.get(e,n));return t}getRowVector(e){return kl.rowVector(this.getRow(e))}setRow(e,t){El(this,e),t=xl(this,t);for(let n=0;n<this.columns;n++)this.set(e,n,t[n]);return this}swapRows(e,t){El(this,e),El(this,t);for(let n=0;n<this.columns;n++){let r=this.get(e,n);this.set(e,n,this.get(t,n)),this.set(t,n,r)}return this}getColumn(e){_l(this,e);let t=[];for(let n=0;n<this.rows;n++)t.push(this.get(n,e));return t}getColumnVector(e){return kl.columnVector(this.getColumn(e))}setColumn(e,t){_l(this,e),t=wl(this,t);for(let n=0;n<this.rows;n++)this.set(n,e,t[n]);return this}swapColumns(e,t){_l(this,e),_l(this,t);for(let n=0;n<this.rows;n++){let r=this.get(n,e);this.set(n,e,this.get(n,t)),this.set(n,t,r)}return this}addRowVector(e){e=xl(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)+e[n]);return this}subRowVector(e){e=xl(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)-e[n]);return this}mulRowVector(e){e=xl(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e[n]);return this}divRowVector(e){e=xl(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)/e[n]);return this}addColumnVector(e){e=wl(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)+e[t]);return this}subColumnVector(e){e=wl(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)-e[t]);return this}mulColumnVector(e){e=wl(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e[t]);return this}divColumnVector(e){e=wl(this,e);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)/e[t]);return this}mulRow(e,t){El(this,e);for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t);return this}mulColumn(e,t){_l(this,e);for(let n=0;n<this.rows;n++)this.set(n,e,this.get(n,e)*t);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e[t]&&(e[t]=this.get(t,n));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e[n]&&(e[n]=this.get(t,n));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n));return e}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){Il(this);let e=this.get(0,0),t=[0,0];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)>e&&(e=this.get(n,r),t[0]=n,t[1]=r);return t}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e[t]&&(e[t]=this.get(t,n));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e[n]&&(e[n]=this.get(t,n));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n));return e}default:throw new Error(`invalid option: ${e}`)}}minIndex(){Il(this);let e=this.get(0,0),t=[0,0];for(let n=0;n<this.rows;n++)for(let r=0;r<this.columns;r++)this.get(n,r)<e&&(e=this.get(n,r),t[0]=n,t[1]=r);return t}maxRow(e){if(El(this,e),this.isEmpty())return NaN;let t=this.get(e,0);for(let n=1;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n));return t}maxRowIndex(e){El(this,e),Il(this);let t=this.get(e,0),n=[e,0];for(let r=1;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r),n[1]=r);return n}minRow(e){if(El(this,e),this.isEmpty())return NaN;let t=this.get(e,0);for(let n=1;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n));return t}minRowIndex(e){El(this,e),Il(this);let t=this.get(e,0),n=[e,0];for(let r=1;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r),n[1]=r);return n}maxColumn(e){if(_l(this,e),this.isEmpty())return NaN;let t=this.get(0,e);for(let n=1;n<this.rows;n++)this.get(n,e)>t&&(t=this.get(n,e));return t}maxColumnIndex(e){_l(this,e),Il(this);let t=this.get(0,e),n=[0,e];for(let r=1;r<this.rows;r++)this.get(r,e)>t&&(t=this.get(r,e),n[0]=r);return n}minColumn(e){if(_l(this,e),this.isEmpty())return NaN;let t=this.get(0,e);for(let n=1;n<this.rows;n++)this.get(n,e)<t&&(t=this.get(n,e));return t}minColumnIndex(e){_l(this,e),Il(this);let t=this.get(0,e),n=[0,e];for(let r=1;r<this.rows;r++)this.get(r,e)<t&&(t=this.get(r,e),n[0]=r);return n}diag(){let e=Math.min(this.rows,this.columns),t=[];for(let n=0;n<e;n++)t.push(this.get(n,n));return t}norm(e="frobenius"){let t=0;if("max"===e)return this.max();if("frobenius"===e){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)t+=this.get(e,n)*this.get(e,n);return Math.sqrt(t)}throw new RangeError(`unknown norm type: ${e}`)}cumulativeSum(){let e=0;for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e+=this.get(t,n),this.set(t,n,e);return this}dot(e){Nl.isMatrix(e)&&(e=e.to1DArray());let t=this.to1DArray();if(t.length!==e.length)throw new RangeError("vectors do not have the same size");let n=0;for(let r=0;r<t.length;r++)n+=t[r]*e[r];return n}mmul(e){e=kl.checkMatrix(e);let t=this.rows,n=this.columns,r=e.columns,i=new kl(t,r),o=new Float64Array(n);for(let a=0;a<r;a++){for(let t=0;t<n;t++)o[t]=e.get(t,a);for(let e=0;e<t;e++){let t=0;for(let r=0;r<n;r++)t+=this.get(e,r)*o[r];i.set(e,a,t)}}return i}strassen2x2(e){e=kl.checkMatrix(e);let t=new kl(2,2);const n=this.get(0,0),r=e.get(0,0),i=this.get(0,1),o=e.get(0,1),a=this.get(1,0),s=e.get(1,0),u=this.get(1,1),c=e.get(1,1),l=(n+u)*(r+c),f=(a+u)*r,d=n*(o-c),h=u*(s-r),p=(n+i)*c,g=l+h-p+(i-u)*(s+c),v=d+p,m=f+h,y=l-f+d+(a-n)*(r+o);return t.set(0,0,g),t.set(0,1,v),t.set(1,0,m),t.set(1,1,y),t}strassen3x3(e){e=kl.checkMatrix(e);let t=new kl(3,3);const n=this.get(0,0),r=this.get(0,1),i=this.get(0,2),o=this.get(1,0),a=this.get(1,1),s=this.get(1,2),u=this.get(2,0),c=this.get(2,1),l=this.get(2,2),f=e.get(0,0),d=e.get(0,1),h=e.get(0,2),p=e.get(1,0),g=e.get(1,1),v=e.get(1,2),m=e.get(2,0),y=e.get(2,1),b=e.get(2,2),E=(n-o)*(-d+g),_=(-n+o+a)*(f-d+g),x=(o+a)*(-f+d),w=n*f,S=(-n+u+c)*(f-h+v),A=(-n+u)*(h-v),T=(u+c)*(-f+h),I=(-i+c+l)*(g+m-y),N=(i-l)*(g-y),D=i*m,k=(c+l)*(-m+y),C=(-i+a+s)*(v+m-b),M=(i-s)*(v-b),O=(a+s)*(-m+b),R=w+D+r*p,P=(n+r+i-o-a-c-l)*g+_+x+w+I+D+k,G=w+S+T+(n+r+i-a-s-u-c)*v+D+C+O,L=E+a*(-f+d+p-g-v-m+b)+_+w+D+C+M,U=E+_+x+w+s*y,z=D+C+M+O+o*h,B=w+S+A+c*(-f+h+p-g-v-m+y)+I+N+D,j=I+N+D+k+u*d,F=w+S+A+T+l*b;return t.set(0,0,R),t.set(0,1,P),t.set(0,2,G),t.set(1,0,L),t.set(1,1,U),t.set(1,2,z),t.set(2,0,B),t.set(2,1,j),t.set(2,2,F),t}mmulStrassen(e){e=kl.checkMatrix(e);let t=this.clone(),n=t.rows,r=t.columns,i=e.rows,o=e.columns;function a(e,t,n){let r=e.rows,i=e.columns;if(r===t&&i===n)return e;{let r=Nl.zeros(t,n);return r=r.setSubMatrix(e,0,0),r}}r!==i&&console.warn(`Multiplying ${n} x ${r} and ${i} x ${o} matrix: dimensions do not match.`);let s=Math.max(n,i),u=Math.max(r,o);return t=a(t,s,u),function e(t,n,r,i){if(r<=512||i<=512)return t.mmul(n);r%2==1&&i%2==1?(t=a(t,r+1,i+1),n=a(n,r+1,i+1)):r%2==1?(t=a(t,r+1,i),n=a(n,r+1,i)):i%2==1&&(t=a(t,r,i+1),n=a(n,r,i+1));let o=parseInt(t.rows/2,10),s=parseInt(t.columns/2,10),u=t.subMatrix(0,o-1,0,s-1),c=n.subMatrix(0,o-1,0,s-1),l=t.subMatrix(0,o-1,s,t.columns-1),f=n.subMatrix(0,o-1,s,n.columns-1),d=t.subMatrix(o,t.rows-1,0,s-1),h=n.subMatrix(o,n.rows-1,0,s-1),p=t.subMatrix(o,t.rows-1,s,t.columns-1),g=n.subMatrix(o,n.rows-1,s,n.columns-1),v=e(Nl.add(u,p),Nl.add(c,g),o,s),m=e(Nl.add(d,p),c,o,s),y=e(u,Nl.sub(f,g),o,s),b=e(p,Nl.sub(h,c),o,s),E=e(Nl.add(u,l),g,o,s),_=e(Nl.sub(d,u),Nl.add(c,f),o,s),x=e(Nl.sub(l,p),Nl.add(h,g),o,s),w=Nl.add(v,b);w.sub(E),w.add(x);let S=Nl.add(y,E),A=Nl.add(m,b),T=Nl.sub(v,m);T.add(y),T.add(_);let I=Nl.zeros(2*w.rows,2*w.columns);return I=I.setSubMatrix(w,0,0),I=I.setSubMatrix(S,w.rows,0),I=I.setSubMatrix(A,0,w.columns),I=I.setSubMatrix(T,w.rows,w.columns),I.subMatrix(0,r-1,0,i-1)}(t,e=a(e,s,u),s,u)}scaleRows(e={}){if("object"!=typeof e)throw new TypeError("options must be an object");const{min:t=0,max:n=1}=e;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(t>=n)throw new RangeError("min must be smaller than max");let r=new kl(this.rows,this.columns);for(let e=0;e<this.rows;e++){const i=this.getRow(e);i.length>0&&pl(i,{min:t,max:n,output:i}),r.setRow(e,i)}return r}scaleColumns(e={}){if("object"!=typeof e)throw new TypeError("options must be an object");const{min:t=0,max:n=1}=e;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(t>=n)throw new RangeError("min must be smaller than max");let r=new kl(this.rows,this.columns);for(let e=0;e<this.columns;e++){const i=this.getColumn(e);i.length&&pl(i,{min:t,max:n,output:i}),r.setColumn(e,i)}return r}flipRows(){const e=Math.ceil(this.columns/2);for(let t=0;t<this.rows;t++)for(let n=0;n<e;n++){let e=this.get(t,n),r=this.get(t,this.columns-1-n);this.set(t,n,r),this.set(t,this.columns-1-n,e)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let t=0;t<this.columns;t++)for(let n=0;n<e;n++){let e=this.get(n,t),r=this.get(this.rows-1-n,t);this.set(n,t,r),this.set(this.rows-1-n,t,e)}return this}kroneckerProduct(e){e=kl.checkMatrix(e);let t=this.rows,n=this.columns,r=e.rows,i=e.columns,o=new kl(t*r,n*i);for(let a=0;a<t;a++)for(let t=0;t<n;t++)for(let n=0;n<r;n++)for(let s=0;s<i;s++)o.set(r*a+n,i*t+s,this.get(a,t)*e.get(n,s));return o}kroneckerSum(e){if(e=kl.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let t=this.rows,n=e.rows,r=this.kroneckerProduct(kl.eye(n,n)),i=kl.eye(t,t).kroneckerProduct(e);return r.add(i)}transpose(){let e=new kl(this.columns,this.rows);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e.set(n,t,this.get(t,n));return e}sortRows(e=Dl){for(let t=0;t<this.rows;t++)this.setRow(t,this.getRow(t).sort(e));return this}sortColumns(e=Dl){for(let t=0;t<this.columns;t++)this.setColumn(t,this.getColumn(t).sort(e));return this}subMatrix(e,t,n,r){Sl(this,e,t,n,r);let i=new kl(t-e+1,r-n+1);for(let o=e;o<=t;o++)for(let t=n;t<=r;t++)i.set(o-e,t-n,this.get(o,t));return i}subMatrixRow(e,t,n){if(void 0===t&&(t=0),void 0===n&&(n=this.columns-1),t>n||t<0||t>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let r=new kl(e.length,n-t+1);for(let i=0;i<e.length;i++)for(let o=t;o<=n;o++){if(e[i]<0||e[i]>=this.rows)throw new RangeError(`Row index out of range: ${e[i]}`);r.set(i,o-t,this.get(e[i],o))}return r}subMatrixColumn(e,t,n){if(void 0===t&&(t=0),void 0===n&&(n=this.rows-1),t>n||t<0||t>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let r=new kl(n-t+1,e.length);for(let i=0;i<e.length;i++)for(let o=t;o<=n;o++){if(e[i]<0||e[i]>=this.columns)throw new RangeError(`Column index out of range: ${e[i]}`);r.set(o-t,i,this.get(o,e[i]))}return r}setSubMatrix(e,t,n){if((e=kl.checkMatrix(e)).isEmpty())return this;Sl(this,t,t+e.rows-1,n,n+e.columns-1);for(let r=0;r<e.rows;r++)for(let i=0;i<e.columns;i++)this.set(t+r,n+i,e.get(r,i));return this}selection(e,t){!function(e,t){if(!fl(t))throw new TypeError("row indices must be an array");for(let n=0;n<t.length;n++)if(t[n]<0||t[n]>=e.rows)throw new RangeError("row indices are out of range")}(this,e),function(e,t){if(!fl(t))throw new TypeError("column indices must be an array");for(let n=0;n<t.length;n++)if(t[n]<0||t[n]>=e.columns)throw new RangeError("column indices are out of range")}(this,t);let n=new kl(e.length,t.length);for(let r=0;r<e.length;r++){let i=e[r];for(let e=0;e<t.length;e++){let o=t[e];n.set(r,e,this.get(i,o))}}return n}trace(){let e=Math.min(this.rows,this.columns),t=0;for(let n=0;n<e;n++)t+=this.get(n,n);return t}clone(){let e=new kl(this.rows,this.columns);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e.set(t,n,this.get(t,n));return e}sum(e){switch(e){case"row":return function(e){let t=Al(e.rows);for(let n=0;n<e.rows;++n)for(let r=0;r<e.columns;++r)t[n]+=e.get(n,r);return t}(this);case"column":return function(e){let t=Al(e.columns);for(let n=0;n<e.rows;++n)for(let r=0;r<e.columns;++r)t[r]+=e.get(n,r);return t}(this);case void 0:return function(e){let t=0;for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)t+=e.get(n,r);return t}(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return function(e){let t=Al(e.rows,1);for(let n=0;n<e.rows;++n)for(let r=0;r<e.columns;++r)t[n]*=e.get(n,r);return t}(this);case"column":return function(e){let t=Al(e.columns,1);for(let n=0;n<e.rows;++n)for(let r=0;r<e.columns;++r)t[r]*=e.get(n,r);return t}(this);case void 0:return function(e){let t=1;for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)t*=e.get(n,r);return t}(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const t=this.sum(e);switch(e){case"row":for(let e=0;e<this.rows;e++)t[e]/=this.columns;return t;case"column":for(let e=0;e<this.columns;e++)t[e]/=this.rows;return t;case void 0:return t/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,t={}){if("object"==typeof e&&(t=e,e=void 0),"object"!=typeof t)throw new TypeError("options must be an object");const{unbiased:n=!0,mean:r=this.mean(e)}=t;if("boolean"!=typeof n)throw new TypeError("unbiased must be a boolean");switch(e){case"row":if(!fl(r))throw new TypeError("mean must be an array");return function(e,t,n){const r=e.rows,i=e.columns,o=[];for(let a=0;a<r;a++){let r=0,s=0,u=0;for(let t=0;t<i;t++)u=e.get(a,t)-n[a],r+=u,s+=u*u;t?o.push((s-r*r/i)/(i-1)):o.push((s-r*r/i)/i)}return o}(this,n,r);case"column":if(!fl(r))throw new TypeError("mean must be an array");return function(e,t,n){const r=e.rows,i=e.columns,o=[];for(let a=0;a<i;a++){let i=0,s=0,u=0;for(let t=0;t<r;t++)u=e.get(t,a)-n[a],i+=u,s+=u*u;t?o.push((s-i*i/r)/(r-1)):o.push((s-i*i/r)/r)}return o}(this,n,r);case void 0:if("number"!=typeof r)throw new TypeError("mean must be a number");return function(e,t,n){const r=e.rows,i=e.columns,o=r*i;let a=0,s=0,u=0;for(let t=0;t<r;t++)for(let r=0;r<i;r++)u=e.get(t,r)-n,a+=u,s+=u*u;return t?(s-a*a/o)/(o-1):(s-a*a/o)/o}(this,n,r);default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,t){"object"==typeof e&&(t=e,e=void 0);const n=this.variance(e,t);if(void 0===e)return Math.sqrt(n);for(let e=0;e<n.length;e++)n[e]=Math.sqrt(n[e]);return n}center(e,t={}){if("object"==typeof e&&(t=e,e=void 0),"object"!=typeof t)throw new TypeError("options must be an object");const{center:n=this.mean(e)}=t;switch(e){case"row":if(!fl(n))throw new TypeError("center must be an array");return function(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)-t[n])}(this,n),this;case"column":if(!fl(n))throw new TypeError("center must be an array");return function(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)-t[r])}(this,n),this;case void 0:if("number"!=typeof n)throw new TypeError("center must be a number");return function(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)-t)}(this,n),this;default:throw new Error(`invalid option: ${e}`)}}scale(e,t={}){if("object"==typeof e&&(t=e,e=void 0),"object"!=typeof t)throw new TypeError("options must be an object");let n=t.scale;switch(e){case"row":if(void 0===n)n=function(e){const t=[];for(let n=0;n<e.rows;n++){let r=0;for(let t=0;t<e.columns;t++)r+=Math.pow(e.get(n,t),2)/(e.columns-1);t.push(Math.sqrt(r))}return t}(this);else if(!fl(n))throw new TypeError("scale must be an array");return function(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)/t[n])}(this,n),this;case"column":if(void 0===n)n=function(e){const t=[];for(let n=0;n<e.columns;n++){let r=0;for(let t=0;t<e.rows;t++)r+=Math.pow(e.get(t,n),2)/(e.rows-1);t.push(Math.sqrt(r))}return t}(this);else if(!fl(n))throw new TypeError("scale must be an array");return function(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)/t[r])}(this,n),this;case void 0:if(void 0===n)n=function(e){const t=e.size-1;let n=0;for(let r=0;r<e.columns;r++)for(let i=0;i<e.rows;i++)n+=Math.pow(e.get(i,r),2)/t;return Math.sqrt(n)}(this);else if("number"!=typeof n)throw new TypeError("scale must be a number");return function(e,t){for(let n=0;n<e.rows;n++)for(let r=0;r<e.columns;r++)e.set(n,r,e.get(n,r)/t)}(this,n),this;default:throw new Error(`invalid option: ${e}`)}}toString(e){return ml(this,e)}}function Dl(e,t){return e-t}Nl.prototype.klass="Matrix","undefined"!=typeof Symbol&&(Nl.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return ml(this)}),Nl.random=Nl.rand,Nl.randomInt=Nl.randInt,Nl.diagonal=Nl.diag,Nl.prototype.diagonal=Nl.prototype.diag,Nl.identity=Nl.eye,Nl.prototype.negate=Nl.prototype.neg,Nl.prototype.tensorProduct=Nl.prototype.kroneckerProduct;class kl extends Nl{constructor(e,t){if(super(),kl.isMatrix(e))return e.clone();if(Number.isInteger(e)&&e>=0){if(this.data=[],!(Number.isInteger(t)&&t>=0))throw new TypeError("nColumns must be a positive integer");for(let n=0;n<e;n++)this.data.push(new Float64Array(t))}else{if(!fl(e))throw new TypeError("First argument must be a positive number or an array");{const n=e;if("number"!=typeof(t=(e=n.length)?n[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let r=0;r<e;r++){if(n[r].length!==t)throw new RangeError("Inconsistent array dimensions");if(!n[r].every((e=>"number"==typeof e)))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(n[r]))}}}this.rows=e,this.columns=t}set(e,t,n){return this.data[e][t]=n,this}get(e,t){return this.data[e][t]}removeRow(e){return El(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return void 0===t&&(t=e,e=this.rows),El(this,e,!0),t=Float64Array.from(xl(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){_l(this,e);for(let t=0;t<this.rows;t++){const n=new Float64Array(this.columns-1);for(let r=0;r<e;r++)n[r]=this.data[t][r];for(let r=e+1;r<this.columns;r++)n[r-1]=this.data[t][r];this.data[t]=n}return this.columns-=1,this}addColumn(e,t){void 0===t&&(t=e,e=this.columns),_l(this,e,!0),t=wl(this,t);for(let n=0;n<this.rows;n++){const r=new Float64Array(this.columns+1);let i=0;for(;i<e;i++)r[i]=this.data[n][i];for(r[i++]=t[n];i<this.columns+1;i++)r[i]=this.data[n][i-1];this.data[n]=r}return this.columns+=1,this}}!function(e,t){e.prototype.add=function(e){return"number"==typeof e?this.addS(e):this.addM(e)},e.prototype.addS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)+e);return this},e.prototype.addM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)+e.get(t,n));return this},e.add=function(e,n){return new t(e).add(n)},e.prototype.sub=function(e){return"number"==typeof e?this.subS(e):this.subM(e)},e.prototype.subS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)-e);return this},e.prototype.subM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)-e.get(t,n));return this},e.sub=function(e,n){return new t(e).sub(n)},e.prototype.subtract=e.prototype.sub,e.prototype.subtractS=e.prototype.subS,e.prototype.subtractM=e.prototype.subM,e.subtract=e.sub,e.prototype.mul=function(e){return"number"==typeof e?this.mulS(e):this.mulM(e)},e.prototype.mulS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e);return this},e.prototype.mulM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e.get(t,n));return this},e.mul=function(e,n){return new t(e).mul(n)},e.prototype.multiply=e.prototype.mul,e.prototype.multiplyS=e.prototype.mulS,e.prototype.multiplyM=e.prototype.mulM,e.multiply=e.mul,e.prototype.div=function(e){return"number"==typeof e?this.divS(e):this.divM(e)},e.prototype.divS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)/e);return this},e.prototype.divM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)/e.get(t,n));return this},e.div=function(e,n){return new t(e).div(n)},e.prototype.divide=e.prototype.div,e.prototype.divideS=e.prototype.divS,e.prototype.divideM=e.prototype.divM,e.divide=e.div,e.prototype.mod=function(e){return"number"==typeof e?this.modS(e):this.modM(e)},e.prototype.modS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)%e);return this},e.prototype.modM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)%e.get(t,n));return this},e.mod=function(e,n){return new t(e).mod(n)},e.prototype.modulus=e.prototype.mod,e.prototype.modulusS=e.prototype.modS,e.prototype.modulusM=e.prototype.modM,e.modulus=e.mod,e.prototype.and=function(e){return"number"==typeof e?this.andS(e):this.andM(e)},e.prototype.andS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)&e);return this},e.prototype.andM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)&e.get(t,n));return this},e.and=function(e,n){return new t(e).and(n)},e.prototype.or=function(e){return"number"==typeof e?this.orS(e):this.orM(e)},e.prototype.orS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)|e);return this},e.prototype.orM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)|e.get(t,n));return this},e.or=function(e,n){return new t(e).or(n)},e.prototype.xor=function(e){return"number"==typeof e?this.xorS(e):this.xorM(e)},e.prototype.xorS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)^e);return this},e.prototype.xorM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)^e.get(t,n));return this},e.xor=function(e,n){return new t(e).xor(n)},e.prototype.leftShift=function(e){return"number"==typeof e?this.leftShiftS(e):this.leftShiftM(e)},e.prototype.leftShiftS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)<<e);return this},e.prototype.leftShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)<<e.get(t,n));return this},e.leftShift=function(e,n){return new t(e).leftShift(n)},e.prototype.signPropagatingRightShift=function(e){return"number"==typeof e?this.signPropagatingRightShiftS(e):this.signPropagatingRightShiftM(e)},e.prototype.signPropagatingRightShiftS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)>>e);return this},e.prototype.signPropagatingRightShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)>>e.get(t,n));return this},e.signPropagatingRightShift=function(e,n){return new t(e).signPropagatingRightShift(n)},e.prototype.rightShift=function(e){return"number"==typeof e?this.rightShiftS(e):this.rightShiftM(e)},e.prototype.rightShiftS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)>>>e);return this},e.prototype.rightShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)>>>e.get(t,n));return this},e.rightShift=function(e,n){return new t(e).rightShift(n)},e.prototype.zeroFillRightShift=e.prototype.rightShift,e.prototype.zeroFillRightShiftS=e.prototype.rightShiftS,e.prototype.zeroFillRightShiftM=e.prototype.rightShiftM,e.zeroFillRightShift=e.rightShift,e.prototype.not=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,~this.get(e,t));return this},e.not=function(e){return new t(e).not()},e.prototype.abs=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.abs(this.get(e,t)));return this},e.abs=function(e){return new t(e).abs()},e.prototype.acos=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.acos(this.get(e,t)));return this},e.acos=function(e){return new t(e).acos()},e.prototype.acosh=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.acosh(this.get(e,t)));return this},e.acosh=function(e){return new t(e).acosh()},e.prototype.asin=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.asin(this.get(e,t)));return this},e.asin=function(e){return new t(e).asin()},e.prototype.asinh=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.asinh(this.get(e,t)));return this},e.asinh=function(e){return new t(e).asinh()},e.prototype.atan=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.atan(this.get(e,t)));return this},e.atan=function(e){return new t(e).atan()},e.prototype.atanh=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.atanh(this.get(e,t)));return this},e.atanh=function(e){return new t(e).atanh()},e.prototype.cbrt=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.cbrt(this.get(e,t)));return this},e.cbrt=function(e){return new t(e).cbrt()},e.prototype.ceil=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.ceil(this.get(e,t)));return this},e.ceil=function(e){return new t(e).ceil()},e.prototype.clz32=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.clz32(this.get(e,t)));return this},e.clz32=function(e){return new t(e).clz32()},e.prototype.cos=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.cos(this.get(e,t)));return this},e.cos=function(e){return new t(e).cos()},e.prototype.cosh=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.cosh(this.get(e,t)));return this},e.cosh=function(e){return new t(e).cosh()},e.prototype.exp=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.exp(this.get(e,t)));return this},e.exp=function(e){return new t(e).exp()},e.prototype.expm1=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.expm1(this.get(e,t)));return this},e.expm1=function(e){return new t(e).expm1()},e.prototype.floor=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.floor(this.get(e,t)));return this},e.floor=function(e){return new t(e).floor()},e.prototype.fround=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.fround(this.get(e,t)));return this},e.fround=function(e){return new t(e).fround()},e.prototype.log=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.log(this.get(e,t)));return this},e.log=function(e){return new t(e).log()},e.prototype.log1p=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.log1p(this.get(e,t)));return this},e.log1p=function(e){return new t(e).log1p()},e.prototype.log10=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.log10(this.get(e,t)));return this},e.log10=function(e){return new t(e).log10()},e.prototype.log2=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.log2(this.get(e,t)));return this},e.log2=function(e){return new t(e).log2()},e.prototype.round=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.round(this.get(e,t)));return this},e.round=function(e){return new t(e).round()},e.prototype.sign=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.sign(this.get(e,t)));return this},e.sign=function(e){return new t(e).sign()},e.prototype.sin=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.sin(this.get(e,t)));return this},e.sin=function(e){return new t(e).sin()},e.prototype.sinh=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.sinh(this.get(e,t)));return this},e.sinh=function(e){return new t(e).sinh()},e.prototype.sqrt=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.sqrt(this.get(e,t)));return this},e.sqrt=function(e){return new t(e).sqrt()},e.prototype.tan=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.tan(this.get(e,t)));return this},e.tan=function(e){return new t(e).tan()},e.prototype.tanh=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.tanh(this.get(e,t)));return this},e.tanh=function(e){return new t(e).tanh()},e.prototype.trunc=function(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,Math.trunc(this.get(e,t)));return this},e.trunc=function(e){return new t(e).trunc()},e.pow=function(e,n){return new t(e).pow(n)},e.prototype.pow=function(e){return"number"==typeof e?this.powS(e):this.powM(e)},e.prototype.powS=function(e){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.pow(this.get(t,n),e));return this},e.prototype.powM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.pow(this.get(t,n),e.get(t,n)));return this}}(Nl,kl);class Cl extends Nl{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,t,n){return this.data[e][t]=n,this}get(e,t){return this.data[e][t]}}function Ml(e,t){let n=0;return Math.abs(e)>Math.abs(t)?(n=t/e,Math.abs(e)*Math.sqrt(1+n*n)):0!==t?(n=e/t,Math.abs(t)*Math.sqrt(1+n*n)):0}class Ol{constructor(e,t={}){if((e=Cl.checkMatrix(e)).isEmpty())throw new Error("Matrix must be non-empty");let n=e.rows,r=e.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:o=!0,autoTranspose:a=!1}=t;let s,u=Boolean(i),c=Boolean(o),l=!1;if(n<r)if(a){s=e.transpose(),n=s.rows,r=s.columns,l=!0;let t=u;u=c,c=t}else s=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else s=e.clone();let f=Math.min(n,r),d=Math.min(n+1,r),h=new Float64Array(d),p=new kl(n,f),g=new kl(r,r),v=new Float64Array(r),m=new Float64Array(n),y=new Float64Array(d);for(let e=0;e<d;e++)y[e]=e;let b=Math.min(n-1,r),E=Math.max(0,Math.min(r-2,n)),_=Math.max(b,E);for(let e=0;e<_;e++){if(e<b){h[e]=0;for(let t=e;t<n;t++)h[e]=Ml(h[e],s.get(t,e));if(0!==h[e]){s.get(e,e)<0&&(h[e]=-h[e]);for(let t=e;t<n;t++)s.set(t,e,s.get(t,e)/h[e]);s.set(e,e,s.get(e,e)+1)}h[e]=-h[e]}for(let t=e+1;t<r;t++){if(e<b&&0!==h[e]){let r=0;for(let i=e;i<n;i++)r+=s.get(i,e)*s.get(i,t);r=-r/s.get(e,e);for(let i=e;i<n;i++)s.set(i,t,s.get(i,t)+r*s.get(i,e))}v[t]=s.get(e,t)}if(u&&e<b)for(let t=e;t<n;t++)p.set(t,e,s.get(t,e));if(e<E){v[e]=0;for(let t=e+1;t<r;t++)v[e]=Ml(v[e],v[t]);if(0!==v[e]){v[e+1]<0&&(v[e]=0-v[e]);for(let t=e+1;t<r;t++)v[t]/=v[e];v[e+1]+=1}if(v[e]=-v[e],e+1<n&&0!==v[e]){for(let t=e+1;t<n;t++)m[t]=0;for(let t=e+1;t<n;t++)for(let n=e+1;n<r;n++)m[t]+=v[n]*s.get(t,n);for(let t=e+1;t<r;t++){let r=-v[t]/v[e+1];for(let i=e+1;i<n;i++)s.set(i,t,s.get(i,t)+r*m[i])}}if(c)for(let t=e+1;t<r;t++)g.set(t,e,v[t])}}let x=Math.min(r,n+1);if(b<r&&(h[b]=s.get(b,b)),n<x&&(h[x-1]=0),E+1<x&&(v[E]=s.get(E,x-1)),v[x-1]=0,u){for(let e=b;e<f;e++){for(let t=0;t<n;t++)p.set(t,e,0);p.set(e,e,1)}for(let e=b-1;e>=0;e--)if(0!==h[e]){for(let t=e+1;t<f;t++){let r=0;for(let i=e;i<n;i++)r+=p.get(i,e)*p.get(i,t);r=-r/p.get(e,e);for(let i=e;i<n;i++)p.set(i,t,p.get(i,t)+r*p.get(i,e))}for(let t=e;t<n;t++)p.set(t,e,-p.get(t,e));p.set(e,e,1+p.get(e,e));for(let t=0;t<e-1;t++)p.set(t,e,0)}else{for(let t=0;t<n;t++)p.set(t,e,0);p.set(e,e,1)}}if(c)for(let e=r-1;e>=0;e--){if(e<E&&0!==v[e])for(let t=e+1;t<r;t++){let n=0;for(let i=e+1;i<r;i++)n+=g.get(i,e)*g.get(i,t);n=-n/g.get(e+1,e);for(let i=e+1;i<r;i++)g.set(i,t,g.get(i,t)+n*g.get(i,e))}for(let t=0;t<r;t++)g.set(t,e,0);g.set(e,e,1)}let w=x-1,S=0,A=Number.EPSILON;for(;x>0;){let e,t;for(e=x-2;e>=-1&&-1!==e;e--){const t=Number.MIN_VALUE+A*Math.abs(h[e]+Math.abs(h[e+1]));if(Math.abs(v[e])<=t||Number.isNaN(v[e])){v[e]=0;break}}if(e===x-2)t=4;else{let n;for(n=x-1;n>=e&&n!==e;n--){let t=(n!==x?Math.abs(v[n]):0)+(n!==e+1?Math.abs(v[n-1]):0);if(Math.abs(h[n])<=A*t){h[n]=0;break}}n===e?t=3:n===x-1?t=1:(t=2,e=n)}switch(e++,t){case 1:{let t=v[x-2];v[x-2]=0;for(let n=x-2;n>=e;n--){let i=Ml(h[n],t),o=h[n]/i,a=t/i;if(h[n]=i,n!==e&&(t=-a*v[n-1],v[n-1]=o*v[n-1]),c)for(let e=0;e<r;e++)i=o*g.get(e,n)+a*g.get(e,x-1),g.set(e,x-1,-a*g.get(e,n)+o*g.get(e,x-1)),g.set(e,n,i)}break}case 2:{let t=v[e-1];v[e-1]=0;for(let r=e;r<x;r++){let i=Ml(h[r],t),o=h[r]/i,a=t/i;if(h[r]=i,t=-a*v[r],v[r]=o*v[r],u)for(let t=0;t<n;t++)i=o*p.get(t,r)+a*p.get(t,e-1),p.set(t,e-1,-a*p.get(t,r)+o*p.get(t,e-1)),p.set(t,r,i)}break}case 3:{const t=Math.max(Math.abs(h[x-1]),Math.abs(h[x-2]),Math.abs(v[x-2]),Math.abs(h[e]),Math.abs(v[e])),i=h[x-1]/t,o=h[x-2]/t,a=v[x-2]/t,s=h[e]/t,l=v[e]/t,f=((o+i)*(o-i)+a*a)/2,d=i*a*(i*a);let m=0;0===f&&0===d||(m=f<0?0-Math.sqrt(f*f+d):Math.sqrt(f*f+d),m=d/(f+m));let y=(s+i)*(s-i)+m,b=s*l;for(let t=e;t<x-1;t++){let i=Ml(y,b);0===i&&(i=Number.MIN_VALUE);let o=y/i,a=b/i;if(t!==e&&(v[t-1]=i),y=o*h[t]+a*v[t],v[t]=o*v[t]-a*h[t],b=a*h[t+1],h[t+1]=o*h[t+1],c)for(let e=0;e<r;e++)i=o*g.get(e,t)+a*g.get(e,t+1),g.set(e,t+1,-a*g.get(e,t)+o*g.get(e,t+1)),g.set(e,t,i);if(i=Ml(y,b),0===i&&(i=Number.MIN_VALUE),o=y/i,a=b/i,h[t]=i,y=o*v[t]+a*h[t+1],h[t+1]=-a*v[t]+o*h[t+1],b=a*v[t+1],v[t+1]=o*v[t+1],u&&t<n-1)for(let e=0;e<n;e++)i=o*p.get(e,t)+a*p.get(e,t+1),p.set(e,t+1,-a*p.get(e,t)+o*p.get(e,t+1)),p.set(e,t,i)}v[x-2]=y,S+=1;break}case 4:if(h[e]<=0&&(h[e]=h[e]<0?-h[e]:0,c))for(let t=0;t<=w;t++)g.set(t,e,-g.get(t,e));for(;e<w&&!(h[e]>=h[e+1]);){let t=h[e];if(h[e]=h[e+1],h[e+1]=t,c&&e<r-1)for(let n=0;n<r;n++)t=g.get(n,e+1),g.set(n,e+1,g.get(n,e)),g.set(n,e,t);if(u&&e<n-1)for(let r=0;r<n;r++)t=p.get(r,e+1),p.set(r,e+1,p.get(r,e)),p.set(r,e,t);e++}S=0,x--}}if(l){let e=g;g=p,p=e}this.m=n,this.n=r,this.s=h,this.U=p,this.V=g}solve(e){let t=e,n=this.threshold,r=this.s.length,i=kl.zeros(r,r);for(let e=0;e<r;e++)Math.abs(this.s[e])<=n?i.set(e,e,0):i.set(e,e,1/this.s[e]);let o=this.U,a=this.rightSingularVectors,s=a.mmul(i),u=a.rows,c=o.rows,l=kl.zeros(u,c);for(let e=0;e<u;e++)for(let t=0;t<c;t++){let n=0;for(let i=0;i<r;i++)n+=s.get(e,i)*o.get(t,i);l.set(e,t,n)}return l.mmul(t)}solveForDiagonal(e){return this.solve(kl.diag(e))}inverse(){let e=this.V,t=this.threshold,n=e.rows,r=e.columns,i=new kl(n,this.s.length);for(let o=0;o<n;o++)for(let n=0;n<r;n++)Math.abs(this.s[n])>t&&i.set(o,n,e.get(o,n)/this.s[n]);let o=this.U,a=o.rows,s=o.columns,u=new kl(n,a);for(let e=0;e<n;e++)for(let t=0;t<a;t++){let n=0;for(let r=0;r<s;r++)n+=i.get(e,r)*o.get(t,r);u.set(e,t,n)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,t=0,n=this.s;for(let r=0,i=n.length;r<i;r++)n[r]>e&&t++;return t}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return kl.diag(this.s)}}class Rl{constructor(e){this.distances=e.distances,this.dimension=e.dimension||2,this.linkDistance=e.linkDistance}layout(){const{dimension:e,distances:t,linkDistance:n}=this;try{const n=kl.mul(kl.pow(t,2),-.5),r=n.mean("row"),i=n.mean("column"),o=n.mean();n.add(o).subRowVector(r).subColumnVector(i);const a=new Ol(n),s=kl.sqrt(a.diagonalMatrix).diagonal();return a.leftSingularVectors.toJSON().map((t=>kl.mul([t],[s]).toJSON()[0].splice(0,e)))}catch(e){const r=[];for(let e=0;e<t.length;e++){const e=Math.random()*n,t=Math.random()*n;r.push([e,t])}return r}}}class Pl{constructor(e){this.disp=[],this.positions=e.positions,this.adjMatrix=e.adjMatrix,this.focusID=e.focusID,this.radii=e.radii,this.iterations=e.iterations||10,this.height=e.height||10,this.width=e.width||10,this.speed=e.speed||100,this.gravity=e.gravity||10,this.nodeSizeFunc=e.nodeSizeFunc,this.k=e.k||5,this.strictRadial=e.strictRadial,this.nodes=e.nodes}layout(){const e=this,t=e.positions,n=[],r=e.iterations,i=e.width/10;e.maxDisplace=i,e.disp=n;for(let i=0;i<r;i++)t.forEach(((e,t)=>{n[t]={x:0,y:0}})),e.getRepulsion(),e.updatePositions();return t}getRepulsion(){const e=this,t=e.positions,n=e.nodes,r=e.disp,i=e.k,o=e.radii||[];t.forEach(((a,s)=>{r[s]={x:0,y:0},t.forEach(((t,u)=>{if(s===u)return;if(o[s]!==o[u])return;let c=a[0]-t[0],l=a[1]-t[1],f=Math.sqrt(c*c+l*l);if(0===f){f=1;const e=s>u?1:-1;c=.01*e,l=.01*e}if(f<e.nodeSizeFunc(n[s])/2+e.nodeSizeFunc(n[u])/2){const e=i*i/f;r[s].x+=c/f*e,r[s].y+=l/f*e}}))}))}updatePositions(){const e=this,t=e.positions,n=e.disp,r=e.speed,i=e.strictRadial,o=e.focusID,a=e.maxDisplace||e.width/10;i&&n.forEach(((e,n)=>{const r=t[n][0]-t[o][0],i=t[n][1]-t[o][1],a=Math.sqrt(r*r+i*i);let s=i/a,u=-r/a;const c=Math.sqrt(e.x*e.x+e.y*e.y);let l=Math.acos((s*e.x+u*e.y)/c);l>Math.PI/2&&(l-=Math.PI/2,s*=-1,u*=-1);const f=Math.cos(l)*c;e.x=s*f,e.y=u*f}));const s=e.radii;t.forEach(((e,u)=>{if(u===o)return;const c=Math.sqrt(n[u].x*n[u].x+n[u].y*n[u].y);if(c>0&&u!==o){const l=Math.min(a*(r/800),c);if(e[0]+=n[u].x/c*l,e[1]+=n[u].y/c*l,i){let n=e[0]-t[o][0],r=e[1]-t[o][1];const i=Math.sqrt(n*n+r*r);n=n/i*s[u],r=r/i*s[u],e[0]=t[o][0]+n,e[1]=t[o][1]+r}}}))}}function Gl(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}class Ll extends o{constructor(e){super(),this.maxIteration=1e3,this.focusNode=null,this.unitRadius=null,this.linkDistance=50,this.preventOverlap=!1,this.strictRadial=!0,this.maxPreventOverlapIteration=200,this.sortStrength=10,this.nodes=[],this.edges=[],this.updateCfg(e)}getDefaultCfg(){return{maxIteration:1e3,focusNode:null,unitRadius:null,linkDistance:50,preventOverlap:!1,nodeSize:void 0,nodeSpacing:void 0,strictRadial:!0,maxPreventOverlapIteration:200,sortBy:void 0,sortStrength:10}}execute(){const e=this,t=e.nodes,n=e.edges||[];if(!t||0===t.length)return void(e.onLayoutEnd&&e.onLayoutEnd());e.width||"undefined"==typeof window||(e.width=window.innerWidth),e.height||"undefined"==typeof window||(e.height=window.innerHeight),e.center||(e.center=[e.width/2,e.height/2]);const r=e.center;if(1===t.length)return t[0].x=r[0],t[0].y=r[1],void(e.onLayoutEnd&&e.onLayoutEnd());const i=e.linkDistance;let o=null;if(a(e.focusNode)){let n=!1;for(let r=0;r<t.length;r++)t[r].id===e.focusNode&&(o=t[r],e.focusNode=o,n=!0,r=t.length);n||(o=null)}else o=e.focusNode;o||(o=t[0],e.focusNode=o);let f=function(e,t){let n=-1;return e.forEach(((e,r)=>{e.id===t&&(n=r)})),n}(t,o.id);f<0&&(f=0),e.focusIndex=f;const d=g({nodes:t,edges:n},!1),h=p(d),v=e.maxToFocus(h,f);e.handleInfinity(h,f,v+1),e.distances=h;const m=h[f],y=e.width||500,b=e.height||500;let E=y-r[0]>r[0]?r[0]:y-r[0],x=b-r[1]>r[1]?r[1]:b-r[1];0===E&&(E=y/2),0===x&&(x=b/2);const w=x>E?E:x,S=Math.max(...m),A=[];m.forEach(((t,n)=>{e.unitRadius||(e.unitRadius=w/S),A[n]=t*e.unitRadius})),e.radii=A;const T=e.eIdealDisMatrix();e.eIdealDistances=T;const I=function(e){const t=e.length,n=e[0].length,r=[];for(let i=0;i<t;i++){const t=[];for(let r=0;r<n;r++)0!==e[i][r]?t.push(1/(e[i][r]*e[i][r])):t.push(0);r.push(t)}return r}(T);e.weights=I;let N=new Rl({linkDistance:i,distances:T}).layout();N.forEach((e=>{c(e[0])&&(e[0]=Math.random()*i),c(e[1])&&(e[1]=Math.random()*i)})),e.positions=N,N.forEach(((e,n)=>{t[n].x=e[0]+r[0],t[n].y=e[1]+r[1]})),N.forEach((e=>{e[0]-=N[f][0],e[1]-=N[f][1]})),e.run();const D=e.preventOverlap,k=e.nodeSize;let C;const M=e.strictRadial;if(D){const n=e.nodeSpacing;let r;r=u(n)?()=>n:_(n)?n:()=>0,C=k?s(k)?e=>(k[0]>k[1]?k[0]:k[1])+r(e):e=>k+r(e):e=>e.size?s(e.size)?(e.size[0]>e.size[1]?e.size[0]:e.size[1])+r(e):l(e.size)?(e.size.width>e.size.height?e.size.width:e.size.height)+r(e):e.size+r(e):10+r(e);const i={nodes:t,nodeSizeFunc:C,adjMatrix:d,positions:N,radii:A,height:b,width:y,strictRadial:M,focusID:f,iterations:e.maxPreventOverlapIteration||200,k:N.length/4.5},o=new Pl(i);N=o.layout()}return N.forEach(((e,n)=>{t[n].x=e[0]+r[0],t[n].y=e[1]+r[1]})),e.onLayoutEnd&&e.onLayoutEnd(),{nodes:t,edges:n}}run(){const e=this,t=e.maxIteration,n=e.positions||[],r=e.weights||[],i=e.eIdealDistances||[],o=e.radii||[];for(let a=0;a<=t;a++){const s=a/t;e.oneIteration(s,n,o,i,r)}}oneIteration(e,t,n,r,i){const o=1-e,a=this.focusIndex;t.forEach(((s,u)=>{const c=Gl(s,[0,0]),l=0===c?0:1/c;if(u===a)return;let f=0,d=0,h=0;t.forEach(((e,t)=>{if(u===t)return;const n=Gl(s,e),o=0===n?0:1/n,a=r[t][u];h+=i[u][t],f+=i[u][t]*(e[0]+a*(s[0]-e[0])*o),d+=i[u][t]*(e[1]+a*(s[1]-e[1])*o)}));const p=0===n[u]?0:1/n[u];h*=o,h+=e*p*p,f*=o,f+=e*p*s[0]*l,s[0]=f/h,d*=o,d+=e*p*s[1]*l,s[1]=d/h}))}eIdealDisMatrix(){const e=this,t=e.nodes;if(!t)return[];const n=e.distances,r=e.linkDistance,i=e.radii||[],o=e.unitRadius||50,s=[];return n&&n.forEach(((n,u)=>{const c=[];n.forEach(((n,s)=>{if(u===s)c.push(0);else if(i[u]===i[s])if("data"===e.sortBy)c.push(n*(Math.abs(u-s)*e.sortStrength)/(i[u]/o));else if(e.sortBy){let r=t[u][e.sortBy]||0,l=t[s][e.sortBy]||0;a(r)&&(r=r.charCodeAt(0)),a(l)&&(l=l.charCodeAt(0)),c.push(n*(Math.abs(r-l)*e.sortStrength)/(i[u]/o))}else c.push(n*r/(i[u]/o));else{const e=(r+o)/2;c.push(n*e)}})),s.push(c)})),s}handleInfinity(e,t,n){const r=e.length;for(let i=0;i<r;i++)if(e[t][i]===1/0){e[t][i]=n,e[i][t]=n;for(let o=0;o<r;o++)e[i][o]!==1/0&&e[t][o]===1/0&&(e[t][o]=n+e[i][o],e[o][t]=n+e[i][o])}for(let n=0;n<r;n++)if(n!==t)for(let i=0;i<r;i++)if(e[n][i]===1/0){let r=Math.abs(e[t][n]-e[t][i]);r=0===r?1:r,e[n][i]=r}}maxToFocus(e,t){let n=0;for(let r=0;r<e[t].length;r++)e[t][r]!==1/0&&(n=e[t][r]>n?e[t][r]:n);return n}getType(){return"radial"}}class Ul extends o{constructor(e){super(),this.nodeSize=30,this.minNodeSpacing=10,this.nodeSpacing=10,this.preventOverlap=!1,this.equidistant=!1,this.startAngle=1.5*Math.PI,this.clockwise=!0,this.sortBy="degree",this.nodes=[],this.edges=[],this.width=300,this.height=300,this.onLayoutEnd=()=>{},this.updateCfg(e)}getDefaultCfg(){return{nodeSize:30,minNodeSpacing:10,nodeSpacing:10,preventOverlap:!1,sweep:void 0,equidistant:!1,startAngle:1.5*Math.PI,clockwise:!0,maxLevelDiff:void 0,sortBy:"degree"}}execute(){var e,t;const n=this,{nodes:r,edges:i}=n,o=r.length;if(0===o)return void(null===(e=n.onLayoutEnd)||void 0===e||e.call(n));n.width||"undefined"==typeof window||(n.width=window.innerWidth),n.height||"undefined"==typeof window||(n.height=window.innerHeight),n.center||(n.center=[n.width/2,n.height/2]);const c=n.center;if(1===o)return r[0].x=c[0],r[0].y=c[1],void(null===(t=n.onLayoutEnd)||void 0===t||t.call(n));const{nodeSize:f,nodeSpacing:d}=n,p=[];let g,v=0;g=s(f)?Math.max(f[0],f[1]):f,s(d)?v=Math.max(d[0],d[1]):u(d)&&(v=d),r.forEach((e=>{p.push(e);let t=g;s(e.size)?t=Math.max(e.size[0],e.size[1]):u(e.size)?t=e.size:l(e.size)&&(t=Math.max(e.size.width,e.size.height)),g=Math.max(g,t),_(d)&&(v=Math.max(d(e),v))})),n.clockwise=void 0!==n.counterclockwise?!n.counterclockwise:n.clockwise;const m={},y={};if(p.forEach(((e,t)=>{m[e.id]=e,y[e.id]=t})),!("degree"!==n.sortBy&&a(n.sortBy)&&void 0!==p[0][n.sortBy]||(n.sortBy="degree",u(r[0].degree)))){const e=h(r.length,y,i);p.forEach(((t,n)=>{t.degree=e[n].all}))}p.sort(((e,t)=>t[n.sortBy]-e[n.sortBy])),n.maxValueNode=p[0],n.maxLevelDiff=n.maxLevelDiff||n.maxValueNode[n.sortBy]/4;const b=[[]];let E=b[0];p.forEach((e=>{if(E.length>0){const t=Math.abs(E[0][n.sortBy]-e[n.sortBy]);n.maxLevelDiff&&t>=n.maxLevelDiff&&(E=[],b.push(E))}E.push(e)}));let x=g+(v||n.minNodeSpacing);if(!n.preventOverlap){const e=b.length>0&&b[0].length>1,t=(Math.min(n.width,n.height)/2-x)/(b.length+(e?1:0));x=Math.min(x,t)}let w=0;if(b.forEach((e=>{let t=n.sweep;void 0===t&&(t=2*Math.PI-2*Math.PI/e.length);const r=e.dTheta=t/Math.max(1,e.length-1);if(e.length>1&&n.preventOverlap){const e=Math.cos(r)-Math.cos(0),t=Math.sin(r)-Math.sin(0),n=Math.sqrt(x*x/(e*e+t*t));w=Math.max(n,w)}e.r=w,w+=x})),n.equidistant){let e=0,t=0;for(let n=0;n<b.length;n++){const r=b[n].r-t;e=Math.max(e,r)}t=0,b.forEach(((n,r)=>{0===r&&(t=n.r),n.r=t,t+=e}))}return b.forEach((e=>{const t=e.dTheta,r=e.r;e.forEach(((e,i)=>{const o=n.startAngle+(n.clockwise?1:-1)*t*i;e.x=c[0]+r*Math.cos(o),e.y=c[1]+r*Math.sin(o)}))})),n.onLayoutEnd&&n.onLayoutEnd(),{nodes:r,edges:i}}getType(){return"concentric"}}class zl extends o{constructor(e){super(),this.center=[0,0],this.linkDistance=50,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.updateCfg(e)}getDefaultCfg(){return{center:[0,0],linkDistance:50}}execute(){const e=this,{nodes:t,edges:n=[]}=e,r=e.center;if(!t||0===t.length)return void(e.onLayoutEnd&&e.onLayoutEnd());if(1===t.length)return t[0].x=r[0],t[0].y=r[1],void(e.onLayoutEnd&&e.onLayoutEnd());const i=e.linkDistance,o=g({nodes:t,edges:n},!1),a=p(o);e.handleInfinity(a);const s=((e,t)=>{const n=[];return e.forEach((e=>{const r=[];e.forEach((e=>{r.push(e*t)})),n.push(r)})),n})(a,i);e.scaledDistances=s;const u=e.runMDS();return e.positions=u,u.forEach(((e,n)=>{t[n].x=e[0]+r[0],t[n].y=e[1]+r[1]})),e.onLayoutEnd&&e.onLayoutEnd(),{nodes:t,edges:n}}runMDS(){const e=this.scaledDistances,t=kl.mul(kl.pow(e,2),-.5),n=t.mean("row"),r=t.mean("column"),i=t.mean();t.add(i).subRowVector(n).subColumnVector(r);const o=new Ol(t),a=kl.sqrt(o.diagonalMatrix).diagonal();return o.leftSingularVectors.toJSON().map((e=>kl.mul([e],[a]).toJSON()[0].splice(0,2)))}handleInfinity(e){let t=-999999;e.forEach((e=>{e.forEach((e=>{e!==1/0&&t<e&&(t=e)}))})),e.forEach(((n,r)=>{n.forEach(((n,i)=>{n===1/0&&(e[r][i]=t)}))}))}getType(){return"mds"}}class Bl extends o{constructor(e){super(),this.maxIteration=1e3,this.workerEnabled=!1,this.gravity=10,this.speed=5,this.clustering=!1,this.clusterGravity=10,this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.onLayoutEnd=()=>{},this.tick=()=>{},this.animate=!0,this.updateCfg(e)}getDefaultCfg(){return{maxIteration:1e3,gravity:10,speed:1,clustering:!1,clusterGravity:10,animate:!0}}execute(){var e,t;const n=this,r=n.nodes;if(void 0!==n.timeInterval&&"undefined"!=typeof window&&window.clearInterval(n.timeInterval),!r||0===r.length)return void(null===(e=n.onLayoutEnd)||void 0===e||e.call(n));n.width||"undefined"==typeof window||(n.width=window.innerWidth),n.height||"undefined"==typeof window||(n.height=window.innerHeight),n.center||(n.center=[n.width/2,n.height/2]);const i=n.center;if(1===r.length)return r[0].x=i[0],r[0].y=i[1],void(null===(t=n.onLayoutEnd)||void 0===t||t.call(n));const o={},a={};return r.forEach(((e,t)=>{u(e.x)||(e.x=Math.random()*this.width),u(e.y)||(e.y=Math.random()*this.height),o[e.id]=e,a[e.id]=t})),n.nodeMap=o,n.nodeIdxMap=a,n.run()}run(){var e;const t=this,n=t.nodes;if(!n)return;const{edges:r,maxIteration:i,workerEnabled:o,clustering:a,animate:s}=t,u={};if(a&&n.forEach((e=>{void 0===u[e.cluster]&&(u[e.cluster]={name:e.cluster,cx:0,cy:0,count:0})})),o||!s){for(let e=0;e<i;e++)t.runOneStep(u);null===(e=t.onLayoutEnd)||void 0===e||e.call(t)}else{if("undefined"==typeof window)return;let e=0;this.timeInterval=window.setInterval((()=>{var n;t.runOneStep(u),e++,e>=i&&(null===(n=t.onLayoutEnd)||void 0===n||n.call(t),window.clearInterval(t.timeInterval))}),0)}return{nodes:n,edges:r}}runOneStep(e){var t;const n=this,r=n.nodes;if(!r)return;const{edges:i,center:o,gravity:a,speed:s,clustering:c}=n,l=n.height*n.width,f=Math.sqrt(l)/10,d=l/(r.length+1),h=Math.sqrt(d),p=[];if(r.forEach(((e,t)=>{p[t]={x:0,y:0}})),n.applyCalculate(r,i,p,h,d),c){for(const t in e)e[t].cx=0,e[t].cy=0,e[t].count=0;r.forEach((t=>{const n=e[t.cluster];u(t.x)&&(n.cx+=t.x),u(t.y)&&(n.cy+=t.y),n.count++}));for(const t in e)e[t].cx/=e[t].count,e[t].cy/=e[t].count;const t=n.clusterGravity||a;r.forEach(((n,r)=>{if(!u(n.x)||!u(n.y))return;const i=e[n.cluster],o=Math.sqrt((n.x-i.cx)*(n.x-i.cx)+(n.y-i.cy)*(n.y-i.cy)),a=h*t;p[r].x-=a*(n.x-i.cx)/o,p[r].y-=a*(n.y-i.cy)/o}))}r.forEach(((e,t)=>{if(!u(e.x)||!u(e.y))return;const n=.01*h*a;p[t].x-=n*(e.x-o[0]),p[t].y-=n*(e.y-o[1])})),r.forEach(((e,t)=>{if(u(e.fx)&&u(e.fy))return e.x=e.fx,void(e.y=e.fy);if(!u(e.x)||!u(e.y))return;const n=Math.sqrt(p[t].x*p[t].x+p[t].y*p[t].y);if(n>0){const r=Math.min(f*(s/800),n);e.x+=p[t].x/n*r,e.y+=p[t].y/n*r}})),null===(t=n.tick)||void 0===t||t.call(n)}applyCalculate(e,t,n,r,i){this.calRepulsive(e,n,i),t&&this.calAttractive(t,n,r)}calRepulsive(e,t,n){e.forEach(((r,i)=>{t[i]={x:0,y:0},e.forEach(((e,o)=>{if(i===o)return;if(!(u(r.x)&&u(e.x)&&u(r.y)&&u(e.y)))return;let a=r.x-e.x,s=r.y-e.y,c=a*a+s*s;if(0===c){c=1;const e=i>o?1:-1;a=.01*e,s=.01*e}const l=n/c;t[i].x+=a*l,t[i].y+=s*l}))}))}calAttractive(e,t,n){e.forEach((e=>{const r=d(e,"source"),i=d(e,"target");if(!r||!i)return;const o=this.nodeIdxMap[r],a=this.nodeIdxMap[i];if(o===a)return;const s=this.nodeMap[r],c=this.nodeMap[i];if(!(u(c.x)&&u(s.x)&&u(c.y)&&u(s.y)))return;const l=c.x-s.x,f=c.y-s.y,h=Math.sqrt(l*l+f*f),p=h*h/n;t[a].x-=l/h*p,t[a].y-=f/h*p,t[o].x+=l/h*p,t[o].y+=f/h*p}))}stop(){this.timeInterval&&"undefined"!=typeof window&&window.clearInterval(this.timeInterval)}destroy(){const e=this;e.stop(),e.tick=null,e.nodes=null,e.edges=null,e.destroyed=!0}getType(){return"fruchterman"}}function jl(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function Fl(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Vl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wl(e,t,n){return t&&Vl(e.prototype,t),n&&Vl(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Hl(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}n(8060);var Xl=n(2975),ql=n.n(Xl);function Yl(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Kl(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Yl(o,r,i,a,s,"next",e)}function s(e){Yl(o,r,i,a,s,"throw",e)}a(void 0)}))}}var $l=1;function Zl(){return $l++}var Jl=function e(t){Fl(this,e)},Ql=function(){function e(t){Fl(this,e),this.clazz=void 0,this.components=[],this.entities=[],this.lookup={},this.clazz=t}var t;return Wl(e,[{key:"clear",value:function(){this.components=[],this.entities=[],this.lookup={}}},{key:"contains",value:function(e){return this.lookup[e]>-1}},{key:"create",value:function(e,t){this.lookup[e]=this.components.length;var n=new this.clazz(t||{});return this.components.push(n),this.entities.push(e),n}},{key:"remove",value:function(e){var t=this.lookup[e];t>-1&&t<this.components.length-1&&(this.components[t]=this.components[this.components.length-1],this.entities[t]=this.entities[this.entities.length-1],this.lookup[this.entities[t]]=t),this.components.pop(),this.entities.pop(),delete this.lookup[e]}},{key:"removeKeepSorted",value:function(e){var t=this.lookup[e];if(t>-1){var n=this.entities[t];if(t<this.components.length-1){for(var r=t+1;r<this.components.length;++r)this.components[r-1]=this.components[r];for(var i=t+1;i<this.entities.length;++i)this.entities[i-1]=this.entities[i],this.lookup[this.entities[i-1]]=i-1}this.components.pop(),this.entities.pop(),delete this.lookup[n]}}},{key:"moveItem",value:function(e,t){if(e!==t){for(var n=this.components[e],r=this.entities[e],i=e<t?1:-1,o=e;o!==t;o+=i){var a=o+i;this.components[o]=this.components[a],this.entities[o]=this.entities[a],this.lookup[this.entities[o]]=o}this.components[t]=n,this.entities[t]=r,this.lookup[r]=t}}},{key:"getEntity",value:function(e){return this.entities[e]}},{key:"getComponent",value:function(e){return this.components[e]}},{key:"getComponentByEntity",value:function(e){var t=this.lookup[e];return t>-1?this.components[t]:null}},{key:"getCount",value:function(){return this.components.length}},{key:"getEntityByComponentIndex",value:function(e){for(var t=0,n=Object.keys(this.lookup);t<n.length;t++){var r=n[t],i=Number(r);if(this.lookup[i]===e)return i}return-1}},{key:"find",value:function(e){for(var t=0;t<this.getCount();t++){var n=this.getComponent(t);if(e(n,t))return n}return null}},{key:"findIndex",value:function(e){for(var t=0;t<this.getCount();t++)if(e(this.getComponent(t),t))return t;return-1}},{key:"forEach",value:function(e){for(var t=0,n=Object.keys(this.lookup);t<n.length;t++){var r=n[t],i=Number(r),o=this.lookup[i];e(i,this.getComponent(o))}}},{key:"forEachAsync",value:(t=Kl(ql().mark((function e(t){var n,r,i,o,a;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0,r=Object.keys(this.lookup);case 1:if(!(n<r.length)){e.next=10;break}return i=r[n],o=Number(i),a=this.lookup[o],e.next=7,t(o,this.getComponent(a));case 7:n++,e.next=1;break;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"map",value:function(e){for(var t=[],n=0,r=Object.keys(this.lookup);n<r.length;n++){var i=r[n],o=Number(i),a=this.lookup[o];t.push(e(o,this.getComponent(a)))}return t}}]),e}();function ef(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function tf(e,t){if(e){if("string"==typeof e)return ef(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ef(e,t):void 0}}function nf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||tf(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var rf=n(7131),of={HierarchyComponentManager:Symbol("HierarchyComponentManager"),TransformComponentManager:Symbol("TransformComponentManager"),NameComponentManager:Symbol("NameComponentManager"),SceneGraphSystem:Symbol("SceneGraphSystem"),FrameGraphSystem:Symbol("FrameGraphSystem"),ResourcePool:Symbol("ResourcePool"),ResourceHandleComponentManager:Symbol("ResourceHandleComponentManager"),PassNodeComponentManager:Symbol("PassNodeComponentManager"),RendererSystem:Symbol("RendererSystem"),RenderPass:Symbol("RenderPass"),RenderPassFactory:Symbol("Factory<IRenderPass>"),Renderable:Symbol("Factory<IRenderPass>"),MeshSystem:Symbol("MeshSystem"),MeshComponentManager:Symbol("MeshComponentManager"),CullableComponentManager:Symbol("CullableComponentManager"),Geometry:Symbol("Geometry"),GeometrySystem:Symbol("GeometrySystem"),GeometryComponentManager:Symbol("GeometryComponentManager"),Material:Symbol("Material"),MaterialSystem:Symbol("MaterialSystem"),MaterialComponentManager:Symbol("MaterialComponentManager"),ForwardRenderPath:Symbol("ForwardRenderPath"),ComputeSystem:Symbol("ComputeSystem"),ComputeComponentManager:Symbol("ComputeComponentManager"),ComputeStrategy:Symbol("ComputeStrategy"),Systems:Symbol("Systems"),World:Symbol("World"),RenderEngine:Symbol("RenderEngine"),WebGPUEngine:Symbol("WebGPUEngine"),WebGLEngine:Symbol("WebGLEngine"),ShaderModuleService:Symbol("ShaderModuleService"),ConfigService:Symbol("ConfigService"),InteractorService:Symbol("InteractorService"),IEventEmitter:Symbol("IEventEmitter"),Light:Symbol("Light")},af=function e(){Fl(this,e),this.index=void 0},sf=function e(){Fl(this,e),this.name=void 0,this.data=void 0,this.execute=void 0,this.tearDown=void 0},uf=function(){function e(){Fl(this,e),this.name=void 0,this.refCount=0,this.hasSideEffect=!1,this.devirtualize=[],this.destroy=[],this.reads=[],this.writes=[]}return Wl(e,[{key:"read",value:function(e){return this.reads.find((function(t){return t.index===e.index}))||this.reads.push(e),e}},{key:"sample",value:function(e){return this.read(e),e}},{key:"write",value:function(e,t){var n=this.writes.find((function(e){return e.index===t.index}));if(n)return t;var r=e.getResourceNode(t);r.resource.version++,r.resource.imported&&(this.hasSideEffect=!0);var i=e.createResourceNode(r.resource);return e.getResourceNode(i).writer=this,this.writes.push(i),i}}]),e}();function cf(e,t){return cf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},cf(e,t)}function lf(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cf(e,t)}function ff(e){return ff="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ff(e)}function df(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hf(e,t){if(t&&("object"===ff(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return df(e)}function pf(e){return pf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pf(e)}var gf,vf,mf,yf,bf,Ef,_f=function(e){lf(i,(function e(){Fl(this,e),this.first=void 0,this.last=void 0}));var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(){var e;Fl(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=r.call.apply(r,[this].concat(n))).version=0,e.refs=0,e.name=void 0,e.imported=void 0,e.priority=void 0,e.discardStart=!0,e.discardEnd=!1,e.descriptor=void 0,e.resource=void 0,e}return Wl(i,[{key:"preExecuteDestroy",value:function(){this.discardEnd=!0}},{key:"postExecuteDestroy",value:function(){this.imported}},{key:"postExecuteDevirtualize",value:function(){this.discardStart=!1}},{key:"preExecuteDevirtualize",value:function(){this.imported}}]),i}(),xf=function e(){Fl(this,e),this.resource=void 0,this.writer=void 0,this.readerCount=0,this.version=void 0};function wf(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Sf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Sf(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Sf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Af=(gf=(0,rf.b2)(),vf=(0,rf.f3)(of.RenderEngine),gf((Ef=function(){function e(){Fl(this,e),this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[],jl(this,"engine",bf,this)}var t,n;return Wl(e,[{key:"execute",value:(n=Kl(ql().mark((function e(t){return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.compile(),e.next=3,this.executePassNodes(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"tearDown",value:function(){this.frameGraphPasses.forEach((function(e){e.tearDown&&e.tearDown()})),this.reset()}},{key:"addPass",value:function(e,t,n,r){var i=new sf;i.execute=n,r&&(i.tearDown=r),i.name=e;var o=new uf;return o.name=e,this.passNodes.push(o),this.frameGraphPasses.push(i),t(this,o,i),i}},{key:"getPass",value:function(e){return this.frameGraphPasses.find((function(t){return t.name===e}))}},{key:"compile",value:function(){var e,t=this,n=wf(this.passNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.refCount=r.writes.length+(r.hasSideEffect?1:0),r.reads.forEach((function(e){t.resourceNodes[e.index].readerCount++}))}}catch(e){n.e(e)}finally{n.f()}var i,o=[],a=wf(this.resourceNodes);try{for(a.s();!(i=a.n()).done;){var s=i.value;0===s.readerCount&&o.push(s)}}catch(e){a.e(e)}finally{a.f()}for(;o.length;){var u=o.pop(),c=u&&u.writer;if(c&&0==--c.refCount){var l,f=wf(c.reads);try{for(f.s();!(l=f.n()).done;){var d=l.value,h=this.resourceNodes[d.index];0==--h.readerCount&&o.push(h)}}catch(e){f.e(e)}finally{f.f()}}}this.resourceNodes.forEach((function(e){e.resource.refs+=e.readerCount}));var p,g=wf(this.passNodes);try{for(g.s();!(p=g.n()).done;){var v=p.value;if(v.refCount){var m,y=wf(v.reads);try{for(y.s();!(m=y.n()).done;){var b=m.value,E=this.resourceNodes[b.index].resource;E.first=E.first?E.first:v,E.last=v}}catch(e){y.e(e)}finally{y.f()}var _,x=wf(v.writes);try{for(x.s();!(_=x.n()).done;){var w=_.value,S=this.resourceNodes[w.index].resource;S.first=S.first?S.first:v,S.last=v}}catch(e){x.e(e)}finally{x.f()}}}}catch(e){g.e(e)}finally{g.f()}for(var A=0;A<2;A++){var T,I=wf(this.resourceNodes);try{for(I.s();!(T=I.n()).done;){var N=T.value.resource;if(N.priority===A&&N.refs){var D=N.first,k=N.last;D&&k&&(D.devirtualize.push(N),k.destroy.push(N))}}}catch(e){I.e(e)}finally{I.f()}}}},{key:"executePassNodes",value:(t=Kl(ql().mark((function e(t){var n,r,i,o,a,s,u,c,l,f,d,h,p;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=wf(this.passNodes.entries()),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=18;break}if(i=nf(r.value,2),o=i[0],!(a=i[1]).refCount){e.next=16;break}s=wf(a.devirtualize);try{for(s.s();!(u=s.n()).done;)u.value.preExecuteDevirtualize(this.engine)}catch(e){s.e(e)}finally{s.f()}c=wf(a.destroy);try{for(c.s();!(l=c.n()).done;)l.value.preExecuteDestroy(this.engine)}catch(e){c.e(e)}finally{c.f()}return e.next=12,this.frameGraphPasses[o].execute(this,this.frameGraphPasses[o],t);case 12:f=wf(a.devirtualize);try{for(f.s();!(d=f.n()).done;)d.value.postExecuteDevirtualize(this.engine)}catch(e){f.e(e)}finally{f.f()}h=wf(a.destroy);try{for(h.s();!(p=h.n()).done;)p.value.postExecuteDestroy(this.engine)}catch(e){h.e(e)}finally{h.f()}case 16:e.next=3;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(1),n.e(e.t0);case 23:return e.prev=23,n.f(),e.finish(23);case 26:this.reset();case 27:case"end":return e.stop()}}),e,this,[[1,20,23,26]])}))),function(e){return t.apply(this,arguments)})},{key:"reset",value:function(){this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[]}},{key:"getResourceNode",value:function(e){return this.resourceNodes[e.index]}},{key:"createResourceNode",value:function(e){var t=new xf;t.resource=e,t.version=e.version,this.resourceNodes.push(t);var n=new af;return n.index=this.resourceNodes.length-1,n}},{key:"createTexture",value:function(e,t,n){var r=new _f;return r.name=t,r.descriptor=n,this.createResourceNode(r)}},{key:"createRenderTarget",value:function(e,t,n){var r=new _f;return r.name=t,r.descriptor=n,this.createResourceNode(r)}},{key:"present",value:function(e){this.addPass("Present",(function(t,n){n.read(e),n.hasSideEffect=!0}),Kl(ql().mark((function e(){return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))))}}]),e}(),bf=Hl((yf=Ef).prototype,"engine",[vf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mf=yf))||mf);function Tf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var If=1e-6,Nf="undefined"!=typeof Float32Array?Float32Array:Array;function Df(){var e=new Nf(4);return Nf!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function kf(e,t,n,r){var i=new Nf(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function Cf(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}function Mf(){var e=new Nf(9);return Nf!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Of(){var e=new Nf(3);return Nf!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Rf(e){var t=new Nf(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Pf(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function Gf(e,t,n){var r=new Nf(3);return r[0]=e,r[1]=t,r[2]=n,r}function Lf(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Uf(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function zf(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Bf(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function jf(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Ff(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Vf(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Wf(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e}function Hf(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function Xf(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),Df();var qf=Bf,Yf=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)},Kf=Pf,$f=(Of(),9007199254740991),Zf={};Zf["[object Float32Array]"]=Zf["[object Float64Array]"]=Zf["[object Int8Array]"]=Zf["[object Int16Array]"]=Zf["[object Int32Array]"]=Zf["[object Uint8Array]"]=Zf["[object Uint8ClampedArray]"]=Zf["[object Uint16Array]"]=Zf["[object Uint32Array]"]=!0,Zf["[object Arguments]"]=Zf["[object Array]"]=Zf["[object ArrayBuffer]"]=Zf["[object Boolean]"]=Zf["[object DataView]"]=Zf["[object Date]"]=Zf["[object Error]"]=Zf["[object Function]"]=Zf["[object Map]"]=Zf["[object Number]"]=Zf["[object Object]"]=Zf["[object RegExp]"]=Zf["[object Set]"]=Zf["[object String]"]=Zf["[object WeakMap]"]=!1;var Jf=Object.prototype.toString,Qf=function(e){return function(e){return!!e&&"object"===ff(e)}(e)&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=$f}(e.length)&&!!Zf[Jf.call(e)]};function ed(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function td(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ed(Object(n),!0).forEach((function(t){Tf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ed(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nd,rd,id,od,ad,sd,ud,cd,ld,fd=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(e){var t;return Fl(this,i),(t=r.call(this,e)).dirty=!0,t.attributes=[],t.indices=void 0,t.indicesBuffer=void 0,t.vertexCount=0,t.maxInstancedCount=void 0,t.aabb=void 0,t.entity=void 0,Object.assign(df(t),e),t}return Wl(i,[{key:"setAttribute",value:function(e,t,n,r){var i=this.attributes.find((function(t){return t.name===e}));return i?(i.data=t,i.dirty=!0):this.attributes.push(td(td({dirty:!0,name:e,data:t},n),{},{bufferGetter:r})),this.dirty=!0,this}},{key:"setIndex",value:function(e){return this.indices=new Uint32Array(e.buffer?e.buffer:e),this.dirty=!0,this}},{key:"applyMatrix",value:function(e){var t,n,r,i,o,a,s,u,c,l,f,d,h,p,g,v,m,y,b,E,_,x,w,S,A,T,I,N,D,k,C,M=this.attributes.find((function(e){return"position"===e.name})),O=this.attributes.find((function(e){return"normal"===e.name}));if(M&&(M.dirty=!0,M.data&&M.data.length))for(var R=0;R<M.data.length;R+=3){var P=kf(M.data[R],M.data[R+1],M.data[R+2],1);Cf(P,P,e),Qf(M.data)?M.data.set([P[0],P[1],P[2]],R):(M.data[R]=P[0],M.data[R+1]=P[1],M.data[R+2]=P[2])}if(O){var G=(t=Mf(),r=(n=e)[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=n[6],l=n[7],f=n[8],d=n[9],h=n[10],p=n[11],g=n[12],v=n[13],m=n[14],y=n[15],(C=(b=r*u-i*s)*(k=h*y-p*m)-(E=r*c-o*s)*(D=d*y-p*v)+(_=r*l-a*s)*(N=d*m-h*v)+(x=i*c-o*u)*(I=f*y-p*g)-(w=i*l-a*u)*(T=f*m-h*g)+(S=o*l-a*c)*(A=f*v-d*g))?(C=1/C,t[0]=(u*k-c*D+l*N)*C,t[1]=(c*I-s*k-l*T)*C,t[2]=(s*D-u*I+l*A)*C,t[3]=(o*D-i*k-a*N)*C,t[4]=(r*k-o*I+a*T)*C,t[5]=(i*I-r*D-a*A)*C,t[6]=(v*S-m*w+y*x)*C,t[7]=(m*_-g*S-y*E)*C,t[8]=(g*w-v*_+y*b)*C,t):null);if(O.data&&O.data.length)for(var L=0;L<O.data.length;L+=3){var U=Gf(O.data[L],O.data[L+1],O.data[L+2]);Xf(U,U,G),Ff(U,U),Qf(O.data)?O.data.set([U[0],U[1],U[2]],L):(O.data[L]=U[0],O.data[L+1]=U[1],O.data[L+2]=U[2])}}}}]),i}(Jl);!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(nd||(nd={}));var dd=(rd=(0,rf.b2)(),id=(0,rf.f3)(of.GeometryComponentManager),od=(0,rf.f3)(of.RenderEngine),rd((ld=function(){function e(){Fl(this,e),jl(this,"geometry",ud,this),jl(this,"engine",cd,this)}var t;return Wl(e,[{key:"execute",value:(t=Kl(ql().mark((function e(){var t=this;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.geometry.forEach((function(e,n){n.dirty&&(n.attributes.forEach((function(e){var n;e.dirty&&e.data&&(e.buffer?null===(n=e.buffer)||void 0===n||n.subData({data:e.data,offset:0}):e.buffer=t.engine.createBuffer({data:e.data,type:nd.FLOAT}),e.dirty=!1)})),n.indices&&(n.indicesBuffer?n.indicesBuffer.subData({data:n.indices,offset:0}):n.indicesBuffer=t.engine.createElements({data:n.indices,count:n.indices.length,type:nd.UNSIGNED_INT,usage:nd.STATIC_DRAW})),n.dirty=!1)}));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"tearDown",value:function(){this.geometry.forEach((function(e,t){t.indicesBuffer&&t.indicesBuffer.destroy(),t.attributes.forEach((function(e){e.buffer&&e.buffer.destroy()}))})),this.geometry.clear()}},{key:"createBufferGeometry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{vertexCount:3},t=e.vertexCount,n=Zl();return this.geometry.create(n,{vertexCount:t})}},{key:"createInstancedBufferGeometry",value:function(e){var t=e.maxInstancedCount,n=e.vertexCount,r=Zl();return this.geometry.create(r,{maxInstancedCount:t,vertexCount:n})}}]),e}(),ud=Hl((sd=ld).prototype,"geometry",[id],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cd=Hl(sd.prototype,"engine",[od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad=sd))||ad);function hd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hd(Object(n),!0).forEach((function(t){Tf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gd,vd,md,yd,bd,Ed,_d,xd,wd,Sd,Ad=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(e){var t;return Fl(this,i),(t=r.call(this,e)).vertexShaderGLSL=void 0,t.fragmentShaderGLSL=void 0,t.defines={},t.dirty=!0,t.uniforms=[],t.cull={enable:!0,face:nd.BACK},t.depth={enable:!0},t.blend=void 0,t.entity=void 0,t.type=void 0,Object.assign(df(t),e),t}return Wl(i,[{key:"setDefines",value:function(e){return this.defines=pd(pd({},this.defines),e),this}},{key:"setCull",value:function(e){return this.cull=e,this}},{key:"setDepth",value:function(e){return this.depth=e,this}},{key:"setBlend",value:function(e){return this.blend=e,this}},{key:"setUniform",value:function(e,t){var n=this;if("string"!=typeof e)return Object.keys(e).forEach((function(t){return n.setUniform(t,e[t])})),this;var r=this.uniforms.find((function(t){return t.name===e}));return r?(r.dirty=!0,r.data=t):this.uniforms.push({name:e,dirty:!0,data:t}),this.dirty=!0,this}}]),i}(Jl);function Td(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Id(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Td(Object(n),!0).forEach((function(t){Tf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Td(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Nd,Dd=(gd=(0,rf.b2)(),vd=(0,rf.f3)(of.MaterialComponentManager),md=(0,rf.f3)(of.RenderEngine),yd=(0,rf.f3)(of.ShaderModuleService),gd((Sd=function(){function e(){Fl(this,e),jl(this,"material",_d,this),jl(this,"engine",xd,this),jl(this,"shaderModule",wd,this)}var t;return Wl(e,[{key:"execute",value:(t=Kl(ql().mark((function e(){return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"tearDown",value:function(){this.material.clear()}},{key:"createShaderMaterial",value:function(e){var t=Zl(),n=e.vertexShader,r=e.fragmentShader,i=[];if(!this.engine.supportWebGPU){var o="material-".concat(t);this.shaderModule.registerModule(o,{vs:e.vertexShader,fs:e.fragmentShader});var a=this.shaderModule.getModule(o);n=a.vs,r=a.fs,a.uniforms&&(i=Object.keys(a.uniforms).map((function(e){return{dirty:!0,name:e,data:a.uniforms[e]}})))}return this.material.create(t,Id(Id({vertexShaderGLSL:n,fragmentShaderGLSL:r},e),{},{uniforms:i}))}}]),e}(),_d=Hl((Ed=Sd).prototype,"material",[vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd=Hl(Ed.prototype,"engine",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd=Hl(Ed.prototype,"shaderModule",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bd=Ed))||bd);!function(e){e[e.Standard=0]="Standard"}(Nd||(Nd={}));var kd=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(e){var t;return Fl(this,i),(t=r.call(this,e)).strategy=Nd.Standard,t.visibilityPlaneMask=0,t.visible=!1,Object.assign(df(t),e),t}return i}(Jl),Cd=function(){function e(t,n){Fl(this,e),this.center=void 0,this.halfExtents=void 0,this.min=Of(),this.max=Of(),this.update(t,n)}return Wl(e,[{key:"update",value:function(e,t){this.center=e||Of(),this.halfExtents=t||Gf(.5,.5,.5),this.min=qf(this.min,this.center,this.halfExtents),this.max=zf(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(e,t){zf(this.center,t,e),jf(this.center,this.center,.5),qf(this.halfExtents,t,e),jf(this.halfExtents,this.halfExtents,.5),Lf(this.min,e),Lf(this.max,t)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(e){var t=this.center,n=t[0],r=t[1],i=t[2],o=this.halfExtents,a=o[0],s=o[1],u=o[2],c=n-a,l=n+a,f=r-s,d=r+s,h=i-u,p=i+u,g=e.center,v=g[0],m=g[1],y=g[2],b=e.halfExtents,E=b[0],_=b[1],x=b[2],w=v-E,S=v+E,A=m-_,T=m+_,I=y-x,N=y+x;w<c&&(c=w),S>l&&(l=S),A<f&&(f=A),T>d&&(d=T),I<h&&(h=I),N>p&&(p=N),t[0]=.5*(c+l),t[1]=.5*(f+d),t[2]=.5*(h+p),o[0]=.5*(l-c),o[1]=.5*(d-f),o[2]=.5*(p-h),this.min[0]=c,this.min[1]=f,this.min[2]=h,this.max[0]=l,this.max[1]=d,this.max[2]=p}},{key:"intersects",value:function(e){var t=this.getMax(),n=this.getMin(),r=e.getMax(),i=e.getMin();return n[0]<=r[0]&&t[0]>=i[0]&&n[1]<=r[1]&&t[1]>=i[1]&&n[2]<=r[2]&&t[2]>=i[2]}},{key:"containsPoint",value:function(e){var t=this.getMin(),n=this.getMax();return!(e[0]<t[0]||e[0]>n[0]||e[1]<t[1]||e[1]>n[1]||e[2]<t[2]||e[2]>n[2])}},{key:"getNegativeFarPoint",value:function(e){return 273===e.pnVertexFlag?Lf(Of(),this.min):272===e.pnVertexFlag?Gf(this.min[0],this.min[1],this.max[2]):257===e.pnVertexFlag?Gf(this.min[0],this.max[1],this.min[2]):256===e.pnVertexFlag?Gf(this.min[0],this.max[1],this.max[2]):17===e.pnVertexFlag?Gf(this.max[0],this.min[1],this.min[2]):16===e.pnVertexFlag?Gf(this.max[0],this.min[1],this.max[2]):1===e.pnVertexFlag?Gf(this.max[0],this.max[1],this.min[2]):Gf(this.max[0],this.max[1],this.max[2])}},{key:"getPositiveFarPoint",value:function(e){return 273===e.pnVertexFlag?Lf(Of(),this.max):272===e.pnVertexFlag?Gf(this.max[0],this.max[1],this.min[2]):257===e.pnVertexFlag?Gf(this.max[0],this.min[1],this.max[2]):256===e.pnVertexFlag?Gf(this.max[0],this.min[1],this.min[2]):17===e.pnVertexFlag?Gf(this.min[0],this.max[1],this.max[2]):16===e.pnVertexFlag?Gf(this.min[0],this.max[1],this.min[2]):1===e.pnVertexFlag?Gf(this.min[0],this.min[1],this.max[2]):Gf(this.min[0],this.min[1],this.min[2])}}]),e}();var Md,Od=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(e){var t;return Fl(this,i),(t=r.call(this,e)).material=void 0,t.geometry=void 0,t.aabb=new Cd,t.aabbDirty=!0,t.model=void 0,t.visible=!0,t.children=[],Object.assign(df(t),e),t}return i}(Jl),Rd=function(){function e(t,n){Fl(this,e),this.distance=void 0,this.normal=void 0,this.pnVertexFlag=void 0,this.distance=t||0,this.normal=n||Gf(0,1,0),this.updatePNVertexFlag()}return Wl(e,[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)}},{key:"distanceToPoint",value:function(e){return Vf(e,this.normal)-this.distance}},{key:"normalize",value:function(){var e=1/Kf(this.normal);jf(this.normal,this.normal,e),this.distance*=e}},{key:"intersectsLine",value:function(e,t,n){var r=this.distanceToPoint(e),i=r/(r-this.distanceToPoint(t)),o=i>=0&&i<=1;return o&&n&&Wf(n,e,t,i),o}}]),e}();!function(e){e[e.OUTSIDE=4294967295]="OUTSIDE",e[e.INSIDE=0]="INSIDE",e[e.INDETERMINATE=2147483647]="INDETERMINATE"}(Md||(Md={}));var Pd,Gd,Ld,Ud,zd,Bd,jd,Fd,Vd,Wd,Hd,Xd,qd,Yd,Kd=function(){function e(t){if(Fl(this,e),this.planes=[],t)this.planes=t;else for(var n=0;n<6;n++)this.planes.push(new Rd)}return Wl(e,[{key:"extractFromVPMatrix",value:function(e){var t=nf(e,16),n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],d=t[10],h=t[11],p=t[12],g=t[13],v=t[14],m=t[15];Uf(this.planes[0].normal,o-n,c-a,h-l),this.planes[0].distance=-(m-p),Uf(this.planes[1].normal,o+n,c+a,h+l),this.planes[1].distance=-(m+p),Uf(this.planes[2].normal,o+r,c+s,h+f),this.planes[2].distance=-(m+g),Uf(this.planes[3].normal,o-r,c-s,h-f),this.planes[3].distance=-(m-g),Uf(this.planes[4].normal,o-i,c-u,h-d),this.planes[4].distance=-(m-v),Uf(this.planes[5].normal,o+i,c+u,h+d),this.planes[5].distance=-(m+v),this.planes.forEach((function(e){e.normalize(),e.updatePNVertexFlag()}))}}]),e}();function $d(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Zd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zd(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Zd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Jd=(Pd=(0,rf.b2)(),Gd=(0,rf.f3)(of.MeshComponentManager),Ld=(0,rf.f3)(of.CullableComponentManager),Ud=(0,rf.f3)(of.GeometryComponentManager),zd=(0,rf.f3)(of.HierarchyComponentManager),Bd=(0,rf.f3)(of.TransformComponentManager),Pd((Yd=function(){function e(){Fl(this,e),jl(this,"mesh",Vd,this),jl(this,"cullable",Wd,this),jl(this,"geometry",Hd,this),jl(this,"hierarchy",Xd,this),jl(this,"transform",qd,this),this.planes=void 0}var t;return Wl(e,[{key:"setFrustumPlanes",value:function(e){this.planes=e}},{key:"execute",value:(t=Kl(ql().mark((function e(t){var n,r,i,o,a,s,u,c,l,f,d,h,p,g,v,m,y,b,E,_,x;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=$d(t);try{for(n.s();!(r=n.n()).done;){i=r.value,o=i.getScene(),a=i.getCamera(),s=$d(o.getEntities());try{for(s.s();!(u=s.n()).done;)c=u.value,(l=this.mesh.getComponentByEntity(c))&&(f=this.hierarchy.getComponentByEntity(c),d=this.cullable.getComponentByEntity(c),h=l.geometry,p=this.transform.getComponentByEntity(c),h&&h.aabb&&p&&l.aabbDirty&&(g=p.worldTransform,v=h.aabb,m=v.center,y=v.halfExtents,b=Hf(Of(),m,g),w=g,(S=Mf())[0]=w[0],S[1]=w[1],S[2]=w[2],S[3]=w[4],S[4]=w[5],S[5]=w[6],S[6]=w[8],S[7]=w[9],S[8]=w[10],E=S,_=Xf(Of(),y,E),l.aabb.update(b,_),l.aabbDirty=!1),d&&h&&(x=this.cullable.getComponentByEntity((null==f?void 0:f.parentID)||-1),d.visibilityPlaneMask=this.computeVisibilityWithPlaneMask(l.aabb,(null==x?void 0:x.visibilityPlaneMask)||Md.INDETERMINATE,this.planes||a.getFrustum().planes),d.visible=d.visibilityPlaneMask!==Md.OUTSIDE))}catch(e){s.e(e)}finally{s.f()}}}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}var w,S}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"tearDown",value:function(){this.cullable.clear(),this.mesh.clear()}},{key:"computeVisibilityWithPlaneMask",value:function(e,t,n){if(t===Md.OUTSIDE||t===Md.INSIDE)return t;for(var r=Md.INSIDE,i=0,o=n.length;i<o;++i){var a=i<31?1<<i:0;if(!(i<31&&0==(t&a))){var s=n[i],u=s.normal,c=s.distance;if(Vf(u,e.getNegativeFarPoint(n[i]))+c>0)return Md.OUTSIDE;Vf(u,e.getPositiveFarPoint(n[i]))+c>0&&(r|=a)}}return r}}]),e}(),Vd=Hl((Fd=Yd).prototype,"mesh",[Gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wd=Hl(Fd.prototype,"cullable",[Ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd=Hl(Fd.prototype,"geometry",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xd=Hl(Fd.prototype,"hierarchy",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd=Hl(Fd.prototype,"transform",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=Fd))||jd);function Qd(){var e=new Nf(16);return Nf!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function eh(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function th(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function nh(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],d=t[10],h=t[11],p=t[12],g=t[13],v=t[14],m=t[15],y=n*s-r*a,b=n*u-i*a,E=n*c-o*a,_=r*u-i*s,x=r*c-o*s,w=i*c-o*u,S=l*g-f*p,A=l*v-d*p,T=l*m-h*p,I=f*v-d*g,N=f*m-h*g,D=d*m-h*v,k=y*D-b*N+E*I+_*T-x*A+w*S;return k?(k=1/k,e[0]=(s*D-u*N+c*I)*k,e[1]=(i*N-r*D-o*I)*k,e[2]=(g*w-v*x+m*_)*k,e[3]=(d*x-f*w-h*_)*k,e[4]=(u*T-a*D-c*A)*k,e[5]=(n*D-i*T+o*A)*k,e[6]=(v*E-p*w-m*b)*k,e[7]=(l*w-d*E+h*b)*k,e[8]=(a*N-s*T+c*S)*k,e[9]=(r*T-n*N-o*S)*k,e[10]=(p*x-g*E+m*y)*k,e[11]=(f*E-l*x-h*y)*k,e[12]=(s*A-a*I-u*S)*k,e[13]=(n*I-r*A+i*S)*k,e[14]=(g*b-p*_-v*y)*k,e[15]=(l*_-f*b+d*y)*k,e):null}function rh(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],d=t[9],h=t[10],p=t[11],g=t[12],v=t[13],m=t[14],y=t[15],b=n[0],E=n[1],_=n[2],x=n[3];return e[0]=b*r+E*s+_*f+x*g,e[1]=b*i+E*u+_*d+x*v,e[2]=b*o+E*c+_*h+x*m,e[3]=b*a+E*l+_*p+x*y,b=n[4],E=n[5],_=n[6],x=n[7],e[4]=b*r+E*s+_*f+x*g,e[5]=b*i+E*u+_*d+x*v,e[6]=b*o+E*c+_*h+x*m,e[7]=b*a+E*l+_*p+x*y,b=n[8],E=n[9],_=n[10],x=n[11],e[8]=b*r+E*s+_*f+x*g,e[9]=b*i+E*u+_*d+x*v,e[10]=b*o+E*c+_*h+x*m,e[11]=b*a+E*l+_*p+x*y,b=n[12],E=n[13],_=n[14],x=n[15],e[12]=b*r+E*s+_*f+x*g,e[13]=b*i+E*u+_*d+x*v,e[14]=b*o+E*c+_*h+x*m,e[15]=b*a+E*l+_*p+x*y,e}function ih(e,t,n){var r,i,o,a,s,u,c,l,f,d,h,p,g=n[0],v=n[1],m=n[2];return t===e?(e[12]=t[0]*g+t[4]*v+t[8]*m+t[12],e[13]=t[1]*g+t[5]*v+t[9]*m+t[13],e[14]=t[2]*g+t[6]*v+t[10]*m+t[14],e[15]=t[3]*g+t[7]*v+t[11]*m+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],d=t[9],h=t[10],p=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=f,e[9]=d,e[10]=h,e[11]=p,e[12]=r*g+s*v+f*m+t[12],e[13]=i*g+u*v+d*m+t[13],e[14]=o*g+c*v+h*m+t[14],e[15]=a*g+l*v+p*m+t[15]),e}function oh(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function ah(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,c,l),e}function sh(e,t){var n=new Nf(3);ah(n,t);var r=1/n[0],i=1/n[1],o=1/n[2],a=t[0]*r,s=t[1]*i,u=t[2]*o,c=t[4]*r,l=t[5]*i,f=t[6]*o,d=t[8]*r,h=t[9]*i,p=t[10]*o,g=a+l+p,v=0;return g>0?(v=2*Math.sqrt(g+1),e[3]=.25*v,e[0]=(f-h)/v,e[1]=(d-u)/v,e[2]=(s-c)/v):a>l&&a>p?(v=2*Math.sqrt(1+a-l-p),e[3]=(f-h)/v,e[0]=.25*v,e[1]=(s+c)/v,e[2]=(d+u)/v):l>p?(v=2*Math.sqrt(1+l-a-p),e[3]=(d-u)/v,e[0]=(s+c)/v,e[1]=.25*v,e[2]=(f+h)/v):(v=2*Math.sqrt(1+p-a-l),e[3]=(s-c)/v,e[0]=(d+u)/v,e[1]=(f+h)/v,e[2]=.25*v),e}function uh(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,c=n*a,l=r*a,f=r*s,d=i*a,h=i*s,p=i*u,g=o*a,v=o*s,m=o*u;return e[0]=1-f-p,e[1]=l+m,e[2]=d-v,e[3]=0,e[4]=l-m,e[5]=1-c-p,e[6]=h+g,e[7]=0,e[8]=d+v,e[9]=h-g,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var ch,lh,fh,dh,hh,ph,gh,vh,mh,yh,bh,Eh,_h,xh,wh,Sh,Ah,Th,Ih,Nh,Dh,kh,Ch,Mh;function Oh(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Rh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rh(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Rh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ph,Gh,Lh,Uh,zh,Bh,jh,Fh,Vh,Wh,Hh,Xh,qh,Yh=(ch=(0,rf.b2)(),lh=(0,rf.f3)(of.MeshComponentManager),fh=(0,rf.f3)(of.GeometryComponentManager),dh=(0,rf.f3)(of.MaterialComponentManager),hh=(0,rf.f3)(of.CullableComponentManager),ph=(0,rf.f3)(of.TransformComponentManager),gh=(0,rf.f3)(of.HierarchyComponentManager),vh=(0,rf.f3)(of.Systems),mh=(0,rf.t6)(of.FrameGraphSystem),yh=(0,rf.f3)(of.RenderEngine),bh=(0,rf.f3)(of.ResourcePool),ch((Mh=Ch=function(){function e(){var t=this;Fl(this,e),jl(this,"mesh",xh,this),jl(this,"geometry",wh,this),jl(this,"material",Sh,this),jl(this,"cullable",Ah,this),jl(this,"transform",Th,this),jl(this,"hierarchy",Ih,this),jl(this,"frameGraphSystem",Nh,this),jl(this,"engine",Dh,this),jl(this,"resourcePool",kh,this),this.modelCache={},this.setup=function(e,t,n){var r=e.createRenderTarget(t,"color buffer",{width:1,height:1,usage:nd.RENDER_ATTACHMENT|nd.SAMPLED|nd.COPY_SRC});n.data={output:t.write(e,r)}},this.execute=function(){var e=Kl(ql().mark((function e(n,r,i){var o,a,s,u,c,l;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.getResourceNode(r.data.output),a=t.resourcePool.getOrCreateResource(o.resource),s=Oh(i),e.prev=3,s.s();case 5:if((u=s.n()).done){e.next=11;break}return c=u.value,e.next=9,t.initView(c);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),s.e(e.t0);case 16:return e.prev=16,s.f(),e.finish(16);case 19:l=t.engine.getCanvas(),a.resize({width:l.width,height:l.height}),t.engine.setScissor({enable:!1}),t.engine.clear({framebuffer:a,color:i[0].getClearColor(),depth:1}),t.engine.useFramebuffer(a,(function(){var e,n=Oh(i);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.renderView(r)}}catch(e){n.e(e)}finally{n.f()}}));case 24:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t,n,r){return e.apply(this,arguments)}}()}var t,n;return Wl(e,[{key:"renderView",value:function(e){var t=e.getScene(),n=e.getCamera(),r=n.getViewTransform(),i=rh(Qd(),n.getPerspective(),r);n.getFrustum().extractFromVPMatrix(i);var o=e.getViewport(),a=o.x,s=o.y,u=o.width,c=o.height;this.engine.viewport({x:a,y:s,width:u,height:c});var l,f=Oh(t.getEntities());try{for(f.s();!(l=f.n()).done;){var d=l.value;this.renderMesh(d,{camera:n,view:e,viewMatrix:r})}}catch(e){f.e(e)}finally{f.f()}}},{key:"renderMesh",value:function(e,t){var n=t.camera,r=t.view,i=t.viewMatrix,o=this.mesh.getComponentByEntity(e);if(o&&o.visible){var a=o.material,s=o.geometry;if(s&&!s.dirty&&a){var u=this.transform.getComponentByEntity(e),c=rh(Qd(),i,u.worldTransform),l=r.getViewport(),f=l.width,d=l.height;a.setUniform({projectionMatrix:n.getPerspective(),modelViewMatrix:c,modelMatrix:u.worldTransform,viewMatrix:i,cameraPosition:n.getPosition(),u_viewport:[f,d]}),o.model&&(o.model.draw({uniforms:a.uniforms.reduce((function(e,t){return e[t.name]=t.data,e}),{})}),a.uniforms.forEach((function(e){e.dirty=!1})),a.dirty=!1)}}}},{key:"initMesh",value:(n=Kl(ql().mark((function e(t,n){var r,i,o,a,s,u,c,l;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.mesh.getComponentByEntity(t)){e.next=3;break}return e.abrupt("return");case 3:if(i=r.material,(o=r.geometry)&&!o.dirty&&i){e.next=7;break}return e.abrupt("return");case 7:if(r.model){e.next=24;break}if(a="m-".concat(i.entity,"-g-").concat(o.entity),!this.modelCache[a]){e.next=12;break}return r.model=this.modelCache[a],e.abrupt("return");case 12:return i.setUniform({projectionMatrix:1,modelViewMatrix:1,modelMatrix:1,viewMatrix:1,cameraPosition:1,u_viewport:1}),s=this.engine,u=s.createModel,c=s.createAttribute,l={vs:i.vertexShaderGLSL,fs:i.fragmentShaderGLSL,defines:i.defines,attributes:o.attributes.reduce((function(e,t){return t.data&&t.buffer&&(e[t.name]=c({buffer:t.buffer,attributes:t.attributes,arrayStride:t.arrayStride,stepMode:t.stepMode,divisor:"vertex"===t.stepMode?0:1})),e}),{}),uniforms:i.uniforms.reduce((function(e,t){return e[t.name]=t.data,e}),{}),scissor:{enable:!0,box:function(){return n.getViewport()}}},i.cull&&(l.cull=i.cull),i.depth&&(l.depth=i.depth),i.blend&&(l.blend=i.blend),o.indicesBuffer&&(l.elements=o.indicesBuffer),o.maxInstancedCount&&(l.instances=o.maxInstancedCount,l.count=o.vertexCount||3),e.next=22,u(l);case 22:r.model=e.sent,this.modelCache[a]=r.model;case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"initView",value:(t=Kl(ql().mark((function e(t){var n,r,i,o;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.getScene(),r=Oh(n.getEntities()),e.prev=2,r.s();case 4:if((i=r.n()).done){e.next=10;break}return o=i.value,e.next=8,this.initMesh(o,t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e){return t.apply(this,arguments)})}]),e}(),Ch.IDENTIFIER="Render Pass",xh=Hl((_h=Mh).prototype,"mesh",[lh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wh=Hl(_h.prototype,"geometry",[fh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sh=Hl(_h.prototype,"material",[dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ah=Hl(_h.prototype,"cullable",[hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Th=Hl(_h.prototype,"transform",[ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ih=Hl(_h.prototype,"hierarchy",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh=Hl(_h.prototype,"frameGraphSystem",[vh,mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=Hl(_h.prototype,"engine",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kh=Hl(_h.prototype,"resourcePool",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eh=_h))||Eh);function Kh(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return $h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function $h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Zh,Jh,Qh,ep,tp,np,rp,ip,op,ap,sp,up,cp,lp,fp,dp,hp,pp,gp,vp,mp,yp,bp=(Ph=(0,rf.b2)(),Gh=(0,rf.f3)(of.RenderEngine),Lh=(0,rf.f3)(of.ResourcePool),Uh=(0,rf.f3)(of.RenderPassFactory),zh=(0,rf.f3)(of.MeshComponentManager),Ph((qh=Xh=function(){function e(){var t=this;Fl(this,e),jl(this,"engine",Fh,this),jl(this,"resourcePool",Vh,this),jl(this,"renderPassFactory",Wh,this),jl(this,"mesh",Hh,this),this.pickingFBO=void 0,this.views=void 0,this.highlightEnabled=!0,this.highlightColor=[255,0,0,255],this.alreadyInRendering=!1,this.setup=function(e,t,n){var r=e.createRenderTarget(t,"picking fbo",{width:1,height:1});n.data={output:t.write(e,r)},t.hasSideEffect=!0},this.execute=function(){var e=Kl(ql().mark((function e(n,r,i){var o,a,s;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.views=i,!t.alreadyInRendering){e.next=3;break}return e.abrupt("return");case 3:o=Kh(i);try{for(s=function(){var e=a.value,i=e.getViewport(),o=i.width,s=i.height;t.alreadyInRendering=!0;var u=n.getResourceNode(r.data.output);t.pickingFBO=t.resourcePool.getOrCreateResource(u.resource),t.pickingFBO.resize({width:o,height:s}),t.engine.useFramebuffer(t.pickingFBO,(function(){t.engine.clear({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n,r=t.renderPassFactory(Yh.IDENTIFIER),i=[],o=Kh(e.getScene().getEntities());try{for(o.s();!(n=o.n()).done;){var a=n.value,s=t.mesh.getComponentByEntity(a);s.material.setUniform("u_PickingStage",1),i.push(s)}}catch(e){o.e(e)}finally{o.f()}r.renderView(e),i.forEach((function(e){e.material.setUniform("u_PickingStage",2)})),t.alreadyInRendering=!1}))},o.s();!(a=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.pick=function(e,n){var r,i,o=e.x,a=e.y,s=t.engine,u=s.readPixels,c=s.useFramebuffer,l=n.getViewport(),f=l.width,d=l.height,h=o*window.devicePixelRatio,p=a*window.devicePixelRatio;if(!(h>f||h<0||p>d||p<0))return c(t.pickingFBO,(function(){var e;0===(r=u({x:Math.round(h),y:Math.round(d-(a+1)*window.devicePixelRatio),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO}))[0]&&0===r[1]&&0===r[2]||(e=nf(r,3),i=e[0]+256*e[1]+65536*e[2]-1,t.highlightEnabled&&t.highlightPickedFeature(r,n))})),i}}return Wl(e,[{key:"enableHighlight",value:function(e){this.highlightEnabled=e}},{key:"setHighlightColor",value:function(e){this.highlightColor=e}},{key:"highlightPickedFeature",value:function(e,t){if(e){var n,r=Kh(t.getScene().getEntities());try{for(r.s();!(n=r.n()).done;){var i=n.value,o=this.mesh.getComponentByEntity(i).material;o.setUniform("u_PickingStage",2),o.setUniform("u_PickingColor",[e[0],e[1],e[2]]),o.setUniform("u_HighlightColor",this.highlightColor)}}catch(e){r.e(e)}finally{r.f()}}}}]),e}(),Xh.IDENTIFIER="PixelPicking Pass",Fh=Hl((jh=qh).prototype,"engine",[Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vh=Hl(jh.prototype,"resourcePool",[Lh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wh=Hl(jh.prototype,"renderPassFactory",[Uh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hh=Hl(jh.prototype,"mesh",[zh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bh=jh))||Bh),Ep=(Zh=(0,rf.b2)(),Jh=(0,rf.f3)(of.RenderEngine),Qh=(0,rf.f3)(of.ResourcePool),Zh((op=ip=function e(){var t=this;Fl(this,e),jl(this,"engine",np,this),jl(this,"resourcePool",rp,this),this.model=void 0,this.setup=function(e,t,n){var r=e.getPass(Yh.IDENTIFIER);if(r){var i=e.createRenderTarget(t,"render to screen",{width:1,height:1});n.data={input:t.read(r.data.output),output:t.write(e,i)}}},this.execute=function(){var e=Kl(ql().mark((function e(n,r){var i,o,a,s,u,c,l;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.engine,o=i.createModel,a=i.createAttribute,s=i.createBuffer,t.model){e.next=6;break}return e.next=4,o({vs:t.engine.supportWebGPU?"layout(location = 0) in vec2 a_Position;\nlayout(location = 0) out vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}":"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:t.engine.supportWebGPU?"layout(set = 0, binding = 0) uniform sampler u_TextureSampler;\nlayout(set = 0, binding = 1) uniform texture2D u_Texture;\n\nlayout(location = 0) in vec2 v_UV;\nlayout(location = 0) out vec4 outColor;\n\nvoid main() {\n  outColor = texture(sampler2D(u_Texture, u_TextureSampler), v_UV);\n}":"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}",attributes:{a_Position:a({buffer:s({data:[-4,-4,4,-4,0,4],type:nd.FLOAT}),size:2,arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})},uniforms:{u_Texture:null},depth:{enable:!1},count:3,blend:{enable:!0}});case 4:u=e.sent,t.model=u;case 6:c=n.getResourceNode(r.data.input),l=t.resourcePool.getOrCreateResource(c.resource),t.engine.useFramebuffer(null,(function(){t.engine.clear({framebuffer:null,color:[0,0,0,0],depth:1,stencil:0}),t.model.draw({uniforms:{u_Texture:l}})}));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.tearDown=function(){t.model=void 0}},ip.IDENTIFIER="Copy Pass",np=Hl((tp=op).prototype,"engine",[Jh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rp=Hl(tp.prototype,"resourcePool",[Qh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep=tp))||ep),_p=(ap=(0,rf.b2)(),sp=(0,rf.f3)(of.Systems),up=(0,rf.t6)(of.FrameGraphSystem),cp=(0,rf.f3)(of.RenderPassFactory),lp=(0,rf.f3)(of.ConfigService),fp=(0,rf.f3)(of.ResourcePool),ap((yp=function(){function e(){Fl(this,e),jl(this,"frameGraphSystem",pp,this),jl(this,"renderPassFactory",gp,this),jl(this,"configService",vp,this),jl(this,"resourcePool",mp,this)}var t;return Wl(e,[{key:"execute",value:(t=Kl(ql().mark((function e(t){var n,r,i,o,a,s,u,c;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.renderPassFactory(Yh.IDENTIFIER),r=n.setup,i=n.execute,this.frameGraphSystem.addPass(Yh.IDENTIFIER,r,i),o=this.renderPassFactory(Ep.IDENTIFIER),a=o.setup,s=o.execute,u=o.tearDown,c=this.frameGraphSystem.addPass(Ep.IDENTIFIER,a,s,u),this.frameGraphSystem.present(c.data.output);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"tearDown",value:function(){this.resourcePool.clean()}},{key:"pick",value:function(e,t){return this.renderPassFactory(bp.IDENTIFIER).pick(e,t)}}]),e}(),pp=Hl((hp=yp).prototype,"frameGraphSystem",[sp,up],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gp=Hl(hp.prototype,"renderPassFactory",[cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vp=Hl(hp.prototype,"configService",[lp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mp=Hl(hp.prototype,"resourcePool",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dp=hp))||dp);var xp,wp,Sp,Ap,Tp,Ip,Np,Dp,kp,Cp,Mp=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(e){var t;return Fl(this,i),(t=r.call(this,e)).parentID=void 0,Object.assign(df(t),e),t}return i}(Jl),Op=(xp=(0,rf.b2)(),wp=(0,rf.f3)(of.HierarchyComponentManager),Sp=(0,rf.f3)(of.TransformComponentManager),Ap=(0,rf.f3)(of.MeshComponentManager),xp((Cp=function(){function e(){Fl(this,e),jl(this,"hierarchy",Np,this),jl(this,"transform",Dp,this),jl(this,"mesh",kp,this)}var t;return Wl(e,[{key:"execute",value:(t=Kl(ql().mark((function e(){return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.runTransformUpdateSystem(),this.runHierarchyUpdateSystem();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"tearDown",value:function(){this.hierarchy.clear(),this.transform.clear()}},{key:"getHierarchyComponentManager",value:function(){return this.hierarchy}},{key:"getTransformComponentManager",value:function(){return this.transform}},{key:"runTransformUpdateSystem",value:function(){var e=this;this.transform.forEach((function(t,n){(n.isDirty()||n.isLocalDirty())&&(e.setMeshAABBDirty(e.mesh.getComponentByEntity(t)),n.updateTransform())}))}},{key:"runHierarchyUpdateSystem",value:function(){var e=this;this.hierarchy.forEach((function(t,n){var r=e.transform.getComponentByEntity(t),i=e.transform.getComponentByEntity(n.parentID);null!==r&&null!==i&&r.updateTransformWithParent(i)}))}},{key:"attach",value:function(e,t,n){this.hierarchy.contains(e)&&this.detach(e),this.hierarchy.create(e,{parentID:t});var r=this.mesh.getComponentByEntity(t);if(this.setMeshAABBDirty(r),r&&-1===r.children.indexOf(e)&&r.children.push(e),this.hierarchy.getCount()>1)for(var i=this.hierarchy.getCount()-1;i>0;--i)for(var o=this.hierarchy.getEntity(i),a=0;a<i;++a)if(this.hierarchy.getComponent(a).parentID===o){this.hierarchy.moveItem(i,a),++i;break}this.hierarchy.getComponentByEntity(e);var s=this.transform.getComponentByEntity(t);null===s&&(s=this.transform.create(t));var u=this.transform.getComponentByEntity(e);null===u&&(u=this.transform.create(e),s=this.transform.getComponentByEntity(t)),u.parent=s,!n&&s&&(u.matrixTransform(nh(Qd(),s.worldTransform)),u.updateTransform()),s&&u.updateTransformWithParent(s)}},{key:"detach",value:function(e){var t=this.hierarchy.getComponentByEntity(e);if(null!==t){var n=this.transform.getComponentByEntity(e);null!==n&&(n.parent=null,n.applyTransform()),this.hierarchy.removeKeepSorted(e);var r=this.mesh.getComponentByEntity(t.parentID);if(r){var i=r.children.indexOf(e);r.children.splice(i,1)}this.setMeshAABBDirty(r)}}},{key:"detachChildren",value:function(e){var t=this.mesh.getComponentByEntity(e);t&&(t.children=[]);for(var n=0;n<this.hierarchy.getCount();){var r;if((null===(r=this.hierarchy.getComponent(n))||void 0===r?void 0:r.parentID)===e){var i=this.hierarchy.getEntity(n);this.detach(i)}else++n}}},{key:"setMeshAABBDirty",value:function(e){e&&(e.aabbDirty=!0)}}]),e}(),Np=Hl((Ip=Cp).prototype,"hierarchy",[wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp=Hl(Ip.prototype,"transform",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kp=Hl(Ip.prototype,"mesh",[Ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tp=Ip))||Tp);function Rp(){var e=new Nf(4);return Nf!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Pp(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function Gp(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=n[0],u=n[1],c=n[2],l=n[3];return e[0]=r*l+a*s+i*c-o*u,e[1]=i*l+a*u+o*s-r*c,e[2]=o*l+a*c+r*u-i*s,e[3]=a*l-r*s-i*u-o*c,e}function Lp(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=o*s,e}function Up(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var o=Math.sin(t),a=Math.cos(t),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),l=Math.cos(r);return e[0]=o*u*l-a*s*c,e[1]=a*s*l+o*u*c,e[2]=a*u*c-o*s*l,e[3]=a*u*l+o*s*c,e}var zp=kf,Bp=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},jp=Gp,Fp=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=r*a,e[2]=i*a,e[3]=o*a,e};Of(),Gf(1,0,0),Gf(0,1,0),Rp(),Rp(),Mf();var Vp=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(e){var t,n,o,a,s,u,c,l,f,d,h,p,g,v,m;return Fl(this,i),(t=r.call(this,e)).dirtyFlag=void 0,t.localDirtyFlag=void 0,t.parent=null,t.localPosition=Gf(0,0,0),t.localRotation=zp(0,0,0,1),t.localScale=Gf(1,1,1),t.localTransform=Qd(),t.position=Gf(0,0,0),t.rotation=zp(0,0,0,1),t.scaling=Gf(1,1,1),t.worldTransform=Qd(),t.matrixTransform=(n=Qd(),function(e){rh(n,t.getLocalTransform(),e),ah(t.localScale,n),oh(t.localPosition,n),sh(t.localRotation,n)}),t.rotateRollPitchYaw=(o=Rp(),a=Rp(),s=Rp(),function(e,n,r){t.setDirty(),Up(o,e,0,0),Up(a,0,n,0),Up(s,0,0,r),Gp(t.localRotation,o,t.localRotation),Gp(t.localRotation,t.localRotation,a),Gp(t.localRotation,s,t.localRotation),Fp(t.localRotation,t.localRotation)}),t.lerp=(u=Of(),c=Rp(),l=Of(),f=Of(),d=Rp(),h=Of(),function(e,n,r){t.setDirty(),ah(u,e.worldTransform),oh(l,e.worldTransform),sh(c,e.worldTransform),ah(f,n.worldTransform),oh(h,n.worldTransform),sh(d,n.worldTransform),Wf(t.localScale,u,f,r),function(e,t,n,r){var i,o,a,s,u,c=t[0],l=t[1],f=t[2],d=t[3],h=n[0],p=n[1],g=n[2],v=n[3];(o=c*h+l*p+f*g+d*v)<0&&(o=-o,h=-h,p=-p,g=-g,v=-v),1-o>If?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r),e[0]=s*c+u*h,e[1]=s*l+u*p,e[2]=s*f+u*g,e[3]=s*d+u*v}(t.localRotation,c,d,r),Wf(t.localPosition,l,h,r)}),t.translate=(m=Of(),function(e){return zf(m,t.getPosition(),e),t.setPosition(m),t.setDirty(!0),df(t)}),t.translateLocal=function(e){return function(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],c=t[2],l=i*c-o*u,f=o*s-r*c,d=r*u-i*s,h=i*d-o*f,p=o*l-r*d,g=r*f-i*l,v=2*a;l*=v,f*=v,d*=v,h*=2,p*=2,g*=2,e[0]=s+l+h,e[1]=u+f+p,e[2]=c+d+g}(e,e,t.localRotation),zf(t.localPosition,t.localPosition,e),t.setLocalDirty(!0),df(t)},t.setPosition=(p=Qd(),function(e){return t.position=e,t.setLocalDirty(!0),null===t.parent?Lf(t.localPosition,e):(eh(p,t.parent.worldTransform),nh(p,p),Hf(t.localPosition,e,p)),df(t)}),t.rotate=(g=Rp(),function(e){if(null===t.parent)Gp(t.localRotation,t.localRotation,e),Fp(t.localRotation,t.localRotation);else{var n=t.getRotation(),r=t.parent.getRotation();Bp(g,r),Lp(g,g),Gp(g,g,e),Gp(t.localRotation,e,n),Fp(t.localRotation,t.localRotation)}return t.setLocalDirty(),df(t)}),t.rotateLocal=function(e){return Gp(t.localRotation,t.localRotation,e),Fp(t.localRotation,t.localRotation),t.setLocalDirty(!0),df(t)},t.setRotation=(v=Rp(),function(e){return null===t.parent?Bp(t.localRotation,e):(Bp(v,t.parent.getRotation()),Lp(v,v),Bp(t.localRotation,v),jp(t.localRotation,t.localRotation,e)),t.setLocalDirty(!0),df(t)}),t}return Wl(i,[{key:"setLocalPosition",value:function(e){Lf(this.localPosition,e),this.setLocalDirty(!0)}},{key:"setLocalScale",value:function(e){Lf(this.localScale,e),this.setLocalDirty(!0)}},{key:"setLocalRotation",value:function(e){return Bp(this.localRotation,e),this.setLocalDirty(!0),this}},{key:"isDirty",value:function(){return this.dirtyFlag}},{key:"setDirty",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?this.dirtyFlag|=i.DIRTY:this.dirtyFlag&=~i.DIRTY}},{key:"isLocalDirty",value:function(){return this.localDirtyFlag}},{key:"setLocalDirty",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?(this.localDirtyFlag|=i.DIRTY,this.setDirty(!0)):this.localDirtyFlag&=~i.DIRTY}},{key:"updateTransform",value:function(){this.isLocalDirty()&&this.getLocalTransform(),this.isDirty()&&null===this.parent&&(eh(this.worldTransform,this.getLocalTransform()),this.setDirty(!1))}},{key:"updateTransformWithParent",value:function(e){rh(this.worldTransform,e.worldTransform,this.getLocalTransform())}},{key:"applyTransform",value:function(){this.setDirty(),ah(this.localScale,this.worldTransform),oh(this.localPosition,this.worldTransform),sh(this.localRotation,this.worldTransform)}},{key:"clearTransform",value:function(){this.setDirty(),this.localPosition=Gf(0,0,0),this.localRotation=zp(0,0,0,1),this.localScale=Gf(1,1,1)}},{key:"scaleLocal",value:function(e){return this.setLocalDirty(),t=this.localScale,n=this.localScale,r=e,t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],this;var t,n,r}},{key:"getLocalPosition",value:function(){return this.localPosition}},{key:"getLocalRotation",value:function(){return this.localRotation}},{key:"getLocalScale",value:function(){return this.localScale}},{key:"getLocalTransform",value:function(){return this.localDirtyFlag&&(function(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,c=o+o,l=a+a,f=i*u,d=i*c,h=i*l,p=o*c,g=o*l,v=a*l,m=s*u,y=s*c,b=s*l,E=r[0],_=r[1],x=r[2];e[0]=(1-(p+v))*E,e[1]=(d+b)*E,e[2]=(h-y)*E,e[3]=0,e[4]=(d-b)*_,e[5]=(1-(f+v))*_,e[6]=(g+m)*_,e[7]=0,e[8]=(h+y)*x,e[9]=(g-m)*x,e[10]=(1-(f+p))*x,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1}(this.localTransform,this.localRotation,this.localPosition,this.localScale),this.setLocalDirty(!1)),this.localTransform}},{key:"getWorldTransform",value:function(){return this.isLocalDirty()||this.isDirty()?(this.parent&&this.parent.getWorldTransform(),this.updateTransform(),this.worldTransform):this.worldTransform}},{key:"getPosition",value:function(){return oh(this.position,this.worldTransform),this.position}},{key:"getRotation",value:function(){return sh(this.rotation,this.worldTransform),this.rotation}},{key:"getScale",value:function(){return ah(this.scaling,this.worldTransform),this.scaling}}]),i}(Jl);Vp.DIRTY=1;var Wp,Hp,Xp,qp,Yp,Kp,$p=n(444),Zp=(Wp=(0,rf.b2)(),Hp=(0,rf.f3)(of.RenderEngine),Wp((Kp=function(){function e(){Fl(this,e),jl(this,"engine",Yp,this),this.resourcePool={}}return Wl(e,[{key:"getOrCreateResource",value:function(e){if(!this.resourcePool[e.name]){var t=e.descriptor,n=t.width,r=t.height,i=t.usage;this.resourcePool[e.name]=this.engine.createFramebuffer({color:this.engine.createTexture2D({width:n,height:r,wrapS:nd.CLAMP_TO_EDGE,wrapT:nd.CLAMP_TO_EDGE,usage:i})})}return this.resourcePool[e.name]}},{key:"clean",value:function(){this.resourcePool={}}}]),e}(),Yp=Hl((qp=Kp).prototype,"engine",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=qp))||Xp);var Jp,Qp,eg,tg,ng=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(e){var t;return Fl(this,i),(t=r.call(this,e)).name=void 0,t.name=e.name||"",t}return i}(Jl),rg=(0,rf.b2)()((Qp=function(){function e(){Fl(this,e),this.config=void 0}return Wl(e,[{key:"get",value:function(){return this.config}},{key:"set",value:function(e){this.config=e}}]),e}(),Jp=Qp))||Jp;!function(e){e.PANSTART="PANSTART",e.PANEND="PANEND",e.PANMOVE="PANMOVE",e.PINCH="PINCH",e.KEYDOWN="KEYDOWN",e.KEYUP="KEYUP",e.HOVER="HOVER"}(tg||(tg={}));var ig,og,ag=(0,rf.b2)()(eg=function(){function e(){Fl(this,e)}return Wl(e,[{key:"listen",value:function(e){}},{key:"on",value:function(e,t){}},{key:"connect",value:function(){}},{key:"disconnect",value:function(){}},{key:"destroy",value:function(){}}]),e}())||eg,sg=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function ug(e){var t={};return{content:e=e.replace(sg,(function(e,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(e,t){return e.push(Number(t.trim())),e}),[]):new Array(function(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16}return t}(n)).fill(0)}return t[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),uniforms:t}}function cg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cg(Object(n),!0).forEach((function(t){Tf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cg(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var fg=/precision\s+(high|low|medium)p\s+float/,dg=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,hg=(0,rf.b2)()((og=function(){function e(){Fl(this,e),this.moduleCache={},this.rawContentCache={}}return Wl(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\n\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\n\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  // compares only in highlight stage\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\n\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color) {\n  bool selected = bool(v_PickingResult.a);\n\n  if (selected) {\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(resultRGB, color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  return filterPickingColor(filterHighlightColor(color));\n}\n"}),this.registerModule("sdf2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}"})}},{key:"registerModule",value:function(e,t){if(!this.rawContentCache[e]){var n=t.vs,r=void 0===n?"":n,i=t.fs,o=void 0===i?"":i,a=t.uniforms,s=ug(r),u=s.content,c=s.uniforms,l=ug(o),f=l.content,d=l.uniforms;this.rawContentCache[e]={fs:f,uniforms:lg(lg(lg({},c),d),a),vs:u}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(e){var t=this;if(this.moduleCache[e])return this.moduleCache[e];var n,r=this.rawContentCache[e].vs||"",i=this.rawContentCache[e].fs||"",o=this.processModule(r,[],"vs"),a=o.content,s=o.includeList,u=this.processModule(i,[],"fs"),c=u.content,l=u.includeList,f=c,d=(n=s.concat(l).concat(e),n.filter((function(e,t,n){return n.indexOf(e)===t}))).reduce((function(e,n){return lg(lg({},e),t.rawContentCache[n].uniforms)}),{});return fg.test(c)||(f="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"+c),this.moduleCache[e]={fs:f.trim(),uniforms:d,vs:a.trim()},this.moduleCache[e]}},{key:"processModule",value:function(e,t,n){var r=this;return{content:e.replace(dg,(function(e,i){var o=i.split(" ")[0].replace(/"/g,"");if(t.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return t.push(o),r.processModule(a||"",t,n).content})),includeList:t}}}]),e}(),ig=og))||ig,pg=new rf.W2;function gg(){var e=new rf.W2;return e.parent=pg,e.bind(of.Systems).to(Op).inSingletonScope().whenTargetNamed(of.SceneGraphSystem),e.bind(of.Systems).to(Af).inSingletonScope().whenTargetNamed(of.FrameGraphSystem),e.bind(of.Systems).to(Jd).inSingletonScope().whenTargetNamed(of.MeshSystem),e.bind(of.Systems).to(dd).inSingletonScope().whenTargetNamed(of.GeometrySystem),e.bind(of.Systems).to(Dd).inSingletonScope().whenTargetNamed(of.MaterialSystem),e.bind(of.Systems).to(_p).inSingletonScope().whenTargetNamed(of.RendererSystem),e.bind(of.ResourcePool).to(Zp).inSingletonScope(),e.bind(of.ConfigService).to(rg).inSingletonScope(),e.bind(of.InteractorService).to(ag).inSingletonScope(),e.bind(of.RenderPass).to(Yh).inSingletonScope().whenTargetNamed(Yh.IDENTIFIER),e.bind(of.RenderPass).to(Ep).inSingletonScope().whenTargetNamed(Ep.IDENTIFIER),e.bind(of.RenderPass).to(bp).inSingletonScope().whenTargetNamed(bp.IDENTIFIER),e.bind(of.RenderPassFactory).toFactory((function(e){return function(t){return e.container.getNamed(of.RenderPass,t)}})),e}function vg(e){for(var t=new Cd,n=Gf(e[0],e[1],e[2]),r=Gf(e[0],e[1],e[2]),i=3;i<e.length;){var o=e[i++],a=e[i++],s=e[i++];o<n[0]&&(n[0]=o),a<n[1]&&(n[1]=a),s<n[2]&&(n[2]=s),o>r[0]&&(r[0]=o),a>r[1]&&(r[1]=a),s>r[2]&&(r[2]=s)}return t.setMinMax(n,r),t}(0,$p.Z)(pg,!1),pg.bind(of.ShaderModuleService).to(hg).inSingletonScope(),pg.bind(of.NameComponentManager).toConstantValue(new Ql(ng)),pg.bind(of.HierarchyComponentManager).toConstantValue(new Ql(Mp)),pg.bind(of.TransformComponentManager).toConstantValue(new Ql(Vp)),pg.bind(of.MeshComponentManager).toConstantValue(new Ql(Od)),pg.bind(of.CullableComponentManager).toConstantValue(new Ql(kd)),pg.bind(of.GeometryComponentManager).toConstantValue(new Ql(fd)),pg.bind(of.MaterialComponentManager).toConstantValue(new Ql(Ad));var mg,yg,bg,Eg,_g,xg="undefined"!=typeof navigator&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent);function wg(e){return"number"==typeof e}function Sg(e){return void 0===e?0:e>360||e<-360?e%360:e}function Ag(e,t,n){return wg(e)?Gf(e,t,n):3===e.length?Rf(e):Gf(e[0],e[1],e[2])}Of(),Of(),Of(),Of(),Of(),Of(),n(5359),n(6859),n(1252),n(6558),n(1847),n(6726),function(e){e.Normal="normal",e.PostProcessing="post-processing"}(mg||(mg={})),n(6495),n(9634),n(9220),n(1871),n(929),n(2163),function(e){e.Void="Void",e.Boolean="Boolean",e.Float="Float",e.Uint32="Uint32",e.Int32="Int32",e.Vector="Vector",e.Vector2Float="vec2<f32>",e.Vector3Float="vec3<f32>",e.Vector4Float="vec4<f32>",e.Vector2Boolean="vec2<bool>",e.Vector3Boolean="vec3<bool>",e.Vector4Boolean="vec4<bool>",e.Vector2Uint="vec2<u32>",e.Vector3Uint="vec3<u32>",e.Vector4Uint="vec4<u32>",e.Vector2Int="vec2<i32>",e.Vector3Int="vec3<i32>",e.Vector4Int="vec4<i32>",e.Matrix="Matrix",e.Matrix3x3Float="mat3x3<f32>",e.Matrix4x4Float="mat4x4<i32>",e.Struct="Struct",e.FloatArray="Float[]",e.Vector4FloatArray="vec4<f32>[]"}(yg||(yg={})),function(e){e.Program="Program",e.Identifier="Identifier",e.VariableDeclaration="VariableDeclaration",e.BlockStatement="BlockStatement",e.ReturnStatement="ReturnStatement",e.FunctionDeclaration="FunctionDeclaration",e.VariableDeclarator="VariableDeclarator",e.AssignmentExpression="AssignmentExpression",e.LogicalExpression="LogicalExpression",e.BinaryExpression="BinaryExpression",e.ArrayExpression="ArrayExpression",e.UnaryExpression="UnaryExpression",e.UpdateExpression="UpdateExpression",e.FunctionExpression="FunctionExpression",e.MemberExpression="MemberExpression",e.ConditionalExpression="ConditionalExpression",e.ExpressionStatement="ExpressionStatement",e.CallExpression="CallExpression",e.NumThreadStatement="NumThreadStatement",e.StorageStatement="StorageStatement",e.DoWhileStatement="DoWhileStatement",e.WhileStatement="WhileStatement",e.ForStatement="ForStatement",e.BreakStatement="BreakStatement",e.ContinueStatement="ContinueStatement",e.IfStatement="IfStatement",e.ImportedFunctionStatement="ImportedFunctionStatement"}(bg||(bg={})),function(e){e.Input="Input",e.Output="Output",e.Uniform="Uniform",e.Workgroup="Workgroup",e.UniformConstant="UniformConstant",e.Image="Image",e.StorageBuffer="StorageBuffer",e.Private="Private",e.Function="Function"}(Eg||(Eg={})),function(e){e.GLSL100="GLSL100",e.GLSL450="GLSL450",e.WGSL="WGSL"}(_g||(_g={}));var Tg,Ig,Ng,Dg,kg,Cg,Mg,Og,Rg,Pg,Gg=function(){function e(t,n){var r,i;Fl(this,e),this.name=void 0,this.matrix=void 0,this.right=void 0,this.up=void 0,this.forward=void 0,this.position=void 0,this.focalPoint=void 0,this.distanceVector=void 0,this.distance=void 0,this.dollyingStep=void 0,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.name=t,this.matrix=(r=n.matrix,(i=new Nf(16))[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i),this.right=Rf(n.right),this.up=Rf(n.up),this.forward=Rf(n.forward),this.position=Rf(n.position),this.focalPoint=Rf(n.focalPoint),this.distanceVector=Rf(n.distanceVector),this.azimuth=n.azimuth,this.elevation=n.elevation,this.roll=n.roll,this.relAzimuth=n.relAzimuth,this.relElevation=n.relElevation,this.relRoll=n.relRoll,this.dollyingStep=n.dollyingStep,this.distance=n.distance}return Wl(e,[{key:"getPosition",value:function(){return this.position}},{key:"getFocalPoint",value:function(){return this.focalPoint}},{key:"getRoll",value:function(){return this.roll}},{key:"retrieve",value:function(e){e.matrix=eh(e.matrix,this.matrix),e.right=Lf(e.right,this.right),e.up=Lf(e.up,this.up),e.forward=Lf(e.forward,this.forward),e.position=Lf(e.position,this.position),e.focalPoint=Lf(e.focalPoint,this.focalPoint),e.distanceVector=Lf(e.distanceVector,this.distanceVector),e.azimuth=this.azimuth,e.elevation=this.elevation,e.roll=this.roll,e.relAzimuth=this.relAzimuth,e.relElevation=this.relElevation,e.relRoll=this.relRoll,e.dollyingStep=this.dollyingStep,e.distance=this.distance}}]),e}();!function(e){e.ORBITING="ORBITING",e.EXPLORING="EXPLORING",e.TRACKING="TRACKING"}(Og||(Og={})),function(e){e.DEFAULT="DEFAULT",e.ROTATIONAL="ROTATIONAL",e.TRANSLATIONAL="TRANSLATIONAL",e.CINEMATIC="CINEMATIC"}(Rg||(Rg={})),function(e){e.ORTHOGRAPHIC="ORTHOGRAPHIC",e.PERSPECTIVE="PERSPECTIVE"}(Pg||(Pg={}));var Lg,Ug,zg,Bg,jg,Fg,Vg,Wg=Math.PI/180,Hg=180/Math.PI,Xg=(Tg=(0,rf.b2)(),Ig=(0,rf.f3)(of.InteractorService),Tg((Mg=Cg=function(){function e(){Fl(this,e),this.matrix=Qd(),this.right=Gf(1,0,0),this.up=Gf(0,1,0),this.forward=Gf(0,0,1),this.position=Gf(0,0,1),this.focalPoint=Gf(0,0,0),this.distanceVector=Gf(0,0,0),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.rotateWorld=!1,jl(this,"interactor",kg,this),this.fov=30,this.near=.1,this.far=1e4,this.aspect=1,this.left=void 0,this.rright=void 0,this.top=void 0,this.bottom=void 0,this.zoom=1,this.perspective=Qd(),this.view=void 0,this.following=void 0,this.type=Og.EXPLORING,this.trackingMode=Rg.DEFAULT,this.projectionMode=Pg.PERSPECTIVE,this.frustum=new Kd,this.landmarks=[],this.landmarkAnimationID=void 0}return Wl(e,[{key:"clone",value:function(){var t=new e;return t.setType(this.type,void 0),t.interactor=this.interactor,t}},{key:"getProjectionMode",value:function(){return this.projectionMode}},{key:"getPerspective",value:function(){return this.perspective}},{key:"getFrustum",value:function(){return this.frustum}},{key:"getPosition",value:function(){return this.position}},{key:"setType",value:function(e,t){return this.type=e,this.type===Og.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===Og.TRACKING&&void 0!==t&&this.setTrackingMode(t),this}},{key:"setProjectionMode",value:function(e){return this.projectionMode=e,this}},{key:"setTrackingMode",value:function(e){if(this.type!==Og.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=e,this}},{key:"setWorldRotation",value:function(e){this.rotateWorld=e,this._getAngles()}},{key:"getViewTransform",value:function(){return nh(Qd(),this.matrix)}},{key:"getWorldTransform",value:function(){return this.matrix}},{key:"setMatrix",value:function(e){return this.matrix=e,this._update(),this}},{key:"setAspect",value:function(e){return this.setPerspective(this.near,this.far,this.fov,e),this}},{key:"setViewOffset",value:function(e,t,n,r,i,o){return this.aspect=e/t,void 0===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.projectionMode===Pg.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"clearViewOffset",value:function(){return void 0!==this.view&&(this.view.enabled=!1),this.projectionMode===Pg.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"setPerspective",value:function(e,t,n,r){return this.projectionMode=Pg.PERSPECTIVE,this.fov=n,this.near=e,this.far=t,this.aspect=r,function(e,t,n,r,i){var o,a=1/Math.tan(t/2);e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r)}(this.perspective,this.fov*Wg,this.aspect,this.near,this.far),this}},{key:"setOrthographic",value:function(e,t,n,r,i,o){this.projectionMode=Pg.ORTHOGRAPHIC,this.rright=t,this.left=e,this.top=n,this.bottom=r,this.near=i,this.far=o;var a=(this.rright-this.left)/(2*this.zoom),s=(this.top-this.bottom)/(2*this.zoom),u=(this.rright+this.left)/2,c=(this.top+this.bottom)/2,l=u-a,f=u+a,d=c+s,h=c-s;if(void 0!==this.view&&this.view.enabled){var p=(this.rright-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;f=(l+=p*this.view.offsetX)+p*this.view.width,h=(d-=g*this.view.offsetY)-g*this.view.height}return function(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),c=1/(o-a);e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*c,e[15]=1}(this.perspective,l,f,d,h,i,o),this}},{key:"setPosition",value:function(e,t,n){return this._setPosition(e,t,n),this.setFocalPoint(this.focalPoint),this}},{key:"setFocalPoint",value:function(e,t,n){var r=Gf(0,1,0);if(this.focalPoint=Ag(e,t,n),this.trackingMode===Rg.CINEMATIC){var i=Bf(Of(),this.focalPoint,this.position);e=i[0],t=i[1],n=i[2];var o=Pf(i),a=Math.asin(t/o)*Hg,s=90+Math.atan2(n,e)*Hg,u=Qd();!function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],c=t[8],l=t[9],f=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*r,e[1]=a*i-l*r,e[2]=s*i-f*r,e[3]=u*i-d*r,e[8]=o*r+c*i,e[9]=a*r+l*i,e[10]=s*r+f*i,e[11]=u*r+d*i}(u,u,s*Wg),function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],d=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*r,e[5]=a*i+l*r,e[6]=s*i+f*r,e[7]=u*i+d*r,e[8]=c*i-o*r,e[9]=l*i-a*r,e[10]=f*i-s*r,e[11]=d*i-u*r}(u,u,a*Wg),r=Hf(Of(),[0,1,0],u)}return nh(this.matrix,function(e,t,n,r){var i,o,a,s,u,c,l,f,d,h,p=t[0],g=t[1],v=t[2],m=r[0],y=r[1],b=r[2],E=n[0],_=n[1],x=n[2];return Math.abs(p-E)<If&&Math.abs(g-_)<If&&Math.abs(v-x)<If?th(e):(l=p-E,f=g-_,d=v-x,i=y*(d*=h=1/Math.hypot(l,f,d))-b*(f*=h),o=b*(l*=h)-m*d,a=m*f-y*l,(h=Math.hypot(i,o,a))?(i*=h=1/h,o*=h,a*=h):(i=0,o=0,a=0),s=f*a-d*o,u=d*i-l*a,c=l*o-f*i,(h=Math.hypot(s,u,c))?(s*=h=1/h,u*=h,c*=h):(s=0,u=0,c=0),e[0]=i,e[1]=s,e[2]=l,e[3]=0,e[4]=o,e[5]=u,e[6]=f,e[7]=0,e[8]=a,e[9]=c,e[10]=d,e[11]=0,e[12]=-(i*p+o*g+a*v),e[13]=-(s*p+u*g+c*v),e[14]=-(l*p+f*g+d*v),e[15]=1,e)}(Qd(),this.position,this.focalPoint,r)),this._getAxes(),this._getDistance(),this._getAngles(),this}},{key:"setDistance",value:function(e){if(!(this.distance===e||e<0)){this.distance=e,this.distance<2e-4&&(this.distance=2e-4),this.dollyingStep=this.distance/100;var t=Of();e=this.distance;var n=this.forward,r=this.focalPoint;return t[0]=e*n[0]+r[0],t[1]=e*n[1]+r[1],t[2]=e*n[2]+r[2],this._setPosition(t),this}}},{key:"setMaxDistance",value:function(e){return this.maxDistance=e,this}},{key:"setMinDistance",value:function(e){return this.minDistance=e,this}},{key:"changeAzimuth",value:function(e){return this.setAzimuth(this.azimuth+e),this}},{key:"changeElevation",value:function(e){return this.setElevation(this.elevation+e),this}},{key:"changeRoll",value:function(e){return this.setRoll(this.roll+e),this}},{key:"setAzimuth",value:function(e){return this.azimuth=Sg(e),this.computeMatrix(),this._getAxes(),this.type===Og.ORBITING||this.type===Og.EXPLORING?this._getPosition():this.type===Og.TRACKING&&this._getFocalPoint(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(e){return this.elevation=Sg(e),this.computeMatrix(),this._getAxes(),this.type===Og.ORBITING||this.type===Og.EXPLORING?this._getPosition():this.type===Og.TRACKING&&this._getFocalPoint(),this}},{key:"setRoll",value:function(e){return this.roll=Sg(e),this.computeMatrix(),this._getAxes(),this.type===Og.ORBITING||this.type===Og.EXPLORING?this._getPosition():this.type===Og.TRACKING&&this._getFocalPoint(),this}},{key:"rotate",value:function(e,t,n){if(this.type===Og.EXPLORING){e=Sg(e),t=Sg(t),n=Sg(n);var r=Pp(Rp(),[1,0,0],(this.rotateWorld?1:-1)*t*Wg),i=Pp(Rp(),[0,1,0],(this.rotateWorld?1:-1)*e*Wg),o=Pp(Rp(),[0,0,1],n*Wg),a=Gp(Rp(),i,r);a=Gp(Rp(),a,o);var s=uh(Qd(),a);ih(this.matrix,this.matrix,[0,0,-this.distance]),rh(this.matrix,this.matrix,s),ih(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation+t)>90)return;this.relElevation=Sg(t),this.relAzimuth=Sg(e),this.relRoll=Sg(n),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.computeMatrix()}return this._getAxes(),this.type===Og.ORBITING||this.type===Og.EXPLORING?this._getPosition():this.type===Og.TRACKING&&this._getFocalPoint(),this._update(),this}},{key:"pan",value:function(e,t){var n=Ag(e,t,0),r=Rf(this.position);return zf(r,r,jf(Of(),this.right,n[0])),zf(r,r,jf(Of(),this.up,n[1])),this._setPosition(r),this}},{key:"dolly",value:function(e){var t=this.forward,n=Rf(this.position),r=this.dollyingStep,i=this.distance+e*this.dollyingStep;return r=Math.max(Math.min(i,this.maxDistance),this.minDistance)-this.distance,n[0]+=r*t[0],n[1]+=r*t[1],n[2]+=r*t[2],this._setPosition(n),this.type===Og.ORBITING||this.type===Og.EXPLORING?this._getDistance():this.type===Og.TRACKING&&zf(this.focalPoint,n,this.distanceVector),this}},{key:"createLandmark",value:function(e,t){var n=this.clone();n.setPosition(t.position),n.setFocalPoint(t.focalPoint),void 0!==t.roll&&n.setRoll(t.roll);var r=new Gg(e,n);return this.landmarks.push(r),r}},{key:"setLandmark",value:function(e){var t=new Gg(e,this);return this.landmarks.push(t),this}},{key:"gotoLandmark",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=this.landmarks.find((function(t){return t.name===e}));if(r){if(0===n)return void r.retrieve(this);void 0!==this.landmarkAnimationID&&window.cancelAnimationFrame(this.landmarkAnimationID),this.interactor.disconnect();var i,o=r.getPosition(),a=r.getFocalPoint(),s=r.getRoll(),u=function e(r){void 0===i&&(i=r);var u,c=r-i,l=(1-Math.cos(c/n*Math.PI))/2,f=Of(),d=Of();if(Wf(f,t.focalPoint,a,l),Wf(d,t.position,o,l),u=t.roll*(1-l)+s*l,t.setFocalPoint(f),t.setPosition(d),t.setRoll(u),t.computeMatrix(),!(Yf(f,a)+Yf(d,o)>.01))return t.setFocalPoint(f),t.setPosition(d),t.setRoll(u),t.computeMatrix(),void t.interactor.connect();c<n&&(t.landmarkAnimationID=window.requestAnimationFrame(e))};window.requestAnimationFrame(u)}}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles()}},{key:"computeMatrix",value:function(){var e,t,n=Pp(Rp(),[0,0,1],this.roll*Wg);th(this.matrix),e=Pp(Rp(),[1,0,0],(this.rotateWorld&&this.type!==Og.TRACKING||this.type===Og.TRACKING?1:-1)*this.elevation*Wg),t=Pp(Rp(),[0,1,0],(this.rotateWorld&&this.type!==Og.TRACKING||this.type===Og.TRACKING?1:-1)*this.azimuth*Wg);var r=Gp(Rp(),t,e);r=Gp(Rp(),r,n);var i=uh(Qd(),r);this.type===Og.ORBITING||this.type===Og.EXPLORING?(ih(this.matrix,this.matrix,this.focalPoint),rh(this.matrix,this.matrix,i),ih(this.matrix,this.matrix,[0,0,this.distance])):this.type===Og.TRACKING&&(ih(this.matrix,this.matrix,this.position),rh(this.matrix,this.matrix,i))}},{key:"_setPosition",value:function(e,t,n){this.position=Ag(e,t,n);var r=this.matrix;r[12]=this.position[0],r[13]=this.position[1],r[14]=this.position[2],r[15]=1}},{key:"_getAxes",value:function(){Lf(this.right,Ag(Cf(Df(),[1,0,0,0],this.matrix))),Lf(this.up,Ag(Cf(Df(),[0,1,0,0],this.matrix))),Lf(this.forward,Ag(Cf(Df(),[0,0,1,0],this.matrix))),Ff(this.right,this.right),Ff(this.up,this.up),Ff(this.forward,this.forward)}},{key:"_getAngles",value:function(){var e=this.distanceVector[0],t=this.distanceVector[1],n=this.distanceVector[2],r=Pf(this.distanceVector);if(0===r)return this.elevation=0,void(this.azimuth=0);this.type===Og.TRACKING||this.rotateWorld?(this.elevation=Math.asin(t/r)*Hg,this.azimuth=Math.atan2(-e,-n)*Hg):(this.elevation=-Math.asin(t/r)*Hg,this.azimuth=-Math.atan2(-e,-n)*Hg)}},{key:"_getPosition",value:function(){Lf(this.position,Ag(Cf(Df(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){var e,t;Xf(this.distanceVector,[0,0,-this.distance],(e=Mf(),t=this.matrix,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e)),zf(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=Bf(Of(),this.focalPoint,this.position),this.distance=Pf(this.distanceVector),this.dollyingStep=this.distance/100}}]),e}(),Cg.ProjectionMode={ORTHOGRAPHIC:"ORTHOGRAPHIC",PERSPECTIVE:"PERSPECTIVE"},kg=Hl((Dg=Mg).prototype,"interactor",[Ig],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ng=Dg))||Ng),qg=(Lg=(0,rf.b2)(),Ug=(0,rf.f3)(of.GeometryComponentManager),Lg((Vg=Fg=function(){function e(){Fl(this,e),this.config=void 0,jl(this,"geometry",jg,this),this.entity=void 0,this.component=void 0}return Wl(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(e){this.config=e}},{key:"setEntity",value:function(e){this.entity=e,this.component=this.geometry.create(e),this.component.entity=e,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),e}(),Fg.BOX="box",Fg.SPHERE="sphere",Fg.PLANE="plane",Fg.MERGED="merged",jg=Hl((Bg=Vg).prototype,"geometry",[Ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zg=Bg))||zg),Yg=n(5512);function Kg(){if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}var $g={}.toString;var Zg={};Zg["[object Float32Array]"]=Zg["[object Float64Array]"]=Zg["[object Int8Array]"]=Zg["[object Int16Array]"]=Zg["[object Int32Array]"]=Zg["[object Uint8Array]"]=Zg["[object Uint8ClampedArray]"]=Zg["[object Uint16Array]"]=Zg["[object Uint32Array]"]=!0,Zg["[object Arguments]"]=Zg["[object Array]"]=Zg["[object ArrayBuffer]"]=Zg["[object Boolean]"]=Zg["[object DataView]"]=Zg["[object Date]"]=Zg["[object Error]"]=Zg["[object Function]"]=Zg["[object Map]"]=Zg["[object Number]"]=Zg["[object Object]"]=Zg["[object RegExp]"]=Zg["[object Set]"]=Zg["[object String]"]=Zg["[object WeakMap]"]=!1;var Jg,Qg,ev,tv,nv,rv,iv,ov,av=Object.prototype.toString,sv=function(e){return function(e){return!!e&&"object"===ff(e)}(e)&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!!Zg[av.call(e)]};function uv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uv(Object(n),!0).forEach((function(t){Tf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uv(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var lv,fv,dv,hv,pv,gv,vv,mv,yv,bv,Ev,_v,xv,wv,Sv,Av,Tv,Iv,Nv,Dv,kv,Cv,Mv,Ov,Rv,Pv,Gv,Lv,Uv,zv,Bv,jv,Fv,Vv,Wv,Hv=(Jg=(0,rf.b2)(),Qg=(0,rf.f3)(of.RenderEngine),ev=(0,rf.f3)(of.ConfigService),Jg((ov=function(){function e(){Fl(this,e),jl(this,"engine",rv,this),jl(this,"configService",iv,this),this.entity=Zl(),this.model=void 0,this.dirty=!0,this.compiledBundle=void 0,this.initPromise=void 0}var t,n,r;return Wl(e,[{key:"init",value:function(){var e=this.configService.get(),t=e.canvas,n=e.engineOptions;this.initPromise=this.engine.init(cv({canvas:t||Kg(),swapChainFormat:Yg.EV.BGRA8Unorm,antialiasing:!1},n))}},{key:"setBundle",value:function(e){this.compiledBundle=JSON.parse(JSON.stringify(e))}},{key:"setDispatch",value:function(e){return this.compiledBundle.context&&(this.compiledBundle.context.dispatch=e),this}},{key:"setMaxIteration",value:function(e){return this.compiledBundle.context&&(this.compiledBundle.context.maxIteration=e),this}},{key:"setBinding",value:function(e,t){var n,r=this;if("string"==typeof e){var i=wg(t)||sv(t)||(n=t,Array.isArray?Array.isArray(n):function(e,t){return $g.call(e)==="[object "+t+"]"}(n,"Array"));if(this.compiledBundle&&this.compiledBundle.context){var o=this.compiledBundle.context.defines.find((function(t){return t.name===e}));if(o)return o.value=t,this;var a=this.compiledBundle.context.uniforms.find((function(t){return t.name===e}));a&&(i?(a.data=t,a.isReferer=!1,a.storageClass===Eg.Uniform?this.model&&this.model.updateUniform(e,t):this.model&&this.model.updateBuffer(e,t)):(a.isReferer=!0,a.data=t))}}else Object.keys(e).forEach((function(t){r.setBinding(t,e[t])}));return this}},{key:"execute",value:(r=Kl(ql().mark((function e(){var t,n,r=this,i=arguments;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:1,!this.dirty){e.next=6;break}return this.compiledBundle.context&&(t>1?this.compiledBundle.context.maxIteration=t:this.compiledBundle.context.maxIteration++),e.next=5,this.compile();case 5:this.dirty=!1;case 6:for(this.engine.beginFrame(),this.engine.clear({}),this.compiledBundle.context&&this.compiledBundle.context.uniforms.filter((function(e){return e.isReferer})).forEach((function(e){var t=e.data,n=e.name;r.model.confirmInput(t.model,n)})),n=0;n<t;n++)this.model.run();return this.engine.endFrame(),e.abrupt("return",this);case 12:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getOutput",value:(n=Kl(ql().mark((function e(){return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.readData());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"compile",value:(t=Kl(ql().mark((function e(){var t,n,r;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initPromise;case 2:return t=cv({},this.compiledBundle.context),n=this.engine.supportWebGPU?this.engine.useWGSL?_g.WGSL:_g.GLSL450:_g.GLSL100,r=this.compiledBundle.shaders[n],t.defines.filter((function(e){return e.runtime})).forEach((function(e){var t="".concat("__DefineValuePlaceholder__").concat(e.name);r=r.replace(t,"".concat(e.value))})),t.shader=r,t.uniforms.forEach((function(e){if(!e.data&&e.storageClass===Eg.StorageBuffer){var n=1;e.type===yg.FloatArray?n=1:e.type===yg.Vector4FloatArray&&(n=4),e.data=new Float32Array(t.output.length*n).fill(0)}})),this.compiledBundle.context=t,e.next=11,this.engine.createComputeModel(this.compiledBundle.context);case 11:this.model=e.sent;case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),rv=Hl((nv=ov).prototype,"engine",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv=Hl(nv.prototype,"configService",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tv=nv))||tv),Xv=(lv=(0,rf.b2)(),fv=(0,rf.f3)(of.MaterialComponentManager),lv((vv=gv=function(){function e(){Fl(this,e),this.config=void 0,jl(this,"material",pv,this),this.entity=void 0,this.component=void 0}return Wl(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(e){this.config=e}},{key:"setEntity",value:function(e,t){this.entity=e,this.component=this.material.create(e),this.component.entity=e,this.component.type=t,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),e}(),gv.BASIC="basic",pv=Hl((hv=vv).prototype,"material",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dv=hv))||dv),qv=(mv=(0,rf.b2)(),yv=(0,rf.f3)(of.MeshComponentManager),bv=(0,rf.f3)(of.CullableComponentManager),Ev=(0,rf.f3)(of.TransformComponentManager),_v=(0,rf.f3)(of.Systems),xv=(0,rf.t6)(of.SceneGraphSystem),mv((kv=Dv=function(){function e(){Fl(this,e),this.attributes={},this.config=void 0,jl(this,"mesh",Av,this),jl(this,"cullable",Tv,this),jl(this,"transform",Iv,this),jl(this,"sceneGraphSystem",Nv,this),this.meshComponent=void 0,this.transformComponent=void 0,this.entity=void 0}return Wl(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getTransformComponent",value:function(){return this.transformComponent}},{key:"getMeshComponent",value:function(){return this.meshComponent}},{key:"setConfig",value:function(e){this.config=e}},{key:"setEntity",value:function(e){this.entity=e,this.cullable.create(e),this.meshComponent=this.mesh.create(e),this.transformComponent=this.transform.create(e),this.onEntityCreated()}},{key:"setMaterial",value:function(e){return this.meshComponent.material=e,this}},{key:"setGeometry",value:function(e){return this.meshComponent.geometry=e,this}},{key:"setAttributes",value:function(e){var t=this;Object.keys(e).forEach((function(n){void 0!==e[n]&&e[n]!==t.attributes[n]&&(t.onAttributeChanged({name:n,data:e[n]}),t.attributes[n]=e[n])}))}},{key:"setVisible",value:function(e){var t=this;return this.meshComponent.visible=e,this.meshComponent.children.forEach((function(n){var r=t.mesh.getComponentByEntity(n);r&&(r.visible=e)})),this}},{key:"isVisible",value:function(){return this.meshComponent.visible}},{key:"attach",value:function(e){return this.sceneGraphSystem.attach(this.entity,e.entity),this}},{key:"detach",value:function(){return this.sceneGraphSystem.detach(this.entity),this}},{key:"detachChildren",value:function(){return this.sceneGraphSystem.detachChildren(this.entity),this}},{key:"onEntityCreated",value:function(){}},{key:"onAttributeChanged",value:function(e){var t=e.name,n=e.data;this.meshComponent&&this.meshComponent.material&&this.meshComponent.material.setUniform(this.convertAttributeName2UniformName(t),n)}},{key:"convertAttributeName2UniformName",value:function(e){return e}}]),e}(),Dv.POINT="point",Dv.LINE="line",Dv.GRID="grid",Av=Hl((Sv=kv).prototype,"mesh",[yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv=Hl(Sv.prototype,"cullable",[bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv=Hl(Sv.prototype,"transform",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv=Hl(Sv.prototype,"sceneGraphSystem",[_v,xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wv=Sv))||wv),Yv=n(1459),Kv=n.n(Yv),$v=function(){function e(t,n){Fl(this,e),this.attribute=void 0,this.buffer=void 0;var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return Wl(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Zv=(Tf(Cv={},nd.POINTS,"points"),Tf(Cv,nd.LINES,"lines"),Tf(Cv,nd.LINE_LOOP,"line loop"),Tf(Cv,nd.LINE_STRIP,"line strip"),Tf(Cv,nd.TRIANGLES,"triangles"),Tf(Cv,nd.TRIANGLE_FAN,"triangle fan"),Tf(Cv,nd.TRIANGLE_STRIP,"triangle strip"),Cv),Jv=(Tf(Mv={},nd.STATIC_DRAW,"static"),Tf(Mv,nd.DYNAMIC_DRAW,"dynamic"),Tf(Mv,nd.STREAM_DRAW,"stream"),Mv),Qv=(Tf(Ov={},nd.BYTE,"int8"),Tf(Ov,nd.UNSIGNED_INT,"int16"),Tf(Ov,nd.INT,"int32"),Tf(Ov,nd.UNSIGNED_BYTE,"uint8"),Tf(Ov,nd.UNSIGNED_SHORT,"uint16"),Tf(Ov,nd.UNSIGNED_INT,"uint32"),Tf(Ov,nd.FLOAT,"float"),Ov),em=(Tf(Rv={},nd.ALPHA,"alpha"),Tf(Rv,nd.LUMINANCE,"luminance"),Tf(Rv,nd.LUMINANCE_ALPHA,"luminance alpha"),Tf(Rv,nd.RGB,"rgb"),Tf(Rv,nd.RGBA,"rgba"),Tf(Rv,nd.RGBA4,"rgba4"),Tf(Rv,nd.RGB5_A1,"rgb5 a1"),Tf(Rv,nd.RGB565,"rgb565"),Tf(Rv,nd.DEPTH_COMPONENT,"depth"),Tf(Rv,nd.DEPTH_STENCIL,"depth stencil"),Rv),tm=(Tf(Pv={},nd.DONT_CARE,"dont care"),Tf(Pv,nd.NICEST,"nice"),Tf(Pv,nd.FASTEST,"fast"),Pv),nm=(Tf(Gv={},nd.NEAREST,"nearest"),Tf(Gv,nd.LINEAR,"linear"),Tf(Gv,nd.LINEAR_MIPMAP_LINEAR,"mipmap"),Tf(Gv,nd.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),Tf(Gv,nd.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),Tf(Gv,nd.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Gv),rm=(Tf(Lv={},nd.REPEAT,"repeat"),Tf(Lv,nd.CLAMP_TO_EDGE,"clamp"),Tf(Lv,nd.MIRRORED_REPEAT,"mirror"),Lv),im=(Tf(Uv={},nd.NONE,"none"),Tf(Uv,nd.BROWSER_DEFAULT_WEBGL,"browser"),Uv),om=(Tf(zv={},nd.NEVER,"never"),Tf(zv,nd.ALWAYS,"always"),Tf(zv,nd.LESS,"less"),Tf(zv,nd.LEQUAL,"lequal"),Tf(zv,nd.GREATER,"greater"),Tf(zv,nd.GEQUAL,"gequal"),Tf(zv,nd.EQUAL,"equal"),Tf(zv,nd.NOTEQUAL,"notequal"),zv),am=(Tf(Bv={},nd.FUNC_ADD,"add"),Tf(Bv,nd.MIN_EXT,"min"),Tf(Bv,nd.MAX_EXT,"max"),Tf(Bv,nd.FUNC_SUBTRACT,"subtract"),Tf(Bv,nd.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Bv),sm=(Tf(jv={},nd.ZERO,"zero"),Tf(jv,nd.ONE,"one"),Tf(jv,nd.SRC_COLOR,"src color"),Tf(jv,nd.ONE_MINUS_SRC_COLOR,"one minus src color"),Tf(jv,nd.SRC_ALPHA,"src alpha"),Tf(jv,nd.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),Tf(jv,nd.DST_COLOR,"dst color"),Tf(jv,nd.ONE_MINUS_DST_COLOR,"one minus dst color"),Tf(jv,nd.DST_ALPHA,"dst alpha"),Tf(jv,nd.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),Tf(jv,nd.CONSTANT_COLOR,"constant color"),Tf(jv,nd.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),Tf(jv,nd.CONSTANT_ALPHA,"constant alpha"),Tf(jv,nd.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),Tf(jv,nd.SRC_ALPHA_SATURATE,"src alpha saturate"),jv),um=(Tf(Fv={},nd.NEVER,"never"),Tf(Fv,nd.ALWAYS,"always"),Tf(Fv,nd.LESS,"less"),Tf(Fv,nd.LEQUAL,"lequal"),Tf(Fv,nd.GREATER,"greater"),Tf(Fv,nd.GEQUAL,"gequal"),Tf(Fv,nd.EQUAL,"equal"),Tf(Fv,nd.NOTEQUAL,"notequal"),Fv),cm=(Tf(Vv={},nd.ZERO,"zero"),Tf(Vv,nd.KEEP,"keep"),Tf(Vv,nd.REPLACE,"replace"),Tf(Vv,nd.INVERT,"invert"),Tf(Vv,nd.INCR,"increment"),Tf(Vv,nd.DECR,"decrement"),Tf(Vv,nd.INCR_WRAP,"increment wrap"),Tf(Vv,nd.DECR_WRAP,"decrement wrap"),Vv),lm=(Tf(Wv={},nd.FRONT,"front"),Tf(Wv,nd.BACK,"back"),Wv),fm=function(){function e(t,n){Fl(this,e),this.buffer=void 0;var r=n.data,i=n.usage,o=n.type;this.buffer=t.buffer({data:r,usage:Jv[i||nd.STATIC_DRAW],type:Qv[o||nd.UNSIGNED_BYTE]})}return Wl(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}]),e}();function dm(e){return function(e){if(Array.isArray(e))return ef(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||tf(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var hm={};hm["[object Float32Array]"]=hm["[object Float64Array]"]=hm["[object Int8Array]"]=hm["[object Int16Array]"]=hm["[object Int32Array]"]=hm["[object Uint8Array]"]=hm["[object Uint8ClampedArray]"]=hm["[object Uint16Array]"]=hm["[object Uint32Array]"]=!0,hm["[object Arguments]"]=hm["[object Array]"]=hm["[object ArrayBuffer]"]=hm["[object Boolean]"]=hm["[object DataView]"]=hm["[object Date]"]=hm["[object Error]"]=hm["[object Function]"]=hm["[object Map]"]=hm["[object Number]"]=hm["[object Object]"]=hm["[object RegExp]"]=hm["[object Set]"]=hm["[object String]"]=hm["[object WeakMap]"]=!1;var pm=Object.prototype.toString,gm=function(e){return function(e){return!!e&&"object"===ff(e)}(e)&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!!hm[pm.call(e)]};function vm(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vm(Object(n),!0).forEach((function(t){Tf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vm(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ym=0,bm=function(){function e(t,n){var r=this;Fl(this,e),this.reGl=t,this.context=n,this.entity=Zl(),this.texFBO=void 0,this.computeCommand=void 0,this.textureCache={},this.outputTextureName=void 0,this.swapOutputTextureName=void 0,this.compiledPingpong=void 0,this.dynamicPingpong=void 0;var i={};this.context.uniforms.forEach((function(e){var t=e.name,n=e.type,o=e.data,a=e.isReferer,s=e.storageClass;if(s===Eg.StorageBuffer){if(a)r.textureCache[t]={data:void 0},i["".concat(t,"Size")]=function(){return o.compiledBundle.context.output.textureSize};else{r.textureCache[t]=r.calcDataTexture(t,n,o);var u=r.textureCache[t],c=u.textureWidth,l=u.isOutput;i["".concat(t,"Size")]=[c,c],l&&(r.outputTextureName=t,r.context.needPingpong&&(r.outputTextureName="".concat(t,"Output"),r.textureCache[r.outputTextureName]=r.calcDataTexture(t,n,o)))}i[t]=function(){return r.textureCache[t].texture}}else if(s===Eg.Uniform){if(o&&(Array.isArray(o)||gm(o))&&o.length>16)throw new Error("invalid data type ".concat(n));i[t]=function(){return e.data}}}));var o=this.getOuputDataTexture(),a=o.textureWidth,s=o.texelCount;i.u_OutputTextureSize=[a,a],i.u_OutputTexelCount=s,this.context.output.textureSize=[a,a];var u={attributes:{a_Position:[[-1,1,0],[-1,-1,0],[1,1,0],[1,-1,0]],a_TexCoord:[[0,1],[0,0],[1,1],[1,0]]},frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n".concat(this.context.shader),uniforms:i,vert:"attribute vec3 a_Position;\nattribute vec2 a_TexCoord;\n\nvarying vec2 v_TexCoord;\n\nvoid main() {\n  gl_Position = vec4(a_Position, 1.0);\n  v_TexCoord = a_TexCoord;\n}",primitive:"triangle strip",count:4};this.computeCommand=this.reGl(u)}var t;return Wl(e,[{key:"run",value:function(){var e=this;this.context.maxIteration>1&&this.context.needPingpong&&(this.compiledPingpong=!0),(this.compiledPingpong||this.dynamicPingpong)&&this.swap(),this.texFBO=this.reGl.framebuffer({color:this.getOuputDataTexture().texture}),this.texFBO.use((function(){e.computeCommand()}))}},{key:"readData",value:(t=Kl(ql().mark((function e(){var t,n,r,i,o,a,s,u,c=this;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reGl({framebuffer:this.texFBO})((function(){t=c.reGl.read()})),!t){e.next=6;break}if(n=this.getOuputDataTexture(),r=n.originalDataLength,i=n.elementsPerTexel,o=n.typedArrayConstructor,a=void 0===o?Float32Array:o,s=[],4!==i)for(u=0;u<t.length;u+=4)1===i?s.push(t[u]):2===i?s.push(t[u],t[u+1]):s.push(t[u],t[u+1],t[u+2]);else s=t;return e.abrupt("return",new a(s.slice(0,r)));case 6:return e.abrupt("return",new Float32Array);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"confirmInput",value:function(e,t){var n;this.entity===e.entity?(this.dynamicPingpong=!0,n=this):n=e,this.textureCache[t].id=n.getOuputDataTexture().id,this.textureCache[t].texture=n.getOuputDataTexture().texture}},{key:"updateUniform",value:function(){}},{key:"updateBuffer",value:function(e,t){var n=this.context.uniforms.find((function(t){return t.name===e}));if(n){var r=this.calcDataTexture(e,n.type,t),i=r.texture,o=r.data;this.textureCache[e].data=o,this.textureCache[e].texture=i}}},{key:"destroy",value:function(){}},{key:"swap",value:function(){if(this.swapOutputTextureName||this.createSwapOutputDataTexture(),this.compiledPingpong){var e=this.context.output.name;this.textureCache[e].id=this.getOuputDataTexture().id,this.textureCache[e].texture=this.getOuputDataTexture().texture}var t=this.outputTextureName;this.outputTextureName=this.swapOutputTextureName,this.swapOutputTextureName=t}},{key:"getOuputDataTexture",value:function(){return this.textureCache[this.outputTextureName]}},{key:"createSwapOutputDataTexture",value:function(){var e=this.cloneDataTexture(this.getOuputDataTexture());this.swapOutputTextureName="".concat(this.entity,"-swap"),this.textureCache[this.swapOutputTextureName]=e}},{key:"cloneDataTexture",value:function(e){var t=e.data,n=e.textureWidth;return mm(mm({},e),{},{id:ym++,texture:this.reGl.texture({width:n,height:n,data:t,type:"float"})})}},{key:"calcDataTexture",value:function(e,t,n){var r=1;t===yg.Vector4FloatArray&&(r=4);for(var i=[],o=0;o<n.length;o+=r)1===r?i.push(n[o],0,0,0):2===r?i.push(n[o],n[o+1],0,0):3===r?i.push(n[o],n[o+1],n[o+2],0):4===r&&i.push(n[o],n[o+1],n[o+2],n[o+3]);var a=n.length,s=Math.ceil(a/r),u=Math.ceil(Math.sqrt(s)),c=u*u;s<c&&i.push.apply(i,dm(new Array(4*(c-s)).fill(0)));var l=this.reGl.texture({width:u,height:u,data:i,type:"float"});return{id:ym++,data:i,originalDataLength:a,typedArrayConstructor:gm(n)?n.constructor:void 0,textureWidth:u,texture:l,texelCount:s,elementsPerTexel:r,isOutput:e===this.context.output.name}}}]),e}(),Em=function(){function e(t,n){Fl(this,e),this.elements=void 0;var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=t.elements({data:r,usage:Jv[i||nd.STATIC_DRAW],type:Qv[o||nd.UNSIGNED_BYTE],count:a})}return Wl(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){this.elements.destroy()}}]),e}(),_m=function(){function e(t,n){Fl(this,e),this.framebuffer=void 0;var r=n.width,i=n.height,o=n.color,a=n.colors,s=(n.depth,n.stencil,{width:r,height:i});Array.isArray(a)&&(s.colors=a.map((function(e){return e.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=t.framebuffer(s)}return Wl(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}]),e}();function xm(e){var t={};return Object.keys(e).forEach((function(n){wm(n,e[n],t,"")})),t}function wm(e,t,n,r){var i,o;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||gm(t)||""===t||void 0!==t.resize?n["".concat(r&&r+".").concat(e)]=t:(o=ff(i=t),null==i||"object"!==o&&"function"!==o||Object.keys(t).forEach((function(i){wm(i,t[i],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,i){Object.keys(t).forEach((function(o){wm(o,t[o],n,"".concat(r&&r+".").concat(e,"[").concat(i,"]"))}))})))}function Sm(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Am(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sm(Object(n),!0).forEach((function(t){Tf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sm(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Tm,Im,Nm,Dm=function(){function e(t,n){Fl(this,e),this.reGl=void 0,this.drawCommand=void 0,this.uniforms={},this.reGl=t;var r=n.vs,i=n.fs,o=n.defines,a=n.attributes,s=n.uniforms,u=n.primitive,c=n.count,l=n.elements,f=n.depth,d=n.blend,h=n.stencil,p=n.cull,g=n.instances,v=n.scissor,m=n.viewport,y={};s&&(this.uniforms=xm(s),Object.keys(s).forEach((function(e){y[e]=t.prop(e)})));var b={};Object.keys(a).forEach((function(e){b[e]=a[e].get()}));var E=o&&this.generateDefines(o)||"",_={attributes:b,frag:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n".concat(E,"\n").concat(i),uniforms:y,vert:"\n".concat(E,"\n").concat(r),primitive:Zv[void 0===u?nd.TRIANGLES:u]};g&&(_.instances=g),c&&(_.count=c),l&&(_.elements=l.get()),v&&(_.scissor=v),m&&(_.viewport=m),this.initDepthDrawParams({depth:f},_),this.initBlendDrawParams({blend:d},_),this.initStencilDrawParams({stencil:h},_),this.initCullDrawParams({cull:p},_),this.drawCommand=t(_)}return Wl(e,[{key:"addUniforms",value:function(e){this.uniforms=Am(Am({},this.uniforms),xm(e))}},{key:"draw",value:function(e){var t=Am(Am({},this.uniforms),xm(e.uniforms||{})),n={};Object.keys(t).forEach((function(e){var r=ff(t[e]);"boolean"===r||"number"===r||Array.isArray(t[e])||t[e].BYTES_PER_ELEMENT?n[e]=t[e]:"string"===r||(n[e]=t[e].get())})),this.drawCommand(n)}},{key:"destroy",value:function(){}},{key:"initDepthDrawParams",value:function(e,t){var n=e.depth;n&&(t.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:om[n.func||nd.LESS],range:n.range||[0,1]})}},{key:"initBlendDrawParams",value:function(e,t){var n=e.blend;if(n){var r=n.enable,i=n.func,o=n.equation,a=n.color,s=void 0===a?[0,0,0,0]:a;t.blend={enable:!!r,func:{srcRGB:sm[i&&i.srcRGB||nd.SRC_ALPHA],srcAlpha:sm[i&&i.srcAlpha||nd.SRC_ALPHA],dstRGB:sm[i&&i.dstRGB||nd.ONE_MINUS_SRC_ALPHA],dstAlpha:sm[i&&i.dstAlpha||nd.ONE_MINUS_SRC_ALPHA]},equation:{rgb:am[o&&o.rgb||nd.FUNC_ADD],alpha:am[o&&o.alpha||nd.FUNC_ADD]},color:s}}}},{key:"initStencilDrawParams",value:function(e,t){var n=e.stencil;if(n){var r=n.enable,i=n.mask,o=void 0===i?-1:i,a=n.func,s=void 0===a?{cmp:nd.ALWAYS,ref:0,mask:-1}:a,u=n.opFront,c=void 0===u?{fail:nd.KEEP,zfail:nd.KEEP,zpass:nd.KEEP}:u,l=n.opBack,f=void 0===l?{fail:nd.KEEP,zfail:nd.KEEP,zpass:nd.KEEP}:l;t.stencil={enable:!!r,mask:o,func:Am(Am({},s),{},{cmp:um[s.cmp]}),opFront:{fail:cm[c.fail],zfail:cm[c.zfail],zpass:cm[c.zpass]},opBack:{fail:cm[f.fail],zfail:cm[f.zfail],zpass:cm[f.zpass]}}}}},{key:"initCullDrawParams",value:function(e,t){var n=e.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?nd.BACK:i;t.cull={enable:!!r,face:lm[o]}}}},{key:"generateDefines",value:function(e){return Object.keys(e).map((function(t){return"#define ".concat(t," ").concat(Number(e[t]))})).join("\n")}}]),e}(),km=function(){function e(t,n){Fl(this,e),this.texture=void 0,this.width=void 0,this.height=void 0;var r=n.data,i=n.type,o=void 0===i?nd.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,c=void 0!==u&&u,l=n.format,f=void 0===l?nd.RGBA:l,d=n.mipmap,h=void 0!==d&&d,p=n.wrapS,g=void 0===p?nd.CLAMP_TO_EDGE:p,v=n.wrapT,m=void 0===v?nd.CLAMP_TO_EDGE:v,y=n.aniso,b=void 0===y?0:y,E=n.alignment,_=void 0===E?1:E,x=n.premultiplyAlpha,w=void 0!==x&&x,S=n.mag,A=void 0===S?nd.NEAREST:S,T=n.min,I=void 0===T?nd.NEAREST:T,N=n.colorSpace,D=void 0===N?nd.BROWSER_DEFAULT_WEBGL:N;this.width=a,this.height=s;var k={width:a,height:s,type:Qv[o],format:em[f],wrapS:rm[g],wrapT:rm[m],mag:nm[A],min:nm[I],alignment:_,flipY:c,colorSpace:im[D],premultiplyAlpha:w,aniso:b};r&&(k.data=r),"number"==typeof h?k.mipmap=tm[h]:"boolean"==typeof h&&(k.mipmap=h),this.texture=t.texture(k)}return Wl(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"destroy",value:function(){this.texture.destroy()}}]),e}(),Cm=(0,rf.b2)()((Im=function(){function e(){var t=this;Fl(this,e),this.supportWebGPU=!1,this.useWGSL=!1,this.$canvas=void 0,this.gl=void 0,this.inited=void 0,this.createModel=function(){var e=Kl(ql().mark((function e(n){return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.uniforms){e.next=3;break}return e.next=3,Promise.all(Object.keys(n.uniforms).map(function(){var e=Kl(ql().mark((function e(t){var r;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.uniforms[t]||void 0===n.uniforms[t].load){e.next=5;break}return e.next=3,n.uniforms[t].load();case 3:r=e.sent,n.uniforms[t]=r;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",new Dm(t.gl,n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createAttribute=function(e){return new $v(t.gl,e)},this.createBuffer=function(e){return new fm(t.gl,e)},this.createElements=function(e){return new Em(t.gl,e)},this.createTexture2D=function(e){return new km(t.gl,e)},this.createFramebuffer=function(e){return new _m(t.gl,e)},this.useFramebuffer=function(e,n){t.gl({framebuffer:e?e.get():null})(n)},this.createComputeModel=function(){var e=Kl(ql().mark((function e(n){return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new bm(t.gl,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.clear=function(e){var n=e.color,r=e.depth,i=e.stencil,o=e.framebuffer,a=void 0===o?null:o,s={color:n,depth:r,stencil:i};s.framebuffer=null===a?a:a.get(),t.gl.clear(s)},this.setScissor=function(e){t.gl&&t.gl._gl&&(e.enable&&e.box?(t.gl._gl.enable(nd.SCISSOR_TEST),t.gl._gl.scissor(e.box.x,e.box.y,e.box.width,e.box.height)):t.gl._gl.disable(nd.SCISSOR_TEST),t.gl._refresh())},this.viewport=function(e){var n=e.x,r=e.y,i=e.width,o=e.height;t.gl&&t.gl._gl&&(t.gl._gl.viewport(n,r,i,o),t.gl._refresh())},this.readPixels=function(e){var n=e.framebuffer,r={x:e.x,y:e.y,width:e.width,height:e.height};return n&&(r.framebuffer=n.get()),t.gl.read(r)},this.getCanvas=function(){return t.$canvas},this.getGLContext=function(){return t.gl._gl},this.destroy=function(){t.gl&&(t.gl.destroy(),t.inited=!1)}}var t;return Wl(e,[{key:"init",value:(t=Kl(ql().mark((function e(t){return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.inited){e.next=2;break}return e.abrupt("return");case 2:return this.$canvas=t.canvas,e.next=5,new Promise((function(e,n){Kv()({canvas:t.canvas,attributes:{alpha:!0,antialias:t.antialias,premultipliedAlpha:!0},pixelRatio:1,extensions:["OES_element_index_uint","OES_texture_float","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(t,r){!t&&r||n(t),e(r)}})}));case 5:this.gl=e.sent,this.inited=!0;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"isFloatSupported",value:function(){return this.gl.limits.readFloat}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}(),Tm=Im))||Tm;function Mm(e,t){return new Promise((function(t,n){!function(e,t,n,r){if("undefined"!=typeof window){var i=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",e),r&&(o.id=r),o.onload=function(){t&&t()},o.onerror=function(t){n&&n("Unable to load script '".concat(e,"'"),t)},i.appendChild(o)}}(e,(function(){t()}),(function(e,t){n(t)}))}))}function Om(){return Rm.apply(this,arguments)}function Rm(){return(Rm=Kl(ql().mark((function e(){return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Nm){e.next=2;break}return e.abrupt("return",Nm);case 2:return e.next=4,Mm("https://preview.babylonjs.com/glslang/glslang.js");case 4:return Nm=window.glslang("https://preview.babylonjs.com/glslang/glslang.wasm"),e.abrupt("return",Nm);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pm,Gm,Lm,Um,zm,Bm,jm,Fm=function(){function e(t,n){Fl(this,e),this.engine=t,this.options=n,this.attribute=void 0,this.buffer=void 0;var r=n,i=r.buffer,o=r.offset,a=r.stride,s=r.normalized,u=r.size,c=r.divisor,l=r.arrayStride,f=r.attributes,d=r.stepMode;this.buffer=i,this.attribute={buffer:i.get(),offset:o||0,stride:a||0,normalized:s||!1,divisor:c||0,arrayStride:l||0,attributes:f,stepMode:d||"vertex"},u&&(this.attribute.size=u)}return Wl(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Vm=function(){function e(t,n){Fl(this,e),this.engine=t,this.options=n,this.buffer=void 0;var r=n,i=r.data,o=r.usage;r.type,this.buffer=this.createBuffer(i instanceof Array?new Float32Array(i):i,o||Yg.FB.Vertex|Yg.FB.CopyDst)}return Wl(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.setSubData(this.buffer,n,t instanceof Array?new Float32Array(t):t)}},{key:"createBuffer",value:function(e,t){var n=e.byteLength%4,r={size:e.byteLength+n,usage:t},i=this.engine.device.createBuffer(r);return this.setSubData(i,0,e),i}},{key:"setSubData",value:function(e,t,n){(xg?this.engine.device.getQueue():this.engine.device.defaultQueue).writeBuffer(e,t,n)}}]),e}(),Wm=function(){function e(t,n){Fl(this,e),this.engine=t,this.context=n,this.entity=Zl(),this.uniformGPUBufferLayout=[],this.uniformBuffer=void 0,this.vertexBuffers={},this.outputBuffer=void 0,this.bindGroupEntries=void 0,this.bindGroup=void 0,this.computePipeline=void 0}var t,n,r;return Wl(e,[{key:"init",value:(r=Kl(ql().mark((function e(){var t,n,r,i,o,a,s,u=this;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.compileComputePipelineStageDescriptor(this.context.shader);case 2:t=e.sent,n=t.computeStage,r=this.context.uniforms.filter((function(e){return e.storageClass===Eg.StorageBuffer})),i=this.context.uniforms.filter((function(e){return e.storageClass===Eg.Uniform})),o=i.length?1:0,this.bindGroupEntries=[],o&&(a=0,s=[],i.forEach((function(e){if("number"==typeof e.data)u.uniformGPUBufferLayout.push({name:e.name,offset:a}),a+=4,s.push(e.data);else{var t,n=(null===(t=e.data)||void 0===t?void 0:t.length)||1;3===n&&(n=4,e.data.push(0));var r=a/4%4;if(r>0){var i=4-r;if(n>1&&n<=i)2===n&&(3===i&&(a+=4,s.push(0)),s.push.apply(s,dm(e.data)),u.uniformGPUBufferLayout.push({name:e.name,offset:a}));else{for(var o=0;o<i;o++)a+=4,s.push(0);s.push.apply(s,dm(e.data)),u.uniformGPUBufferLayout.push({name:e.name,offset:a})}}a+=4*n}})),this.uniformBuffer=new Vm(this.engine,{data:s instanceof Array?new Float32Array(s):s,usage:Yg.FB.Uniform|Yg.FB.CopyDst}),this.bindGroupEntries.push({binding:0,resource:{buffer:this.uniformBuffer.get()}})),r.forEach((function(e){var t;null!==e.data&&(e.type!==yg.Vector4FloatArray&&e.type!==yg.FloatArray||(e.name===u.context.output.name?(t=new Vm(u.engine,{data:isFinite(Number(e.data))?[e.data]:e.data,usage:Yg.FB.Storage|Yg.FB.CopyDst|Yg.FB.CopySrc}),u.outputBuffer=t,u.context.output={name:e.name,length:isFinite(Number(e.data))?1:e.data.length,typedArrayConstructor:Float32Array,gpuBuffer:t.get()}):e.isReferer?e.data.model&&e.data.model.outputBuffer&&(t=e.data.model.outputBuffer):t=new Vm(u.engine,{data:isFinite(Number(e.data))?[e.data]:e.data,usage:Yg.FB.Storage|Yg.FB.CopyDst|Yg.FB.CopySrc}),u.vertexBuffers[e.name]=t,u.bindGroupEntries.push({binding:o,resource:{name:e.name,refer:t?void 0:e.data,buffer:t?t.get():void 0}}),o++))})),this.computePipeline=this.engine.device.createComputePipeline({computeStage:n}),console.log(this.bindGroupEntries),this.bindGroup=this.engine.device.createBindGroup({layout:this.computePipeline.getBindGroupLayout(0),entries:this.bindGroupEntries});case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"destroy",value:function(){var e=this;this.uniformBuffer&&this.uniformBuffer.destroy(),Object.keys(this.vertexBuffers).forEach((function(t){return e.vertexBuffers[t].destroy()}))}},{key:"readData",value:(n=Kl(ql().mark((function e(){var t,n,r,i,o,a,s,u,c;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.context.output)){e.next=16;break}if(n=t.length,r=t.typedArrayConstructor,!(i=t.gpuBuffer)){e.next=16;break}return o=n*r.BYTES_PER_ELEMENT,a=this.engine.device.createBuffer({size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),(s=this.engine.device.createCommandEncoder()).copyBufferToBuffer(i,0,a,0,o),(xg?this.engine.device.getQueue():this.engine.device.defaultQueue).submit([s.finish()]),e.next=12,a.mapAsync(Yg.gc.Read);case 12:return u=a.getMappedRange(),c=new r(u.slice(0)),a.unmap(),e.abrupt("return",c);case 16:return e.abrupt("return",new Float32Array);case 17:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"run",value:function(){var e;this.engine.currentComputePass&&(this.engine.currentComputePass.setPipeline(this.computePipeline),this.engine.currentComputePass.setBindGroup(0,this.bindGroup),(e=this.engine.currentComputePass).dispatch.apply(e,dm(this.context.dispatch)))}},{key:"updateBuffer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.vertexBuffers[e];r&&r.subData({data:t,offset:n})}},{key:"updateUniform",value:function(e,t){var n=this.uniformGPUBufferLayout.find((function(t){return t.name===e}));n&&this.uniformBuffer.subData({data:Number.isFinite(t)?new Float32Array([t]):new Float32Array(t),offset:n.offset})}},{key:"confirmInput",value:function(e,t){var n=this.vertexBuffers[t],r=e.outputBuffer;if(n&&r&&n!==r){var i=this.engine.device.createCommandEncoder(),o=e.context.output,a=o.length*o.typedArrayConstructor.BYTES_PER_ELEMENT;i.copyBufferToBuffer(r.get(),0,n.get(),0,a),(xg?this.engine.device.getQueue():this.engine.device.defaultQueue).submit([i.finish()])}}},{key:"compileShaderToSpirV",value:function(e,t,n){return this.compileRawShaderToSpirV(n+e,t)}},{key:"compileRawShaderToSpirV",value:function(e,t){return this.engine.glslang.compileGLSL(e,t)}},{key:"compileComputePipelineStageDescriptor",value:(t=Kl(ql().mark((function e(t){var n;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,this.engine.options.useWGSL){e.next=6;break}return e.next=5,this.compileShaderToSpirV(t,"compute","#version 450\n");case 5:n=e.sent;case 6:return e.abrupt("return",{computeStage:{module:this.engine.device.createShaderModule({code:n,isWHLSL:xg}),entryPoint:"main"}});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Hm=function(){function e(t,n){Fl(this,e),this.engine=t,this.options=n,this.indexCount=void 0,this.buffer=void 0;var r=n,i=r.data,o=(r.usage,r.type,r.count);this.indexCount=o||0,this.buffer=new Vm(t,{data:i instanceof Array?new Uint16Array(i):i,usage:Yg.FB.Index|Yg.FB.CopyDst})}return Wl(e,[{key:"get",value:function(){return this.buffer}},{key:"subData",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Xm=function(){function e(t,n){Fl(this,e),this.engine=t,this.options=n,this.colorTexture=void 0,this.depthTexture=void 0,this.width=0,this.height=0;var r=n,i=(r.width,r.height,r.color),o=(r.colors,r.depth);r.stencil,i&&(this.colorTexture=i),o&&(this.depthTexture=o)}return Wl(e,[{key:"get",value:function(){var e,t;return{color:null===(e=this.colorTexture)||void 0===e?void 0:e.get(),depth:null===(t=this.depthTexture)||void 0===t?void 0:t.get()}}},{key:"destroy",value:function(){var e,t;null===(e=this.colorTexture)||void 0===e||e.destroy(),null===(t=this.depthTexture)||void 0===t||t.destroy()}},{key:"resize",value:function(e){var t,n,r=e.width,i=e.height;r===this.width&&i===this.height||(null===(t=this.colorTexture)||void 0===t||t.resize({width:r,height:i}),null===(n=this.depthTexture)||void 0===n||n.resize({width:r,height:i})),this.width=r,this.height=i}}]),e}(),qm=(Tf(Pm={},nd.POINTS,Yg.YV.PointList),Tf(Pm,nd.LINES,Yg.YV.LineList),Tf(Pm,nd.LINE_LOOP,Yg.YV.LineList),Tf(Pm,nd.LINE_STRIP,Yg.YV.LineStrip),Tf(Pm,nd.TRIANGLES,Yg.YV.TriangleList),Tf(Pm,nd.TRIANGLE_FAN,Yg.YV.TriangleList),Tf(Pm,nd.TRIANGLE_STRIP,Yg.YV.TriangleStrip),Pm),Ym=(Tf(Gm={},nd.NEVER,Yg.wb.Never),Tf(Gm,nd.ALWAYS,Yg.wb.Always),Tf(Gm,nd.LESS,Yg.wb.Less),Tf(Gm,nd.LEQUAL,Yg.wb.LessEqual),Tf(Gm,nd.GREATER,Yg.wb.Greater),Tf(Gm,nd.GEQUAL,Yg.wb.GreaterEqual),Tf(Gm,nd.EQUAL,Yg.wb.Equal),Tf(Gm,nd.NOTEQUAL,Yg.wb.NotEqual),Gm),Km=(Tf(Lm={},nd.FUNC_ADD,Yg.db.Add),Tf(Lm,nd.MIN_EXT,Yg.db.Min),Tf(Lm,nd.MAX_EXT,Yg.db.Max),Tf(Lm,nd.FUNC_SUBTRACT,Yg.db.Subtract),Tf(Lm,nd.FUNC_REVERSE_SUBTRACT,Yg.db.ReverseSubtract),Lm),$m=(Tf(Um={},nd.ZERO,Yg.zi.Zero),Tf(Um,nd.ONE,Yg.zi.One),Tf(Um,nd.SRC_COLOR,Yg.zi.SrcColor),Tf(Um,nd.ONE_MINUS_SRC_COLOR,Yg.zi.OneMinusSrcColor),Tf(Um,nd.SRC_ALPHA,Yg.zi.SrcAlpha),Tf(Um,nd.ONE_MINUS_SRC_ALPHA,Yg.zi.OneMinusSrcAlpha),Tf(Um,nd.DST_COLOR,Yg.zi.DstColor),Tf(Um,nd.ONE_MINUS_DST_COLOR,Yg.zi.OneMinusDstColor),Tf(Um,nd.DST_ALPHA,Yg.zi.DstAlpha),Tf(Um,nd.ONE_MINUS_DST_ALPHA,Yg.zi.OneMinusDstAlpha),Tf(Um,nd.CONSTANT_COLOR,Yg.zi.BlendColor),Tf(Um,nd.ONE_MINUS_CONSTANT_COLOR,Yg.zi.OneMinusBlendColor),Tf(Um,nd.SRC_ALPHA_SATURATE,Yg.zi.SrcAlphaSaturated),Um),Zm=(Tf(zm={},nd.ALPHA,"r8unorm"),Tf(zm,nd.RGBA,"rgba8unorm"),Tf(zm,nd.DEPTH_COMPONENT,"depth32float"),Tf(zm,nd.DEPTH_STENCIL,"depth24plus-stencil8"),zm),Jm=(Tf(Bm={},nd.NEAREST,"nearest"),Tf(Bm,nd.LINEAR,"linear"),Bm),Qm=(Tf(jm={},nd.REPEAT,"repeat"),Tf(jm,nd.CLAMP_TO_EDGE,"clamp-to-edge"),Tf(jm,nd.MIRRORED_REPEAT,"mirror-repeat"),jm);function ey(e){var t=e.cull;return t&&t.enable?t.face?t.face===nd.FRONT?Yg.Wf.Front:Yg.Wf.Back:void 0:Yg.Wf.None}function ty(e){var t=e.depth,n=(e.stencil,{compare:Yg.wb.Always,depthFailOp:Yg.xS.Keep,failOp:Yg.xS.Keep,passOp:Yg.xS.Keep});return{depthWriteEnabled:t&&t.enable,depthCompare:Ym[(null==t?void 0:t.func)||nd.ALWAYS],format:Yg.EV.Depth24PlusStencil8,stencilFront:n,stencilBack:n,stencilReadMask:4294967295,stencilWriteMask:4294967295}}function ny(e,t){var n=e.blend;return[{format:t,alphaBlend:{srcFactor:$m[n&&n.func&&n.func.srcAlpha||nd.ONE],dstFactor:$m[n&&n.func&&n.func.dstAlpha||nd.ZERO],operation:Km[n&&n.equation&&n.equation.alpha||nd.FUNC_ADD]},colorBlend:{srcFactor:$m[n&&n.func&&n.func.srcRGB||nd.ONE],dstFactor:$m[n&&n.func&&n.func.dstRGB||nd.ZERO],operation:Km[n&&n.equation&&n.equation.rgb||nd.FUNC_ADD]},writeMask:Yg.Yw.All}]}function ry(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function iy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ry(Object(n),!0).forEach((function(t){Tf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ry(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oy(e){for(var t=0,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0,a=r;o<a.length;o++){var s=a[o];t+=s.length}for(var u=new e(t),c=0,l=0,f=r;l<f.length;l++){var d=f[l];u.set(d,c),c+=d.length}return u}var ay,sy,uy,cy=function(){function e(t,n){Fl(this,e),this.engine=t,this.options=n,this.pipelineLayout=void 0,this.renderPipeline=void 0,this.uniformsBindGroupLayout=void 0,this.uniformBindGroup=void 0,this.uniformBuffer=void 0,this.uniforms={},this.uniformGPUBufferLayout=[],this.attributeCache={},this.indexBuffer=void 0,this.indexCount=void 0}var t,n;return Wl(e,[{key:"init",value:(n=Kl(ql().mark((function e(){var t,n,r,i,o,a,s,u,c,l,f,d,h,p,g,v,m=this;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.options,n=t.vs,r=t.fs,i=t.attributes,o=t.uniforms,a=t.primitive,t.count,s=t.elements,u=t.depth,c=t.blend,l=t.stencil,f=t.cull,t.instances,e.next=3,this.compilePipelineStageDescriptor(n,r,null);case 3:d=e.sent,h=d.vertexStage,p=d.fragmentStage,o&&this.buildUniformBindGroup(o),s&&(this.indexBuffer=s.get(),this.indexCount=s.indexCount),g={vertexBuffers:Object.keys(i).map((function(e,t){var n=i[e],r=n.get(),o=r.arrayStride,a=r.stepMode,s=r.attributes;return m.attributeCache[e]=n,{arrayStride:o,stepMode:a,attributes:s}}))},v={sampleCount:this.engine.mainPassSampleCount,primitiveTopology:qm[a||nd.TRIANGLES],rasterizationState:iy(iy({},this.getDefaultRasterizationStateDescriptor()),{},{cullMode:ey({cull:f})}),depthStencilState:ty({depth:u,stencil:l}),colorStates:ny({blend:c},this.engine.options.swapChainFormat),layout:this.pipelineLayout,vertexStage:h,fragmentStage:p,vertexState:g},this.renderPipeline=this.engine.device.createRenderPipeline(v);case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"addUniforms",value:function(e){this.uniforms=iy(iy({},this.uniforms),xm(e))}},{key:"draw",value:function(e){var t=this,n=this.engine.getCurrentRenderPass(),r=iy(iy({},this.uniforms),xm(e.uniforms||{})),i=[];Object.keys(r).forEach((function(e){var n=ff(r[e]);if("boolean"===n||"number"===n||Array.isArray(r[e])||r[e].BYTES_PER_ELEMENT){var o,a=null===(o=t.uniformGPUBufferLayout.find((function(t){return t.name===e})))||void 0===o?void 0:o.offset;null!==a&&t.uniformBuffer.subData({data:r[e],offset:a})}else{var s,u=null===(s=t.uniformGPUBufferLayout.find((function(t){return t.name===e})))||void 0===s?void 0:s.offset;if(null!==u){var c=r[e].get(),l=c.color||c,f=l.texture,d=l.sampler;d&&(i.push({binding:u,resource:d}),u++),i.push({binding:u,resource:f.createView()})}}})),this.uniformBuffer&&(i[0]={binding:0,resource:{buffer:this.uniformBuffer.get()}}),this.uniformBindGroup=this.engine.device.createBindGroup({layout:this.uniformsBindGroupLayout,entries:i}),this.renderPipeline&&n.setPipeline(this.renderPipeline),n.setBindGroup(0,this.uniformBindGroup),this.indexBuffer&&n.setIndexBuffer(this.indexBuffer.get(),Yg.iD.Uint32,0),Object.keys(this.attributeCache).forEach((function(e,r){n.setVertexBuffer(0+r,t.attributeCache[e].get().buffer,0)})),this.indexBuffer?n.drawIndexed(this.indexCount,this.options.instances||1,0,0,0):n.draw(this.options.count||0,this.options.instances||0,0,0)}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}},{key:"compilePipelineStageDescriptor",value:(t=Kl(ql().mark((function e(t,n,r){var i,o,a;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i="#version 450\n",o=t,a=n,this.engine.options.useWGSL){e.next=10;break}return e.next=6,this.compileShaderToSpirV(t,"vertex",i);case 6:return o=e.sent,e.next=9,this.compileShaderToSpirV(n,"fragment",i);case 9:a=e.sent;case 10:return e.abrupt("return",this.createPipelineStageDescriptor(o,a));case 11:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"compileShaderToSpirV",value:function(e,t,n){return this.compileRawShaderToSpirV(n+e,t)}},{key:"compileRawShaderToSpirV",value:function(e,t){return this.engine.glslang.compileGLSL(e,t)}},{key:"createPipelineStageDescriptor",value:function(e,t){return{vertexStage:{module:this.engine.device.createShaderModule({code:e,isWHLSL:xg}),entryPoint:"main"},fragmentStage:{module:this.engine.device.createShaderModule({code:t,isWHLSL:xg}),entryPoint:"main"}}}},{key:"getDefaultRasterizationStateDescriptor",value:function(){return{frontFace:Yg.zX.CCW,cullMode:Yg.Wf.None,depthBias:0,depthBiasSlopeScale:0,depthBiasClamp:0}}},{key:"buildUniformBindGroup",value:function(e){var t=this,n=0,r=oy.apply(void 0,[Float32Array].concat(dm(Object.keys(e).map((function(r){return e[r]?(t.uniformGPUBufferLayout.push({name:r,offset:n}),n+=4*(e[r].length||1),e[r]):[]}))))),i=[],o=!1;r.length&&(o=!0,i.push({binding:0,visibility:Yg.$X.Fragment|Yg.$X.Vertex,type:Yg.$l.UniformBuffer})),Object.keys(e).filter((function(t){return null===e[t]})).forEach((function(e,n){t.uniformGPUBufferLayout.push({name:e,offset:2*n+(o?1:0)}),i.push({binding:2*n+(o?1:0),visibility:Yg.$X.Fragment,type:Yg.$l.Sampler},{binding:2*n+(o?1:0)+1,visibility:Yg.$X.Fragment,type:Yg.$l.SampledTexture})})),this.uniformsBindGroupLayout=this.engine.device.createBindGroupLayout({entries:i}),this.pipelineLayout=this.engine.device.createPipelineLayout({bindGroupLayouts:[this.uniformsBindGroupLayout]}),o&&(this.uniformBuffer=new Vm(this.engine,{data:r instanceof Array?new Float32Array(r):r,usage:Yg.FB.Uniform|Yg.FB.CopyDst}))}}]),e}(),ly=function(){function e(t,n){Fl(this,e),this.engine=t,this.options=n,this.texture=void 0,this.sampler=void 0,this.width=void 0,this.height=void 0,this.createTexture()}return Wl(e,[{key:"get",value:function(){return{texture:this.texture,sampler:this.sampler}}},{key:"update",value:function(){}},{key:"resize",value:function(e){var t=e.width,n=e.height;t===this.width&&n===this.height||(this.destroy(),this.createTexture()),this.width=t,this.height=n}},{key:"destroy",value:function(){this.texture&&this.texture.destroy()}},{key:"createTexture",value:function(){var e=this.options,t=(void 0===(e.data,e.type)&&nd.UNSIGNED_BYTE,e.width),n=e.height,r=(e.flipY,e.format),i=void 0===r?nd.RGBA:r,o=(e.mipmap,e.wrapS),a=void 0===o?nd.CLAMP_TO_EDGE:o,s=e.wrapT,u=void 0===s?nd.CLAMP_TO_EDGE:s,c=e.aniso,l=void 0===c?0:c,f=(e.alignment,e.premultiplyAlpha,e.mag),d=void 0===f?nd.NEAREST:f,h=e.min,p=void 0===h?nd.NEAREST:h,g=(void 0===e.colorSpace&&nd.BROWSER_DEFAULT_WEBGL,e.usage);this.width=t,this.height=n,this.texture=this.engine.device.createTexture({size:[t,n,1],mipLevelCount:1,sampleCount:1,dimension:Yg.kd.E2d,format:Zm[i],usage:g||Yg.v2.Sampled|Yg.v2.CopyDst}),(!g||g&Yg.v2.Sampled)&&(this.sampler=this.engine.device.createSampler({addressModeU:Qm[a],addressModeV:Qm[u],addressModeW:Qm[a],magFilter:Jm[d],minFilter:Jm[p],maxAnisotropy:l}))}}]),e}(),fy=(0,rf.b2)()((sy=function(){function e(){var t=this;Fl(this,e),this.supportWebGPU=!0,this.useWGSL=!1,this.options=void 0,this.canvas=void 0,this.context=void 0,this.glslang=void 0,this.adapter=void 0,this.device=void 0,this.swapChain=void 0,this.mainPassSampleCount=void 0,this.mainTexture=void 0,this.depthTexture=void 0,this.mainColorAttachments=void 0,this.mainTextureExtends=void 0,this.mainDepthAttachment=void 0,this.uploadEncoder=void 0,this.renderEncoder=void 0,this.computeEncoder=void 0,this.renderTargetEncoder=void 0,this.commandBuffers=new Array(4).fill(void 0),this.currentRenderPass=null,this.mainRenderPass=null,this.currentRenderTargetViewDescriptor=void 0,this.currentComputePass=null,this.bundleEncoder=void 0,this.tempBuffers=[],this.currentRenderTarget=null,this.uploadEncoderDescriptor={label:"upload"},this.renderEncoderDescriptor={label:"render"},this.renderTargetEncoderDescriptor={label:"renderTarget"},this.computeEncoderDescriptor={label:"compute"},this.pipelines={},this.computePipelines={},this.defaultSampleCount=4,this.clearDepthValue=1,this.clearStencilValue=0,this.transientViewport={x:1/0,y:0,width:0,height:0},this.cachedViewport={x:0,y:0,width:0,height:0},this.clear=function(e){e.framebuffer;var n=e.color,r=e.depth,i=e.stencil;t.options.supportCompute&&t.startComputePass(),t.currentRenderTarget?(t.currentRenderPass&&t.endRenderTargetRenderPass(),t.startRenderTargetRenderPass(t.currentRenderTarget,n||null,!!r,!!i)):(t.mainColorAttachments[0].loadValue=n||Yg.Ws.Load,t.mainDepthAttachment.depthLoadValue=r||Yg.Ws.Load,t.mainDepthAttachment.stencilLoadValue=i?t.clearStencilValue:Yg.Ws.Load,t.mainRenderPass&&t.endMainRenderPass(),t.startMainRenderPass())},this.createModel=function(){var e=Kl(ql().mark((function e(n){var r;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new cy(t,n),e.next=3,r.init();case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createAttribute=function(e){return new Fm(t,e)},this.createBuffer=function(e){return new Vm(t,e)},this.createElements=function(e){return new Hm(t,e)},this.createTexture2D=function(e){return new ly(t,e)},this.createFramebuffer=function(e){return new Xm(t,e)},this.useFramebuffer=function(e,n){t.currentRenderTarget&&t.unbindFramebuffer(t.currentRenderTarget),t.currentRenderTarget=e,t.currentRenderTargetViewDescriptor={dimension:Yg.p_.E2d,arrayLayerCount:1,aspect:Yg.H7.All},t.currentRenderPass=null,n()},this.createComputeModel=function(){var e=Kl(ql().mark((function e(n){var r;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Wm(t,n),e.next=3,r.init();case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getCanvas=function(){return t.canvas},this.getGLContext=function(){throw new Error("Method not implemented.")},this.viewport=function(e){var n=e.x,r=e.y,i=e.width,o=e.height;t.currentRenderPass?t.transientViewport.x!==1/0?t.getCurrentRenderPass().setViewport(t.transientViewport.x,t.transientViewport.y,t.transientViewport.width,t.transientViewport.height,0,1):n===t.cachedViewport.x&&r===t.cachedViewport.y&&i===t.cachedViewport.width&&o===t.cachedViewport.height||(t.cachedViewport={x:n,y:r,width:i,height:o},t.getCurrentRenderPass().setViewport(n,r,i,o,0,1)):t.transientViewport={x:n,y:r,width:i,height:o}},this.readPixels=function(e){throw new Error("Method not implemented.")}}var t,n;return Wl(e,[{key:"isFloatSupported",value:function(){return!0}},{key:"init",value:(n=Kl(ql().mark((function e(t){return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.canvas=t.canvas,this.options=t,this.useWGSL=!!t.useWGSL,this.mainPassSampleCount=t.antialiasing?this.defaultSampleCount:1,e.next=6,this.initGlslang();case 6:this.initContextAndSwapChain(),this.initMainAttachments();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setScissor",value:function(e){throw new Error("Method not implemented.")}},{key:"destroy",value:function(){this.mainTexture&&this.mainTexture.destroy(),this.depthTexture&&this.depthTexture.destroy(),this.tempBuffers.forEach((function(e){return e.destroy()})),this.tempBuffers=[]}},{key:"beginFrame",value:function(){this.uploadEncoder=this.device.createCommandEncoder(this.uploadEncoderDescriptor),this.renderEncoder=this.device.createCommandEncoder(this.renderEncoderDescriptor),this.renderTargetEncoder=this.device.createCommandEncoder(this.renderTargetEncoderDescriptor),this.options.supportCompute&&(this.computeEncoder=this.device.createCommandEncoder(this.computeEncoderDescriptor))}},{key:"endFrame",value:function(){this.options.supportCompute&&this.endComputePass(),this.endMainRenderPass(),this.commandBuffers[0]=this.uploadEncoder.finish(),this.commandBuffers[1]=this.renderEncoder.finish(),this.options.supportCompute&&(this.commandBuffers[2]=this.computeEncoder.finish()),this.commandBuffers[3]=this.renderTargetEncoder.finish(),xg?this.device.getQueue().submit(this.commandBuffers.filter((function(e){return e}))):this.device.defaultQueue.submit(this.commandBuffers.filter((function(e){return e})))}},{key:"getCurrentRenderPass",value:function(){return this.currentRenderTarget&&!this.currentRenderPass?this.startRenderTargetRenderPass(this.currentRenderTarget,null,!1,!1):this.currentRenderPass||this.startMainRenderPass(),this.currentRenderPass}},{key:"initGlslang",value:(t=Kl(ql().mark((function e(){var t,n;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Om();case 2:return this.glslang=e.sent,e.next=5,null===(t=navigator)||void 0===t||null===(n=t.gpu)||void 0===n?void 0:n.requestAdapter();case 5:return this.adapter=e.sent,e.next=8,this.adapter.requestDevice();case 8:this.device=e.sent;case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"initContextAndSwapChain",value:function(){this.context=this.canvas.getContext(xg?"gpu":"gpupresent"),this.swapChain=this.context.configureSwapChain({device:this.device,format:this.options.swapChainFormat,usage:Yg.v2.OutputAttachment|Yg.v2.CopySrc})}},{key:"initMainAttachments",value:function(){if(this.mainTextureExtends={width:this.canvas.width,height:this.canvas.height,depth:1},this.options.antialiasing){var e={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:Yg.kd.E2d,format:Yg.EV.BGRA8Unorm,usage:Yg.v2.OutputAttachment};this.mainTexture&&this.mainTexture.destroy(),this.mainTexture=this.device.createTexture(e),this.mainColorAttachments=[{attachment:xg?this.mainTexture.createDefaultView():this.mainTexture.createView(),loadValue:[0,0,0,1],storeOp:Yg.EG.Store}]}else this.mainColorAttachments=[{attachment:xg?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),loadValue:[0,0,0,1],storeOp:Yg.EG.Store}];var t={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:Yg.kd.E2d,format:xg?"depth32float-stencil8":Yg.EV.Depth24PlusStencil8,usage:Yg.v2.OutputAttachment};this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture(t),this.mainDepthAttachment={attachment:xg?this.depthTexture.createDefaultView():this.depthTexture.createView(),depthLoadValue:this.clearDepthValue,depthStoreOp:Yg.EG.Store,stencilLoadValue:this.clearStencilValue,stencilStoreOp:Yg.EG.Store}}},{key:"startComputePass",value:function(){this.currentComputePass&&this.endComputePass(),this.currentComputePass=this.computeEncoder.beginComputePass()}},{key:"startMainRenderPass",value:function(){this.currentRenderPass&&!this.currentRenderTarget&&this.endMainRenderPass(),this.options.antialiasing?this.mainColorAttachments[0].resolveTarget=xg?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView():this.mainColorAttachments[0].attachment=xg?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),this.currentRenderPass=this.renderEncoder.beginRenderPass({colorAttachments:this.mainColorAttachments,depthStencilAttachment:this.mainDepthAttachment}),this.mainRenderPass=this.currentRenderPass,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"startRenderTargetRenderPass",value:function(e,t,n){var r,i,o,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=null===(r=e.get().color)||void 0===r?void 0:r.texture;s&&(o=s.createView(this.currentRenderTargetViewDescriptor));var u,c=null===(i=e.get().depth)||void 0===i?void 0:i.texture;c&&(u=c.createView());var l=this.renderTargetEncoder.beginRenderPass({colorAttachments:[{attachment:o,loadValue:null!==t?t:Yg.Ws.Load,storeOp:Yg.EG.Store}],depthStencilAttachment:c&&u?{attachment:u,depthLoadValue:n?this.clearDepthValue:Yg.Ws.Load,depthStoreOp:Yg.EG.Store,stencilLoadValue:a?this.clearStencilValue:Yg.Ws.Load,stencilStoreOp:Yg.EG.Store}:void 0});this.currentRenderPass=l,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"endMainRenderPass",value:function(){this.currentRenderPass===this.mainRenderPass&&null!==this.currentRenderPass&&(this.currentRenderPass.endPass(),this.resetCachedViewport(),this.currentRenderPass=null,this.mainRenderPass=null)}},{key:"endComputePass",value:function(){this.currentComputePass&&(this.currentComputePass.endPass(),this.currentComputePass=null)}},{key:"endRenderTargetRenderPass",value:function(){this.currentRenderPass&&(this.currentRenderPass.endPass(),this.resetCachedViewport())}},{key:"resetCachedViewport",value:function(){this.cachedViewport={x:0,y:0,width:0,height:0}}},{key:"unbindFramebuffer",value:function(e){this.currentRenderPass&&this.currentRenderPass!==this.mainRenderPass&&this.endRenderTargetRenderPass(),this.transientViewport.x=1/0,this.currentRenderTarget=null,this.currentRenderPass=this.mainRenderPass}}]),e}(),ay=sy))||ay;var dy,hy=4/64,py=(0,rf.b2)()(uy=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(){return Fl(this,i),r.apply(this,arguments)}return Wl(i,[{key:"onEntityCreated",value:function(){var e=this.config,t=e.widthSegments,n=void 0===t?1:t,r=e.heightSegments,i=void 0===r?1:r,o=e.depthSegments,a=void 0===o?1:o,s=e.halfExtents,u=n,c=i,l=a,f=nf(void 0===s?Gf(.5,.5,.5):s,3),d=f[0],h=f[1],p=f[2],g=[Gf(-d,-h,p),Gf(d,-h,p),Gf(d,h,p),Gf(-d,h,p),Gf(d,-h,-p),Gf(-d,-h,-p),Gf(-d,h,-p),Gf(d,h,-p)],v=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],m=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],y=[],b=[],E=[],_=[],x=[],w=0,S=function(e,t,n){var r,i,o,a;for(o=0;o<=t;o++)for(a=0;a<=n;a++){var s=Of(),u=Of(),c=Of(),l=Of();Wf(s,g[v[e][0]],g[v[e][1]],o/t),Wf(u,g[v[e][0]],g[v[e][2]],a/n),qf(c,u,g[v[e][0]]),zf(l,s,c),r=o/t,i=a/n,y.push(l[0],l[1],l[2]),b.push(m[e][0],m[e][1],m[e][2]),E.push(r,i),r=.875*(r/=3)+hy,i=.875*(i/=3)+hy,r+=e%3/3,i+=Math.floor(e/3)/3,_.push(r,i),o<t&&a<n&&(x.push(w+n+1,w+1,w),x.push(w+n+1,w+n+2,w+1)),w++}};S(0,u,c),S(1,u,c),S(2,u,l),S(3,u,l),S(4,l,c),S(5,l,c);var A=vg(y),T=this.getComponent();T.indices=Uint32Array.from(x),T.aabb=A,T.vertexCount=w,T.attributes=[{dirty:!0,name:"position",data:Float32Array.from(y),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(b),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(E),arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),i}(qg))||uy;var gy,vy=(0,rf.b2)()(dy=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(){return Fl(this,i),r.apply(this,arguments)}return Wl(i,[{key:"onEntityCreated",value:function(){var e=this.config.geometries,t=void 0===e?[]:e,n=this.getComponent();n.aabb=new Cd;var r=[],i=[],o=0;t.forEach((function(e){var t=e.aabb,a=e.indices,s=e.vertexCount,u=e.attributes;n.aabb.add(t),n.vertexCount+=s,a&&i.push.apply(i,dm(a.map((function(e){return e+o})))),o+=s,u.forEach((function(e,t){r[t]?e.data&&(wg(e.data)?r[t].push(e.data):sv(e.data)?r[t].data=function(e,t){if(!e&&!t)throw new Error("Please specify valid arguments for parameters a and b.");if(!t||0===t.length)return e;if(!e||0===e.length)return t;if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))throw new Error("The types of the two arguments passed for parameters a and b do not match.");var n=new e.constructor(e.length+t.length);return n.set(e),n.set(t,e.length),n}(r[t].data,e.data):r[t].data=r[t].data.concat(e.data)):(r[t]=e,r[t].dirty=!0)}))})),n.attributes=r,n.indices=Uint32Array.from(i),n.dirty=!0}}]),i}(qg))||dy;var my,yy=(0,rf.b2)()(gy=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(){return Fl(this,i),r.apply(this,arguments)}return Wl(i,[{key:"onEntityCreated",value:function(){for(var e=this.config,t=e.halfExtents,n=void 0===t?[.5,.5]:t,r=e.widthSegments,i=void 0===r?5:r,o=e.lengthSegments,a=void 0===o?5:o,s=[],u=[],c=[],l=[],f=0,d=0;d<=i;d++)for(var h=0;h<=a;h++){var p=-n[0]+2*n[0]*d/i,g=-(-n[1]+2*n[1]*h/a),v=d/i,m=h/a;s.push(p,0,g),u.push(0,1,0),c.push(v,m),d<i&&h<a&&(l.push(f+a+1,f+1,f),l.push(f+a+1,f+a+2,f+1)),f++}var y=vg(s),b=this.getComponent();b.indices=Uint32Array.from(l),b.aabb=y,b.vertexCount=f,b.attributes=[{dirty:!0,name:"position",data:Float32Array.from(s),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(u),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(c),arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),i}(qg))||gy;var by,Ey,_y,xy,wy,Sy,Ay,Ty,Iy=(0,rf.b2)()(my=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(){return Fl(this,i),r.apply(this,arguments)}return Wl(i,[{key:"onEntityCreated",value:function(){for(var e=this.config,t=e.radius,n=void 0===t?.5:t,r=e.latitudeBands,i=void 0===r?16:r,o=e.longitudeBands,a=void 0===o?16:o,s=[],u=[],c=[],l=[],f=0;f<=i;f++)for(var d=f*Math.PI/i,h=Math.sin(d),p=Math.cos(d),g=0;g<=a;g++){var v=2*g*Math.PI/a-Math.PI/2,m=Math.sin(v),y=Math.cos(v)*h,b=p,E=m*h,_=1-g/a,x=1-f/i;s.push(y*n,b*n,E*n),u.push(y,b,E),c.push(_,x)}for(var w=0;w<i;++w)for(var S=0;S<a;++S){var A=w*(a+1)+S,T=A+a+1;l.push(A+1,T,A),l.push(A+1,T+1,T)}var I=vg(s),N=this.getComponent();N.indices=Uint32Array.from(l),N.aabb=I,N.vertexCount=s.length/3,N.attributes=[{dirty:!0,name:"position",data:Float32Array.from(s),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(u),arrayStride:12,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(c),arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),i}(qg))||my;var Ny,Dy,ky,Cy,My,Oy,Ry,Py,Gy,Ly,Uy,zy,By=(by=(0,rf.b2)(),Ey=(0,rf.f3)(of.RenderEngine),_y=(0,rf.f3)(of.ShaderModuleService),by((Ty=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(){var e;Fl(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return jl(e=r.call.apply(r,[this].concat(n)),"engine",Sy,df(e)),jl(e,"shaderModuleService",Ay,df(e)),e}return Wl(i,[{key:"onEntityCreated",value:function(){var e=this.getComponent(),t=this.engine.supportWebGPU?"layout(set = 0, binding = 0) uniform Uniforms {\n  vec4 color;\n  mat4 projectionMatrix;\n  mat4 modelViewMatrix;\n} uniforms;\n\nlayout(location = 0) in vec3 position;\n// layout(location = 1) in vec3 barycentric;\n\nlayout(location = 0) out vec4 fragColor;\n// layout(location = 1) out vec3 v_Barycentric;\n\nvoid main() {\n  gl_Position = uniforms.projectionMatrix * uniforms.modelViewMatrix * vec4(position, 1.0);\n  fragColor = uniforms.color;\n  // v_Barycentric = barycentric;\n}":'attribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec4 color;\n\nvarying vec4 fragColor;\n\n#pragma include "uv.vert.declaration"\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  fragColor = color;\n\n  #pragma include "uv.vert.main"\n}',n=this.engine.supportWebGPU?"// layout(set = 0, binding = 1) uniform WireframeUniforms {\n//   float lineWidth;\n//   vec4 lineColor;\n// } wireframe;\n\nlayout(location = 0) in vec4 fragColor;\n// layout(location = 1) in vec3 v_Barycentric;\n\nlayout(location = 0) out vec4 outColor;\n\n// wireframe\n// float edgeFactor() {\n//   vec3 d = fwidth(v_Barycentric);\n//   vec3 a3 = smoothstep(vec3(0.0), d * wireframe.lineWidth, v_Barycentric);\n//   return min(min(a3.x, a3.y), a3.z);\n// }\n\nvoid main() {\n  // outColor = mix(fragColor, wireframe.lineColor, (1.0 - edgeFactor()));\n  outColor = fragColor;\n}":'varying vec4 fragColor;\n\n#pragma include "uv.frag.declaration"\n#pragma include "map.frag.declaration"\n\nvoid main() {\n  vec4 diffuseColor = fragColor;\n\n  #pragma include "map.frag.main"\n\n  gl_FragColor = diffuseColor;\n}';this.shaderModuleService.registerModule("material-basic",{vs:t,fs:n});var r=this.shaderModuleService.getModule("material-basic"),i=r.vs,o=r.fs,a=r.uniforms;e.vertexShaderGLSL=i,e.fragmentShaderGLSL=o,e.setUniform(a),this.config.map&&(e.setDefines({USE_UV:1,USE_MAP:1}),e.setUniform({map:this.config.map,uvTransform:Mf()}))}}]),i}(Xv),Sy=Hl((wy=Ty).prototype,"engine",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ay=Hl(wy.prototype,"shaderModuleService",[_y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xy=wy))||xy);var jy,Fy,Vy,Wy,Hy,Xy,qy,Yy,Ky,$y,Zy,Jy,Qy=(Ny=(0,rf.b2)(),Dy=(0,rf.f3)(of.Systems),ky=(0,rf.t6)(of.MaterialSystem),Cy=(0,rf.f3)(of.Systems),My=(0,rf.t6)(of.GeometrySystem),Oy=(0,rf.f3)(of.ShaderModuleService),Ny((zy=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(){var e;Fl(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return jl(e=r.call.apply(r,[this].concat(n)),"materialSystem",Gy,df(e)),jl(e,"geometrySystem",Ly,df(e)),jl(e,"shaderModuleService",Uy,df(e)),e}return Wl(i,[{key:"onAttributeChanged",value:function(e){var t=e.name,n=e.data,r=this.getMeshComponent();r&&r.material&&("gridColor"===t?(r.material.setUniform("u_GridColor",n),r.material.setUniform("u_GridColor2",n)):"gridSize"===t&&(r.material.setUniform("u_GridSize",n),r.material.setUniform("u_GridSize2",n)))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:"attribute vec3 a_Position;\n\nvarying vec3 v_Position;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nvoid main() {\n  v_Position = a_Position;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_Position, 1.);\n}",fs:"// generate grid, borrow from clay.gl viewer\n// @see https://github.com/pissang/clay-viewer/blob/master/src/graphic/ground.glsl\n#extension GL_OES_standard_derivatives : enable\n\nvarying vec3 v_Position;\n// varying vec3 v_Normal;\n\nuniform float u_GridSize : 5;\nuniform float u_GridSize2 : .5;\nuniform vec4 u_GridColor : [0, 0, 0, 1];\nuniform vec4 u_GridColor2 : [0.3, 0.3, 0.3, 1];\nuniform bool u_GridEnabled : true;\n\n// uniform vec3 u_LightDirection;\n// uniform vec3 u_LightColor;\n// uniform vec3 u_Camera;\n\nvoid main() {\n  // vec3 n = v_Normal;\n  // vec3 l = normalize(u_LightDirection);\n  // float NdotL = clamp(dot(n, l), 0.001, 1.0);\n\n  gl_FragColor = vec4(1.);\n\n  if (u_GridEnabled) {\n    float wx = v_Position.x;\n    float wz = v_Position.z;\n    // float x0 = abs(fract(wx / u_GridSize - 0.5) - 0.5) / fwidth(wx) * u_GridSize / 2.0;\n    // float z0 = abs(fract(wz / u_GridSize - 0.5) - 0.5) / fwidth(wz) * u_GridSize / 2.0;\n\n    float x1 = abs(fract(wx / u_GridSize2 - 0.5) - 0.5) / fwidth(wx) * u_GridSize2;\n    float z1 = abs(fract(wz / u_GridSize2 - 0.5) - 0.5) / fwidth(wz) * u_GridSize2;\n\n    // float v0 = 1.0 - clamp(min(x0, z0), 0.0, 1.0);\n    float v1 = 1.0 - clamp(min(x1, z1), 0.0, 1.0);\n    // if (v0 > 0.1) {\n        // gl_FragColor = mix(gl_FragColor, u_GridColor, v0);\n    // }\n    // else {\n        gl_FragColor = mix(gl_FragColor, u_GridColor2, v1);\n    // }\n  }\n\n  // float shadowFactor = calcShadow(u_ShadowMap, v_PositionFromLight, l, n);\n  // vec3 diffuseColor = u_LightColor * NdotL * shadowFactor;\n\n  // gl_FragColor.rgb *= diffuseColor;\n}"});var e=this.shaderModuleService.getModule("grid"),t=e.vs,n=e.fs,r=e.uniforms,i=this.materialSystem.createShaderMaterial({vertexShader:t,fragmentShader:n});this.setMaterial(i);var o=this.geometrySystem.createBufferGeometry({vertexCount:4});this.setGeometry(o),i.setCull({enable:!1,face:nd.BACK}).setDepth({enable:!0,func:nd.LESS}),i.setUniform(r),this.setAttributes({gridColor:this.config.gridColor,gridSize:this.config.gridSize}),o.setIndex([0,3,2,2,1,0]),o.setAttribute("a_Position",Float32Array.from([-4,-1,-4,4,-1,-4,4,-1,4,-4,-1,4]),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})}}]),i}(qv),Gy=Hl((Py=zy).prototype,"materialSystem",[Dy,ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ly=Hl(Py.prototype,"geometrySystem",[Cy,My],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uy=Hl(Py.prototype,"shaderModuleService",[Oy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry=Py))||Ry),eb=n(5182),tb=n(5235);function nb(e,t,n,r,i){rb(t,r,-i),rb(t,r,i),e.push(n),e.push(n)}function rb(e,t,n){e.push([[t[0],t[1]],n])}var ib,ob,ab,sb,ub,cb,lb,fb,db,hb,pb,gb,vb=(jy=(0,rf.b2)(),Fy=(0,rf.f3)(of.Systems),Vy=(0,rf.t6)(of.MaterialSystem),Wy=(0,rf.f3)(of.Systems),Hy=(0,rf.t6)(of.GeometrySystem),Xy=(0,rf.f3)(of.ShaderModuleService),jy((Jy=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(){var e;Fl(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return jl(e=r.call.apply(r,[this].concat(n)),"materialSystem",Ky,df(e)),jl(e,"geometrySystem",$y,df(e)),jl(e,"shaderModuleService",Zy,df(e)),e.vertexCount=void 0,e}return Wl(i,[{key:"onAttributeChanged",value:function(e){var t=e.name,n=e.data,r=this.getMeshComponent();if(r&&r.material)switch(t){case"dashArray":r.material.setUniform("u_dash_array",n);break;case"dashOffset":r.material.setUniform("u_dash_offset",n);break;case"dashRatio":r.material.setUniform("u_dash_ratio",n);break;case"thickness":r.material.setUniform("u_thickness",n);break;case"color":var i=new Array(this.vertexCount).fill(void 0).map((function(){return n})).reduce((function(e,t){return[].concat(dm(e),dm(t))}),[]);r.geometry.setAttribute("a_color",Float32Array.from(i),{arrayStride:16,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]})}}},{key:"onEntityCreated",value:function(){var e=this;this.shaderModuleService.registerModule("line",{vs:"attribute vec2 a_pos;\nattribute vec4 a_color;\nattribute float a_line_miter;\nattribute vec2 a_line_normal;\nattribute float a_counters;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float u_thickness : 0.02;\nuniform vec2 u_viewport;\n\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_counters;\n\nvoid main() {\n  v_color = a_color;\n  v_counters = a_counters;\n\n  vec3 normal = normalize(vec3(a_line_normal, 0.0));\n\n  vec4 offset = vec4(normal * u_thickness / 2.0 * a_line_miter, 0.0);\n\n  v_normal = vec2(normal * sign(a_line_miter));\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_pos, 0.0, 1.0) + offset;\n}\n",fs:"uniform float u_dash_array : 0.02;\nuniform float u_dash_offset : 0;\nuniform float u_dash_ratio : 0;\nuniform float u_thickness : 0.02;\n\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_counters;\n\nvoid main() {\n    float blur = 1. - smoothstep(0.98, 1., length(v_normal));\n\n    gl_FragColor = v_color;\n    gl_FragColor.a *= blur * ceil(mod(v_counters + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));\n}"});var t=this.shaderModuleService.getModule("line"),n=t.vs,r=t.fs,i=t.uniforms,o=this.materialSystem.createShaderMaterial({vertexShader:n,fragmentShader:r}),a=function(e,t,n){for(var r=[0,0],i=[0,0],o=[0,0],a=[0,0],s=-1,u=!1,c=null,l=(0,eb.create)(),f=0,d=[],h=[],p=[],g=[0,0],v=e.length,m=1;m<v;m++){var y=f,b=e[m-1],E=e[m],_=m<e.length-1?e[m+1]:null;if(g.push(m/v,m/v),(0,tb.o7)(r,E,b),c||(c=[0,0],(0,tb.mJ)(c,r)),u||(u=!0,nb(h,d,b,c,1)),p.push([y+0,y+1,y+2]),_){(0,tb.o7)(i,_,E);var x=(0,tb.x7)(o,a,r,i,1),w=(0,eb.dot)(o,c)<0?-1:1,S=x>3;if(!isFinite(x)){(0,tb.mJ)(c,r),nb(h,d,E,c,1),p.push(1===s?[y,y+2,y+3]:[y+2,y+1,y+3]),f+=2,s=w;continue}S?(x=3,g.push(m/v),rb(d,c,-w),h.push(E),rb(d,a,x*w),h.push(E),p.push(s!==-w?[y,y+2,y+3]:[y+2,y+1,y+3]),p.push([y+2,y+3,y+4]),(0,tb.mJ)(l,i),(0,eb.copy)(c,l),rb(d,c,-w),h.push(E),f+=3):(nb(h,d,E,a,x),p.push(1===s?[y,y+2,y+3]:[y+2,y+1,y+3]),w=-1,(0,eb.copy)(c,a),f+=2),s=w}else(0,tb.mJ)(c,r),nb(h,d,E,c,1),p.push(1===s?[y,y+2,y+3]:[y+2,y+1,y+3]),f+=2}return{normals:d,attrIndex:p,attrPos:h,attrCounters:g}}(this.config.points),s=a.normals,u=a.attrIndex,c=a.attrPos,l=a.attrCounters,f=c.length;this.vertexCount=f;var d=this.geometrySystem.createBufferGeometry({vertexCount:f});this.setMaterial(o),this.setGeometry(d),o.setCull({enable:!1,face:nd.BACK}).setUniform(i),this.setAttributes({dashArray:this.config.dashArray,dashOffset:this.config.dashOffset,dashRatio:this.config.dashRatio,thickness:this.config.thickness});var h=[],p=[];s.forEach((function(e){var t=e[0],n=e[1];h.push([t[0],t[1]]),p.push(n)})),d.setIndex(u.reduce((function(e,t){return[].concat(dm(e),dm(t))}),[])),d.setAttribute("a_pos",Float32Array.from(c.reduce((function(e,t){return[].concat(dm(e),dm(t))}),[])),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]});var g=new Array(f).fill(void 0).map((function(){return dm(e.config.color)})).reduce((function(e,t){return[].concat(dm(e),dm(t))}),[]);d.setAttribute("a_color",Float32Array.from(g),{arrayStride:16,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]}),d.setAttribute("a_line_miter",Float32Array.from(p),{arrayStride:4,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float"}]}),d.setAttribute("a_line_normal",Float32Array.from(h.reduce((function(e,t){return[].concat(dm(e),dm(t))}),[])),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:3,offset:0,format:"float2"}]}),d.setAttribute("a_counters",Float32Array.from(l),{arrayStride:4,stepMode:"vertex",attributes:[{shaderLocation:4,offset:0,format:"float"}]})}}]),i}(qv),Ky=Hl((Yy=Jy).prototype,"materialSystem",[Fy,Vy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$y=Hl(Yy.prototype,"geometrySystem",[Wy,Hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zy=Hl(Yy.prototype,"shaderModuleService",[Xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qy=Yy))||qy);function mb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var yb,bb,Eb,_b,xb,wb,Sb,Ab,Tb,Ib,Nb=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],Db=(ib=(0,rf.b2)(),ob=(0,rf.f3)(of.Systems),ab=(0,rf.t6)(of.MaterialSystem),sb=(0,rf.f3)(of.Systems),ub=(0,rf.t6)(of.GeometrySystem),cb=(0,rf.f3)(of.ShaderModuleService),ib((gb=function(e){lf(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=pf(t);if(n){var i=pf(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return hf(this,e)});function i(){var e;Fl(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return jl(e=r.call.apply(r,[this].concat(n)),"materialSystem",db,df(e)),jl(e,"geometrySystem",hb,df(e)),jl(e,"shaderModuleService",pb,df(e)),e}return Wl(i,[{key:"onAttributeChanged",value:function(e){var t=e.name,n=e.data,r=this.getMeshComponent();r&&r.material&&("strokeWidth"===t?r.material.setUniform("u_stroke_width",n):"strokeColor"===t?r.material.setUniform("u_stroke_color",n):"strokeOpacity"===t?r.material.setUniform("u_stroke_opacity",n):"opacity"===t?r.material.setUniform("u_opacity",n):"blur"===t&&r.material.setUniform("u_blur",n))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:'attribute vec2 position;\nattribute vec4 color;\nattribute float shape;\nattribute vec2 offset;\nattribute float size;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nuniform float u_stroke_width : 0.01;\nuniform float u_device_pixel_ratio;\nuniform vec2 u_viewport;\n\nvarying vec4 v_color;\nvarying vec4 v_data;\nvarying float v_radius;\n\n#pragma include "picking"\n\nvoid main() {\n  v_color = color;\n  v_radius = size;\n\n  lowp float antialiasblur = 1.0 / u_device_pixel_ratio * (size + u_stroke_width);\n\n  // construct point coords\n  v_data = vec4(position, antialiasblur, shape);\n\n  gl_Position = projectionMatrix * modelViewMatrix\n    * vec4(position * size + offset, 0.0, 1.0);\n\n  setPickingColor(a_PickingColor);\n}',fs:"uniform float u_blur : 0.05;\nuniform float u_opacity : 0.7;\nuniform float u_stroke_width : 0.01;\nuniform vec4 u_stroke_color : [0, 0, 0, 0];\nuniform float u_stroke_opacity : 1;\n\nvarying vec4 v_color;\nvarying vec4 v_data;\nvarying float v_radius;\n\n#pragma include \"sdf2d\"\n#pragma include \"picking\"\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  float antialiasblur = v_data.z;\n  float antialiased_blur = -max(u_blur, antialiasblur);\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  // if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  // } else if (shape == 1) {\n  //   outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n  //   inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  // } else if (shape == 2) {\n  //   outer_df = sdBox(v_data.xy, vec2(1.));\n  //   inner_df = sdBox(v_data.xy, vec2(r));\n  // } else if (shape == 3) {\n  //   outer_df = sdPentagon(v_data.xy, 0.8);\n  //   inner_df = sdPentagon(v_data.xy, r * 0.8);\n  // } else if (shape == 4) {\n  //   outer_df = sdHexagon(v_data.xy, 0.8);\n  //   inner_df = sdHexagon(v_data.xy, r * 0.8);\n  // } else if (shape == 5) {\n  //   outer_df = sdOctogon(v_data.xy, 1.0);\n  //   inner_df = sdOctogon(v_data.xy, r);\n  // } else if (shape == 6) {\n  //   outer_df = sdHexagram(v_data.xy, 0.52);\n  //   inner_df = sdHexagram(v_data.xy, r * 0.52);\n  // } else if (shape == 7) {\n  //   outer_df = sdRhombus(v_data.xy, vec2(1.0));\n  //   inner_df = sdRhombus(v_data.xy, vec2(r));\n  // } else if (shape == 8) {\n  //   outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n  //   inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  // }\n\n  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    inner_df\n  );\n  vec4 strokeColor = u_stroke_color == vec4(0) ? v_color : u_stroke_color;\n\n  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);\n  gl_FragColor.a = gl_FragColor.a * opacity_t;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}"});var e=this.shaderModuleService.getModule("grid"),t=e.vs,n=e.fs,r=e.uniforms,i=this.materialSystem.createShaderMaterial({vertexShader:t,fragmentShader:n,cull:{enable:!1},depth:{enable:!1},blend:{enable:!0,func:{srcRGB:nd.SRC_ALPHA,dstRGB:nd.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}});i.setUniform(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mb(Object(n),!0).forEach((function(t){Tf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({u_device_pixel_ratio:window.devicePixelRatio},r));var o=this.buildAttributes(),a=this.geometrySystem.createInstancedBufferGeometry({maxInstancedCount:o.instancedOffsets.length/2,vertexCount:6});a.setIndex([0,2,1,0,3,2]),a.setAttribute("position",Float32Array.from(o.positions),{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]}),a.setAttribute("offset",Float32Array.from(o.instancedOffsets),{arrayStride:8,stepMode:"instance",attributes:[{shaderLocation:1,offset:0,format:"float2"}]}),a.setAttribute("color",Float32Array.from(o.instancedColors),{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:2,offset:0,format:"float4"}]}),a.setAttribute("size",Float32Array.from(o.instancedSizes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:3,offset:0,format:"float"}]}),a.setAttribute("shape",Float32Array.from(o.instancedShapes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:4,offset:0,format:"float"}]}),a.setAttribute("a_PickingColor",Float32Array.from(o.instancedPickingColors),{arrayStride:12,stepMode:"instance",attributes:[{shaderLocation:6,offset:0,format:"float3"}]}),this.setMaterial(i),this.setGeometry(a)}},{key:"buildAttribute",value:function(e,t,n){var r,i,o,a,s;(r=t.instancedPickingColors).push.apply(r,dm([(s=e.id||n)+1&255,s+1>>8&255,s+1>>8>>8&255])),t.instancedShapes.push(Nb.indexOf(e.shape||"circle")),(i=t.instancedColors).push.apply(i,dm(e.color||[1,0,0,1])),(o=t.instancedOffsets).push.apply(o,dm(e.position||[0,0])),(a=t.instancedSizes).push.apply(a,dm(e.size||[.2,.2]))}},{key:"buildAttributes",value:function(){var e=this,t={positions:[1,1,1,-1,-1,-1,-1,1],instancedOffsets:[],instancedColors:[],instancedSizes:[],instancedShapes:[],instancedPickingColors:[]};return Array.isArray(this.config)?this.config.forEach((function(n,r){e.buildAttribute(n,t,r)})):this.buildAttribute(this.config,t,0),t}}]),i}(qv),db=Hl((fb=gb).prototype,"materialSystem",[ob,ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hb=Hl(fb.prototype,"geometrySystem",[sb,ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pb=Hl(fb.prototype,"shaderModuleService",[cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lb=fb))||lb);function kb(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Cb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Cb(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Cb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Mb,Ob,Rb,Pb,Gb,Lb,Ub,zb,Bb,jb,Fb,Vb,Wb=(yb=(0,rf.b2)(),bb=(0,rf.f3)(of.RenderEngine),Eb=(0,rf.f3)(of.ShaderModuleService),_b=(0,rf.f3)(of.ConfigService),yb((Ib=function(){function e(){Fl(this,e),this.container=void 0,jl(this,"engine",Sb,this),jl(this,"shaderModule",Ab,this),jl(this,"configService",Tb,this),this.inited=!1,this.rendering=!1,this.pendings=[],this.views=[],this.size=void 0}var t,n;return Wl(e,[{key:"init",value:(n=Kl(ql().mark((function e(){var t,n,r,i,o;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.shaderModule.registerBuiltinModules(),this.shaderModule.registerModule("uv.vert.declaration",{vs:"#ifdef USE_UV\n  attribute vec2 uv;\n\t#ifdef UVS_VERTEX_ONLY\n    vec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif"}),this.shaderModule.registerModule("uv.vert.main",{vs:"#ifdef USE_UV\n  vUv = (uvTransform * vec3(uv, 1)).xy;\n#endif"}),this.shaderModule.registerModule("uv.frag.declaration",{fs:"#if (defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ))\n  varying vec2 vUv;\n#endif"}),this.shaderModule.registerModule("map.frag.declaration",{fs:"#ifdef USE_MAP\n  uniform sampler2D map;\n#endif"}),this.shaderModule.registerModule("map.frag.main",{fs:"#ifdef USE_MAP\n  vec4 texelColor = texture2D(map, vUv);\n  // texelColor = mapTexelToLinear(texelColor);\n  diffuseColor *= texelColor;\n#endif"}),t=this.container.getAll(of.Systems),!(n=this.configService.get()).canvas){e.next=30;break}return e.next=11,this.engine.init({canvas:n.canvas,swapChainFormat:Yg.EV.BGRA8Unorm,antialiasing:!1});case 11:r=kb(t),e.prev=12,r.s();case 14:if((i=r.n()).done){e.next=21;break}if(!(o=i.value).initialize){e.next=19;break}return e.next=19,o.initialize();case 19:e.next=14;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(12),r.e(e.t0);case 26:return e.prev=26,r.f(),e.finish(26);case 29:this.inited=!0;case 30:case"end":return e.stop()}}),e,this,[[12,23,26,29]])}))),function(){return n.apply(this,arguments)})},{key:"render",value:(t=Kl(ql().mark((function e(){var t,n,r,i,o,a,s,u=arguments;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inited&&!this.rendering){e.next=2;break}return e.abrupt("return");case 2:for(this.pendings.length&&this.pendings.forEach((function(e){e()})),this.rendering=!0,this.engine.beginFrame(),t=this.container.getAll(of.Systems),n=u.length,r=new Array(n),i=0;i<n;i++)r[i]=u[i];o=kb(t),e.prev=8,o.s();case 10:if((a=o.n()).done){e.next=17;break}if(!(s=a.value).execute){e.next=15;break}return e.next=15,s.execute(r);case 15:e.next=10;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),o.e(e.t0);case 22:return e.prev=22,o.f(),e.finish(22);case 25:this.engine.endFrame(),this.rendering=!1;case 27:case"end":return e.stop()}}),e,this,[[8,19,22,25]])}))),function(){return t.apply(this,arguments)})},{key:"clear",value:function(e){var t=this;return this.inited?this.engine.clear(e):this.pendings.unshift((function(){t.engine.clear(e),t.pendings.shift()})),this}},{key:"setSize",value:function(e){var t=e.width,n=e.height,r=this.engine.getCanvas();return this.size={width:t,height:n},r.width=t,r.height=n,this}},{key:"getSize",value:function(){return this.size}}]),e}(),Sb=Hl((wb=Ib).prototype,"engine",[bb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ab=Hl(wb.prototype,"shaderModule",[Eb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tb=Hl(wb.prototype,"configService",[_b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xb=wb))||xb),Hb=(0,rf.b2)()((Ob=function(){function e(){Fl(this,e),this.entities=[]}return Wl(e,[{key:"getEntities",value:function(){return this.entities}},{key:"addRenderable",value:function(e){return this.addEntity(e.getEntity()),this}},{key:"removeRenderable",value:function(e){return this.removeEntity(e.getEntity()),this}},{key:"addLight",value:function(){}},{key:"addEntity",value:function(e){return-1===this.entities.indexOf(e)&&this.entities.push(e),this}},{key:"removeEntity",value:function(e){var t=this.entities.indexOf(e);return this.entities.splice(t,1),this}}]),e}(),Mb=Ob))||Mb,Xb=(0,rf.b2)()((Pb=function(){function e(){Fl(this,e),this.cache={}}return Wl(e,[{key:"get",value:function(e){return this.cache[e]}},{key:"set",value:function(e,t){this.cache[e]=t}}]),e}(),Rb=Pb))||Rb;function qb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qb(Object(n),!0).forEach((function(t){Tf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Kb,$b,Zb,Jb,Qb,eE,tE,nE,rE,iE,oE,aE,sE,uE=(Gb=(0,rf.b2)(),Lb=(0,rf.f3)(Xb),Ub=(0,rf.f3)(of.RenderEngine),Gb((Vb=function(){function e(){Fl(this,e),jl(this,"textureCache",jb,this),jl(this,"engine",Fb,this),this.config=void 0,this.loaded=!1,this.texture=void 0}var t;return Wl(e,[{key:"setConfig",value:function(e){this.config=e}},{key:"isLoaded",value:function(){return this.loaded}},{key:"load",value:(t=Kl(ql().mark((function e(){var t=this;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.config.url){e.next=4;break}return e.abrupt("return",new Promise((function(e,n){var r=t.textureCache.get(t.config.url);if(r)e(r);else{var i=new Image;i.crossOrigin="Anonymous",i.src=t.config.url,i.onload=function(){var n=t.engine.createTexture2D(Yb(Yb({},t.config),{},{data:i,width:i.width,height:i.height,flipY:!0}));t.textureCache.set(t.config.url,n),t.texture=n,t.loaded=!0,e(n)},i.onerror=function(){n()}}})));case 4:return this.loaded=!0,this.texture=this.engine.createTexture2D(this.config),e.abrupt("return",this.texture);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),jb=Hl((Bb=Vb).prototype,"textureCache",[Lb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fb=Hl(Bb.prototype,"engine",[Ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zb=Bb))||zb),cE=(Kb=(0,rf.b2)(),$b=(0,rf.f3)(of.Systems),Zb=(0,rf.t6)(of.RendererSystem),Kb((tE=function(){function e(){Fl(this,e),jl(this,"rendererSystem",eE,this),this.camera=void 0,this.scene=void 0,this.viewport={x:0,y:0,width:0,height:0},this.clearColor=[1,1,1,1]}return Wl(e,[{key:"getCamera",value:function(){return this.camera}},{key:"getScene",value:function(){return this.scene}},{key:"getViewport",value:function(){return this.viewport}},{key:"getClearColor",value:function(){return this.clearColor}},{key:"setCamera",value:function(e){return this.camera=e,this}},{key:"setScene",value:function(e){return this.scene=e,this}},{key:"setViewport",value:function(e){return this.viewport=e,this}},{key:"setClearColor",value:function(e){return this.clearColor=e,this}},{key:"pick",value:function(e){return this.rendererSystem.pick(e,this)}}]),e}(),eE=Hl((Qb=tE).prototype,"rendererSystem",[$b,Zb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jb=Qb))||Jb);function lE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lE(Object(n),!0).forEach((function(t){Tf(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lE(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var dE=(nE=(0,rf.b2)(),rE=(0,rf.f3)(of.ConfigService),nE((sE=function(){function e(){Fl(this,e),jl(this,"configService",aE,this),this.container=void 0}var t;return Wl(e,[{key:"getEngine",value:(t=Kl(ql().mark((function e(){var t,n,r,i;return ql().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.container.get(of.RenderEngine),n=this.configService.get(),r=n.canvas,i=n.engineOptions,e.next=4,t.init(fE({canvas:r||Kg(),swapChainFormat:Yg.EV.BGRA8Unorm,antialiasing:!1},i));case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getTransformComponent",value:function(e){return this.container.get(of.TransformComponentManager).getComponentByEntity(e)}},{key:"getMeshComponent",value:function(e){return this.container.get(of.MeshComponentManager).getComponentByEntity(e)}},{key:"setConfig",value:function(e){this.configService.set(e)}},{key:"setContainer",value:function(e){this.container=e}},{key:"getContainer",value:function(){return this.container}},{key:"createEntity",value:function(){return Zl()}},{key:"createScene",value:function(){return this.container.get(Hb)}},{key:"createCamera",value:function(){return this.container.get(Xg)}},{key:"createView",value:function(){return this.container.get(cE)}},{key:"createRenderable",value:function(e,t){var n=e?this.container.getNamed(of.Renderable,e):this.container.get(qv),r=Zl();return n.setConfig(t||{}),n.setEntity(r),n}},{key:"createGeometry",value:function(e,t){var n=this.container.getNamed(of.Geometry,e),r=Zl();return n.setConfig(t||{}),n.setEntity(r),n.getComponent()}},{key:"createMaterial",value:function(e,t){var n=this.container.getNamed(of.Material,e),r=Zl();return n.setConfig(t||{}),n.setEntity(r,e),n.getComponent()}},{key:"createTexture2D",value:function(e){var t=this.container.get(uE);return t.setConfig(e),t}},{key:"createBufferGeometry",value:function(e){return this.container.getNamed(of.Systems,of.GeometrySystem).createBufferGeometry(e)}},{key:"createInstancedBufferGeometry",value:function(e){return this.container.getNamed(of.Systems,of.GeometrySystem).createInstancedBufferGeometry(e)}},{key:"createShaderMaterial",value:function(e){return this.container.getNamed(of.Systems,of.MaterialSystem).createShaderMaterial(e)}},{key:"createKernel",value:function(e){var t=this.container.get(Hv);return"string"==typeof e?t.setBundle(JSON.parse(e)):t.setBundle(e),t.init(),t}},{key:"createRenderer",value:function(){var e=this.container.get(Wb);return e.container=this.container,e.init(),e}},{key:"destroy",value:function(){this.container.getAll(of.Systems).forEach((function(e){e.tearDown&&e.tearDown()})),this.container.get(of.RenderEngine).destroy(),this.container.get(of.InteractorService).destroy()}}],[{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=gg(),r=navigator.gpu?fy:Cm;n.isBound(of.RenderEngine)||n.bind(of.RenderEngine).to(r).inSingletonScope(),n.bind(Wb).toSelf(),n.bind(Hv).toSelf(),n.bind(qv).toSelf(),n.bind(cE).toSelf(),n.bind(Xg).toSelf(),n.bind(Hb).toSelf(),n.bind(e).toSelf(),n.bind(Xb).toSelf(),n.bind(uE).toSelf(),n.bind(of.Geometry).to(py).whenTargetNamed(qg.BOX),n.bind(of.Geometry).to(Iy).whenTargetNamed(qg.SPHERE),n.bind(of.Geometry).to(yy).whenTargetNamed(qg.PLANE),n.bind(of.Geometry).to(vy).whenTargetNamed(qg.MERGED),n.bind(of.Material).to(By).whenTargetNamed(Xv.BASIC),n.bind(of.Renderable).to(Db).whenTargetNamed(qv.POINT),n.bind(of.Renderable).to(vb).whenTargetNamed(qv.LINE),n.bind(of.Renderable).to(Qy).whenTargetNamed(qv.GRID);var i=n.get(e);return i.setContainer(n),i.setConfig(t),i}}]),e}(),aE=Hl((oE=sE).prototype,"configService",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iE=oE))||iE);const hE=(e,t)=>{let n;return n=e?u(e)?()=>e:e:()=>t||1,n},pE=e=>{const t=[],n=e.length,r=e[0].length;for(let i=0;i<r;i++)e.forEach(((e,r)=>{if(t.push(e[i]),r===n-1)for(;t.length%4!=0;)t.push(0)}));return new Float32Array(t)};var gE=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};class vE extends o{constructor(e){super(),this.maxIteration=1e3,this.gravity=10,this.speed=1,this.clustering=!1,this.clusterField="cluster",this.clusterGravity=10,this.workerEnabled=!1,this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.updateCfg(e)}getDefaultCfg(){return{maxIteration:1e3,gravity:10,speed:1,clustering:!1,clusterGravity:10}}execute(){return gE(this,void 0,void 0,(function*(){const e=this,t=e.nodes;if(!t||0===t.length)return void(e.onLayoutEnd&&e.onLayoutEnd());e.width||"undefined"==typeof window||(e.width=window.innerWidth),e.height||"undefined"==typeof window||(e.height=window.innerHeight),e.center||(e.center=[e.width/2,e.height/2]);const n=e.center;if(1===t.length)return t[0].x=n[0],t[0].y=n[1],void(e.onLayoutEnd&&e.onLayoutEnd());const r={},i={};t.forEach(((e,t)=>{u(e.x)||(e.x=Math.random()*this.width),u(e.y)||(e.y=Math.random()*this.height),r[e.id]=e,i[e.id]=t})),e.nodeMap=r,e.nodeIdxMap=i,yield e.run()}))}executeWithWorker(e,t){return gE(this,void 0,void 0,(function*(){const n=this,r=n.nodes,i=n.center;if(!r||0===r.length)return;if(1===r.length)return r[0].x=i[0],void(r[0].y=i[1]);const o={},a={};r.forEach(((e,t)=>{u(e.x)||(e.x=Math.random()*this.width),u(e.y)||(e.y=Math.random()*this.height),o[e.id]=e,a[e.id]=t})),n.nodeMap=o,n.nodeIdxMap=a,yield n.run(e,t)}))}run(e,t){return gE(this,void 0,void 0,(function*(){const n=this,r=n.nodes,i=n.edges,o=n.maxIteration,a=n.center,s=n.height*n.width;let c=Math.sqrt(s)/10;const l=s/(r.length+1),f=Math.sqrt(l),h=n.speed,p=n.clustering,{array:g,count:v}=((e,t)=>{const n=[],r=e.length,i={};return t.forEach((t=>{e.forEach(((e,o)=>{if(void 0===i[t[e]]&&(i[t[e]]=Object.keys(i).length),n.push(i[t[e]]),o===r-1)for(;n.length%4!=0;)n.push(0)}))})),{array:new Float32Array(n),count:Object.keys(i).length}})([n.clusterField],r);r.forEach(((e,t)=>{let n=0,r=0;u(e.fx)&&u(e.fy)&&(n=e.fx||.001,r=e.fy||.001),g[4*t+1]=n,g[4*t+2]=r}));const m=r.length,{maxEdgePerVetex:y,array:b}=((e,t)=>{const n=[],r=[],i={};let o=0;for(o=0;o<e.length;o++){const t=e[o];i[t.id]=o,n.push(t.x),n.push(t.y),n.push(0),n.push(0),r.push([])}for(o=0;o<t.length;o++){const e=t[o],n=d(e,"source"),a=d(e,"target");isNaN(i[n])||isNaN(i[a])||(r[i[n]].push(i[a]),r[i[a]].push(i[n]))}let a=0;for(o=0;o<e.length;o++){const e=n.length,t=r[o],i=t.length;n[4*o+2]=e,n[4*o+3]=i,a=Math.max(a,i);for(let e=0;e<i;++e){const r=t[e];n.push(+r)}}for(;n.length%4!=0;)n.push(0);return{maxEdgePerVetex:a,array:new Float32Array(n)}})(r,i);let E;E=n.workerEnabled?dE.create({canvas:e,engineOptions:{supportCompute:!0}}):dE.create({engineOptions:{supportCompute:!0}});const _=n.onLayoutEnd,x=[];for(let e=0;e<v;e++)x.push(0,0,0,0);const w=E.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\ntype GWebGPUParams = [[block]] struct {\\n  [[offset 0]] u_K : f32;\\n  [[offset 4]] u_K2 : f32;\\n  [[offset 8]] u_Center : vec2<f32>;\\n  [[offset 16]] u_Gravity : f32;\\n  [[offset 20]] u_ClusterGravity : f32;\\n  [[offset 24]] u_Speed : f32;\\n  [[offset 28]] u_MaxDisplace : f32;\\n  [[offset 32]] u_Clustering : f32;\\n};\\n[[binding 0, set 0]] var<uniform> gWebGPUUniformParams : GWebGPUParams;\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_AttributeArray : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\ntype GWebGPUBuffer2 = [[block]] struct {\\n  [[offset 0]] u_ClusterCenters : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 3, set 0]] var<storage_buffer> gWebGPUBuffer2 : GWebGPUBuffer2;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nfn calcRepulsive(i : i32, currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {if (i != j) {var nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nvar xDist : f32 = currentNode.x - nextNode.x;\\nvar yDist : f32 = currentNode.y - nextNode.y;\\nvar dist : f32 = ((xDist * xDist) + (yDist * yDist)) + 0.01;\\nvar param : f32 = gWebGPUUniformParams.u_K2 / dist;\\nif (dist > 0.0) {dx = dx + param * xDist;\\ndy = dy + param * yDist;\\nif ((xDist == 0.0) && (yDist == 0.0)) {var sign : f32 = select(1.0, -1.0, i < j);\\ndx = dx + param * std::sign;\\ndy = dy + param * std::sign;}}}}\\nreturn vec2<f32>(dx, dy);}\\nfn calcGravity(currentNode : vec4<f32>, nodeAttributes : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nvar vx : f32 = currentNode.x - gWebGPUUniformParams.u_Center.x;\\nvar vy : f32 = currentNode.y - gWebGPUUniformParams.u_Center.y;\\nvar gf : f32 = (0.01 * gWebGPUUniformParams.u_K) * gWebGPUUniformParams.u_Gravity;\\ndx = gf * vx;\\ndy = gf * vy;\\nif (gWebGPUUniformParams.u_Clustering == 1.0) {var clusterIdx : i32 = i32(nodeAttributes.x);\\nvar center : vec4<f32> = gWebGPUBuffer2.u_ClusterCenters[clusterIdx];\\nvar cvx : f32 = currentNode.x - center.x;\\nvar cvy : f32 = currentNode.y - center.y;\\nvar dist : f32 = std::sqrt((cvx * cvx) + (cvy * cvy)) + 0.01;\\nvar parma : f32 = (gWebGPUUniformParams.u_K * gWebGPUUniformParams.u_ClusterGravity) / dist;\\ndx = dx + parma * cvx;\\ndy = dy + parma * cvy;}\\nreturn vec2<f32>(dx, dy);}\\nfn calcAttractive(i : i32, currentNode : vec4<f32>) -> vec2<f32> {var dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nvar arr_offset : i32 = i32(std::floor(currentNode.z + 0.5));\\nvar length : i32 = i32(std::floor(currentNode.w + 0.5));\\nvar node_buffer : vec4<f32>;\\nfor (var p : i32 = 0; p < __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX; p = p + 1) {if (p >= length) {break;}\\nvar arr_idx : i32 = arr_offset + i32(p);\\nvar buf_offset : i32 = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[i32(arr_idx / 4)];}\\nvar float_j : f32 = select(node_buffer.x, select(node_buffer.y, select(node_buffer.z, node_buffer.w, buf_offset == 2), buf_offset == 1), buf_offset == 0);\\nvar nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[i32(float_j)];\\nvar xDist : f32 = currentNode.x - nextNode.x;\\nvar yDist : f32 = currentNode.y - nextNode.y;\\nvar dist : f32 = std::sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\nvar attractiveF : f32 = dist / gWebGPUUniformParams.u_K;\\nif (dist > 0.0) {dx = dx - xDist * attractiveF;\\ndy = dy - yDist * attractiveF;\\nif ((xDist == 0.0) && (yDist == 0.0)) {var sign : f32 = select(1.0, -1.0, i < i32(float_j));\\ndx = dx - std::sign * attractiveF;\\ndy = dy - std::sign * attractiveF;}}}\\nreturn vec2<f32>(dx, dy);}\\nfn main() -> void {var i : i32 = globalInvocationID.x;\\nvar currentNode : vec4<f32> = gWebGPUBuffer0.u_Data[i];\\nvar dx : f32 = 0.0;\\nvar dy : f32 = 0.0;\\nif (i >= __DefineValuePlaceholder__VERTEX_COUNT) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvar nodeAttributes : vec4<f32> = gWebGPUBuffer1.u_AttributeArray[i];\\nif ((nodeAttributes.y != 0.0) && (nodeAttributes.z != 0.0)) {gWebGPUBuffer0.u_Data[i] = vec4<f32>(nodeAttributes.y, nodeAttributes.z, currentNode.z, currentNode.w);\\nreturn ;}\\nvar repulsive : vec2<f32> = calcRepulsive(i, currentNode);\\ndx = dx + repulsive.x;\\ndy = dy + repulsive.y;\\nvar attractive : vec2<f32> = calcAttractive(i, currentNode);\\ndx = dx + attractive.x;\\ndy = dy + attractive.y;\\nvar gravity : vec2<f32> = calcGravity(currentNode, nodeAttributes);\\ndx = dx - gravity.x;\\ndy = dy - gravity.y;\\ndx = dx * gWebGPUUniformParams.u_Speed;\\ndy = dy * gWebGPUUniformParams.u_Speed;\\nvar distLength : f32 = std::sqrt((dx * dx) + (dy * dy));\\nif (distLength > 0.0) {var limitedDist : f32 = std::min(gWebGPUUniformParams.u_MaxDisplace * gWebGPUUniformParams.u_Speed, distLength);\\ngWebGPUBuffer0.u_Data[i] = vec4<f32>(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w);}\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\nlayout(std140, set = 0, binding = 0) uniform GWebGPUParams {\\n  float u_K;\\n  float u_K2;\\n  vec2 u_Center;\\n  float u_Gravity;\\n  float u_ClusterGravity;\\n  float u_Speed;\\n  float u_MaxDisplace;\\n  float u_Clustering;\\n} gWebGPUUniformParams;\\nlayout(std430, set = 0, binding = 1) buffer   GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 2) buffer readonly  GWebGPUBuffer1 {\\n  vec4 u_AttributeArray[];\\n} gWebGPUBuffer1;\\n\\nlayout(std430, set = 0, binding = 3) buffer readonly  GWebGPUBuffer2 {\\n  vec4 u_ClusterCenters[];\\n} gWebGPUBuffer2;\\n\\n\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nvec2 calcRepulsive(int i, vec4 currentNode) {float dx = 0.0;\\nfloat dy = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = gWebGPUBuffer0.u_Data[j];\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = ((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat param = gWebGPUUniformParams.u_K2 / dist;\\nif (dist > 0.0) {dx += param * xDist;\\ndy += param * yDist;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < j) ? (1.0) : (-1.0);\\ndx += param * sign;\\ndy += param * sign;}}}}\\nreturn vec2(dx, dy);}\\nvec2 calcGravity(vec4 currentNode, vec4 nodeAttributes) {float dx = 0.0;\\nfloat dy = 0.0;\\nfloat vx = currentNode.x - gWebGPUUniformParams.u_Center.x;\\nfloat vy = currentNode.y - gWebGPUUniformParams.u_Center.y;\\nfloat gf = (0.01 * gWebGPUUniformParams.u_K) * gWebGPUUniformParams.u_Gravity;\\ndx = gf * vx;\\ndy = gf * vy;\\nif (gWebGPUUniformParams.u_Clustering == 1.0) {int clusterIdx = int(nodeAttributes.x);\\nvec4 center = gWebGPUBuffer2.u_ClusterCenters[clusterIdx];\\nfloat cvx = currentNode.x - center.x;\\nfloat cvy = currentNode.y - center.y;\\nfloat dist = sqrt((cvx * cvx) + (cvy * cvy)) + 0.01;\\nfloat parma = (gWebGPUUniformParams.u_K * gWebGPUUniformParams.u_ClusterGravity) / dist;\\ndx += parma * cvx;\\ndy += parma * cvy;}\\nreturn vec2(dx, dy);}\\nvec2 calcAttractive(int i, vec4 currentNode) {float dx = 0.0;\\nfloat dy = 0.0;\\nint arr_offset = int(floor(currentNode.z + 0.5));\\nint length = int(floor(currentNode.w + 0.5));\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + int(p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[int(arr_idx / 4)];}\\nfloat float_j = (buf_offset == 0) ? (node_buffer.x) : ((buf_offset == 1) ? (node_buffer.y) : ((buf_offset == 2) ? (node_buffer.z) : (node_buffer.w)));\\nvec4 nextNode = gWebGPUBuffer0.u_Data[int(float_j)];\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat attractiveF = dist / gWebGPUUniformParams.u_K;\\nif (dist > 0.0) {dx -= xDist * attractiveF;\\ndy -= yDist * attractiveF;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < int(float_j)) ? (1.0) : (-1.0);\\ndx -= sign * attractiveF;\\ndy -= sign * attractiveF;}}}\\nreturn vec2(dx, dy);}\\nvoid main() {int i = globalInvocationID.x;\\nvec4 currentNode = gWebGPUBuffer0.u_Data[i];\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nif (i >= VERTEX_COUNT) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvec4 nodeAttributes = gWebGPUBuffer1.u_AttributeArray[i];\\nif ((nodeAttributes.y != 0.0) && (nodeAttributes.z != 0.0)) {gWebGPUBuffer0.u_Data[i] = vec4(nodeAttributes.y, nodeAttributes.z, currentNode.z, currentNode.w);\\nreturn ;}\\nvec2 repulsive = calcRepulsive(i, currentNode);\\ndx += repulsive.x;\\ndy += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode);\\ndx += attractive.x;\\ndy += attractive.y;\\nvec2 gravity = calcGravity(currentNode, nodeAttributes);\\ndx -= gravity.x;\\ndy -= gravity.y;\\ndx *= gWebGPUUniformParams.u_Speed;\\ndy *= gWebGPUUniformParams.u_Speed;\\nfloat distLength = sqrt((dx * dx) + (dy * dy));\\nif (distLength > 0.0) {float limitedDist = min(gWebGPUUniformParams.u_MaxDisplace * gWebGPUUniformParams.u_Speed, distLength);\\ngWebGPUBuffer0.u_Data[i] = vec4(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w);}}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform float u_K;\\nuniform float u_K2;\\nuniform vec2 u_Center;\\nuniform float u_Gravity;\\nuniform float u_ClusterGravity;\\nuniform float u_Speed;\\nuniform float u_MaxDisplace;\\nuniform float u_Clustering;\\nuniform sampler2D u_AttributeArray;\\nuniform vec2 u_AttributeArraySize;\\nvec4 getDatau_AttributeArray(vec2 address2D) {\\n  return vec4(texture2D(u_AttributeArray, address2D).rgba);\\n}\\nvec4 getDatau_AttributeArray(float address1D) {\\n  return getDatau_AttributeArray(addrTranslation_1Dto2D(address1D, u_AttributeArraySize));\\n}\\nvec4 getDatau_AttributeArray(int address1D) {\\n  return getDatau_AttributeArray(float(address1D));\\n}\\nuniform sampler2D u_ClusterCenters;\\nuniform vec2 u_ClusterCentersSize;\\nvec4 getDatau_ClusterCenters(vec2 address2D) {\\n  return vec4(texture2D(u_ClusterCenters, address2D).rgba);\\n}\\nvec4 getDatau_ClusterCenters(float address1D) {\\n  return getDatau_ClusterCenters(addrTranslation_1Dto2D(address1D, u_ClusterCentersSize));\\n}\\nvec4 getDatau_ClusterCenters(int address1D) {\\n  return getDatau_ClusterCenters(float(address1D));\\n}\\nvec2 calcRepulsive(int i, vec4 currentNode) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = getDatau_Data(j);\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = ((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat param = u_K2 / dist;\\nif (dist > 0.0) {dx += param * xDist;\\ndy += param * yDist;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < j) ? (1.0) : (-1.0);\\ndx += param * sign;\\ndy += param * sign;}}}}\\nreturn vec2(dx, dy);}\\nvec2 calcGravity(vec4 currentNode, vec4 nodeAttributes) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nfloat vx = currentNode.x - u_Center.x;\\nfloat vy = currentNode.y - u_Center.y;\\nfloat gf = (0.01 * u_K) * u_Gravity;\\ndx = gf * vx;\\ndy = gf * vy;\\nif (u_Clustering == 1.0) {int clusterIdx = int(nodeAttributes.x);\\nvec4 center = getDatau_ClusterCenters(clusterIdx);\\nfloat cvx = currentNode.x - center.x;\\nfloat cvy = currentNode.y - center.y;\\nfloat dist = sqrt((cvx * cvx) + (cvy * cvy)) + 0.01;\\nfloat parma = (u_K * u_ClusterGravity) / dist;\\ndx += parma * cvx;\\ndy += parma * cvy;}\\nreturn vec2(dx, dy);}\\nvec2 calcAttractive(int i, vec4 currentNode) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nint arr_offset = int(floor(currentNode.z + 0.5));\\nint length = int(floor(currentNode.w + 0.5));\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + int(p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = getDatau_Data(int(arr_idx / 4));}\\nfloat float_j = (buf_offset == 0) ? (node_buffer.x) : ((buf_offset == 1) ? (node_buffer.y) : ((buf_offset == 2) ? (node_buffer.z) : (node_buffer.w)));\\nvec4 nextNode = getDatau_Data(int(float_j));\\nfloat xDist = currentNode.x - nextNode.x;\\nfloat yDist = currentNode.y - nextNode.y;\\nfloat dist = sqrt((xDist * xDist) + (yDist * yDist)) + 0.01;\\nfloat attractiveF = dist / u_K;\\nif (dist > 0.0) {dx -= xDist * attractiveF;\\ndy -= yDist * attractiveF;\\nif ((xDist == 0.0) && (yDist == 0.0)) {float sign = (i < int(float_j)) ? (1.0) : (-1.0);\\ndx -= sign * attractiveF;\\ndy -= sign * attractiveF;}}}\\nreturn vec2(dx, dy);}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint i = globalInvocationID.x;\\nvec4 currentNode = getDatau_Data(i);\\nfloat dx = 0.0;\\nfloat dy = 0.0;\\nif (i >= VERTEX_COUNT) {gl_FragColor = vec4(currentNode);\\nreturn ;}\\nvec4 nodeAttributes = getDatau_AttributeArray(i);\\nif ((nodeAttributes.y != 0.0) && (nodeAttributes.z != 0.0)) {gl_FragColor = vec4(vec4(nodeAttributes.y, nodeAttributes.z, currentNode.z, currentNode.w));\\nreturn ;}\\nvec2 repulsive = calcRepulsive(i, currentNode);\\ndx += repulsive.x;\\ndy += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode);\\ndx += attractive.x;\\ndy += attractive.y;\\nvec2 gravity = calcGravity(currentNode, nodeAttributes);\\ndx -= gravity.x;\\ndy -= gravity.y;\\ndx *= u_Speed;\\ndy *= u_Speed;\\nfloat distLength = sqrt((dx * dx) + (dy * dy));\\nif (distLength > 0.0) {float limitedDist = min(u_MaxDisplace * u_Speed, distLength);\\ngl_FragColor = vec4(vec4(currentNode.x + ((dx / distLength) * limitedDist), currentNode.y + ((dy / distLength) * limitedDist), currentNode.z, currentNode.w));}if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"MAX_EDGE_PER_VERTEX","type":"Float","runtime":true},{"name":"VERTEX_COUNT","type":"Float","runtime":true}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]},{"name":"u_K","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_K2","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Center","type":"vec2<f32>","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Gravity","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_ClusterGravity","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Speed","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_MaxDisplace","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_Clustering","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_AttributeArray","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_ClusterCenters","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_Data","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([m,1,1]).setBinding({u_Data:b,u_K:f,u_K2:l,u_Gravity:n.gravity,u_ClusterGravity:n.clusterGravity||n.gravity||1,u_Speed:h,u_MaxDisplace:c,u_Clustering:p?1:0,u_Center:a,u_AttributeArray:g,u_ClusterCenters:x,MAX_EDGE_PER_VERTEX:y,VERTEX_COUNT:m});let S;p&&(S=E.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\n\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 0, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_NodeAttributes : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\ntype GWebGPUBuffer2 = [[block]] struct {\\n  [[offset 0]] u_ClusterCenters : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer2 : GWebGPUBuffer2;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nfn main() -> void {var i : i32 = globalInvocationID.x;\\nvar center : vec4<f32> = gWebGPUBuffer2.u_ClusterCenters[i];\\nvar sumx : f32 = 0.0;\\nvar sumy : f32 = 0.0;\\nvar count : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {var attributes : vec4<f32> = gWebGPUBuffer1.u_NodeAttributes[j];\\nvar clusterIdx : i32 = i32(attributes.x);\\nvar vertex : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nif (clusterIdx == i) {sumx = sumx + vertex.x;\\nsumy = sumy + vertex.y;\\ncount = count + 1.0;}}\\ngWebGPUBuffer2.u_ClusterCenters[i] = vec4<f32>(sumx / count, sumy / count, count, i);\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\n\\nlayout(std430, set = 0, binding = 0) buffer readonly  GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 1) buffer readonly  GWebGPUBuffer1 {\\n  vec4 u_NodeAttributes[];\\n} gWebGPUBuffer1;\\n\\nlayout(std430, set = 0, binding = 2) buffer   GWebGPUBuffer2 {\\n  vec4 u_ClusterCenters[];\\n} gWebGPUBuffer2;\\n\\n\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define CLUSTER_COUNT __DefineValuePlaceholder__CLUSTER_COUNT\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\nvoid main() {int i = globalInvocationID.x;\\nvec4 center = gWebGPUBuffer2.u_ClusterCenters[i];\\nfloat sumx = 0.0;\\nfloat sumy = 0.0;\\nfloat count = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 attributes = gWebGPUBuffer1.u_NodeAttributes[j];\\nint clusterIdx = int(attributes.x);\\nvec4 vertex = gWebGPUBuffer0.u_Data[j];\\nif (clusterIdx == i) {sumx += vertex.x;\\nsumy += vertex.y;\\ncount += 1.0;}}\\ngWebGPUBuffer2.u_ClusterCenters[i] = vec4(sumx / count, sumy / count, count, i);}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define CLUSTER_COUNT __DefineValuePlaceholder__CLUSTER_COUNT\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform sampler2D u_NodeAttributes;\\nuniform vec2 u_NodeAttributesSize;\\nvec4 getDatau_NodeAttributes(vec2 address2D) {\\n  return vec4(texture2D(u_NodeAttributes, address2D).rgba);\\n}\\nvec4 getDatau_NodeAttributes(float address1D) {\\n  return getDatau_NodeAttributes(addrTranslation_1Dto2D(address1D, u_NodeAttributesSize));\\n}\\nvec4 getDatau_NodeAttributes(int address1D) {\\n  return getDatau_NodeAttributes(float(address1D));\\n}\\nuniform sampler2D u_ClusterCenters;\\nuniform vec2 u_ClusterCentersSize;\\nvec4 getDatau_ClusterCenters(vec2 address2D) {\\n  return vec4(texture2D(u_ClusterCenters, address2D).rgba);\\n}\\nvec4 getDatau_ClusterCenters(float address1D) {\\n  return getDatau_ClusterCenters(addrTranslation_1Dto2D(address1D, u_ClusterCentersSize));\\n}\\nvec4 getDatau_ClusterCenters(int address1D) {\\n  return getDatau_ClusterCenters(float(address1D));\\n}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint i = globalInvocationID.x;\\nvec4 center = getDatau_ClusterCenters(i);\\nfloat sumx = 0.0;\\nfloat sumy = 0.0;\\nfloat count = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 attributes = getDatau_NodeAttributes(j);\\nint clusterIdx = int(attributes.x);\\nvec4 vertex = getDatau_Data(j);\\nif (clusterIdx == i) {sumx += vertex.x;\\nsumy += vertex.y;\\ncount += 1.0;}}\\ngl_FragColor = vec4(vec4(sumx / count, sumy / count, count, i));if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"VERTEX_COUNT","type":"Float","runtime":true},{"name":"CLUSTER_COUNT","type":"Float","runtime":true}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_NodeAttributes","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_ClusterCenters","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_ClusterCenters","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([v,1,1]).setBinding({u_Data:b,u_NodeAttributes:g,u_ClusterCenters:x,VERTEX_COUNT:m,CLUSTER_COUNT:v})),yield(()=>gE(this,void 0,void 0,(function*(){for(let e=0;e<o;e++)yield w.execute(),p&&(S.setBinding({u_Data:w}),yield S.execute(),w.setBinding({u_ClusterCenters:S})),w.setBinding({u_MaxDisplace:c*=.99});const n=yield w.getOutput();e?t.postMessage({type:ke,vertexEdgeData:n}):r.forEach(((e,t)=>{const r=n[4*t],i=n[4*t+1];e.x=r,e.y=i})),_&&_()})))()}))}getType(){return"fruchterman-gpu"}}var mE=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};class yE extends o{constructor(e){super(),this.maxIteration=1e3,this.edgeStrength=200,this.nodeStrength=1e3,this.coulombDisScale=.005,this.damping=.9,this.maxSpeed=1e3,this.minMovement=.5,this.interval=.02,this.factor=1,this.linkDistance=1,this.gravity=10,this.workerEnabled=!1,this.nodes=[],this.edges=[],this.width=300,this.height=300,this.nodeMap={},this.nodeIdxMap={},this.updateCfg(e)}getDefaultCfg(){return{maxIteration:2e3,gravity:10,clustering:!1,clusterGravity:10}}execute(){return mE(this,void 0,void 0,(function*(){const e=this,t=e.nodes;if(!t||0===t.length)return void(e.onLayoutEnd&&e.onLayoutEnd());e.width||"undefined"==typeof window||(e.width=window.innerWidth),e.height||"undefined"==typeof window||(e.height=window.innerHeight),e.center||(e.center=[e.width/2,e.height/2]);const n=e.center;if(1===t.length)return t[0].x=n[0],t[0].y=n[1],void(e.onLayoutEnd&&e.onLayoutEnd());const r={},i={};t.forEach(((t,n)=>{u(t.x)||(t.x=Math.random()*e.width),u(t.y)||(t.y=Math.random()*e.height),r[t.id]=t,i[t.id]=n})),e.nodeMap=r,e.nodeIdxMap=i,e.nodeStrength=hE(e.nodeStrength,1),e.edgeStrength=hE(e.edgeStrength,1),yield e.run()}))}executeWithWorker(e,t){const n=this,r=n.nodes,i=n.center;if(!r||0===r.length)return;if(1===r.length)return r[0].x=i[0],void(r[0].y=i[1]);const o={},a={};r.forEach(((e,t)=>{u(e.x)||(e.x=Math.random()*n.width),u(e.y)||(e.y=Math.random()*n.height),o[e.id]=e,a[e.id]=t})),n.nodeMap=o,n.nodeIdxMap=a,n.nodeStrength=hE(n.nodeStrength,1),n.edgeStrength=hE(n.edgeStrength,1),n.run(e,t)}run(e,t){return mE(this,void 0,void 0,(function*(){const n=this,r=n.nodes,i=n.edges,o=n.maxIteration;n.width||"undefined"==typeof window||(n.width=window.innerWidth),n.height||"undefined"==typeof window||(n.height=window.innerHeight);const a=r.length;n.linkDistance=hE(n.linkDistance),n.edgeStrength=hE(n.edgeStrength);const{maxEdgePerVetex:s,array:c}=((e,t,n,r)=>{const i=[],o=[],a={};let s=0;for(s=0;s<e.length;s++){const t=e[s];a[t.id]=s,i.push(t.x),i.push(t.y),i.push(0),i.push(0),o.push([])}for(s=0;s<t.length;s++){const e=t[s],i=d(e,"source"),u=d(e,"target");o[a[i]].push(a[u]),o[a[i]].push(n(e)),o[a[i]].push(r(e)),o[a[i]].push(0),o[a[u]].push(a[i]),o[a[u]].push(n(e)),o[a[u]].push(r(e)),o[a[u]].push(0)}let u=0;for(s=0;s<e.length;s++){const e=i.length,t=o[s],n=t.length;i[4*s+2]=e+1048576*n/4,i[4*s+3]=0,u=Math.max(u,n/4);for(let e=0;e<n;++e){const n=t[e];i.push(+n)}}for(;i.length%4!=0;)i.push(0);return{maxEdgePerVetex:u,array:new Float32Array(i)}})(r,i,n.linkDistance,n.edgeStrength);n.degrees=h(r.length,n.nodeIdxMap,i).map((e=>e.all));const l=[],f=[],p=[],g=[],v=[],m=[],y=[];n.getMass||(n.getMass=e=>n.degrees[n.nodeIdxMap[e.id]]||1);const b=n.gravity,E=n.center;r.forEach(((e,t)=>{l.push(n.getMass(e)),f.push(n.nodeStrength(e)),n.degrees[t]||(n.degrees[t]=0);let r=[E[0],E[1],b];if(n.getCenter){const i=n.getCenter(e,n.degrees[t]);i&&u(i[0])&&u(i[1])&&u(i[2])&&(r=i)}p.push(r[0]),g.push(r[1]),v.push(r[2]),u(e.fx)&&u(e.fy)?(m.push(e.fx||.001),y.push(e.fy||.001)):(m.push(0),y.push(0))}));const _=pE([l,n.degrees,f,m]),x=pE([p,g,v,y]);let w;w=n.workerEnabled?dE.create({canvas:e,engineOptions:{supportCompute:!0}}):dE.create({engineOptions:{supportCompute:!0}});const S=n.onLayoutEnd,A=[];c.forEach((e=>{A.push(e)}));for(let e=0;e<4;e++)A.push(0);const T=w.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\ntype GWebGPUParams = [[block]] struct {\\n  [[offset 0]] u_damping : f32;\\n  [[offset 4]] u_maxSpeed : f32;\\n  [[offset 8]] u_minMovement : f32;\\n  \\n  [[offset 12]] u_coulombDisScale : f32;\\n  [[offset 16]] u_factor : f32;\\n  \\n  \\n  [[offset 20]] u_interval : f32;\\n};\\n[[binding 0, set 0]] var<uniform> gWebGPUUniformParams : GWebGPUParams;\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_AveMovement : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\ntype GWebGPUBuffer2 = [[block]] struct {\\n  [[offset 0]] u_NodeAttributeArray1 : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 3, set 0]] var<storage_buffer> gWebGPUBuffer2 : GWebGPUBuffer2;\\ntype GWebGPUBuffer3 = [[block]] struct {\\n  [[offset 0]] u_NodeAttributeArray2 : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 4, set 0]] var<storage_buffer> gWebGPUBuffer3 : GWebGPUBuffer3;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nfn unpack_float(packedValue : f32) -> vec2<i32> {var packedIntValue : i32 = i32(packedValue);\\nvar v0 : i32 = packedIntValue / 1048576;\\nreturn vec2<i32>(v0, packedIntValue - (v0 * 1048576));}\\nfn calcRepulsive(i : i32, currentNode : vec4<f32>) -> vec2<f32> {var ax : f32 = 0.0;\\nvar ay : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {if (i != j) {var nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nvar vx : f32 = currentNode.x - nextNode.x;\\nvar vy : f32 = currentNode.y - nextNode.y;\\nvar dist : f32 = std::sqrt((vx * vx) + (vy * vy)) + 0.01;\\nvar n_dist : f32 = (dist + 0.1) * gWebGPUUniformParams.u_coulombDisScale;\\nvar direx : f32 = vx / dist;\\nvar direy : f32 = vy / dist;\\nvar attributesi : vec4<f32> = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvar attributesj : vec4<f32> = gWebGPUBuffer2.u_NodeAttributeArray1[j];\\nvar massi : f32 = attributesi.x;\\nvar nodeStrengthi : f32 = attributesi.z;\\nvar nodeStrengthj : f32 = attributesj.z;\\nvar nodeStrength : f32 = (nodeStrengthi + nodeStrengthj) / 2.0;\\nvar param : f32 = (nodeStrength * gWebGPUUniformParams.u_factor) / (n_dist * n_dist);\\nax = ax + direx * param;\\nay = ay + direy * param;}}\\nreturn vec2<f32>(ax, ay);}\\nfn calcGravity(i : i32, currentNode : vec4<f32>, attributes2 : vec4<f32>) -> vec2<f32> {var vx : f32 = currentNode.x - attributes2.x;\\nvar vy : f32 = currentNode.y - attributes2.y;\\nvar ax : f32 = vx * attributes2.z;\\nvar ay : f32 = vy * attributes2.z;\\nreturn vec2<f32>(ax, ay);}\\nfn calcAttractive(i : i32, currentNode : vec4<f32>, attributes1 : vec4<f32>) -> vec2<f32> {var mass : f32 = attributes1.x;\\nvar ax : f32 = 0.0;\\nvar ay : f32 = 0.0;\\nvar compressed : vec2<i32> = unpack_float(currentNode.z);\\nvar length : i32 = compressed.x;\\nvar arr_offset : i32 = compressed.y;\\nvar node_buffer : vec4<f32>;\\nfor (var p : i32 = 0; p < __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX; p = p + 1) {if (p >= length) {break;}\\nvar arr_idx : i32 = arr_offset + (4 * p);\\nvar buf_offset : i32 = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[i32(arr_idx / 4)];}\\nvar float_j : f32 = node_buffer.x;\\nvar nextNode : vec4<f32> = gWebGPUBuffer0.u_Data[i32(float_j)];\\nvar vx : f32 = nextNode.x - currentNode.x;\\nvar vy : f32 = nextNode.y - currentNode.y;\\nvar dist : f32 = std::sqrt((vx * vx) + (vy * vy)) + 0.01;\\nvar direx : f32 = vx / dist;\\nvar direy : f32 = vy / dist;\\nvar edgeLength : f32 = node_buffer.y;\\nvar edgeStrength : f32 = node_buffer.z;\\nvar diff : f32 = edgeLength - dist;\\nvar param : f32 = (diff * edgeStrength) / mass;\\nax = ax - direx * param;\\nay = ay - direy * param;}\\nreturn vec2<f32>(ax, ay);}\\nfn main() -> void {var i : i32 = globalInvocationID.x;\\nvar currentNode : vec4<f32> = gWebGPUBuffer0.u_Data[i];\\nvar movement : vec4<f32> = gWebGPUBuffer1.u_AveMovement[0];\\nvar ax : f32 = 0.0;\\nvar ay : f32 = 0.0;\\nif ((i >= __DefineValuePlaceholder__VERTEX_COUNT) || (movement.x < gWebGPUUniformParams.u_minMovement)) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvar nodeAttributes1 : vec4<f32> = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvar nodeAttributes2 : vec4<f32> = gWebGPUBuffer3.u_NodeAttributeArray2[i];\\nvar repulsive : vec2<f32> = calcRepulsive(i, currentNode);\\nax = ax + repulsive.x;\\nay = ay + repulsive.y;\\nvar attractive : vec2<f32> = calcAttractive(i, currentNode, nodeAttributes1);\\nax = ax + attractive.x;\\nay = ay + attractive.y;\\nvar gravity : vec2<f32> = calcGravity(i, currentNode, nodeAttributes2);\\nax = ax - gravity.x;\\nay = ay - gravity.y;\\nvar param : f32 = gWebGPUUniformParams.u_interval * gWebGPUUniformParams.u_damping;\\nvar vx : f32 = ax * param;\\nvar vy : f32 = ay * param;\\nvar vlength : f32 = std::sqrt((vx * vx) + (vy * vy)) + 0.0001;\\nif (vlength > gWebGPUUniformParams.u_maxSpeed) {var param2 : f32 = gWebGPUUniformParams.u_maxSpeed / vlength;\\nvx = param2 * vx;\\nvy = param2 * vy;}\\nvar distx : f32 = vx * gWebGPUUniformParams.u_interval;\\nvar disty : f32 = vy * gWebGPUUniformParams.u_interval;\\nvar distLength : f32 = std::sqrt((distx * distx) + (disty * disty));\\nif ((nodeAttributes1.w != 0.0) && (nodeAttributes2.w != 0.0)) {gWebGPUBuffer0.u_Data[i] = vec4<f32>(nodeAttributes1.w, nodeAttributes2.w, currentNode.z, 0.0);}else {gWebGPUBuffer0.u_Data[i] = vec4<f32>(currentNode.x + distx, currentNode.y + disty, currentNode.z, distLength);}\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\nlayout(std140, set = 0, binding = 0) uniform GWebGPUParams {\\n  float u_damping;\\n  float u_maxSpeed;\\n  float u_minMovement;\\n  \\n  float u_coulombDisScale;\\n  float u_factor;\\n  \\n  \\n  float u_interval;\\n} gWebGPUUniformParams;\\nlayout(std430, set = 0, binding = 1) buffer   GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 2) buffer readonly  GWebGPUBuffer1 {\\n  vec4 u_AveMovement[];\\n} gWebGPUBuffer1;\\n\\nlayout(std430, set = 0, binding = 3) buffer readonly  GWebGPUBuffer2 {\\n  vec4 u_NodeAttributeArray1[];\\n} gWebGPUBuffer2;\\n\\nlayout(std430, set = 0, binding = 4) buffer readonly  GWebGPUBuffer3 {\\n  vec4 u_NodeAttributeArray2[];\\n} gWebGPUBuffer3;\\n\\n\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define SHIFT_20 1048576.0\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nivec2 unpack_float(float packedValue) {int packedIntValue = int(packedValue);\\nint v0 = packedIntValue / int(SHIFT_20);\\nreturn ivec2(v0, packedIntValue - (v0 * int(SHIFT_20)));}\\nvec2 calcRepulsive(int i, vec4 currentNode) {float ax = 0.0;\\nfloat ay = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = gWebGPUBuffer0.u_Data[j];\\nfloat vx = currentNode.x - nextNode.x;\\nfloat vy = currentNode.y - nextNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat n_dist = (dist + 0.1) * gWebGPUUniformParams.u_coulombDisScale;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nvec4 attributesi = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvec4 attributesj = gWebGPUBuffer2.u_NodeAttributeArray1[j];\\nfloat massi = attributesi.x;\\nfloat nodeStrengthi = attributesi.z;\\nfloat nodeStrengthj = attributesj.z;\\nfloat nodeStrength = (nodeStrengthi + nodeStrengthj) / 2.0;\\nfloat param = (nodeStrength * gWebGPUUniformParams.u_factor) / (n_dist * n_dist);\\nax += direx * param;\\nay += direy * param;}}\\nreturn vec2(ax, ay);}\\nvec2 calcGravity(int i, vec4 currentNode, vec4 attributes2) {float vx = currentNode.x - attributes2.x;\\nfloat vy = currentNode.y - attributes2.y;\\nfloat ax = vx * attributes2.z;\\nfloat ay = vy * attributes2.z;\\nreturn vec2(ax, ay);}\\nvec2 calcAttractive(int i, vec4 currentNode, vec4 attributes1) {float mass = attributes1.x;\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nivec2 compressed = unpack_float(currentNode.z);\\nint length = compressed.x;\\nint arr_offset = compressed.y;\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + (4 * p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = gWebGPUBuffer0.u_Data[int(arr_idx / 4)];}\\nfloat float_j = node_buffer.x;\\nvec4 nextNode = gWebGPUBuffer0.u_Data[int(float_j)];\\nfloat vx = nextNode.x - currentNode.x;\\nfloat vy = nextNode.y - currentNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nfloat edgeLength = node_buffer.y;\\nfloat edgeStrength = node_buffer.z;\\nfloat diff = edgeLength - dist;\\nfloat param = (diff * edgeStrength) / mass;\\nax -= direx * param;\\nay -= direy * param;}\\nreturn vec2(ax, ay);}\\nvoid main() {int i = globalInvocationID.x;\\nvec4 currentNode = gWebGPUBuffer0.u_Data[i];\\nvec4 movement = gWebGPUBuffer1.u_AveMovement[0];\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nif ((i >= VERTEX_COUNT) || (movement.x < gWebGPUUniformParams.u_minMovement)) {gWebGPUBuffer0.u_Data[i] = currentNode;\\nreturn ;}\\nvec4 nodeAttributes1 = gWebGPUBuffer2.u_NodeAttributeArray1[i];\\nvec4 nodeAttributes2 = gWebGPUBuffer3.u_NodeAttributeArray2[i];\\nvec2 repulsive = calcRepulsive(i, currentNode);\\nax += repulsive.x;\\nay += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode, nodeAttributes1);\\nax += attractive.x;\\nay += attractive.y;\\nvec2 gravity = calcGravity(i, currentNode, nodeAttributes2);\\nax -= gravity.x;\\nay -= gravity.y;\\nfloat param = gWebGPUUniformParams.u_interval * gWebGPUUniformParams.u_damping;\\nfloat vx = ax * param;\\nfloat vy = ay * param;\\nfloat vlength = sqrt((vx * vx) + (vy * vy)) + 0.0001;\\nif (vlength > gWebGPUUniformParams.u_maxSpeed) {float param2 = gWebGPUUniformParams.u_maxSpeed / vlength;\\nvx = param2 * vx;\\nvy = param2 * vy;}\\nfloat distx = vx * gWebGPUUniformParams.u_interval;\\nfloat disty = vy * gWebGPUUniformParams.u_interval;\\nfloat distLength = sqrt((distx * distx) + (disty * disty));\\nif ((nodeAttributes1.w != 0.0) && (nodeAttributes2.w != 0.0)) {gWebGPUBuffer0.u_Data[i] = vec4(nodeAttributes1.w, nodeAttributes2.w, currentNode.z, 0.0);}else {gWebGPUBuffer0.u_Data[i] = vec4(currentNode.x + distx, currentNode.y + disty, currentNode.z, distLength);}}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define MAX_EDGE_PER_VERTEX __DefineValuePlaceholder__MAX_EDGE_PER_VERTEX\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n#define SHIFT_20 1048576.0\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform float u_damping;\\nuniform float u_maxSpeed;\\nuniform float u_minMovement;\\nuniform sampler2D u_AveMovement;\\nuniform vec2 u_AveMovementSize;\\nvec4 getDatau_AveMovement(vec2 address2D) {\\n  return vec4(texture2D(u_AveMovement, address2D).rgba);\\n}\\nvec4 getDatau_AveMovement(float address1D) {\\n  return getDatau_AveMovement(addrTranslation_1Dto2D(address1D, u_AveMovementSize));\\n}\\nvec4 getDatau_AveMovement(int address1D) {\\n  return getDatau_AveMovement(float(address1D));\\n}\\nuniform float u_coulombDisScale;\\nuniform float u_factor;\\nuniform sampler2D u_NodeAttributeArray1;\\nuniform vec2 u_NodeAttributeArray1Size;\\nvec4 getDatau_NodeAttributeArray1(vec2 address2D) {\\n  return vec4(texture2D(u_NodeAttributeArray1, address2D).rgba);\\n}\\nvec4 getDatau_NodeAttributeArray1(float address1D) {\\n  return getDatau_NodeAttributeArray1(addrTranslation_1Dto2D(address1D, u_NodeAttributeArray1Size));\\n}\\nvec4 getDatau_NodeAttributeArray1(int address1D) {\\n  return getDatau_NodeAttributeArray1(float(address1D));\\n}\\nuniform sampler2D u_NodeAttributeArray2;\\nuniform vec2 u_NodeAttributeArray2Size;\\nvec4 getDatau_NodeAttributeArray2(vec2 address2D) {\\n  return vec4(texture2D(u_NodeAttributeArray2, address2D).rgba);\\n}\\nvec4 getDatau_NodeAttributeArray2(float address1D) {\\n  return getDatau_NodeAttributeArray2(addrTranslation_1Dto2D(address1D, u_NodeAttributeArray2Size));\\n}\\nvec4 getDatau_NodeAttributeArray2(int address1D) {\\n  return getDatau_NodeAttributeArray2(float(address1D));\\n}\\nuniform float u_interval;\\nivec2 unpack_float(float packedValue) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint packedIntValue = int(packedValue);\\nint v0 = packedIntValue / int(SHIFT_20);\\nreturn ivec2(v0, packedIntValue - (v0 * int(SHIFT_20)));}\\nvec2 calcRepulsive(int i, vec4 currentNode) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {if (i != j) {vec4 nextNode = getDatau_Data(j);\\nfloat vx = currentNode.x - nextNode.x;\\nfloat vy = currentNode.y - nextNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat n_dist = (dist + 0.1) * u_coulombDisScale;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nvec4 attributesi = getDatau_NodeAttributeArray1(i);\\nvec4 attributesj = getDatau_NodeAttributeArray1(j);\\nfloat massi = attributesi.x;\\nfloat nodeStrengthi = attributesi.z;\\nfloat nodeStrengthj = attributesj.z;\\nfloat nodeStrength = (nodeStrengthi + nodeStrengthj) / 2.0;\\nfloat param = (nodeStrength * u_factor) / (n_dist * n_dist);\\nax += direx * param;\\nay += direy * param;}}\\nreturn vec2(ax, ay);}\\nvec2 calcGravity(int i, vec4 currentNode, vec4 attributes2) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat vx = currentNode.x - attributes2.x;\\nfloat vy = currentNode.y - attributes2.y;\\nfloat ax = vx * attributes2.z;\\nfloat ay = vy * attributes2.z;\\nreturn vec2(ax, ay);}\\nvec2 calcAttractive(int i, vec4 currentNode, vec4 attributes1) {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat mass = attributes1.x;\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nivec2 compressed = unpack_float(currentNode.z);\\nint length = compressed.x;\\nint arr_offset = compressed.y;\\nvec4 node_buffer;\\nfor (int p = 0; p < MAX_EDGE_PER_VERTEX; p++) {if (p >= length) {break;}\\nint arr_idx = arr_offset + (4 * p);\\nint buf_offset = arr_idx - ((arr_idx / 4) * 4);\\nif ((p == 0) || (buf_offset == 0)) {node_buffer = getDatau_Data(int(arr_idx / 4));}\\nfloat float_j = node_buffer.x;\\nvec4 nextNode = getDatau_Data(int(float_j));\\nfloat vx = nextNode.x - currentNode.x;\\nfloat vy = nextNode.y - currentNode.y;\\nfloat dist = sqrt((vx * vx) + (vy * vy)) + 0.01;\\nfloat direx = vx / dist;\\nfloat direy = vy / dist;\\nfloat edgeLength = node_buffer.y;\\nfloat edgeStrength = node_buffer.z;\\nfloat diff = edgeLength - dist;\\nfloat param = (diff * edgeStrength) / mass;\\nax -= direx * param;\\nay -= direy * param;}\\nreturn vec2(ax, ay);}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nint i = globalInvocationID.x;\\nvec4 currentNode = getDatau_Data(i);\\nvec4 movement = getDatau_AveMovement(0.0);\\nfloat ax = 0.0;\\nfloat ay = 0.0;\\nif ((i >= VERTEX_COUNT) || (movement.x < u_minMovement)) {gl_FragColor = vec4(currentNode);\\nreturn ;}\\nvec4 nodeAttributes1 = getDatau_NodeAttributeArray1(i);\\nvec4 nodeAttributes2 = getDatau_NodeAttributeArray2(i);\\nvec2 repulsive = calcRepulsive(i, currentNode);\\nax += repulsive.x;\\nay += repulsive.y;\\nvec2 attractive = calcAttractive(i, currentNode, nodeAttributes1);\\nax += attractive.x;\\nay += attractive.y;\\nvec2 gravity = calcGravity(i, currentNode, nodeAttributes2);\\nax -= gravity.x;\\nay -= gravity.y;\\nfloat param = u_interval * u_damping;\\nfloat vx = ax * param;\\nfloat vy = ay * param;\\nfloat vlength = sqrt((vx * vx) + (vy * vy)) + 0.0001;\\nif (vlength > u_maxSpeed) {float param2 = u_maxSpeed / vlength;\\nvx = param2 * vx;\\nvy = param2 * vy;}\\nfloat distx = vx * u_interval;\\nfloat disty = vy * u_interval;\\nfloat distLength = sqrt((distx * distx) + (disty * disty));\\nif ((nodeAttributes1.w != 0.0) && (nodeAttributes2.w != 0.0)) {gl_FragColor = vec4(vec4(nodeAttributes1.w, nodeAttributes2.w, currentNode.z, 0.0));}else {gl_FragColor = vec4(vec4(currentNode.x + distx, currentNode.y + disty, currentNode.z, distLength));}if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"MAX_EDGE_PER_VERTEX","type":"Float","runtime":true},{"name":"VERTEX_COUNT","type":"Float","runtime":true},{"name":"SHIFT_20","type":"Float","value":1048576,"runtime":false}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]},{"name":"u_damping","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_maxSpeed","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_minMovement","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_AveMovement","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_coulombDisScale","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_factor","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_NodeAttributeArray1","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_NodeAttributeArray2","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_interval","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_Data","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([a,1,1]).setBinding({u_Data:c,u_damping:n.damping,u_maxSpeed:n.maxSpeed,u_minMovement:n.minMovement,u_coulombDisScale:n.coulombDisScale,u_factor:n.factor,u_NodeAttributeArray1:_,u_NodeAttributeArray2:x,MAX_EDGE_PER_VERTEX:s,VERTEX_COUNT:a,u_AveMovement:A,u_interval:n.interval}),I=w.createKernel('{"shaders":{"WGSL":"import \\"GLSL.std.450\\" as std;\\n\\n\\n# var gWebGPUDebug : bool = false;\\n# var gWebGPUDebugOutput : vec4<f32> = vec4<f32>(0.0);\\n\\n[[builtin global_invocation_id]] var<in> globalInvocationID : vec3<u32>;\\n# [[builtin work_group_size]] var<in> workGroupSize : vec3<u32>;\\n# [[builtin work_group_id]] var<in> workGroupID : vec3<u32>;\\n[[builtin local_invocation_id]] var<in> localInvocationID : vec3<u32>;\\n# [[builtin num_work_groups]] var<in> numWorkGroups : vec3<u32>;\\n[[builtin local_invocation_idx]] var<in> localInvocationIndex : u32;\\n\\ntype GWebGPUParams = [[block]] struct {\\n  [[offset 0]] u_iter : f32;\\n};\\n[[binding 0, set 0]] var<uniform> gWebGPUUniformParams : GWebGPUParams;\\ntype GWebGPUBuffer0 = [[block]] struct {\\n  [[offset 0]] u_Data : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 1, set 0]] var<storage_buffer> gWebGPUBuffer0 : GWebGPUBuffer0;\\ntype GWebGPUBuffer1 = [[block]] struct {\\n  [[offset 0]] u_AveMovement : [[stride 16]] array<vec4<f32>>;\\n};\\n[[binding 2, set 0]] var<storage_buffer> gWebGPUBuffer1 : GWebGPUBuffer1;\\n\\n\\n\\n\\n\\n\\n\\n\\nfn main() -> void {var movement : f32 = 0.0;\\nfor (var j : i32 = 0; j < __DefineValuePlaceholder__VERTEX_COUNT; j = j + 1) {var vertex : vec4<f32> = gWebGPUBuffer0.u_Data[j];\\nmovement = movement + vertex.w;}\\nmovement = movement / f32(__DefineValuePlaceholder__VERTEX_COUNT);\\ngWebGPUBuffer1.u_AveMovement[0] = vec4<f32>(movement, 0.0, 0.0, 0.0);\\nreturn;}\\n\\nentry_point compute as \\"main\\" = main;\\n","GLSL450":"\\n\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\nivec3 globalInvocationID = ivec3(gl_GlobalInvocationID);\\nivec3 workGroupSize = ivec3(1,1,1);\\nivec3 workGroupID = ivec3(gl_WorkGroupID);\\nivec3 localInvocationID = ivec3(gl_LocalInvocationID);\\nivec3 numWorkGroups = ivec3(gl_NumWorkGroups);\\nint localInvocationIndex = int(gl_LocalInvocationIndex);\\n\\nlayout(std140, set = 0, binding = 0) uniform GWebGPUParams {\\n  float u_iter;\\n} gWebGPUUniformParams;\\nlayout(std430, set = 0, binding = 1) buffer readonly  GWebGPUBuffer0 {\\n  vec4 u_Data[];\\n} gWebGPUBuffer0;\\n\\nlayout(std430, set = 0, binding = 2) buffer   GWebGPUBuffer1 {\\n  vec4 u_AveMovement[];\\n} gWebGPUBuffer1;\\n\\n\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\nlayout (\\n  local_size_x = 1,\\n  local_size_y = 1,\\n  local_size_z = 1\\n) in;\\n\\n\\n\\nvoid main() {float movement = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 vertex = gWebGPUBuffer0.u_Data[j];\\nmovement += vertex.w;}\\nmovement = movement / float(VERTEX_COUNT);\\ngWebGPUBuffer1.u_AveMovement[0] = vec4(movement, 0.0, 0.0, 0.0);}\\n","GLSL100":"\\n\\nfloat epsilon = 0.00001;\\nvec2 addrTranslation_1Dto2D(float address1D, vec2 texSize) {\\n  vec2 conv_const = vec2(1.0 / texSize.x, 1.0 / (texSize.x * texSize.y));\\n  vec2 normAddr2D = float(address1D) * conv_const;\\n  return vec2(fract(normAddr2D.x + epsilon), normAddr2D.y);\\n}\\n\\nvoid barrier() {}\\n  \\n\\nuniform vec2 u_OutputTextureSize;\\nuniform int u_OutputTexelCount;\\nvarying vec2 v_TexCoord;\\n\\nbool gWebGPUDebug = false;\\nvec4 gWebGPUDebugOutput = vec4(0.0);\\n\\n#define VERTEX_COUNT __DefineValuePlaceholder__VERTEX_COUNT\\n\\nuniform sampler2D u_Data;\\nuniform vec2 u_DataSize;\\nvec4 getDatau_Data(vec2 address2D) {\\n  return vec4(texture2D(u_Data, address2D).rgba);\\n}\\nvec4 getDatau_Data(float address1D) {\\n  return getDatau_Data(addrTranslation_1Dto2D(address1D, u_DataSize));\\n}\\nvec4 getDatau_Data(int address1D) {\\n  return getDatau_Data(float(address1D));\\n}\\nuniform float u_iter;\\nuniform sampler2D u_AveMovement;\\nuniform vec2 u_AveMovementSize;\\nvec4 getDatau_AveMovement(vec2 address2D) {\\n  return vec4(texture2D(u_AveMovement, address2D).rgba);\\n}\\nvec4 getDatau_AveMovement(float address1D) {\\n  return getDatau_AveMovement(addrTranslation_1Dto2D(address1D, u_AveMovementSize));\\n}\\nvec4 getDatau_AveMovement(int address1D) {\\n  return getDatau_AveMovement(float(address1D));\\n}\\nvoid main() {\\nivec3 workGroupSize = ivec3(1, 1, 1);\\nivec3 numWorkGroups = ivec3(1, 1, 1);     \\nint globalInvocationIndex = int(floor(v_TexCoord.x * u_OutputTextureSize.x))\\n  + int(floor(v_TexCoord.y * u_OutputTextureSize.y)) * int(u_OutputTextureSize.x);\\nint workGroupIDLength = globalInvocationIndex / (workGroupSize.x * workGroupSize.y * workGroupSize.z);\\nivec3 workGroupID = ivec3(workGroupIDLength / numWorkGroups.y / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.z, workGroupIDLength / numWorkGroups.x / numWorkGroups.y);\\nint localInvocationIDZ = globalInvocationIndex / (workGroupSize.x * workGroupSize.y);\\nint localInvocationIDY = (globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y) / workGroupSize.x;\\nint localInvocationIDX = globalInvocationIndex - localInvocationIDZ * workGroupSize.x * workGroupSize.y - localInvocationIDY * workGroupSize.x;\\nivec3 localInvocationID = ivec3(localInvocationIDX, localInvocationIDY, localInvocationIDZ);\\nivec3 globalInvocationID = workGroupID * workGroupSize + localInvocationID;\\nint localInvocationIndex = localInvocationID.z * workGroupSize.x * workGroupSize.y\\n                + localInvocationID.y * workGroupSize.x + localInvocationID.x;\\nfloat movement = 0.0;\\nfor (int j = 0; j < VERTEX_COUNT; j++) {vec4 vertex = getDatau_Data(j);\\nmovement += vertex.w;}\\nmovement = movement / float(VERTEX_COUNT);\\ngl_FragColor = vec4(vec4(movement, 0.0, 0.0, 0.0));if (gWebGPUDebug) {\\n  gl_FragColor = gWebGPUDebugOutput;\\n}}\\n"},"context":{"name":"","dispatch":[1,1,1],"threadGroupSize":[1,1,1],"maxIteration":1,"defines":[{"name":"VERTEX_COUNT","type":"Float","runtime":true}],"uniforms":[{"name":"u_Data","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_iter","type":"Float","storageClass":"Uniform","readonly":true,"writeonly":false,"size":[1,1]},{"name":"u_AveMovement","type":"vec4<f32>[]","storageClass":"StorageBuffer","readonly":false,"writeonly":false,"size":[1,1]}],"globalDeclarations":[],"output":{"name":"u_AveMovement","size":[1,1],"length":1},"needPingpong":true}}').setDispatch([1,1,1]).setBinding({u_Data:c,VERTEX_COUNT:a,u_AveMovement:[0,0,0,0]});yield(()=>mE(this,void 0,void 0,(function*(){for(let e=0;e<o;e++){yield T.execute(),I.setBinding({u_Data:T}),yield I.execute();const t=Math.max(.02,n.interval-.002*e);T.setBinding({u_interval:t,u_AveMovement:I})}const i=yield T.getOutput();e?t.postMessage({type:ke,vertexEdgeData:i}):r.forEach(((e,t)=>{const n=i[4*t],r=i[4*t+1];e.x=n,e.y=r})),S&&S()})))()}))}getType(){return"gForce-gpu"}}class bE extends o{constructor(e){super(),this.center=[0,0],this.maxIteration=100,this.gravity=10,this.comboGravity=10,this.linkDistance=10,this.alpha=1,this.alphaMin=.001,this.alphaDecay=1-Math.pow(this.alphaMin,1/300),this.alphaTarget=0,this.velocityDecay=.6,this.edgeStrength=.6,this.nodeStrength=30,this.preventOverlap=!1,this.preventNodeOverlap=!1,this.preventComboOverlap=!1,this.collideStrength=void 0,this.nodeCollideStrength=.5,this.comboCollideStrength=.5,this.comboSpacing=20,this.comboPadding=10,this.optimizeRangeFactor=1,this.onTick=()=>{},this.onLayoutEnd=()=>{},this.depthAttractiveForceScale=1,this.depthRepulsiveForceScale=2,this.nodes=[],this.edges=[],this.combos=[],this.comboTrees=[],this.width=300,this.height=300,this.bias=[],this.nodeMap={},this.oriComboMap={},this.indexMap={},this.comboMap={},this.previousLayouted=!1,this.updateCfg(e)}getDefaultCfg(){return{maxIteration:100,center:[0,0],gravity:10,speed:1,comboGravity:30,preventOverlap:!1,preventComboOverlap:!0,preventNodeOverlap:!0,nodeSpacing:void 0,collideStrength:void 0,nodeCollideStrength:.5,comboCollideStrength:.5,comboSpacing:20,comboPadding:10,edgeStrength:.6,nodeStrength:30,linkDistance:10}}execute(){const e=this,t=e.nodes,n=e.center;if(e.comboTree={id:"comboTreeRoot",depth:-1,children:e.comboTrees},t&&0!==t.length){if(1===t.length)return t[0].x=n[0],t[0].y=n[1],void(e.onLayoutEnd&&e.onLayoutEnd());e.initVals(),e.run(),e.onLayoutEnd&&e.onLayoutEnd()}else e.onLayoutEnd&&e.onLayoutEnd()}run(){const e=this,t=e.nodes,n=e.previousLayouted?e.maxIteration/5:e.maxIteration;e.width||"undefined"==typeof window||(e.width=window.innerWidth),e.height||"undefined"==typeof window||(e.height=window.innerHeight);const r=e.center,i=e.velocityDecay,o=e.comboMap;e.previousLayouted||e.initPos(o);for(let r=0;r<n;r++){const n=[];t.forEach(((e,t)=>{n[t]={x:0,y:0}})),e.applyCalculate(n),e.applyComboCenterForce(n),t.forEach(((e,t)=>{u(e.x)&&u(e.y)&&(e.x+=n[t].x*i,e.y+=n[t].y*i)})),e.alpha+=(e.alphaTarget-e.alpha)*e.alphaDecay,e.onTick()}const a=[0,0];t.forEach((e=>{u(e.x)&&u(e.y)&&(a[0]+=e.x,a[1]+=e.y)})),a[0]/=t.length,a[1]/=t.length;const s=[r[0]-a[0],r[1]-a[1]];t.forEach(((e,t)=>{u(e.x)&&u(e.y)&&(e.x+=s[0],e.y+=s[1])})),e.combos.forEach((e=>{const t=o[e.id];t&&t.empty&&(e.x=t.cx||e.x,e.y=t.cy||e.y)})),e.previousLayouted=!0}initVals(){const e=this,t=e.edges,n=e.nodes,r=e.combos,i={},o={},a={};n.forEach(((e,t)=>{o[e.id]=e,a[e.id]=t})),e.nodeMap=o,e.indexMap=a;const c={};r.forEach((e=>{c[e.id]=e})),e.oriComboMap=c,e.comboMap=e.getComboMap();const f=e.preventOverlap;e.preventComboOverlap=e.preventComboOverlap||f,e.preventNodeOverlap=e.preventNodeOverlap||f;const h=e.collideStrength;h&&(e.comboCollideStrength=h,e.nodeCollideStrength=h),e.comboCollideStrength=e.comboCollideStrength?e.comboCollideStrength:0,e.nodeCollideStrength=e.nodeCollideStrength?e.nodeCollideStrength:0;for(let e=0;e<t.length;++e){const n=d(t[e],"source"),r=d(t[e],"target");i[n]?i[n]++:i[n]=1,i[r]?i[r]++:i[r]=1}const p=[];for(let e=0;e<t.length;++e){const n=d(t[e],"source"),r=d(t[e],"target");p[e]=i[n]/(i[n]+i[r])}this.bias=p;const g=e.nodeSize,v=e.nodeSpacing;let m,y;if(y=u(v)?()=>v:_(v)?v:()=>0,this.nodeSpacing=y,g)if(_(g))m=e=>g(e);else if(s(g)){const e=(g[0]>g[1]?g[0]:g[1])/2;m=t=>e}else{const e=g/2;m=t=>e}else m=e=>e.size?s(e.size)?(e.size[0]>e.size[1]?e.size[0]:e.size[1])/2:l(e.size)?(e.size.width>e.size.height?e.size.width:e.size.height)/2:e.size/2:10;this.nodeSize=m;const b=e.comboSpacing;let E;E=u(b)?()=>b:_(b)?b:()=>0,this.comboSpacing=E;const x=e.comboPadding;let w;w=u(x)?()=>x:s(x)?()=>Math.max.apply(null,x):_(x)?x:()=>0,this.comboPadding=w;let S,A=this.linkDistance;A||(A=10),S=u(A)?e=>A:A,this.linkDistance=S;let T,I=this.edgeStrength;I||(I=1),T=u(I)?e=>I:I,this.edgeStrength=T;let N,D=this.nodeStrength;D||(D=30),N=u(D)?e=>D:D,this.nodeStrength=N}initPos(e){this.nodes.forEach(((t,n)=>{const r=t.comboId,i=e[r];r&&i?(t.x=i.cx+100/(n+1),t.y=i.cy+100/(n+1)):(t.x=100/(n+1),t.y=100/(n+1))}))}getComboMap(){const e=this,t=e.nodeMap,n=e.comboTrees,r=e.oriComboMap,i={};return(n||[]).forEach((n=>{const o=[];m(n,(n=>{if("node"===n.itemType)return!0;if(!r[n.id])return!0;if(void 0===i[n.id]){const t={id:n.id,name:n.id,cx:0,cy:0,count:0,depth:e.oriComboMap[n.id].depth||0,children:[]};i[n.id]=t}const a=n.children;a&&a.forEach((e=>{if(!i[e.id]&&!t[e.id])return!0;o.push(e)}));const s=i[n.id];if(s.cx=0,s.cy=0,0===o.length){s.empty=!0;const e=r[n.id];s.cx=e.x,s.cy=e.y}return o.forEach((e=>{if(s.count++,"node"!==e.itemType){const t=i[e.id];return u(t.cx)&&(s.cx+=t.cx),void(u(t.cy)&&(s.cy+=t.cy))}const n=t[e.id];n&&(u(n.x)&&(s.cx+=n.x),u(n.y)&&(s.cy+=n.y))})),s.cx/=s.count||1,s.cy/=s.count||1,s.children=o,!0}))})),i}applyComboCenterForce(e){const t=this,n=t.gravity,r=t.comboGravity||n,i=this.alpha,o=t.comboTrees,a=t.indexMap,s=t.nodeMap,c=t.comboMap;(o||[]).forEach((t=>{m(t,(t=>{if("node"===t.itemType)return!0;if(!c[t.id])return!0;const n=c[t.id],o=(n.depth+1)/10*.5,l=n.cx,f=n.cy;return n.cx=0,n.cy=0,n.children.forEach((t=>{if("node"!==t.itemType){const e=c[t.id];return e&&u(e.cx)&&(n.cx+=e.cx),void(e&&u(e.cy)&&(n.cy+=e.cy))}const d=s[t.id],h=d.x-l||.005,p=d.y-f||.005,g=Math.sqrt(h*h+p*p),v=a[d.id],m=r*i/g*o;e[v].x-=h*m,e[v].y-=p*m,u(d.x)&&(n.cx+=d.x),u(d.y)&&(n.cy+=d.y)})),n.cx/=n.count||1,n.cy/=n.count||1,!0}))}))}applyCalculate(e){const t=this,n=t.comboMap,r=t.nodes,i={};r.forEach(((e,t)=>{r.forEach(((n,r)=>{if(t<r)return;const o=e.x-n.x||.005,a=e.y-n.y||.005;let s=o*o+a*a;const u=Math.sqrt(s);s<1&&(s=u),i[`${e.id}-${n.id}`]={vx:o,vy:a,vl2:s,vl:u},i[`${n.id}-${e.id}`]={vl2:s,vl:u,vx:-o,vy:-a}}))})),t.updateComboSizes(n),t.calRepulsive(e,i),t.calAttractive(e,i),t.preventComboOverlap&&t.comboNonOverlapping(e,n)}updateComboSizes(e){const t=this,n=t.comboTrees,r=t.nodeMap,i=t.nodeSize,o=t.comboSpacing,a=t.comboPadding;(n||[]).forEach((n=>{const u=[];m(n,(n=>{if("node"===n.itemType)return!0;const c=e[n.id];if(!c)return!1;const l=n.children;l&&l.forEach((t=>{(e[t.id]||r[t.id])&&u.push(t)})),c.minX=1/0,c.minY=1/0,c.maxX=-1/0,c.maxY=-1/0,u.forEach((e=>{if("node"!==e.itemType)return!0;const t=r[e.id];if(!t)return!0;const n=i(t),o=t.x-n,a=t.y-n,s=t.x+n,u=t.y+n;c.minX>o&&(c.minX=o),c.minY>a&&(c.minY=a),c.maxX<s&&(c.maxX=s),c.maxY<u&&(c.maxY=u)}));let f=t.oriComboMap[n.id].size||10;s(f)&&(f=f[0]);const d=Math.max(c.maxX-c.minX,c.maxY-c.minY,f);return c.r=d/2+o(c)/2+a(c),!0}))}))}comboNonOverlapping(e,t){const n=this,r=n.comboTree,i=n.comboCollideStrength,o=n.indexMap,a=n.nodeMap;m(r,(n=>{if(!t[n.id]&&!a[n.id]&&"comboTreeRoot"!==n.id)return!1;const r=n.children;return r&&r.length>1&&r.forEach(((n,s)=>{if("node"===n.itemType)return!1;const u=t[n.id];u&&r.forEach(((r,c)=>{if(s<=c)return!1;if("node"===r.itemType)return!1;const l=t[r.id];if(!l)return!1;const f=u.cx-l.cx||.005,d=u.cy-l.cy||.005,h=f*f+d*d,p=u.r||1,g=l.r||1,v=p+g,m=g*g,y=p*p;if(h<v*v){const t=n.children;if(!t||0===t.length)return!1;const s=r.children;if(!s||0===s.length)return!1;const u=Math.sqrt(h),c=(v-u)/u*i,l=f*c,p=d*c,g=m/(y+m),b=1-g;t.forEach((t=>{if("node"!==t.itemType)return!1;if(!a[t.id])return;const n=o[t.id];s.forEach((t=>{if("node"!==t.itemType)return!1;if(!a[t.id])return!1;const r=o[t.id];e[n].x+=l*g,e[n].y+=p*g,e[r].x-=l*b,e[r].y-=p*b}))}))}}))})),!0}))}calRepulsive(e,t){const n=this,r=n.nodes,i=n.width*n.optimizeRangeFactor,o=n.nodeStrength,a=n.alpha,s=n.nodeCollideStrength,u=n.preventNodeOverlap,c=n.nodeSize,l=n.nodeSpacing,f=n.depthRepulsiveForceScale,d=n.center;r.forEach(((h,p)=>{if(h.x&&h.y){if(d){const t=n.gravity,r=h.x-d[0]||.005,i=h.y-d[1]||.005,o=Math.sqrt(r*r+i*i);e[p].x-=r*t*a/o,e[p].y-=i*t*a/o}r.forEach(((n,r)=>{if(p===r)return;if(!n.x||!n.y)return;const{vl2:d,vl:g}=t[`${h.id}-${n.id}`];if(g>i)return;const{vx:v,vy:m}=t[`${h.id}-${n.id}`];let y=Math.log(Math.abs(n.depth-h.depth)/10)+1||1;y=y<1?1:y,n.comboId!==h.comboId&&(y+=1);const b=y?Math.pow(f,y):1,E=o(n)*a/d*b;if(e[p].x+=v*E,e[p].y+=m*E,p<r&&u){const t=c(h)+l(h)||1,i=c(n)+l(n)||1,o=t+i;if(d<o*o){const n=(o-g)/g*s,a=i*i;let u=a/(t*t+a);const c=v*n,l=m*n;e[p].x+=c*u,e[p].y+=l*u,u=1-u,e[r].x-=c*u,e[r].y-=l*u}}}))}}))}calAttractive(e,t){const n=this,r=n.edges,i=n.linkDistance,o=n.alpha,a=n.edgeStrength,s=n.bias,c=n.depthAttractiveForceScale;r.forEach(((r,l)=>{const f=d(r,"source"),h=d(r,"target");if(!f||!h||f===h)return;const p=n.indexMap[f],g=n.indexMap[h],v=n.nodeMap[f],m=n.nodeMap[h];if(!v||!m)return;let y=v.depth===m.depth?0:Math.log(Math.abs(v.depth-m.depth)/10);v.comboId===m.comboId&&(y/=2);let b=y?Math.pow(c,y):1;if(v.comboId!==m.comboId&&1===b?b=c/2:v.comboId===m.comboId&&(b=2),!(u(m.x)&&u(v.x)&&u(m.y)&&u(v.y)))return;const{vl:E,vx:_,vy:x}=t[`${h}-${f}`],w=(E-i(r))/E*o*a(r)*b,S=_*w,A=x*w,T=s[l];e[g].x-=S*T,e[g].y-=A*T,e[p].x+=S*(1-T),e[p].y+=A*(1-T)}))}getType(){return"comboForce"}}class EE extends o{constructor(e){super(),this.center=[0,0],this.nodes=[],this.edges=[],this.combos=[],this.comboEdges=[],this.comboPadding=10,this.comboTrees=[],this.updateCfg(e)}getDefaultCfg(){return{}}execute(){const e=this,t=e.nodes,n=e.center;if(t&&0!==t.length){if(1===t.length)return t[0].x=n[0],t[0].y=n[1],void(e.onLayoutEnd&&e.onLayoutEnd());e.initVals(),e.run(),e.onLayoutEnd&&e.onLayoutEnd()}else e.onLayoutEnd&&e.onLayoutEnd()}run(){var e;const{nodes:t,edges:n,combos:r,comboEdges:i,center:o}=this,a={};t.forEach((e=>{a[e.id]=e}));const s={};r.forEach((e=>{s[e.id]=e}));const u=this.getInnerGraphs(a),c=[],l=[],f={};let d=!0;this.comboTrees.forEach((e=>{const t=u[e.id],n=Object.assign(Object.assign({},e),{x:t.x||s[e.id].x,y:t.y||s[e.id].y,fx:t.fx||s[e.id].fx,fy:t.fy||s[e.id].fy,mass:t.mass||s[e.id].mass,size:t.size});l.push(n),isNaN(n.x)||0===n.x||isNaN(n.y)||0===n.y?(n.x=100*Math.random(),n.y=100*Math.random()):d=!1,c.push(e.id),m(e,(t=>(t.id!==e.id&&(f[t.id]=e.id),!0)))})),t.forEach((e=>{if(e.comboId&&s[e.comboId])return;const t=Object.assign({},e);l.push(t),isNaN(t.x)||0===t.x||isNaN(t.y)||0===t.y?(t.x=100*Math.random(),t.y=100*Math.random()):d=!1,c.push(e.id)}));const h=[];if(n.concat(i).forEach((e=>{const t=f[e.source]||e.source,n=f[e.target]||e.target;t!==n&&c.includes(t)&&c.includes(n)&&h.push({source:t,target:n})})),null==l?void 0:l.length){if(1===l.length)l[0].x=o[0],l[0].y=o[1];else{const t={nodes:l,edges:h},n=this.outerLayout||new C({gravity:1,factor:2,linkDistance:(e,t,n)=>{var r,i;const o=(((null===(r=t.size)||void 0===r?void 0:r[0])||30)+((null===(i=n.size)||void 0===i?void 0:i[0])||30))/2;return Math.min(1.5*o,700)}}),r=null===(e=n.getType)||void 0===e?void 0:e.call(n);n.updateCfg({center:o,kg:5,preventOverlap:!0,animate:!1}),d&&Ce[r]&&(l.length<100?new zl:new N).layout(t),n.layout(t)}l.forEach((e=>{const t=u[e.id];if(t)t.visited=!0,t.x=e.x,t.y=e.y,t.nodes.forEach((t=>{t.x+=e.x,t.y+=e.y}));else{const t=a[e.id];t&&(t.x=e.x,t.y=e.y)}}))}const p=Object.keys(u);for(let e=p.length-1;e>=0;e--){const t=p[e],n=u[t];n&&(n.nodes.forEach((e=>{n.visited||(e.x+=n.x||0,e.y+=n.y||0),a[e.id]&&(a[e.id].x=e.x,a[e.id].y=e.y)})),s[t]&&(s[t].x=n.x,s[t].y=n.y))}return{nodes:t,edges:n,combos:r,comboEdges:i}}getInnerGraphs(e){const{comboTrees:t,nodeSize:n,edges:r,comboPadding:i,spacing:o}=this,a={},c=this.innerLayout||new Ul({sortBy:"id"});return c.center=[0,0],c.preventOverlap=!0,c.nodeSpacing=o,(t||[]).forEach((t=>{m(t,(t=>{var o;let l=(null==i?void 0:i(t))||10;if(s(l)&&(l=Math.max(...l)),null===(o=t.children)||void 0===o?void 0:o.length){const i=t.children.map((t=>{if("combo"===t.itemType)return a[t.id];const n=e[t.id]||{};return Object.assign(Object.assign({},n),t)})),o=i.map((e=>e.id)),s={nodes:i,edges:r.filter((e=>o.includes(e.source)&&o.includes(e.target)))};let f=1/0;i.forEach((e=>{var t;e.size||(e.size=(null===(t=a[e.id])||void 0===t?void 0:t.size)||(null==n?void 0:n(e))||[30,30]),u(e.size)&&(e.size=[e.size,e.size]),f>e.size[0]&&(f=e.size[0]),f>e.size[1]&&(f=e.size[1])})),c.layout(s);const{minX:d,minY:h,maxX:p,maxY:g}=(e=>{let t=1/0,n=1/0,r=-1/0,i=-1/0;return e.forEach((e=>{t>e.x&&(t=e.x),n>e.y&&(n=e.y),r<e.x&&(r=e.x),i<e.y&&(i=e.y)})),{minX:t,minY:n,maxX:r,maxY:i}})(i),v=Math.max(p-d,g-h,f)+2*l;a[t.id]={id:t.id,nodes:i,size:[v,v]}}else if("combo"===t.itemType){const e=l?[2*l,2*l]:[30,30];a[t.id]={id:t.id,nodes:[],size:e}}return!0}))})),a}initVals(){const e=this,t=e.nodeSize,n=e.spacing;let r,i;if(i=u(n)?()=>n:_(n)?n:()=>0,this.spacing=i,t)if(_(t))r=e=>{const n=t(e),r=i(e);return s(e.size)?((e.size[0]>e.size[1]?e.size[0]:e.size[1])+r)/2:((n||10)+r)/2};else if(s(t)){const e=(t[0]>t[1]?t[0]:t[1])/2;r=t=>e+i(t)/2}else{const e=t/2;r=t=>e+i(t)/2}else r=e=>{const t=i(e);return e.size?s(e.size)?((e.size[0]>e.size[1]?e.size[0]:e.size[1])+t)/2:l(e.size)?((e.size.width>e.size.height?e.size.width:e.size.height)+t)/2:(e.size+t)/2:10+t/2};this.nodeSize=r;const o=e.comboPadding;let a;a=u(o)?()=>o:s(o)?()=>Math.max.apply(null,o):_(o)?o:()=>0,this.comboPadding=a}getType(){return"comboCombined"}}class _E{constructor(e){this.id=e.id||0,this.rx=e.rx,this.ry=e.ry,this.fx=0,this.fy=0,this.mass=e.mass,this.degree=e.degree,this.g=e.g||0}distanceTo(e){const t=this.rx-e.rx,n=this.ry-e.ry;return Math.hypot(t,n)}setPos(e,t){this.rx=e,this.ry=t}resetForce(){this.fx=0,this.fy=0}addForce(e){const t=e.rx-this.rx,n=e.ry-this.ry;let r=Math.hypot(t,n);r=r<1e-4?1e-4:r;const i=this.g*(this.degree+1)*(e.degree+1)/r;this.fx+=i*t/r,this.fy+=i*n/r}in(e){return e.contains(this.rx,this.ry)}add(e){const t=this.mass+e.mass,n=(this.rx*this.mass+e.rx*e.mass)/t,r=(this.ry*this.mass+e.ry*e.mass)/t,i=this.degree+e.degree;return new _E({rx:n,ry:r,mass:t,degree:i})}}class xE{constructor(e){this.xmid=e.xmid,this.ymid=e.ymid,this.length=e.length,this.massCenter=e.massCenter||[0,0],this.mass=e.mass||1}getLength(){return this.length}contains(e,t){const n=this.length/2;return e<=this.xmid+n&&e>=this.xmid-n&&t<=this.ymid+n&&t>=this.ymid-n}NW(){const e=this.xmid-this.length/4,t=this.ymid+this.length/4,n=this.length/2;return new xE({xmid:e,ymid:t,length:n})}NE(){const e=this.xmid+this.length/4,t=this.ymid+this.length/4,n=this.length/2;return new xE({xmid:e,ymid:t,length:n})}SW(){const e=this.xmid-this.length/4,t=this.ymid-this.length/4,n=this.length/2;return new xE({xmid:e,ymid:t,length:n})}SE(){const e=this.xmid+this.length/4,t=this.ymid-this.length/4,n=this.length/2;return new xE({xmid:e,ymid:t,length:n})}}class wE{constructor(e){this.body=null,this.quad=null,this.NW=null,this.NE=null,this.SW=null,this.SE=null,this.theta=.5,null!=e&&(this.quad=e)}insert(e){null!=this.body?this._isExternal()?(this.quad&&(this.NW=new wE(this.quad.NW()),this.NE=new wE(this.quad.NE()),this.SW=new wE(this.quad.SW()),this.SE=new wE(this.quad.SE())),this._putBody(this.body),this._putBody(e),this.body=this.body.add(e)):(this.body=this.body.add(e),this._putBody(e)):this.body=e}_putBody(e){this.quad&&(e.in(this.quad.NW())&&this.NW?this.NW.insert(e):e.in(this.quad.NE())&&this.NE?this.NE.insert(e):e.in(this.quad.SW())&&this.SW?this.SW.insert(e):e.in(this.quad.SE())&&this.SE&&this.SE.insert(e))}_isExternal(){return null==this.NW&&null==this.NE&&null==this.SW&&null==this.SE}updateForce(e){null!=this.body&&e!==this.body&&(this._isExternal()||(this.quad?this.quad.getLength():0)/this.body.distanceTo(e)<this.theta?e.addForce(this.body):(this.NW&&this.NW.updateForce(e),this.NE&&this.NE.updateForce(e),this.SW&&this.SW.updateForce(e),this.SE&&this.SE.updateForce(e)))}}class SE extends o{constructor(e){super(),this.center=[0,0],this.width=300,this.height=300,this.nodes=[],this.edges=[],this.kr=5,this.kg=1,this.mode="normal",this.preventOverlap=!1,this.dissuadeHubs=!1,this.barnesHut=void 0,this.maxIteration=0,this.ks=.1,this.ksmax=10,this.tao=.1,this.onLayoutEnd=()=>{},this.prune=void 0,this.updateCfg(e)}getDefaultCfg(){return{}}execute(){const e=this,{nodes:t,onLayoutEnd:n,prune:r}=e;let i=e.maxIteration;e.width||"undefined"==typeof window||(e.width=window.innerWidth),e.height||"undefined"==typeof window||(e.height=window.innerHeight);const o=[],a=t.length;for(let n=0;n<a;n+=1){const r=t[n];let i=10,a=10;u(r.size)&&(i=r.size,a=r.size),s(r.size)?(isNaN(r.size[0])||(i=r.size[0]),isNaN(r.size[1])||(a=r.size[1])):l(r.size)&&(i=r.size.width,a=r.size.height),e.getWidth&&!isNaN(e.getWidth(r))&&(a=e.getWidth(r)),e.getHeight&&!isNaN(e.getHeight(r))&&(i=e.getHeight(r));const c=Math.max(i,a);o.push(c)}void 0===e.barnesHut&&a>250&&(e.barnesHut=!0),void 0===e.prune&&a>100&&(e.prune=!0),0!==this.maxIteration||e.prune?0===this.maxIteration&&r&&(i=100,a<=200&&a>100?i=500:a>200&&(i=950),this.maxIteration=i):(i=250,a<=200&&a>100?i=1e3:a>200&&(i=1200),this.maxIteration=i),e.kr||(e.kr=50,a>100&&a<=500?e.kr=20:a>500&&(e.kr=1)),e.kg||(e.kg=20,a>100&&a<=500?e.kg=10:a>500&&(e.kg=1)),this.nodes=e.updateNodesByForces(o),n()}updateNodesByForces(e){const t=this,{edges:n,maxIteration:r}=t;let i=t.nodes;const o=n.filter((e=>d(e,"source")!==d(e,"target"))),a=i.length,s=o.length,u=[],c={},l={},f=[];for(let e=0;e<a;e+=1)c[i[e].id]=e,u[e]=0,(void 0===i[e].x||isNaN(i[e].x))&&(i[e].x=1e3*Math.random()),(void 0===i[e].y||isNaN(i[e].y))&&(i[e].y=1e3*Math.random()),f.push({x:i[e].x,y:i[e].y});for(let e=0;e<s;e+=1){let t,n,r=0,s=0;for(let u=0;u<a;u+=1){const a=d(o[e],"source"),c=d(o[e],"target");i[u].id===a?(t=i[u],r=u):i[u].id===c&&(n=i[u],s=u),l[e]={sourceIdx:r,targetIdx:s}}t&&(u[c[t.id]]+=1),n&&(u[c[n.id]]+=1)}let h=r;if(i=this.iterate(h,c,l,s,u,e),t.prune){for(let e=0;e<s;e+=1)u[l[e].sourceIdx]<=1?(i[l[e].sourceIdx].x=i[l[e].targetIdx].x,i[l[e].sourceIdx].y=i[l[e].targetIdx].y):u[l[e].targetIdx]<=1&&(i[l[e].targetIdx].x=i[l[e].sourceIdx].x,i[l[e].targetIdx].y=i[l[e].sourceIdx].y);t.prune=!1,t.barnesHut=!1,h=100,i=this.iterate(h,c,l,s,u,e)}return i}iterate(e,t,n,r,i,o){const a=this;let{nodes:s}=a;const{kr:u,preventOverlap:c}=a,{barnesHut:l}=a,f=s.length;let d=0,h=e,p=[];const g=[],v=[];for(let e=0;e<f;e+=1)if(p[2*e]=0,p[2*e+1]=0,l){const t={id:e,rx:s[e].x,ry:s[e].y,mass:1,g:u,degree:i[e]};v[e]=new _E(t)}for(;h>0;){for(let e=0;e<f;e+=1)g[2*e]=p[2*e],g[2*e+1]=p[2*e+1],p[2*e]=0,p[2*e+1]=0;p=this.getAttrForces(h,50,r,t,n,i,o,p),p=l&&(c&&h>50||!c)?this.getOptRepGraForces(p,v,i):this.getRepGraForces(h,50,p,100,o,i);const e=this.updatePos(p,g,d,i);s=e.nodes,d=e.sg,h--,a.tick&&a.tick()}return s}getAttrForces(e,t,n,r,i,o,a,s){const{nodes:u,preventOverlap:c,dissuadeHubs:l,mode:f,prune:d}=this;for(let h=0;h<n;h+=1){const n=u[i[h].sourceIdx],p=i[h].sourceIdx,g=u[i[h].targetIdx],v=i[h].targetIdx;if(d&&(o[p]<=1||o[v]<=1))continue;const m=[g.x-n.x,g.y-n.y];let y=Math.hypot(m[0],m[1]);y=y<1e-4?1e-4:y,m[0]=m[0]/y,m[1]=m[1]/y,c&&e<t&&(y=y-a[p]-a[v]);let b=y,E=b;"linlog"===f&&(b=Math.log(1+y),E=b),l&&(b=y/o[p],E=y/o[v]),c&&e<t&&y<=0?(b=0,E=0):c&&e<t&&y>0&&(b=y,E=y),s[2*r[n.id]]+=b*m[0],s[2*r[g.id]]-=E*m[0],s[2*r[n.id]+1]+=b*m[1],s[2*r[g.id]+1]-=E*m[1]}return s}getRepGraForces(e,t,n,r,i,o){const{nodes:a,preventOverlap:s,kr:u,kg:c,center:l,prune:f}=this,d=a.length;for(let h=0;h<d;h+=1){for(let c=h+1;c<d;c+=1){if(f&&(o[h]<=1||o[c]<=1))continue;const l=[a[c].x-a[h].x,a[c].y-a[h].y];let d=Math.hypot(l[0],l[1]);d=d<1e-4?1e-4:d,l[0]=l[0]/d,l[1]=l[1]/d,s&&e<t&&(d=d-i[h]-i[c]);let p=u*(o[h]+1)*(o[c]+1)/d;s&&e<t&&d<0?p=r*(o[h]+1)*(o[c]+1):s&&e<t&&0===d?p=0:s&&e<t&&d>0&&(p=u*(o[h]+1)*(o[c]+1)/d),n[2*h]-=p*l[0],n[2*c]+=p*l[0],n[2*h+1]-=p*l[1],n[2*c+1]+=p*l[1]}const p=[a[h].x-l[0],a[h].y-l[1]],g=Math.hypot(p[0],p[1]);p[0]=p[0]/g,p[1]=p[1]/g;const v=c*(o[h]+1);n[2*h]-=v*p[0],n[2*h+1]-=v*p[1]}return n}getOptRepGraForces(e,t,n){const{nodes:r,kg:i,center:o,prune:a}=this,s=r.length;let u=9e10,c=-9e10,l=9e10,f=-9e10;for(let e=0;e<s;e+=1)a&&n[e]<=1||(t[e].setPos(r[e].x,r[e].y),r[e].x>=c&&(c=r[e].x),r[e].x<=u&&(u=r[e].x),r[e].y>=f&&(f=r[e].y),r[e].y<=l&&(l=r[e].y));const d=Math.max(c-u,f-l),h=new xE({xmid:(c+u)/2,ymid:(f+l)/2,length:d,massCenter:o,mass:s}),p=new wE(h);for(let e=0;e<s;e+=1)a&&n[e]<=1||t[e].in(h)&&p.insert(t[e]);for(let u=0;u<s;u+=1){if(a&&n[u]<=1)continue;t[u].resetForce(),p.updateForce(t[u]),e[2*u]-=t[u].fx,e[2*u+1]-=t[u].fy;const s=[r[u].x-o[0],r[u].y-o[1]];let c=Math.hypot(s[0],s[1]);c=c<1e-4?1e-4:c,s[0]=s[0]/c,s[1]=s[1]/c;const l=i*(n[u]+1);e[2*u]-=l*s[0],e[2*u+1]-=l*s[1]}return e}updatePos(e,t,n,r){const{nodes:i,ks:o,tao:a,prune:s,ksmax:c}=this,l=i.length,f=[],d=[];let h=0,p=0;for(let n=0;n<l;n+=1){if(s&&r[n]<=1)continue;const i=[e[2*n]-t[2*n],e[2*n+1]-t[2*n+1]],o=Math.hypot(i[0],i[1]),a=[e[2*n]+t[2*n],e[2*n+1]+t[2*n+1]],u=Math.hypot(a[0],a[1]);f[n]=o,d[n]=u/2,h+=(r[n]+1)*f[n],p+=(r[n]+1)*d[n]}const g=n;n=a*p/h,0!==g&&(n=n>1.5*g?1.5*g:n);for(let t=0;t<l;t+=1){if(s&&r[t]<=1)continue;if(u(i[t].fx)&&u(i[t].fy))continue;let a=o*n/(1+n*Math.sqrt(f[t])),l=Math.hypot(e[2*t],e[2*t+1]);l=l<1e-4?1e-4:l;const d=c/l;a=a>d?d:a;const h=a*e[2*t],p=a*e[2*t+1];i[t].x+=h,i[t].y+=p}return{nodes:i,sg:n}}}class AE{constructor(){this.cells=[],this.columnNum=0,this.rowNum=0,this.additionColumn=[],this.additionRow=[]}init(e,t,n){this.cells=[],this.CELL_W=n.CELL_W||AE.DEFAULT_CELL_W,this.CELL_H=n.CELL_H||AE.DEFAULT_CELL_H,this.columnNum=Math.ceil(e/this.CELL_W),this.rowNum=Math.ceil(t/this.CELL_H),AE.MIN_DIST=Math.pow(e,2)+Math.pow(t,2);for(let e=0;e<this.columnNum;e++){const t=[];for(let n=0;n<this.rowNum;n++){const r={dx:e,dy:n,x:e*this.CELL_W,y:n*this.CELL_H,occupied:!1};t.push(r)}this.cells.push(t)}}findGridByNodeId(e){var t,n;for(let r=0;r<this.columnNum;r++)for(let i=0;i<this.rowNum;i++)if(this.cells[r][i].node&&(null===(n=null===(t=this.cells[r][i])||void 0===t?void 0:t.node)||void 0===n?void 0:n.id)===e)return{column:r,row:i};return null}sqdist(e,t){return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)}occupyNearest(e){let t,n=AE.MIN_DIST,r=null;for(let i=0;i<this.columnNum;i++)for(let o=0;o<this.rowNum;o++)!this.cells[i][o].occupied&&(t=this.sqdist(e,this.cells[i][o]))<n&&(n=t,r=this.cells[i][o]);return r&&(r.occupied=!0),r}insertColumn(e,t){if(!(t<=0)){for(let e=0;e<t;e++){this.cells[e+this.columnNum]=[];for(let t=0;t<this.rowNum;t++)this.cells[e+this.columnNum][t]={dx:e,dy:t,x:e*this.CELL_W,y:t*this.CELL_H,occupied:!1,node:null}}for(let n=this.columnNum-1;n>e;n--)for(let e=0;e<this.rowNum;e++)this.cells[n+t][e]=Object.assign(Object.assign({},this.cells[n][e]),{x:(n+t)*this.CELL_W,y:e*this.CELL_H}),this.cells[n][e]={x:n*this.CELL_W,y:e*this.CELL_H,occupied:!0,node:null};for(let n=0;n<this.additionColumn.length;n++)this.additionColumn[n]>=e&&(this.additionColumn[n]+=t);for(let n=0;n<t;n++)this.additionColumn.push(e+n+1);this.columnNum+=t}}insertRow(e,t){if(!(t<=0)){for(let e=0;e<t;e++)for(let t=0;t<this.columnNum;t++)this.cells[t][e+this.rowNum]={dx:t,dy:e,x:t*this.CELL_W,y:e*this.CELL_H,occupied:!1,node:null};for(let n=0;n<this.columnNum;n++)for(let r=this.rowNum-1;r>e;r--)this.cells[n][r+t]=Object.assign(Object.assign({},this.cells[n][r]),{dx:n,dy:r+t,x:n*this.CELL_W,y:(r+t)*this.CELL_H}),this.cells[n][r]={dx:n,dy:r,x:n*this.CELL_W,y:r*this.CELL_H,occupied:!1,node:null};for(let n=0;n<this.additionRow.length;n++)this.additionRow[n]>=e&&(this.additionRow[n]+=t);for(let n=0;n<t;n++)this.additionRow.push(e+n+1);this.rowNum+=t}}getNodes(){const e=[];for(let t=0;t<this.columnNum;t++)for(let n=0;n<this.rowNum;n++)this.cells[t][n].node&&e.push(this.cells[t][n]);return e}}AE.MIN_DIST=50,AE.DEFAULT_CELL_W=80,AE.DEFAULT_CELL_H=80;const TE=1e7,IE=1.5707963267948966,NE=new Map;let DE=.8;function kE(e,t){const n=(NE.get(e.id)||[]).find((e=>e.source===t.id||e.target===t.id)),r=e.size[0]*e.size[1],i=t.size[0]*t.size[1],o=r>i?t:e,a=r>i?e:t,s=o.x-o.size[0]/2,u=o.y-o.size[1]/2,c=o.x+o.size[0]/2,l=o.y+o.size[1]/2,f=a.x-a.size[0]/2,d=a.y-a.size[1]/2,h=a.x+a.size[0]/2,p=a.y+a.size[1]/2,g=o.x,v=o.y,m=a.x,y=a.y;let b=0,E=0;if(c>=f&&h>=s&&l>=d&&p>=u)E=Math.sqrt(Math.pow(m-g,2)+Math.pow(y-v,2)),0===E&&(E=1e-7),b=10/E*100+((c<h?c:h)-(s>f?s:f))*((l<p?l:p)-(u>d?u:d)),b*=TE;else{let e=!1;const t=function(e,t,n){const r=e.x-e.size[0]/2,i=e.y-e.size[1]/2,o=e.x+e.size[0]/2,a=e.y+e.size[1]/2,s=t.x-t.size[0]/2,u=t.y-t.size[1]/2,c=t.x+t.size[0]/2,l=t.y+t.size[1]/2,f=e.x,d=e.y,h=t.x,p=t.y,g=h-f,v=Math.atan2(g,p-d);let m=0,y=0,b=0,E=0;v>IE?(y=i-l,m=s-o,b=parseFloat(y?(y/Math.cos(v)).toFixed(2):m.toFixed(2)),E=parseFloat(m?(m/Math.sin(v)).toFixed(2):y.toFixed(2))):0<v&&v<=IE?(y=u-a,m=s-o,b=E=y>m?parseFloat(y?(y/Math.cos(v)).toFixed(2):m.toFixed(2)):parseFloat(m?(m/Math.sin(v)).toFixed(2):y.toFixed(2))):v<-IE?(y=i-l,m=-(c-r),b=E=y>m?parseFloat(y?(y/Math.cos(v)).toFixed(2):m.toFixed(2)):parseFloat(m?(m/Math.sin(v)).toFixed(2):y.toFixed(2))):(y=u-a,m=Math.abs(g)>(o-r)/2?r-c:g,b=E=y>m?parseFloat(y?(y/Math.cos(v)).toFixed(2):m.toFixed(2)):parseFloat(m&&0!==v?(m/Math.sin(v)).toFixed(2):y.toFixed(2)));const _=parseFloat(v.toFixed(2));let x=n;return n&&(x=1.1780972450961724<_&&_<1.9634954084936207),{distance:Math.abs(b<E?b:E),isHoriz:x}}(o,a,e);E=t.distance,e=t.isHoriz,E<=10?b+=0!==E?n?10+1e7/E:10+1e8/E:TE:(b+=E,n&&(b+=E*E))}return b}function CE(e){let t=0;for(let n=0;n<e.length;n++){const r=e[n];(r.x<0||r.y<0||r.x>1200||r.y>800)&&(t+=1e12);for(let i=n+1;i<e.length;i++)t+=kE(r,e[i])}return t}function ME(e,t,n,r){const i=new Map;n.forEach(((e,t)=>{i.set(e.id,e)}));const o=r.filter((t=>t.source===e.id||t.target===e.id))||[],a=[];o.forEach((t=>{const n=t.source===e.id?t.target:t.source,r=i.get(n);r&&a.push(r)}));let s=!0;for(let n=0;n<a.length;n++){const r=a[n],i=180*Math.atan((e.y-r.y)/(r.x-e.y)),o=180*Math.atan((t.y-r.y)/(r.x-t.y)),u=o<30||o>150,c=i>70&&i<110,l=o>70&&o<110;if((i<30||i>150)&&!u||i*o<0){s=!1;break}if(c&&!l||i*o<0){s=!1;break}if((r.x-e.x)*(r.x-t.x)<0){s=!1;break}if((r.y-e.y)*(r.y-t.y)<0){s=!1;break}}return s}function OE(e,t){let n=!1;const r=[10,-10,0,0],i=[0,0,10,-10];for(let o=0;o<e.length;++o){const a=e[o];let s=RE(a,e);for(let o=0;o<r.length;o++)if(ME(a,{x:a.x+r[o],y:a.y+i[o]},e,t)){a.x+=r[o],a.y+=i[o];const t=RE(a,e),u=Math.random();t<s||u<DE&&u>.1?(s=t,n=!0):(a.x-=r[o],a.y-=i[o])}}return DE>.1&&(DE*=.5),n?CE(e):0}function RE(e,t){let n=0;(e.x<0||e.y<0||e.x+e.size[0]+20>1200||e.y+e.size[1]+20>800)&&(n+=1e12);for(let r=0;r<t.length;++r)e.id!==t[r].id&&(n+=kE(e,t[r]));return n}function PE(e,t){const{nodes:n,edges:r}=e,i=t.width,o=t.height;if(!(null==n?void 0:n.length))return Promise.resolve();const a=[];n.forEach((e=>{if(r.filter((t=>t.source===e.id||t.target===e.id)).length>1){const t=Object.assign({},e);delete t.size,a.push(t)}}));const s=[];r.forEach((e=>{const t=a.find((t=>t.id===e.source)),n=a.find((t=>t.id===e.target));t&&n&&s.push(e)}));const u=new mr({type:"dagre",ranksep:t.nodeMinGap,nodesep:t.nodeMinGap}),{nodes:c}=u.layout({nodes:a,edges:s});n.forEach((e=>{const t=(c||[]).find((t=>t.id===e.id));e.x=(null==t?void 0:t.x)||i/2,e.y=(null==t?void 0:t.y)||o/2}));const l=JSON.parse(JSON.stringify(n)),f=JSON.parse(JSON.stringify(r)),d=be().nodes(l).force("link",Se(f).id((e=>e.id)).distance((e=>s.find((t=>t.source===e.source&&t.target===e.target))?30:20))).force("charge",Ee()).force("center",_e(i/2,o/2)).force("x",Ne(i/2)).force("y",De(o/2)).alpha(.3).alphaDecay(.08).alphaMin(.001),h=new Promise((e=>{d.on("end",(()=>{n.forEach((e=>{const t=l.find((t=>t.id===e.id));t&&(e.x=t.x,e.y=t.y)}));const a=Math.min(...n.map((e=>e.x))),s=Math.max(...n.map((e=>e.x))),u=Math.min(...n.map((e=>e.y))),c=Math.max(...n.map((e=>e.y))),f=i/(s-a),d=o/(c-u);n.forEach((e=>{void 0!==e.x&&f<1&&(e.x=(e.x-a)*f),void 0!==e.y&&d<1&&(e.y=(e.y-u)*d)})),n.forEach((e=>{e.sizeTemp=e.size,e.size=[10,10]})),function(e,t){if(0===e.length)return{nodes:e,edges:t};e.forEach((e=>{const n=t.filter((t=>t.source===e.id||t.target===e.id));NE.set(e,n)})),e.sort(((e,t)=>{var n,r;return(null===(n=NE.get(e.id))||void 0===n?void 0:n.length)-(null===(r=NE.get(t.id))||void 0===r?void 0:r.length)}));let n=CE(e),r=20,i=1,o=0,a=0;for(;r>0&&(a++,!(a>=50));){const a=OE(e,t);0!==a&&(o=a),i=o-n,n=o,0===i?--r:r=20}e.forEach((e=>{e.x=e.x-e.size[0]/2,e.y=e.y-e.size[1]/2}))}(n,r),n.forEach((e=>{e.size=e.sizeTemp||[],delete e.sizeTemp})),function(e,t){if(!e.nodes||0===e.nodes.length)return e;const n=t.width,r=t.height,i=t.nodeMinGap;let o=1e4,a=1e4;e.nodes.forEach((e=>{const t=e.size[0]||50,n=e.size[1]||50;o=Math.min(t,o),a=Math.min(n,a)}));const s=new AE;s.init(n,r,{CELL_H:a,CELL_W:o}),e.nodes.forEach((e=>{const t=s.occupyNearest(e);t&&(t.node={id:e.id,size:e.size},e.x=t.x,e.y=t.y,e.dx=t.dx,e.dy=t.dy)}));for(let t=0;t<e.nodes.length;t++){const n=e.nodes[t],r=s.findGridByNodeId(n.id);if(!r)throw new Error("can not find node cell");const{column:u,row:c}=r;if(n.size[0]+i>o){const e=Math.ceil((n.size[0]+i)/o)-1;let t=e;for(let n=0;n<e&&s.additionColumn.indexOf(u+n+1)>-1&&!s.cells[u+n+1][c].node;n++)t--;s.insertColumn(u,t)}if(n.size[1]+i>a){const e=Math.ceil((n.size[1]+i)/a)-1;let t=e;for(let n=0;n<e&&s.additionRow.indexOf(c+n+1)>-1&&!s.cells[u][c+n+1].node;n++)t--;s.insertRow(c,t)}}for(let t=0;t<s.columnNum;t++)for(let n=0;n<s.rowNum;n++){const r=s.cells[t][n];if(r.node){const t=e.nodes.find((e=>{var t;return e.id===(null===(t=null==r?void 0:r.node)||void 0===t?void 0:t.id)}));t&&(t.x=r.x+t.size[0]/2,t.y=r.y+t.size[1]/2)}}}({nodes:n,edges:r},t),e()}))}));return h}class GE extends o{constructor(e){super(),this.width=300,this.height=300,this.nodeMinGap=50,this.onLayoutEnd=()=>{},e&&this.updateCfg(e)}getDefaultCfg(){return{width:300,height:300,nodeMinGap:50}}execute(){const e=this,t=e.nodes,n=e.edges;return null==t||t.forEach((e=>{e.size||(e.size=[50,50])})),PE({nodes:t,edges:n},{width:this.width,height:this.height,nodeMinGap:this.nodeMinGap}).then((()=>{e.onLayoutEnd&&e.onLayoutEnd()}))}getType(){return"er"}}class LE{constructor(e){const t=I(e.type);this.layoutInstance=new t(e)}layout(e){return this.layoutInstance.layout(e)}updateCfg(e){this.layoutInstance.updateCfg(e)}init(e){this.correctLayers(e.nodes),this.layoutInstance.init(e)}correctLayers(e){if(!(null==e?void 0:e.length))return;let t=1/0;const n=[];if(e.forEach((e=>{a(e.layer)&&(e.layer=parseInt(e.layer,10)),void 0===e.layer||isNaN(e.layer)||(n.push(e),e.layer<t&&(t=e.layer))})),t<=0){const e=Math.abs(t)+1;n.forEach((t=>t.layer+=e))}}execute(){this.layoutInstance.execute()}getDefaultCfg(){return this.layoutInstance.getDefaultCfg()}destroy(){return this.layoutInstance.destroy()}}const UE={force:Me,fruchterman:Bl,forceAtlas2:SE,gForce:C,force2:F,dagre:mr,dagreCompound:cl,circular:Pe,radial:Ll,concentric:Ul,grid:N,mds:zl,comboForce:bE,comboCombined:EE,random:D,"gForce-gpu":yE,"fruchterman-gpu":vE,er:GE},zE={meta:{global:!1},methods:{onAction:function(e){if("instance"===e.action.name)return i}}},BE={layout:zE}},6835:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r={}},3075:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r={}},380:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r={"zh-cn":n(3075).Z}},2267:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=[]},6625:(e,t,n)=>{"use strict";function r(e){return{state:{},getters:{},mutations:{},actions:{}}}n.d(t,{Z:()=>r})},8292:(e,t,n)=>{var r=n(9233),i=n(361)(r);i.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]),e.exports=i},361:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(r)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(i[a]=!0)}for(var s=0;s<e.length;s++){var u=[].concat(e[s]);r&&i[u[0]]||(n&&(u[2]?u[2]="".concat(n," and ").concat(u[2]):u[2]=n),t.push(u))}},t}},9233:e=>{"use strict";function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e.exports=function(e){var n,r,i=(r=4,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(n,r)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=i[1],a=i[3];if(!a)return o;if("function"==typeof btoa){var s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),u="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),c="/*# ".concat(u," */"),l=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[o].concat(l).concat([c]).join("\n")}return[o].join("\n")}},3353:e=>{e.exports=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}},1518:e=>{e.exports=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}},1387:e=>{e.exports=function(e){var t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}},2337:e=>{e.exports=function(e,t){return e[0]=t[0],e[1]=t[1],e}},5377:e=>{e.exports=function(){var e=new Float32Array(2);return e[0]=0,e[1]=0,e}},4188:e=>{e.exports=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}},3213:(e,t,n)=>{e.exports=n(8170)},8170:e=>{e.exports=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}},7691:(e,t,n)=>{e.exports=n(903)},903:e=>{e.exports=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}},1407:e=>{e.exports=function(e,t){return e[0]*t[0]+e[1]*t[1]}},1709:e=>{e.exports=1e-6},1053:(e,t,n)=>{e.exports=function(e,t){var n=e[0],i=e[1],o=t[0],a=t[1];return Math.abs(n-o)<=r*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=r*Math.max(1,Math.abs(i),Math.abs(a))};var r=n(1709)},9677:e=>{e.exports=function(e,t){return e[0]===t[0]&&e[1]===t[1]}},4772:e=>{e.exports=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}},5190:(e,t,n)=>{e.exports=function(e,t,n,i,o,a){var s,u;for(t||(t=2),n||(n=0),u=i?Math.min(i*t+n,e.length):e.length,s=n;s<u;s+=t)r[0]=e[s],r[1]=e[s+1],o(r,r,a),e[s]=r[0],e[s+1]=r[1];return e};var r=n(5377)()},3549:e=>{e.exports=function(e,t){var n=new Float32Array(2);return n[0]=e,n[1]=t,n}},5182:(e,t,n)=>{e.exports={EPSILON:n(1709),create:n(5377),clone:n(1387),fromValues:n(3549),copy:n(2337),set:n(2343),equals:n(1053),exactEquals:n(9677),add:n(3353),subtract:n(2764),sub:n(5691),multiply:n(7270),mul:n(2440),divide:n(903),div:n(7691),inverse:n(3408),min:n(8656),max:n(4933),rotate:n(7505),floor:n(4772),ceil:n(1518),round:n(7984),scale:n(2863),scaleAndAdd:n(6788),distance:n(8170),dist:n(3213),squaredDistance:n(4738),sqrDist:n(3993),length:n(719),len:n(8275),squaredLength:n(2156),sqrLen:n(6628),negate:n(370),normalize:n(1125),dot:n(1407),cross:n(4188),lerp:n(5424),random:n(3538),transformMat2:n(2853),transformMat2d:n(2033),transformMat3:n(3953),transformMat4:n(4675),forEach:n(5190),limit:n(5179)}},3408:e=>{e.exports=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}},8275:(e,t,n)=>{e.exports=n(719)},719:e=>{e.exports=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}},5424:e=>{e.exports=function(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}},5179:e=>{e.exports=function(e,t,n){var r=t[0]*t[0]+t[1]*t[1];if(r>n*n){var i=Math.sqrt(r);e[0]=t[0]/i*n,e[1]=t[1]/i*n}else e[0]=t[0],e[1]=t[1];return e}},4933:e=>{e.exports=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}},8656:e=>{e.exports=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}},2440:(e,t,n)=>{e.exports=n(7270)},7270:e=>{e.exports=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}},370:e=>{e.exports=function(e,t){return e[0]=-t[0],e[1]=-t[1],e}},1125:e=>{e.exports=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e}},3538:e=>{e.exports=function(e,t){t=t||1;var n=2*Math.random()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}},7505:e=>{e.exports=function(e,t,n){var r=Math.cos(n),i=Math.sin(n),o=t[0],a=t[1];return e[0]=o*r-a*i,e[1]=o*i+a*r,e}},7984:e=>{e.exports=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}},2863:e=>{e.exports=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}},6788:e=>{e.exports=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}},2343:e=>{e.exports=function(e,t,n){return e[0]=t,e[1]=n,e}},3993:(e,t,n)=>{e.exports=n(4738)},6628:(e,t,n)=>{e.exports=n(2156)},4738:e=>{e.exports=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}},2156:e=>{e.exports=function(e){var t=e[0],n=e[1];return t*t+n*n}},5691:(e,t,n)=>{e.exports=n(2764)},2764:e=>{e.exports=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}},2853:e=>{e.exports=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e}},2033:e=>{e.exports=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e}},3953:e=>{e.exports=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e}},4675:e=>{e.exports=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e}},1089:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(e,t,r,i){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,t)&&Reflect.defineMetadata(n,r(),this,t),Reflect.hasMetadata(n,this,t)?Reflect.getMetadata(n,this,t):r()},set:function(e){Reflect.defineMetadata(n,e,this,t)}})}t.makePropertyInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.get(n)}),t)}}},t.makePropertyInjectNamedDecorator=function(e,t){return function(n,i){return function(o,a){r(o,a,(function(){return e.getNamed(n,i)}),t)}}},t.makePropertyInjectTaggedDecorator=function(e,t){return function(n,i,o){return function(a,s){r(a,s,(function(){return e.getTagged(n,i,o)}),t)}}},t.makePropertyMultiInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.getAll(n)}),t)}}}},444:(e,t,n)=>{"use strict";var r=n(1089);t.Z=function(e,t){return void 0===t&&(t=!0),{lazyInject:r.makePropertyInjectDecorator(e,t),lazyInjectNamed:r.makePropertyInjectNamedDecorator(e,t),lazyInjectTagged:r.makePropertyInjectTaggedDecorator(e,t),lazyMultiInject:r.makePropertyMultiInjectDecorator(e,t)}}},1005:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagProperty=t.tagParameter=t.decorate=void 0;var r=n(7182),i=n(1760);function o(e,t,n,i,o){var a={},s="number"==typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(a=Reflect.getMetadata(e,t));var c=a[u];if(Array.isArray(c))for(var l=0,f=c;l<f.length;l++){var d=f[l];if(d.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+d.key.toString())}else c=[];c.push(i),a[u]=c,Reflect.defineMetadata(e,a,t)}function a(e,t){Reflect.decorate(e,t)}function s(e,t){return function(n,r){t(n,r,e)}}t.tagParameter=function(e,t,n,r){o(i.TAGGED,e,t,r,n)},t.tagProperty=function(e,t,n){o(i.TAGGED_PROP,e.constructor,t,n)},t.decorate=function(e,t,n){"number"==typeof n?a([s(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):a([e],t)}},4497:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inject=t.LazyServiceIdentifer=void 0;var r=n(7182),i=n(1760),o=n(6168),a=n(1005),s=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=s,t.inject=function(e){return function(t,n,s){if(void 0===e)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(t.name));var u=new o.Metadata(i.INJECT_TAG,e);"number"==typeof s?a.tagParameter(t,n,s,u):a.tagProperty(t,n,u)}}},6299:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=void 0;var r=n(7182),i=n(1760);t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,e))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(i.PARAM_TYPES,t,e),e}}},6129:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiInject=void 0;var r=n(1760),i=n(6168),o=n(1005);t.multiInject=function(e){return function(t,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,s):o.tagProperty(t,n,s)}}},9131:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.named=void 0;var r=n(1760),i=n(6168),o=n(1005);t.named=function(e){return function(t,n,a){var s=new i.Metadata(r.NAMED_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,s):o.tagProperty(t,n,s)}}},1426:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.optional=void 0;var r=n(1760),i=n(6168),o=n(1005);t.optional=function(){return function(e,t,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(e,t,n,a):o.tagProperty(e,t,a)}}},7914:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.postConstruct=void 0;var r=n(7182),i=n(1760),o=n(6168);t.postConstruct=function(){return function(e,t,n){var a=new o.Metadata(i.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,e.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,e.constructor)}}},1265:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagged=void 0;var r=n(6168),i=n(1005);t.tagged=function(e,t){return function(n,o,a){var s=new r.Metadata(e,t);"number"==typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}},8994:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.targetName=void 0;var r=n(1760),i=n(6168),o=n(1005);t.targetName=function(e){return function(t,n,a){var s=new i.Metadata(r.NAME_TAG,e);o.tagParameter(t,n,a,s)}}},4349:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unmanaged=void 0;var r=n(1760),i=n(6168),o=n(1005);t.unmanaged=function(){return function(e,t,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(e,t,n,a)}}},5368:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=void 0;var r=n(997),i=n(3409),o=function(){function e(e,t){this.id=i.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===r.BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=o},8331:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingCount=void 0,t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},7182:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STACK_OVERFLOW=t.CIRCULAR_DEPENDENCY_IN_FACTORY=t.POST_CONSTRUCT_ERROR=t.MULTIPLE_POST_CONSTRUCT_METHODS=t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=t.ARGUMENTS_LENGTH_MISMATCH=t.INVALID_DECORATOR_OPERATION=t.INVALID_TO_SELF_VALUE=t.INVALID_FUNCTION_BINDING=t.INVALID_MIDDLEWARE_RETURN=t.NO_MORE_SNAPSHOTS_AVAILABLE=t.INVALID_BINDING_TYPE=t.NOT_IMPLEMENTED=t.CIRCULAR_DEPENDENCY=t.UNDEFINED_INJECT_ANNOTATION=t.MISSING_INJECT_ANNOTATION=t.MISSING_INJECTABLE_ANNOTATION=t.NOT_REGISTERED=t.CANNOT_UNBIND=t.AMBIGUOUS_MATCH=t.KEY_NOT_FOUND=t.NULL_ARGUMENT=t.DUPLICATED_METADATA=t.DUPLICATED_INJECTABLE_DECORATOR=void 0,t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]},t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"},997:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=void 0,t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"},t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},1760:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NON_CUSTOM_TAG_KEYS=t.POST_CONSTRUCT=t.DESIGN_PARAM_TYPES=t.PARAM_TYPES=t.TAGGED_PROP=t.TAGGED=t.MULTI_INJECT_TAG=t.INJECT_TAG=t.OPTIONAL_TAG=t.UNMANAGED_TAG=t.NAME_TAG=t.NAMED_TAG=void 0,t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct",t.NON_CUSTOM_TAG_KEYS=[t.INJECT_TAG,t.MULTI_INJECT_TAG,t.NAME_TAG,t.UNMANAGED_TAG,t.NAMED_TAG,t.OPTIONAL_TAG]},7690:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;var a=n(5368),s=n(7182),u=n(997),c=n(1760),l=n(4100),f=n(3383),d=n(1337),h=n(9171),p=n(3409),g=n(4384),v=n(6952),m=n(2788),y=function(){function e(e){this._appliedMiddleware=[];var t=e||{};if("object"!=typeof t)throw new Error(""+s.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=u.BindingScopeEnum.Transient;else if(t.defaultScope!==u.BindingScopeEnum.Singleton&&t.defaultScope!==u.BindingScopeEnum.Transient&&t.defaultScope!==u.BindingScopeEnum.Request)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+s.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=p.id(),this._bindingDictionary=new m.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new l.MetadataReader}return e.merge=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=new e,s=o([t,n],r).map((function(e){return f.getBindingDictionary(e)})),u=f.getBindingDictionary(a);function c(e,t){e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))}return s.forEach((function(e){c(e,u)})),a},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,(function(){var t,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,i.label=1;case 1:return n<r.length?(o=r[n],a=t(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(e){return function(t){return t.moduleId===e}};t.forEach((function(t){var n=r(t.id);e._bindingDictionary.removeByCondition(n)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||u.BindingScopeEnum.Transient,n=new a.Binding(e,t);return this._bindingDictionary.add(e,n),new h.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(s.CANNOT_UNBIND+" "+g.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new m.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,c.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=f.createMockRequest(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(v.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(s.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,u.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,u.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,c.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,u.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,u.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,c.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach((function(e){t.applyMiddleware(e)})),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,o){var a=null,u={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(u)))throw new Error(s.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(u);return a},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=f.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),d.resolve(n)}},e}();t.Container=y},8280:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncContainerModule=t.ContainerModule=void 0;var r=n(3409);t.ContainerModule=function(e){this.id=r.id(),this.registry=e};t.AsyncContainerModule=function(e){this.id=r.id(),this.registry=e}},6952:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerSnapshot=void 0;var n=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=n},2788:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lookup=void 0;var r=n(7182),i=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(r.NULL_ARGUMENT);if(null==t)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(r.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(r.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,r){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(r,i):t._map.delete(r)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();t.Lookup=i},7131:(e,t,n)=>{"use strict";t.f3=t.t6=t.b2=t.W2=void 0,n(1760);var r=n(7690);Object.defineProperty(t,"W2",{enumerable:!0,get:function(){return r.Container}});n(997),n(8280);var i=n(6299);Object.defineProperty(t,"b2",{enumerable:!0,get:function(){return i.injectable}});n(1265);var o=n(9131);Object.defineProperty(t,"t6",{enumerable:!0,get:function(){return o.named}});var a=n(4497);Object.defineProperty(t,"f3",{enumerable:!0,get:function(){return a.inject}});n(1426),n(4349),n(6129),n(8994),n(7914),n(4100),n(3409),n(1005),n(1634),n(4384),n(6869)},561:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var r=n(3409),i=function(){function e(e){this.id=r.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=i},6168:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var r=n(1760),i=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=i},4100:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataReader=void 0;var r=n(1760),i=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(r.TAGGED_PROP,e)||[]},e}();t.MetadataReader=i},4083:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Plan=void 0;t.Plan=function(e,t){this.parentContext=e,this.rootRequest=t}},3383:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBindingDictionary=t.createMockRequest=t.plan=void 0;var r=n(8331),i=n(7182),o=n(997),a=n(1760),s=n(6656),u=n(4384),c=n(561),l=n(6168),f=n(4083),d=n(4026),h=n(8567),p=n(1749);function g(e){return e._bindingDictionary}function v(e,t,n,o,a){var s,c=y(n.container,a.serviceIdentifier);return c.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&e.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),c=y(n.container,a.serviceIdentifier)),s=t?c:c.filter((function(e){var t=new h.Request(e.serviceIdentifier,n,o,e,a);return e.constraint(t)})),function(e,t,n,o){switch(t.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var a=u.getServiceIdentifierAsString(e),s=i.NOT_REGISTERED;throw s+=u.listMetadataForTarget(a,n),s+=u.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(s);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;throw a=u.getServiceIdentifierAsString(e),s=i.AMBIGUOUS_MATCH+" "+a,s+=u.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(s)}}(a.serviceIdentifier,s,a,n.container),s}function m(e,t,n,r,a,s){var u,c;if(null===a){u=v(e,t,r,null,s),c=new h.Request(n,r,null,u,s);var l=new f.Plan(r,c);r.addPlan(l)}else u=v(e,t,r,a,s),c=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(t){var n=null;if(s.isArray())n=c.addChildRequest(t.serviceIdentifier,t,s);else{if(t.cache)return;n=c}if(t.type===o.BindingTypeEnum.Instance&&null!==t.implementationType){var a=d.getDependencies(e,t.implementationType);if(!r.container.options.skipBaseClassChecks){var u=d.getBaseClassDependencyCount(e,t.implementationType);if(a.length<u){var l=i.ARGUMENTS_LENGTH_MISMATCH(d.getFunctionName(t.implementationType));throw new Error(l)}}a.forEach((function(t){m(e,!1,t.serviceIdentifier,r,n,t)}))}}))}function y(e,t){var n=[],r=g(e);return r.hasKey(t)?n=r.get(t):null!==e.parent&&(n=y(e.parent,t)),n}t.getBindingDictionary=g,t.plan=function(e,t,n,r,i,o,f,d){void 0===d&&(d=!1);var h=new c.Context(t),g=function(e,t,n,r,i,o){var s=e?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new l.Metadata(s,n),c=new p.Target(t,"",n,u);if(void 0!==i){var f=new l.Metadata(i,o);c.metadata.push(f)}return c}(n,r,i,0,o,f);try{return m(e,d,i,h,null,g),h}catch(e){throw s.isStackOverflowExeption(e)&&h.plan&&u.circularDependencyToException(h.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new p.Target(o.TargetTypeEnum.Variable,"",t,new l.Metadata(n,r)),a=new c.Context(e);return new h.Request(t,a,null,[],i)}},4087:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryableString=void 0;var n=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=n},4026:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=t.getBaseClassDependencyCount=t.getDependencies=void 0;var i=n(4497),o=n(7182),a=n(997),s=n(1760),u=n(4384);Object.defineProperty(t,"getFunctionName",{enumerable:!0,get:function(){return u.getFunctionName}});var c=n(1749);function l(e,t,n,i){var a=e.getConstructorMetadata(n),s=a.compilerGeneratedMetadata;if(void 0===s){var u=o.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(u)}var c=a.userGeneratedMetadata,l=Object.keys(c),h=0===n.length&&l.length>0,p=l.length>n.length,g=function(e,t,n,r,i){for(var o=[],a=0;a<i;a++){var s=f(a,e,t,n,r);null!==s&&o.push(s)}return o}(i,t,s,c,h||p?l.length:n.length),v=d(e,n);return r(r([],g),v)}function f(e,t,n,r,s){var u=s[e.toString()]||[],l=h(u),f=!0!==l.unmanaged,d=r[e];if((d=l.inject||l.multiInject||d)instanceof i.LazyServiceIdentifer&&(d=d.unwrap()),f){if(!t&&(d===Object||d===Function||void 0===d)){var p=o.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(p)}var g=new c.Target(a.TargetTypeEnum.ConstructorArgument,l.targetName,d);return g.metadata=u,g}return null}function d(e,t){for(var n=e.getPropertiesMetadata(t),i=[],o=0,s=Object.keys(n);o<s.length;o++){var u=s[o],l=n[u],f=h(n[u]),p=f.targetName||u,g=f.inject||f.multiInject,v=new c.Target(a.TargetTypeEnum.ClassProperty,p,g);v.metadata=l,i.push(v)}var m=Object.getPrototypeOf(t.prototype).constructor;if(m!==Object){var y=d(e,m);i=r(r([],i),y)}return i}function h(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[s.INJECT_TAG],multiInject:t[s.MULTI_INJECT_TAG],targetName:t[s.NAME_TAG],unmanaged:t[s.UNMANAGED_TAG]}}t.getDependencies=function(e,t){return l(e,u.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=l(t,u.getFunctionName(r),r,!0),o=i.map((function(e){return e.metadata.filter((function(e){return e.key===s.UNMANAGED_TAG}))})),a=[].concat.apply([],o).length,c=i.length-a;return c>0?c:e(t,r)}return 0}},8567:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var r=n(3409),i=function(){function e(e,t,n,i,o){this.id=r.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=i},1749:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Target=void 0;var r=n(1760),i=n(3409),o=n(6168),a=n(4087),s=function(){function e(e,t,n,s){this.id=i.id(),this.type=e,this.serviceIdentifier=n,this.name=new a.QueryableString(t||""),this.metadata=new Array;var u=null;"string"==typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++)if(n[t].key===e)return!0;return!1},e.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(r.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return r.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===r.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return r.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(r.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}();t.Target=s},9181:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInstance=void 0;var i=n(7182),o=n(997),a=n(1760);t.resolveInstance=function(e,t,n){var s,u,c=null;t.length>0?(u=t.filter((function(e){return null!==e.target&&e.target.type===o.TargetTypeEnum.ConstructorArgument})).map(n),c=function(e,t,n){var r=t.filter((function(e){return null!==e.target&&e.target.type===o.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(t,n){var r;r=t.target.name.value();var o=i[n];e[r]=o})),e}(c=new((s=e).bind.apply(s,r([void 0],u))),t,n)):c=new e;return function(e,t){if(Reflect.hasMetadata(a.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(a.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(i.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,c),c}},1337:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=void 0;var r=n(7182),i=n(997),o=n(6656),a=n(4384),s=n(9181),u=function(e,t,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},c=function(e){return function(t){t.parentContext.setCurrentRequest(t);var n=t.bindings,o=t.childRequests,l=t.target&&t.target.isArray(),f=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(l&&f)return o.map((function(t){return c(e)(t)}));var d=null;if(!t.target.isOptional()||0!==n.length){var h=n[0],p=h.scope===i.BindingScopeEnum.Singleton,g=h.scope===i.BindingScopeEnum.Request;if(p&&h.activated)return h.cache;if(g&&null!==e&&e.has(h.id))return e.get(h.id);if(h.type===i.BindingTypeEnum.ConstantValue)d=h.cache,h.activated=!0;else if(h.type===i.BindingTypeEnum.Function)d=h.cache,h.activated=!0;else if(h.type===i.BindingTypeEnum.Constructor)d=h.implementationType;else if(h.type===i.BindingTypeEnum.DynamicValue&&null!==h.dynamicValue)d=u("toDynamicValue",h.serviceIdentifier,(function(){return h.dynamicValue(t.parentContext)}));else if(h.type===i.BindingTypeEnum.Factory&&null!==h.factory)d=u("toFactory",h.serviceIdentifier,(function(){return h.factory(t.parentContext)}));else if(h.type===i.BindingTypeEnum.Provider&&null!==h.provider)d=u("toProvider",h.serviceIdentifier,(function(){return h.provider(t.parentContext)}));else{if(h.type!==i.BindingTypeEnum.Instance||null===h.implementationType){var v=a.getServiceIdentifierAsString(t.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+v)}d=s.resolveInstance(h.implementationType,o,c(e))}return"function"==typeof h.onActivation&&(d=h.onActivation(t.parentContext,d)),p&&(h.cache=d,h.activated=!0),g&&null!==e&&!e.has(h.id)&&e.set(h.id,d),d}}};t.resolve=function(e){return c(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}},7330:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInSyntax=void 0;var r=n(997),i=n(8821),o=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=o},1299:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInWhenOnSyntax=void 0;var r=n(7330),i=n(1233),o=n(1797),a=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=a},1233:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingOnSyntax=void 0;var r=n(1797),i=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new r.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=i},9171:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingToSyntax=void 0;var r=n(7182),i=n(997),o=n(1299),a=n(8821),s=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=e,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(r.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=i.BindingTypeEnum.Function,this._binding.scope=i.BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();t.BindingToSyntax=s},8821:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenOnSyntax=void 0;var r=n(1233),i=n(1797),o=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=o},1797:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenSyntax=void 0;var r=n(1233),i=n(1634),o=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=i.namedConstraint(e),new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=i.taggedConstraint(e)(t),new r.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return i.typeConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return i.namedConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return i.taggedConstraint(e)(t)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=o},1634:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=void 0;var r=n(1760),i=n(6168),o=function(e,t){var n=e.parentRequest;return null!==n&&(!!t(n)||o(n,t))};t.traverseAncerstors=o;var a=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new i.Metadata(e,t),n}};t.taggedConstraint=a;var s=a(r.NAMED_TAG);t.namedConstraint=s,t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}},6869:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=void 0,t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}}},6656:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStackOverflowExeption=void 0;var r=n(7182);t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===r.STACK_OVERFLOW}},3409:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.id=void 0;var n=0;t.id=function(){return n++}},4384:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.circularDependencyToException=t.listMetadataForTarget=t.listRegisteredBindingsForServiceIdentifier=t.getServiceIdentifierAsString=t.getFunctionName=void 0;var r=n(7182);function i(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function o(e,t){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===t||o(e.parentRequest,t))}function a(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}t.getServiceIdentifierAsString=i,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var r="",i=n(e,t);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(e){var t="Object";null!==e.implementationType&&(t=a(e.implementationType)),r=r+"\n "+t,e.constraint.metaData&&(r=r+" - "+e.constraint.metaData)}))),r},t.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(o(t,t.serviceIdentifier)){var n=function(e){return function e(t,n){void 0===n&&(n=[]);var r=i(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}(e).reverse().join(" --\x3e ")}(t);throw new Error(r.CIRCULAR_DEPENDENCY+" "+n)}e(t)}))},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=a},5235:(e,t,n)=>{var r=n(3353),i=n(2343),o=n(1125),a=n(2764),s=n(1407),u=[0,0];e.exports.x7=function(e,t,n,a,c){return r(e,n,a),o(e,e),i(t,-e[1],e[0]),i(u,-n[1],n[0]),c/s(t,u)},e.exports.mJ=function(e,t){return i(e,-t[1],t[0]),e},e.exports.o7=function(e,t,n){return a(e,t,n),o(e,e),e}},8060:(e,t,n)=>{var r;!function(e){!function(t){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(e);function o(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===r.Reflect?r.Reflect=e:i=o(r.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,u={create:o?function(){return P(Object.create(null))}:a?function(){return P({__proto__:null})}:function(){return P({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&{NODE_ENV:"production"}&&"true"==={NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL,f=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,d=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new f}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,h=new(l||"function"!=typeof WeakMap?function(){var e=u.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+a()}while(u.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function o(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):o(new Uint8Array(e),e):o(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function p(e,t,n){var r=h.get(e);if(w(r)){if(!n)return;r=new f,h.set(e,r)}var i=r.get(t);if(w(i)){if(!n)return;i=new f,r.set(t,i)}return i}function g(e,t,n){if(v(e,t,n))return!0;var r=R(t);return!S(r)&&g(e,r,n)}function v(e,t,n){var r=p(t,n,!1);return!w(r)&&!!r.has(e)}function m(e,t,n){if(v(e,t,n))return y(e,t,n);var r=R(t);return S(r)?void 0:m(e,r,n)}function y(e,t,n){var r=p(t,n,!1);if(!w(r))return r.get(e)}function b(e,t,n,r){p(n,r,!0).set(e,t)}function E(e,t){var n=_(e,t),r=R(e);if(null===r)return n;var i=E(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new d,a=[],s=0,u=n;s<u.length;s++){var c=u[s];o.has(c)||(o.add(c),a.push(c))}for(var l=0,f=i;l<f.length;l++)c=f[l],o.has(c)||(o.add(c),a.push(c));return a}function _(e,t){var n=[],r=p(e,t,!1);if(w(r))return n;for(var o=function(e){var t=C(e,i);if(!D(t))throw new TypeError;var n=t.call(e);if(!A(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=M(o);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(e){try{O(o)}finally{throw e}}a++}}function x(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function w(e){return void 0===e}function S(e){return null===e}function A(e){return"object"==typeof e?null!==e:"function"==typeof e}function T(e,t){switch(x(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=C(e,r);if(void 0!==i){var o=i.call(e,n);if(A(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(D(n)&&!A(i=n.call(e)))return i;if(D(r=e.valueOf)&&!A(i=r.call(e)))return i}else{var r;if(D(r=e.valueOf)&&!A(i=r.call(e)))return i;var i,o=e.toString;if(D(o)&&!A(i=o.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function I(e){var t=T(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function N(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function D(e){return"function"==typeof e}function k(e){return"function"==typeof e}function C(e,t){var n=e[t];if(null!=n){if(!D(n))throw new TypeError;return n}}function M(e){var t=e.next();return!t.done&&t}function O(e){var t=e.return;t&&t.call(e)}function R(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function P(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(w(n)){if(!N(e))throw new TypeError;if(!k(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!w(r)&&!S(r)){if(!k(r))throw new TypeError;t=r}}return t}(e,t)}if(!N(e))throw new TypeError;if(!A(t))throw new TypeError;if(!A(r)&&!w(r)&&!S(r))throw new TypeError;return S(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!w(o)&&!S(o)){if(!A(o))throw new TypeError;r=o}}return r}(e,t,n=I(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!A(n))throw new TypeError;if(!w(r)&&!function(e){switch(x(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;b(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!A(n))throw new TypeError;return w(r)||(r=I(r)),b(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!A(t))throw new TypeError;return w(n)||(n=I(n)),g(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!A(t))throw new TypeError;return w(n)||(n=I(n)),v(e,t,n)})),e("getMetadata",(function(e,t,n){if(!A(t))throw new TypeError;return w(n)||(n=I(n)),m(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!A(t))throw new TypeError;return w(n)||(n=I(n)),y(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!A(e))throw new TypeError;return w(t)||(t=I(t)),E(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!A(e))throw new TypeError;return w(t)||(t=I(t)),_(e,t)})),e("deleteMetadata",(function(e,t,n){if(!A(t))throw new TypeError;w(n)||(n=I(n));var r=p(t,n,!1);if(w(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=h.get(t);return i.delete(n),i.size>0||h.delete(t),!0}))}(i)}()}(r||(r={}))},1459:function(e){e.exports=function(){"use strict";var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n="\n";function r(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||r(t)}function o(e){return e?": "+e:""}function a(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function s(e,t,n){t.indexOf(e)<0&&r("invalid value"+o(n)+". must be one of: "+t)}var u=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(e,t){for(e+="";e.length<t;)e=" "+e;return e}function l(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function f(e,t){this.number=e,this.line=t,this.errors=[]}function d(e,t,n){this.file=e,this.line=t,this.message=n}function h(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function p(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function g(e,t){var n,r=e.split("\n"),i=1,o=0,a={unknown:new l,0:new l};a.unknown.name=a[0].name=t||h(),a.unknown.lines.push(new f(0,""));for(var s=0;s<r.length;++s){var u=r[s],c=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(c)switch(c[1]){case"line":var d=/(\d+)(\s+\d+)?/.exec(c[2]);d&&(i=0|d[1],d[2]&&((o=0|d[2])in a||(a[o]=new l)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(c[2]);p&&(a[o].name=p[1]?(n=p[2],"undefined"!=typeof atob?atob(n):"base64:"+n):p[2])}a[o].lines.push(new f(i++,u))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function v(e){e._commandRef=h()}function m(e,t){var n=p();r(e+" in command "+(t||h())+("unknown"===n?"":" called from "+n))}function y(e,t,n,r){a(e,t)||m("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e,r||h())}var b=33071,E={};function _(e,t){return 32820===e||32819===e||33635===e?2:34042===e?4:E[e]*t}function x(e){return!(e&e-1||!e)}E[5120]=E[5121]=1,E[5122]=E[5123]=E[36193]=E[33635]=E[32819]=E[32820]=2,E[5124]=E[5125]=E[5126]=E[34042]=4;var w=t(i,{optional:function(e){e()},raise:r,commandRaise:m,command:function(e,t,n){e||m(t,n||h())},parameter:function(e,t,n){e in t||r("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||m("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||h())},constructor:function(e){Object.keys(e).forEach((function(e){u.indexOf(e)<0&&r('invalid regl constructor argument "'+e+'". must be one of '+u)}))},type:function(e,t,n){a(e,t)||r("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e)},commandType:y,isTypedArray:function(t,n){e(t)||r("invalid parameter type"+o(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||r("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")},oneOf:s,shaderError:function(e,t,r,o,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),u=o===e.FRAGMENT_SHADER?"fragment":"vertex";y(r,"string",u+" shader source must be a string",a);var l=g(r,a),f=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new d(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new d("unknown",0,e))}})),t}(s);(function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))})(l,f),Object.keys(l).forEach((function(e){var t=l[e];if(t.hasErrors){var r=[""],i=[""];o("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){o(c(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(e.line+n,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(r){var i=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),t=Math.max(e.line.indexOf(s,t),0)}else t=0;o(c("| ",6)),o(c("^^^",t+3)+n,"font-weight:bold"),o(c("| ",6)),o(i+n,"font-weight:bold")})),o(c("| ",6)+n)}else o(c(e.number,4)+"|  "),o(e.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(e,t){r.push(e),i.push(t||"")}})),i.raise("Error compiling "+u+" shader, "+l[0].name)}},linkError:function(e,t,r,o,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),u=g(r,a),c='Error linking program with vertex shader, "'+g(o,a)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+c+"\n%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(c+n+s),i.raise(c)}},callSite:p,saveCommandRef:v,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}v(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?s(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):s(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:h,texture2D:function(e,t,n){var r,o=t.width,a=t.height,s=t.channels;i(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),e.wrapS===b&&e.wrapT===b||i(x(o)&&x(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==a&&i(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(i(x(o)&&x(a),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var c=o>>r,l=a>>r;i(t.mipmask&1<<r,"missing mipmap data");var f=u[r];if(i(f.width===c&&f.height===l,"invalid shape for mip images"),i(f.format===t.format&&f.internalformat===t.internalformat&&f.type===t.type,"incompatible type for mip image"),f.compressed);else if(f.data){var d=Math.ceil(_(f.type,s)*c/f.unpackAlignment)*f.unpackAlignment;i(f.data.byteLength===d*l,"invalid data for image, buffer size is inconsistent with image format")}else f.element||f.copy}else e.genMipmaps||i(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var o=e.width,a=e.height,s=e.channels;i(o>0&&o<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),i(o===a,"cube map must be square"),i(t.wrapS===b&&t.wrapT===b,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var c=n[u];i(c.width===o&&c.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(i(!c.compressed,"can not generate mipmap for compressed textures"),i(1===c.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=c.images,f=0;f<16;++f){var d=l[f];if(d){var h=o>>f,p=a>>f;i(c.mipmask&1<<f,"missing mipmap data"),i(d.width===h&&d.height===p,"invalid shape for mip images"),i(d.format===e.format&&d.internalformat===e.internalformat&&d.type===e.type,"incompatible type for mip image"),d.compressed||(d.data?i(d.data.byteLength===h*p*Math.max(_(d.type,s),d.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):d.element||d.copy)}}}}}),S=0;function A(e,t){this.id=S++,this.type=e,this.data=t}function T(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function I(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+T(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return I(e.substr(0,r.index)).concat(I(r[1])).concat(I(e.substr(r.index+r[0].length)));var i=e.split(".");if(1===i.length)return['"'+T(e)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(I(i[a]));return o}function N(e){return"["+I(e).join("][")+"]"}var D={DynamicVariable:A,define:function(e,t){return new A(e,N(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof A},unbox:function e(t,n){return"function"==typeof t?new A(0,t):"number"==typeof t||"boolean"==typeof t?new A(5,t):Array.isArray(t)?new A(6,t.map(((t,r)=>e(t,n+"["+r+"]")))):t instanceof A?t:void w(!1,"invalid option type in uniform "+n)},accessor:N},k={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},C="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function M(e){return"string"==typeof e?e.split():(w(Array.isArray(e),"invalid extension array"),e)}function O(e){return"string"==typeof e?(w("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function R(e){var n,r,i,o,a,s=e||{},u={},c=[],l=[],f="undefined"==typeof window?1:window.devicePixelRatio,d=!1,h=function(e){e&&w.raise(e)},p=function(){};if("string"==typeof s?(w("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(s),w(n,"invalid query string for element")):"object"==typeof s?"string"==typeof(a=s).nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?n=s:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(s)?i=(o=s).canvas:(w.constructor(s),"gl"in s?o=s.gl:"canvas"in s?i=O(s.canvas):"container"in s&&(r=O(s.container)),"attributes"in s&&(u=s.attributes,w.type(u,"object","invalid context attributes")),"extensions"in s&&(c=M(s.extensions)),"optionalExtensions"in s&&(l=M(s.optionalExtensions)),"onDone"in s&&(w.type(s.onDone,"function","invalid or missing onDone callback"),h=s.onDone),"profile"in s&&(d=!!s.profile),"pixelRatio"in s&&(f=+s.pixelRatio,w(f>0,"invalid pixel ratio"))):w.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!o){if(!i){w("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var g=function(e,n,r){var i,o=document.createElement("canvas");function a(){var n=window.innerWidth,i=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();n=a.right-a.left,i=a.bottom-a.top}o.width=r*n,o.height=r*i,t(o.style,{width:n+"px",height:i+"px"})}return t(o.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(o),e===document.body&&(o.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}(r||document.body,0,f);if(!g)return null;i=g.canvas,p=g.onDestroy}void 0===u.premultipliedAlpha&&(u.premultipliedAlpha=!0),o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,u)}return o?{gl:o,canvas:i,container:r,extensions:c,optionalExtensions:l,pixelRatio:f,profile:d,onDone:h,onDestroy:p}:(p(),h("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function P(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function G(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function L(){var e=P(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[G(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[G(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var U=L();U.zero=L();var z=3553,B=6408,j=5126,F=36160;function V(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var W=function(e){return Object.keys(e).map((function(t){return e[t]}))},H={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||U.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:X(e,t[0],t[1],t[2],a,0);break;default:q(e,t,0,a,0)}return a}};function X(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],c=0;c<n;++c)for(var l=u[c],f=0;f<r;++f)i[a++]=l[f]}function q(e,t,n,r,i){for(var o=1,a=n+1;a<t.length;++a)o*=t[a];var s=t[n];if(t.length-n==4){var u=t[n+1],c=t[n+2],l=t[n+3];for(a=0;a<s;++a)X(e[a],u,c,l,r,i),i+=o}else for(a=0;a<s;++a)q(e[a],t,n+1,r,i),i+=o}var Y={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},K={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},$={dynamic:35048,stream:35040,static:35044},Z=H.flatten,J=H.shape,Q=5121,ee=5126,te=[];function ne(e){return 0|Y[Object.prototype.toString.call(e)]}function re(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function ie(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var c=0;c<r;++c)e[s++]=t[i*u+o*c+a]}te[5120]=1,te[5122]=2,te[5124]=4,te[5121]=1,te[5123]=2,te[5125]=4,te[5126]=4;var oe={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ae=5121,se=5123,ue=5125,ce=34963;var le=new Float32Array(1),fe=new Uint32Array(le.buffer);function de(e){for(var t=U.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{le[0]=e[n];var r=fe[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function he(t){return Array.isArray(t)||e(t)}var pe=function(e){return!(e&e-1||!e)},ge=3553,ve=34067,me=34069,ye=6408,be=6406,Ee=6407,_e=6409,xe=6410,we=32855,Se=6402,Ae=34041,Te=35904,Ie=35906,Ne=36193,De=33776,ke=33777,Ce=33778,Me=33779,Oe=5121,Re=5123,Pe=5125,Ge=5126,Le=33071,Ue=9728,ze=9984,Be=9987,je=4352,Fe=33984,Ve=[ze,9986,9985,Be],We=[0,_e,xe,Ee,ye],He={};function Xe(e){return"[object "+e+"]"}He[6409]=He[6406]=He[6402]=1,He[34041]=He[6410]=2,He[6407]=He[35904]=3,He[6408]=He[35906]=4;var qe=Xe("HTMLCanvasElement"),Ye=Xe("OffscreenCanvas"),Ke=Xe("CanvasRenderingContext2D"),$e=Xe("ImageBitmap"),Ze=Xe("HTMLImageElement"),Je=Xe("HTMLVideoElement"),Qe=Object.keys(Y).concat([qe,Ye,Ke,$e,Ze,Je]),et=[];et[5121]=1,et[5126]=4,et[36193]=2,et[5123]=2,et[5125]=4;var tt=[];function nt(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function rt(e){return!!Array.isArray(e)&&!(0===e.length||!he(e[0]))}function it(e){return Object.prototype.toString.call(e)}function ot(e){return it(e)===qe}function at(e){return it(e)===Ye}function st(e){if(!e)return!1;var t=it(e);return Qe.indexOf(t)>=0||nt(e)||rt(e)||V(e)}function ut(e){return 0|Y[Object.prototype.toString.call(e)]}function ct(e,t){return U.allocType(e.type===Ne?Ge:e.type,t)}function lt(e,t){e.type===Ne?(e.data=de(t),U.freeType(t)):e.data=t}function ft(e,t,n,r,i,o){var a;if(a=void 0!==tt[e]?tt[e]:He[e]*et[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function dt(n,r,i,o,a,s,u){var c={"don't care":je,"dont care":je,nice:4354,fast:4353},l={repeat:10497,clamp:Le,mirror:33648},f={nearest:Ue,linear:9729},d=t({mipmap:Be,"nearest mipmap nearest":ze,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":Be},f),h={none:0,browser:37444},p={uint8:Oe,rgba4:32819,rgb565:33635,"rgb5 a1":32820},g={alpha:be,luminance:_e,"luminance alpha":xe,rgb:Ee,rgba:ye,rgba4:32854,"rgb5 a1":we,rgb565:36194},v={};r.ext_srgb&&(g.srgb=Te,g.srgba=Ie),r.oes_texture_float&&(p.float32=p.float=Ge),r.oes_texture_half_float&&(p.float16=p["half float"]=Ne),r.webgl_depth_texture&&(t(g,{depth:Se,"depth stencil":Ae}),t(p,{uint16:Re,uint32:Pe,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&t(v,{"rgb s3tc dxt1":De,"rgba s3tc dxt1":ke,"rgba s3tc dxt3":Ce,"rgba s3tc dxt5":Me}),r.webgl_compressed_texture_atc&&t(v,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&t(v,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(v["rgb etc1"]=36196);var m=Array.prototype.slice.call(n.getParameter(34467));Object.keys(v).forEach((function(e){var t=v[e];m.indexOf(t)>=0&&(g[e]=t)}));var y=Object.keys(g);i.textureFormats=y;var b=[];Object.keys(g).forEach((function(e){var t=g[e];b[t]=e}));var E=[];Object.keys(p).forEach((function(e){var t=p[e];E[t]=e}));var _=[];Object.keys(f).forEach((function(e){_[f[e]]=e}));var x=[];Object.keys(d).forEach((function(e){var t=d[e];x[t]=e}));var S=[];Object.keys(l).forEach((function(e){S[l[e]]=e}));var A=y.reduce((function(e,t){var n=g[t];return n===_e||n===be||n===_e||n===xe||n===Se||n===Ae||r.ext_srgb&&(n===Te||n===Ie)?e[n]=n:n===we||t.indexOf("rgba")>=0?e[n]=ye:e[n]=Ee,e}),{});function T(){this.internalformat=ye,this.format=ye,this.type=Oe,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function I(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function N(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(w.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(w.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(w.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(w.parameter(t.colorSpace,h,"invalid colorSpace"),e.colorSpace=h[t.colorSpace]),"type"in t){var n=t.type;w(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),w(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),w(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),w.parameter(n,p,"invalid texture type"),e.type=p[n]}var o=e.width,a=e.height,s=e.channels,u=!1;"shape"in t?(w(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(s=t.shape[2],w(s>0&&s<=4,"invalid number of channels"),u=!0),w(o>=0&&o<=i.maxTextureSize,"invalid width"),w(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,w(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,w(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,w(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,w(s>0&&s<=4,"invalid number of channels"),u=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var c=!1;if("format"in t){var l=t.format;w(r.webgl_depth_texture||!("depth"===l||"depth stencil"===l),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),w.parameter(l,g,"invalid texture format");var f=e.internalformat=g[l];e.format=A[f],l in p&&("type"in t||(e.type=p[l])),l in v&&(e.compressed=!0),c=!0}!u&&c?e.channels=He[e.format]:u&&!c?e.channels!==We[e.format]&&(e.format=e.internalformat=We[e.channels]):c&&u&&w(e.channels===He[e.format],"number of channels inconsistent with specified format")}}function D(e){n.pixelStorei(37440,e.flipY),n.pixelStorei(37441,e.premultiplyAlpha),n.pixelStorei(37443,e.colorSpace),n.pixelStorei(3317,e.unpackAlignment)}function k(){T.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function C(t,n){var r=null;if(st(n)?r=n:n&&(w.type(n,"object","invalid pixel data type"),N(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),st(n.data)&&(r=n.data)),w(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){w(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,w(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==Oe||(t.type=ut(r));else if(nt(r))t.channels=t.channels||4,function(e,t){var n=t.length;switch(e.type){case Oe:case Re:case Pe:case Ge:var r=U.allocType(e.type,n);r.set(t),e.data=r;break;case Ne:e.data=de(t);break;default:w.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(V(r)){var u=r.data;Array.isArray(u)||t.type!==Oe||(t.type=ut(u));var c,l,f,d,h,p,g=r.shape,v=r.stride;3===g.length?(f=g[2],p=v[2]):(w(2===g.length,"invalid ndarray pixel data, must be 2 or 3D"),f=1,p=1),c=g[0],l=g[1],d=v[0],h=v[1],t.alignment=1,t.width=c,t.height=l,t.channels=f,t.format=t.internalformat=We[f],t.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,c=ct(e,a*s*u),l=0,f=0;f<s;++f)for(var d=0;d<a;++d)for(var h=0;h<u;++h)c[l++]=t[n*d+r*f+i*h+o];lt(e,c)}(t,u,d,h,p,r.offset)}else if(ot(r)||at(r)||it(r)===Ke)ot(r)||at(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return it(e)===$e}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(e){return it(e)===Ze}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(function(e){return it(e)===Je}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(rt(r)){var m=t.width||r[0].length,y=t.height||r.length,b=t.channels;b=he(r[0][0])?b||r[0][0].length:b||1;for(var E=H.shape(r),_=1,x=0;x<E.length;++x)_*=E[x];var S=ct(t,_);H.flatten(r,E,"",S),lt(t,S),t.alignment=1,t.width=m,t.height=y,t.channels=b,t.format=t.internalformat=We[b],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===Ge?w(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Ne&&w(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function M(e,t,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,c=e.type,l=e.width,f=e.height;D(e),i?n.texImage2D(t,r,u,u,c,i):e.compressed?n.compressedTexImage2D(t,r,s,l,f,0,a):e.needsCopy?(o(),n.copyTexImage2D(t,r,u,e.xOffset,e.yOffset,l,f,0)):n.texImage2D(t,r,u,l,f,0,u,c,a||null)}function O(e,t,r,i,a){var s=e.element,u=e.data,c=e.internalformat,l=e.format,f=e.type,d=e.width,h=e.height;D(e),s?n.texSubImage2D(t,a,r,i,l,f,s):e.compressed?n.compressedTexSubImage2D(t,a,r,i,c,d,h,u):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,d,h)):n.texSubImage2D(t,a,r,i,d,h,l,f,u)}var R=[];function P(){return R.pop()||new k}function G(e){e.needsFree&&U.freeType(e.data),k.call(e),R.push(e)}function L(){T.call(this),this.genMipmaps=!1,this.mipmapHint=je,this.mipmask=0,this.images=Array(16)}function z(e,t,n){var r=e.images[0]=P();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function B(e,t){var n=null;if(st(t))I(n=e.images[0]=P(),e),C(n,t),e.mipmask=1;else if(N(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)I(n=e.images[i]=P(),e),n.width>>=i,n.height>>=i,C(n,r[i]),e.mipmask|=1<<i;else I(n=e.images[0]=P(),e),C(n,t),e.mipmask=1;I(e,e.images[0]),!e.compressed||e.internalformat!==De&&e.internalformat!==ke&&e.internalformat!==Ce&&e.internalformat!==Me||w(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function j(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;M(n[r],t,r)}}var F=[];function X(){var e=F.pop()||new L;T.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function q(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&G(t[n]),t[n]=null;F.push(e)}function Y(){this.minFilter=Ue,this.magFilter=Ue,this.wrapS=Le,this.wrapT=Le,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=je}function K(e,t){if("min"in t){var n=t.min;w.parameter(n,d),e.minFilter=d[n],Ve.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;w.parameter(r,f),e.magFilter=f[r]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(w.parameter(s,l),o=a=l[s]):Array.isArray(s)&&(w.parameter(s[0],l),w.parameter(s[1],l),o=l[s[0]],a=l[s[1]])}else{if("wrapS"in t){var u=t.wrapS;w.parameter(u,l),o=l[u]}if("wrapT"in t){var h=t.wrapT;w.parameter(h,l),a=l[h]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var p=t.anisotropic;w("number"==typeof p&&p>=1&&p<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var g=!1;switch(typeof t.mipmap){case"string":w.parameter(t.mipmap,c,"invalid mipmap hint"),e.mipmapHint=c[t.mipmap],e.genMipmaps=!0,g=!0;break;case"boolean":g=e.genMipmaps=t.mipmap;break;case"object":w(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,g=!0;break;default:w.raise("invalid mipmap type")}g&&!("min"in t)&&(e.minFilter=ze)}}function $(e,t){n.texParameteri(t,10241,e.minFilter),n.texParameteri(t,10240,e.magFilter),n.texParameteri(t,10242,e.wrapS),n.texParameteri(t,10243,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,34046,e.anisotropic),e.genMipmaps&&(n.hint(33170,e.mipmapHint),n.generateMipmap(t))}var Z=0,J={},Q=i.maxTextureUnits,ee=Array(Q).map((function(){return null}));function te(e){T.call(this),this.mipmask=0,this.internalformat=ye,this.id=Z++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Y,u.profile&&(this.stats={size:0})}function ne(e){n.activeTexture(Fe),n.bindTexture(e.target,e.texture)}function re(){var e=ee[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(ge,null)}function ie(e){var t=e.texture;w(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(Fe+r),n.bindTexture(i,null),ee[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete J[e.id],s.textureCount--}return t(te.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var r=0;r<Q;++r){var i=ee[r];if(i){if(i.bindCount>0)continue;i.unit=-1}ee[r]=e,t=r;break}t>=Q&&w.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<t+1&&(s.maxTextureUnits=t+1),e.unit=t,n.activeTexture(Fe+t),n.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ie(this)}}),u.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(J).forEach((function(t){e+=J[t].stats.size})),e}),{create2D:function(e,t){var r=new te(ge);function o(e,t){var n=r.texInfo;Y.call(n);var a=X();return"number"==typeof e?z(a,0|e,"number"==typeof t?0|t:0|e):e?(w.type(e,"object","invalid arguments to regl.texture"),K(n,e),B(a,e)):z(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,I(r,a),w.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,ne(r),j(a,ge),$(n,ge),re(),q(a),u.profile&&(r.stats.size=ft(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=b[r.internalformat],o.type=E[r.type],o.mag=_[n.magFilter],o.min=x[n.minFilter],o.wrapS=S[n.wrapS],o.wrapT=S[n.wrapT],o}return J[r.id]=r,s.textureCount++,o(e,t),o.subimage=function(e,t,n,i){w(!!e,"must specify image data");var a=0|t,s=0|n,u=0|i,c=P();return I(c,r),c.width=0,c.height=0,C(c,e),c.width=c.width||(r.width>>u)-a,c.height=c.height||(r.height>>u)-s,w(r.type===c.type&&r.format===c.format&&r.internalformat===c.internalformat,"incompatible format for texture.subimage"),w(a>=0&&s>=0&&a+c.width<=r.width&&s+c.height<=r.height,"texture.subimage write out of bounds"),w(r.mipmask&1<<u,"missing mipmap data"),w(c.data||c.element||c.needsCopy,"missing image data"),ne(r),O(c,ge,a,s,u),re(),G(c),o},o.resize=function(e,t){var i=0|e,a=0|t||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,ne(r);for(var s=0;r.mipmask>>s;++s){var c=i>>s,l=a>>s;if(!c||!l)break;n.texImage2D(ge,s,r.format,c,l,0,r.format,r.type,null)}return re(),u.profile&&(r.stats.size=ft(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,t,r,o,a,c){var l=new te(ve);J[l.id]=l,s.cubeCount++;var f=new Array(6);function d(e,t,n,r,o,a){var s,c=l.texInfo;for(Y.call(c),s=0;s<6;++s)f[s]=X();if("number"!=typeof e&&e)if("object"==typeof e)if(t)B(f[0],e),B(f[1],t),B(f[2],n),B(f[3],r),B(f[4],o),B(f[5],a);else if(K(c,e),N(l,e),"faces"in e){var h=e.faces;for(w(Array.isArray(h)&&6===h.length,"cube faces must be a length 6 array"),s=0;s<6;++s)w("object"==typeof h[s]&&!!h[s],"invalid input for cube map face"),I(f[s],l),B(f[s],h[s])}else for(s=0;s<6;++s)B(f[s],e);else w.raise("invalid arguments to cube map");else{var p=0|e||1;for(s=0;s<6;++s)z(f[s],p,p)}for(I(l,f[0]),i.npotTextureCube||w(pe(l.width)&&pe(l.height),"your browser does not support non power or two texture dimensions"),c.genMipmaps?l.mipmask=(f[0].width<<1)-1:l.mipmask=f[0].mipmask,w.textureCube(l,c,f,i),l.internalformat=f[0].internalformat,d.width=f[0].width,d.height=f[0].height,ne(l),s=0;s<6;++s)j(f[s],me+s);for($(c,ve),re(),u.profile&&(l.stats.size=ft(l.internalformat,l.type,d.width,d.height,c.genMipmaps,!0)),d.format=b[l.internalformat],d.type=E[l.type],d.mag=_[c.magFilter],d.min=x[c.minFilter],d.wrapS=S[c.wrapS],d.wrapT=S[c.wrapT],s=0;s<6;++s)q(f[s]);return d}return d(e,t,r,o,a,c),d.subimage=function(e,t,n,r,i){w(!!t,"must specify image data"),w("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=P();return I(u,l),u.width=0,u.height=0,C(u,t),u.width=u.width||(l.width>>s)-o,u.height=u.height||(l.height>>s)-a,w(l.type===u.type&&l.format===u.format&&l.internalformat===u.internalformat,"incompatible format for texture.subimage"),w(o>=0&&a>=0&&o+u.width<=l.width&&a+u.height<=l.height,"texture.subimage write out of bounds"),w(l.mipmask&1<<s,"missing mipmap data"),w(u.data||u.element||u.needsCopy,"missing image data"),ne(l),O(u,me+e,o,a,s),re(),G(u),d},d.resize=function(e){var t=0|e;if(t!==l.width){d.width=l.width=t,d.height=l.height=t,ne(l);for(var r=0;r<6;++r)for(var i=0;l.mipmask>>i;++i)n.texImage2D(me+r,i,l.format,t>>i,t>>i,0,l.format,l.type,null);return re(),u.profile&&(l.stats.size=ft(l.internalformat,l.type,d.width,d.height,!1,!0)),d}},d._reglType="textureCube",d._texture=l,u.profile&&(d.stats=l.stats),d.destroy=function(){l.decRef()},d},clear:function(){for(var e=0;e<Q;++e)n.activeTexture(Fe+e),n.bindTexture(ge,null),ee[e]=null;W(J).forEach(ie),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<Q;++e){var t=ee[e];t&&(t.bindCount=0,t.unit=-1,ee[e]=null)}W(J).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===ge)n.texImage2D(ge,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(me+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);$(e.texInfo,e.target)}))},refresh:function(){for(var e=0;e<Q;++e){var t=ee[e];t&&(t.bindCount=0,t.unit=-1,ee[e]=null),n.activeTexture(Fe+e),n.bindTexture(ge,null),n.bindTexture(ve,null)}}}}tt[32854]=2,tt[32855]=2,tt[36194]=2,tt[34041]=4,tt[33776]=.5,tt[33777]=.5,tt[33778]=1,tt[33779]=1,tt[35986]=.5,tt[35987]=1,tt[34798]=1,tt[35840]=.5,tt[35841]=.25,tt[35842]=.5,tt[35843]=.25,tt[36196]=.5;var ht=36161,pt=32854,gt=[];function vt(e,t,n){return gt[e]*t*n}gt[32854]=2,gt[32855]=2,gt[36194]=2,gt[33189]=2,gt[36168]=1,gt[34041]=4,gt[35907]=4,gt[34836]=16,gt[34842]=8,gt[34843]=6;var mt=36160,yt=36161,bt=3553,Et=34069,_t=[6407,6408],xt=[];xt[6408]=4,xt[6407]=3;var wt=[];wt[5121]=1,wt[5126]=4,wt[36193]=2;var St=[32854,32855,36194,35907,34842,34843,34836],At={};At[36053]="complete",At[36054]="incomplete attachment",At[36057]="incomplete dimensions",At[36055]="incomplete, missing attachment",At[36061]="unsupported";function Tt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}var It=5121,Nt=5126;function Dt(t,n,r,i,o,a,s){function u(u){var c;null===n.next?(w(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),c=It):(w(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),c=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(w(c===It||c===Nt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),c===Nt&&w(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):w(c===It,"Reading from a framebuffer is only allowed for the type 'uint8'"));var l=0,f=0,d=i.framebufferWidth,h=i.framebufferHeight,p=null;e(u)?p=u:u&&(w.type(u,"object","invalid arguments to regl.read()"),l=0|u.x,f=0|u.y,w(l>=0&&l<i.framebufferWidth,"invalid x offset for regl.read"),w(f>=0&&f<i.framebufferHeight,"invalid y offset for regl.read"),d=0|(u.width||i.framebufferWidth-l),h=0|(u.height||i.framebufferHeight-f),p=u.data||null),p&&(c===It?w(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):c===Nt&&w(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),w(d>0&&d+l<=i.framebufferWidth,"invalid width for read pixels"),w(h>0&&h+f<=i.framebufferHeight,"invalid height for read pixels"),r();var g=d*h*4;return p||(c===It?p=new Uint8Array(g):c===Nt&&(p=p||new Float32Array(g))),w.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),w(p.byteLength>=g,"data buffer for regl.read() too small"),t.pixelStorei(3333,4),t.readPixels(l,f,d,h,6408,c,p),p}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}(e):u(e)}}function kt(e){return Array.prototype.slice.call(e)}function Ct(e){return kt(e).join("")}var Mt="xyzw".split(""),Ot="dither",Rt="blend.enable",Pt="blend.color",Gt="blend.equation",Lt="blend.func",Ut="depth.enable",zt="depth.func",Bt="depth.range",jt="depth.mask",Ft="colorMask",Vt="cull.enable",Wt="cull.face",Ht="frontFace",Xt="lineWidth",qt="polygonOffset.enable",Yt="polygonOffset.offset",Kt="sample.alpha",$t="sample.enable",Zt="sample.coverage",Jt="stencil.enable",Qt="stencil.mask",en="stencil.func",tn="stencil.opFront",nn="stencil.opBack",rn="scissor.enable",on="scissor.box",an="viewport",sn="profile",un="framebuffer",cn="vert",ln="frag",fn="elements",dn="primitive",hn="count",pn="offset",gn="instances",vn="vao",mn="Width",yn="Height",bn=un+mn,En=un+yn,_n="drawingBufferWidth",xn="drawingBufferHeight",wn=[Lt,Gt,en,tn,nn,Zt,an,on,Yt],Sn=34962,An=5126,Tn=35664,In=35665,Nn=35666,Dn=5124,kn=35667,Cn=35668,Mn=35669,On=35670,Rn=35671,Pn=35672,Gn=35673,Ln=35674,Un=35675,zn=35676,Bn=35678,jn=35680,Fn=1028,Vn=1029,Wn=2305,Hn=7680,Xn={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},qn=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Yn={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Kn={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},$n={frag:35632,vert:35633},Zn={cw:2304,ccw:Wn};function Jn(t){return Array.isArray(t)||e(t)||V(t)}function Qn(e){return e.sort((function(e,t){return e===an?-1:t===an?1:e<t?-1:1}))}function er(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function tr(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function nr(e){return new er(!1,!1,!1,e)}function rr(e,t){var n=e.type;if(0===n){var r=e.data.length;return new er(!0,r>=1,r>=2,t)}if(4===n){var i=e.data;return new er(i.thisDep,i.contextDep,i.propDep,t)}if(5===n)return new er(!1,!1,!1,t);if(6===n){for(var o=!1,a=!1,s=!1,u=0;u<e.data.length;++u){var c=e.data[u];if(1===c.type)s=!0;else if(2===c.type)a=!0;else if(3===c.type)o=!0;else if(0===c.type){o=!0;var l=c.data;l>=1&&(a=!0),l>=2&&(s=!0)}else 4===c.type&&(o=o||c.data.thisDep,a=a||c.data.contextDep,s=s||c.data.propDep)}return new er(o,a,s,t)}return new er(3===n,2===n,1===n,t)}var ir=new er(!1,!1,!1,(function(){}));function or(e,n,r,i,o,a,s,u,c,l,f,d,h,p,g){var v=l.Record,m={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(m.min=32775,m.max=32776);var y=r.angle_instanced_arrays,b=r.webgl_draw_buffers,E={dirty:!0,profile:g.profile},_={},x=[],S={},A={};function T(e){return e.replace(".","_")}function I(e,t,n){var r=T(e);x.push(e),_[r]=E[r]=!!n,S[r]=t}function N(e,t,n){var r=T(e);x.push(e),Array.isArray(n)?(E[r]=n.slice(),_[r]=n.slice()):E[r]=_[r]=n,A[r]=t}I(Ot,3024),I(Rt,3042),N(Pt,"blendColor",[0,0,0,0]),N(Gt,"blendEquationSeparate",[32774,32774]),N(Lt,"blendFuncSeparate",[1,0,1,0]),I(Ut,2929,!0),N(zt,"depthFunc",513),N(Bt,"depthRange",[0,1]),N(jt,"depthMask",!0),N(Ft,Ft,[!0,!0,!0,!0]),I(Vt,2884),N(Wt,"cullFace",Vn),N(Ht,Ht,Wn),N(Xt,Xt,1),I(qt,32823),N(Yt,"polygonOffset",[0,0]),I(Kt,32926),I($t,32928),N(Zt,"sampleCoverage",[1,!1]),I(Jt,2960),N(Qt,"stencilMask",-1),N(en,"stencilFunc",[519,0,-1]),N(tn,"stencilOpSeparate",[Fn,Hn,Hn,Hn]),N(nn,"stencilOpSeparate",[Vn,Hn,Hn,Hn]),I(rn,3089),N(on,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),N(an,an,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var k={gl:e,context:h,strings:n,next:_,current:E,draw:d,elements:a,buffer:o,shader:f,attributes:l.state,vao:l,uniforms:c,framebuffer:u,extensions:r,timer:p,isBufferArgs:Jn},C={primTypes:oe,compareFuncs:Yn,blendFuncs:Xn,blendEquations:m,stencilOps:Kn,glTypes:K,orientationType:Zn};w.optional((function(){k.isArrayLike=he})),b&&(C.backBuffer=[Vn],C.drawBuffer=P(i.maxDrawbuffers,(function(e){return 0===e?[0]:P(e,(function(e){return 36064+e}))})));var M=0;function O(){var e=function(){var e=0,n=[],r=[];function i(){var n=[],r=[];return t((function(){n.push.apply(n,kt(arguments))}),{def:function(){var t="v"+e++;return r.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,kt(arguments)),n.push(";")),t},toString:function(){return Ct([r.length>0?"var "+r.join(",")+";":"",Ct(n)])}})}function o(){var e=i(),n=i(),r=e.toString,o=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,kt(arguments))}),{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+o()}})}var a=i(),s={};return{global:a,link:function(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o},block:i,proc:function(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var a=0;a<n;++a)i();var u=o(),c=u.toString;return s[e]=t(u,{arg:i,toString:function(){return Ct(["function(",r.join(),"){",c(),"}"])}})},scope:o,cond:function(){var e=Ct(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return t(n,{then:function(){return n.apply(n,kt(arguments)),this},else:function(){return r.apply(r,kt(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),Ct(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(s).forEach((function(t){e.push('"',t,'":',s[t].toString(),",")})),e.push("}");var t=Ct(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}}}(),r=e.link,i=e.global;e.id=M++,e.batchId="0";var o=r(k),a=e.shared={props:"a0"};Object.keys(k).forEach((function(e){a[e]=i.def(o,".",e)})),w.optional((function(){e.CHECK=r(w),e.commandStr=w.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},C.invalidBlendCombinations=qn}));var s=e.next={},u=e.current={};Object.keys(A).forEach((function(e){Array.isArray(E[e])&&(s[e]=i.def(a.next,".",e),u[e]=i.def(a.current,".",e))}));var c=e.constants={};Object.keys(C).forEach((function(e){c[e]=i.def(JSON.stringify(C[e]))})),e.invoke=function(t,n){switch(n.type){case 0:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case 1:return t.def(a.props,n.data);case 2:return t.def(a.context,n.data);case 3:return t.def("this",n.data);case 4:return n.data.append(e,t),n.data.ref;case 5:return n.data.toString();case 6:return n.data.map((function(n){return e.invoke(t,n)}))}},e.attribCache={};var f={};return e.scopeAttrib=function(e){var t=n.id(e);if(t in f)return f[t];var i=l.scope[t];return i||(i=l.scope[t]=new v),f[t]=r(i)},e}function R(e,t,s,c,d){var h=e.static,p=e.dynamic;w.optional((function(){var e=[un,cn,ln,fn,dn,pn,hn,gn,sn,vn].concat(x);function t(t){Object.keys(t).forEach((function(t){w.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',d.commandStr)}))}t(h),t(p)}));var g=function(e,t){var n=e.static;if("string"==typeof n[ln]&&"string"==typeof n[cn]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)w("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(e,t),b=function(e,t){var n=e.static,r=e.dynamic;if(un in n){var i=n[un];return i?(i=u.getFramebuffer(i),w.command(i,"invalid framebuffer object"),nr((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+bn,n+".width"),t.set(o,"."+En,n+".height"),n}))):nr((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+bn,r+"."+_n),t.set(r,"."+En,r+"."+xn),"null"}))}if(un in r){var o=r[un];return rr(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");w.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=r.context;return t.set(s,"."+bn,a+"?"+a+".width:"+s+"."+_n),t.set(s,"."+En,a+"?"+a+".height:"+s+"."+xn),a}))}return null}(e),E=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];w.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,c=0|o.x,l=0|o.y;return"width"in o?(a=0|o.width,w.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,w.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new er(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",bn,"-",c));var i=s;return"height"in o||(i=t.def(n,".",En,"-",l)),[c,l,r,i]}))}if(e in i){var f=i[e],d=rr(f,(function(t,n){var r=t.invoke(n,f);w.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",bn,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",En,"-",a,")");return w.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[o,a,s,u]}));return t&&(d.thisDep=d.thisDep||t.thisDep,d.contextDep=d.contextDep||t.contextDep,d.propDep=d.propDep||t.propDep),d}return t?new er(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",bn),t.def(n,".",En)]})):null}var a=o(an);if(a){var s=a;a=new er(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,".viewportWidth",n[2]),t.set(r,".viewportHeight",n[3]),n}))}return{viewport:a,scissor_box:o(on)}}(e,b,d),_=function(e,t){var n=e.static,r=e.dynamic,i=function(){if(fn in n){var e=n[fn];Jn(e)?e=a.getElements(a.create(e,!0)):e&&(e=a.getElements(e),w.command(e,"invalid elements",t.commandStr));var i=nr((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return i.value=e,i}if(fn in r){var o=r[fn];return rr(o,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,o),s=t.def("null"),u=t.def(r,"(",a,")"),c=e.cond(u).then(s,"=",i,".createStream(",a,");").else(s,"=",i,".getElements(",a,");");return w.optional((function(){e.assert(c.else,"!"+a+"||"+s,"invalid elements")})),t.entry(c),t.exit(e.cond(u).then(i,".destroyStream(",s,");")),e.ELEMENTS=s,s}))}return null}();function o(e,o){if(e in n){var a=0|n[e];return w.command(!o||a>=0,"invalid "+e,t.commandStr),nr((function(e,t){return o&&(e.OFFSET=a),a}))}if(e in r){var s=r[e];return rr(s,(function(t,n){var r=t.invoke(n,s);return o&&(t.OFFSET=r,w.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}return o&&i?nr((function(e,t){return e.OFFSET="0",0})):null}var s=o(pn,!0);return{elements:i,primitive:function(){if(dn in n){var e=n[dn];return w.commandParameter(e,oe,"invalid primitve",t.commandStr),nr((function(t,n){return oe[e]}))}if(dn in r){var o=r[dn];return rr(o,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return w.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(oe))})),t.def(n,"[",r,"]")}))}return i?tr(i)?i.value?nr((function(e,t){return t.def(e.ELEMENTS,".primType")})):nr((function(){return 4})):new er(i.thisDep,i.contextDep,i.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):null}(),count:function(){if(hn in n){var e=0|n[hn];return w.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),nr((function(){return e}))}if(hn in r){var o=r[hn];return rr(o,(function(e,t){var n=e.invoke(t,o);return w.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(i){if(tr(i)){if(i)return s?new er(s.thisDep,s.contextDep,s.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return w.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):nr((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var a=nr((function(){return-1}));return w.optional((function(){a.MISSING=!0})),a}var u=new er(i.thisDep||s.thisDep,i.contextDep||s.contextDep,i.propDep||s.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return w.optional((function(){u.DYNAMIC=!0})),u}return null}(),instances:o(gn,!1),offset:s}}(e,d),S=function(e,t){var n=e.static,r=e.dynamic,o={};return x.forEach((function(e){var a=T(e);function s(t,i){if(e in n){var s=t(n[e]);o[a]=nr((function(){return s}))}else if(e in r){var u=r[e];o[a]=rr(u,(function(e,t){return i(e,t,e.invoke(t,u))}))}}switch(e){case Vt:case Rt:case Ot:case Jt:case Ut:case rn:case qt:case Kt:case $t:case jt:return s((function(n){return w.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return w.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case zt:return s((function(n){return w.commandParameter(n,Yn,"invalid "+e,t.commandStr),Yn[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return w.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(Yn))})),n.def(i,"[",r,"]")}));case Bt:return s((function(e){return w.command(he(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return w.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case Lt:return s((function(e){w.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return w.commandParameter(n,Xn,a+".srcRGB",t.commandStr),w.commandParameter(r,Xn,a+".srcAlpha",t.commandStr),w.commandParameter(i,Xn,a+".dstRGB",t.commandStr),w.commandParameter(o,Xn,a+".dstAlpha",t.commandStr),w.command(-1===qn.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Xn[n],Xn[i],Xn[r],Xn[o]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return w.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(Xn))})),s}w.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");w.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),c=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),c,n.def(i,"[",o("dst","Alpha"),"]")]}));case Gt:return s((function(n){return"string"==typeof n?(w.commandParameter(n,m,"invalid "+e,t.commandStr),[m[n],m[n]]):"object"==typeof n?(w.commandParameter(n.rgb,m,e+".rgb",t.commandStr),w.commandParameter(n.alpha,m,e+".alpha",t.commandStr),[m[n.rgb],m[n.alpha]]):void w.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return w.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(m))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case Pt:return s((function(e){return w.command(he(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),P(4,(function(t){return+e[t]}))}),(function(e,t,n){return w.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),P(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case Qt:return s((function(e){return w.commandType(e,"number",a,t.commandStr),0|e}),(function(e,t,n){return w.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case en:return s((function(n){w.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return w.commandParameter(r,Yn,e+".cmp",t.commandStr),w.commandType(i,"number",e+".ref",t.commandStr),w.commandType(o,"number",e+".mask",t.commandStr),[Yn[r],i,o]}),(function(e,t,n){var r=e.constants.compareFuncs;return w.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Hn),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case tn:case nn:return s((function(n){w.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return w.commandParameter(r,Kn,e+".fail",t.commandStr),w.commandParameter(i,Kn,e+".zfail",t.commandStr),w.commandParameter(o,Kn,e+".zpass",t.commandStr),[e===nn?Vn:Fn,Kn[r],Kn[i],Kn[o]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return w.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(Kn))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Hn)}return w.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[e===nn?Vn:Fn,o("fail"),o("zfail"),o("zpass")]}));case Yt:return s((function(e){w.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return w.commandType(n,"number",a+".factor",t.commandStr),w.commandType(r,"number",a+".units",t.commandStr),[n,r]}),(function(t,n,r){return w.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Wt:return s((function(e){var n=0;return"front"===e?n=Fn:"back"===e&&(n=Vn),w.command(!!n,a,t.commandStr),n}),(function(e,t,n){return w.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',Fn,":",Vn)}));case Xt:return s((function(e){return w.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return w.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case Ht:return s((function(e){return w.commandParameter(e,Zn,a,t.commandStr),Zn[e]}),(function(e,t,n){return w.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?2304:'+Wn)}));case Ft:return s((function(e){return w.command(he(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return w.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),P(4,(function(e){return"!!"+n+"["+e+"]"}))}));case Zt:return s((function(e){w.command("object"==typeof e&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return w.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return w.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),o}(e,d),A=function(e,t,r){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=n.id(i[e]);w.optional((function(){f.shader($n[e],t,w.guessCommand())}));var r=nr((function(){return t}));return r.id=t,r}if(e in o){var a=o[e];return rr(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return w.optional((function(){n(t.shared.shader,".shader(",$n[e],",",i,",",t.command,");")})),i}))}return null}var s,u=a(ln),c=a(cn),l=null;return tr(u)&&tr(c)?(l=f.program(c.id,u.id,null,r),s=nr((function(e,t){return e.link(l)}))):s=new er(u&&u.thisDep||c&&c.thisDep,u&&u.contextDep||c&&c.contextDep,u&&u.propDep||c&&c.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",ln);var i=r+".program("+(c?c.append(e,t):t.def(r,".",cn))+","+n;return w.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:c,progVar:s,program:l}}(e,0,g);function I(e){var t=E[e];t&&(S[e]=t)}I(an),I(T(on));var N=Object.keys(S).length>0,D={framebuffer:b,draw:_,shader:A,state:S,dirty:N,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(D.profile=function(e){var t,n=e.static,r=e.dynamic;if(sn in n){var i=!!n[sn];(t=nr((function(e,t){return i}))).enable=i}else if(sn in r){var o=r[sn];t=rr(o,(function(e,t){return e.invoke(t,o)}))}return t}(e),D.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=nr((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=nr((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(w.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=nr((function(e){return e.link(o.color[0])}))):w.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else he(o)?r=nr((function(t){return t.global.def("[",P(o.length,(function(n){return w.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):w.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=rr(t,(function(e,n){return e.invoke(n,t)}))})),i}(s,d),D.drawVAO=D.scopeVAO=function(e,t){var n=e.static,r=e.dynamic;if(vn in n){var i=n[vn];return null!==i&&null===l.getVAO(i)&&(i=l.createVAO(i)),nr((function(e){return e.link(l.getVAO(i))}))}if(vn in r){var o=r[vn];return rr(o,(function(e,t){var n=e.invoke(t,o);return t.def(e.shared.vao+".getVAO("+n+")")}))}return null}(e),!D.drawVAO&&A.program&&!g&&r.angle_instanced_arrays){var k=!0,C=A.program.attributes.map((function(e){var n=t.static[e];return k=k&&!!n,n}));if(k&&C.length>0){var M=l.getVAO(l.createVAO(C));D.drawVAO=new er(null,null,null,(function(e,t){return e.link(M)})),D.useVAO=!0}}return g?D.useVAO=!0:D.attributes=function(e,t){var r=e.static,i=e.dynamic,a={};return Object.keys(r).forEach((function(e){var i=r[e],s=n.id(e),u=new v;if(Jn(i))u.state=1,u.buffer=o.getBuffer(o.create(i,Sn,!1,!0)),u.type=0;else{var c=o.getBuffer(i);if(c)u.state=1,u.buffer=c,u.type=0;else if(w.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var l=i.constant;u.buffer="null",u.state=2,"number"==typeof l?u.x=l:(w.command(he(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e,t.commandStr),Mt.forEach((function(e,t){t<l.length&&(u[e]=l[t])})))}else{c=Jn(i.buffer)?o.getBuffer(o.create(i.buffer,Sn,!1,!0)):o.getBuffer(i.buffer),w.command(!!c,'missing buffer for attribute "'+e+'"',t.commandStr);var f=0|i.offset;w.command(f>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var d=0|i.stride;w.command(d>=0&&d<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var h=0|i.size;w.command(!("size"in i)||h>0&&h<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var p=!!i.normalized,g=0;"type"in i&&(w.commandParameter(i.type,K,"invalid type for attribute "+e,t.commandStr),g=K[i.type]);var m=0|i.divisor;"divisor"in i&&(w.command(0===m||y,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),w.command(m>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),w.optional((function(){var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){w.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),u.buffer=c,u.state=1,u.size=h,u.normalized=p,u.type=g||c.dtype,u.offset=f,u.stride=d,u.divisor=m}}a[e]=nr((function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(e){r[e]=u[e]})),u.buffer&&(r.buffer=e.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];a[e]=rr(t,(function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;w.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var c={isStream:r.def(!1)},l=new v;l.state=1,Object.keys(l).forEach((function(e){c[e]=r.def(""+l[e])}));var f=c.buffer,d=c.type;function h(e){r(c[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",c.isStream,"=true;",f,"=",u,".createStream(",Sn,",",i,");",d,"=",f,".dtype;","}else{",f,"=",u,".getBuffer(",i,");","if(",f,"){",d,"=",f,".dtype;",'}else if("constant" in ',i,"){",c.state,"=",2,";","if(typeof "+i+'.constant === "number"){',c[Mt[0]],"=",i,".constant;",Mt.slice(1).map((function(e){return c[e]})).join("="),"=0;","}else{",Mt.map((function(e,t){return c[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",f,"=",u,".createStream(",Sn,",",i,".buffer);","}else{",f,"=",u,".getBuffer(",i,".buffer);","}",d,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",f,".dtype;",c.normalized,"=!!",i,".normalized;"),h("size"),h("offset"),h("stride"),h("divisor"),r("}}"),r.exit("if(",c.isStream,"){",u,".destroyStream(",f,");","}"),c}))})),a}(t,d),D.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=nr((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=rr(t,(function(e,n){return e.invoke(n,t)}))})),r}(c),D}function G(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o].append(e,t);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),t(i)}function L(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;b&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,c=e.constants,l=c.drawBuffer,f=c.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",36160,",",u,".framebuffer);"),b&&t(i,".drawBuffersWEBGL(",l,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),b&&t(i,".drawBuffersWEBGL(",f,");"),t("}",s,".cur=",u,";"),r||t("}")}function U(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,c=e.cond(s,".dirty");x.forEach((function(t){var r,l,f=T(t);if(!(f in n.state))if(f in a){r=a[f],l=o[f];var d=P(E[f].length,(function(e){return c.def(r,"[",e,"]")}));c(e.cond(d.map((function(e,t){return e+"!=="+l+"["+t+"]"})).join("||")).then(i,".",A[f],"(",d,");",d.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";"))}else{r=c.def(u,".",f);var h=e.cond(r,"!==",s,".",f);c(h),f in S?h(e.cond(r).then(i,".enable(",S[f],");").else(i,".disable(",S[f],");"),s,".",f,"=",r,";"):h(i,".",A[f],"(",r,");",s,".",f,"=",r,";")}})),0===Object.keys(n.state).length&&c(s,".dirty=false;"),t(c)}function z(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;Qn(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var c=u.append(e,t);if(S[i]){var l=S[i];tr(u)?t(s,c?".enable(":".disable(",l,");"):t(e.cond(c).then(s,".enable(",l,");").else(s,".disable(",l,");")),t(a,".",i,"=",c,";")}else if(he(c)){var f=o[i];t(s,".",A[i],"(",c,");",c.map((function(e,t){return f+"["+t+"]="+e})).join(";"),";")}else t(s,".",A[i],"(",c,");",a,".",i,"=",c,";")}}))}function B(e,t){y&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function j(e,t,n,r,i){var o,a,s,u=e.shared,c=e.stats,l=u.current,f=u.timer,d=n.profile;function h(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function g(e){e(o=t.def(),"=",h(),";"),"string"==typeof i?e(c,".count+=",i,";"):e(c,".count++;"),p&&(r?e(a=t.def(),"=",f,".getNumPendingQueries();"):e(f,".beginQuery(",c,");"))}function v(e){e(c,".cpuTime+=",h(),"-",o,";"),p&&(r?e(f,".pushScopeStats(",a,",",f,".getNumPendingQueries(),",c,");"):e(f,".endQuery();"))}function m(e){var n=t.def(l,".profile");t(l,".profile=",e,";"),t.exit(l,".profile=",n,";")}if(d){if(tr(d))return void(d.enable?(g(t),v(t.exit),m("true")):m("false"));m(s=d.append(e,t))}else s=t.def(l,".profile");var y=e.block();g(y),t("if(",s,"){",y,"}");var b=e.block();v(b),t.exit("if(",s,"){",b,"}")}function F(e,t,n,r,i){var o=e.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(e,t)}else{if(!i(ir))return;var c=e.scopeAttrib(s);w.optional((function(){e.assert(t,c+".state","missing attribute "+s)})),a={},Object.keys(new v).forEach((function(e){a[e]=t.def(c,".",e)}))}!function(n,r,i){var a=o.gl,s=t.def(n,".location"),u=t.def(o.attributes,"[",s,"]"),c=i.state,l=i.buffer,f=[i.x,i.y,i.z,i.w],d=["buffer","normalized","offset","stride"];function h(){t("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",o,"||",u,".size!==",n,"||",d.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",Sn,",",l,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",d.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),y){var c=i.divisor;t("if(",u,".divisor!==",c,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,c],");",u,".divisor=",c,";}")}}function p(){t("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",Mt.map((function(e,t){return u+"."+e+"!=="+f[t]})).join("||"),"){",a,".vertexAttrib4f(",s,",",f,");",Mt.map((function(e,t){return u+"."+e+"="+f[t]+";"})).join(""),"}")}1===c?h():2===c?p():(t("if(",c,"===",1,"){"),h(),t("}else{"),p(),t("}"))}(e.link(r),function(e){switch(e){case Tn:case kn:case Rn:return 2;case In:case Cn:case Pn:return 3;case Nn:case Mn:case Gn:return 4;default:return 1}}(r.info.type),a)}))}function V(e,t,r,i,o){for(var a,s=e.shared,u=s.gl,c=0;c<i.length;++c){var l,f=i[c],d=f.name,h=f.info.type,p=r.uniforms[d],g=e.link(f)+".location";if(p){if(!o(p))continue;if(tr(p)){var v=p.value;if(w.command(null!=v,'missing uniform "'+d+'"',e.commandStr),h===Bn||h===jn){w.command("function"==typeof v&&(h===Bn&&("texture2d"===v._reglType||"framebuffer"===v._reglType)||h===jn&&("textureCube"===v._reglType||"framebufferCube"===v._reglType)),"invalid texture for uniform "+d,e.commandStr);var m=e.link(v._texture||v.color[0]._texture);t(u,".uniform1i(",g,",",m+".bind());"),t.exit(m,".unbind();")}else if(h===Ln||h===Un||h===zn){w.optional((function(){w.command(he(v),"invalid matrix for uniform "+d,e.commandStr),w.command(h===Ln&&4===v.length||h===Un&&9===v.length||h===zn&&16===v.length,"invalid length for matrix uniform "+d,e.commandStr)}));var y=e.global.def("new Float32Array(["+Array.prototype.slice.call(v)+"])"),b=2;h===Un?b=3:h===zn&&(b=4),t(u,".uniformMatrix",b,"fv(",g,",false,",y,");")}else{switch(h){case An:w.commandType(v,"number","uniform "+d,e.commandStr),a="1f";break;case Tn:w.command(he(v)&&2===v.length,"uniform "+d,e.commandStr),a="2f";break;case In:w.command(he(v)&&3===v.length,"uniform "+d,e.commandStr),a="3f";break;case Nn:w.command(he(v)&&4===v.length,"uniform "+d,e.commandStr),a="4f";break;case On:w.commandType(v,"boolean","uniform "+d,e.commandStr),a="1i";break;case Dn:w.commandType(v,"number","uniform "+d,e.commandStr),a="1i";break;case Rn:case kn:w.command(he(v)&&2===v.length,"uniform "+d,e.commandStr),a="2i";break;case Pn:case Cn:w.command(he(v)&&3===v.length,"uniform "+d,e.commandStr),a="3i";break;case Gn:case Mn:w.command(he(v)&&4===v.length,"uniform "+d,e.commandStr),a="4i"}t(u,".uniform",a,"(",g,",",he(v)?Array.prototype.slice.call(v):v,");")}continue}l=p.append(e,t)}else{if(!o(ir))continue;l=t.def(s.uniforms,"[",n.id(d),"]")}h===Bn?(w(!Array.isArray(l),"must specify a scalar prop for textures"),t("if(",l,"&&",l,'._reglType==="framebuffer"){',l,"=",l,".color[0];","}")):h===jn&&(w(!Array.isArray(l),"must specify a scalar prop for cube maps"),t("if(",l,"&&",l,'._reglType==="framebufferCube"){',l,"=",l,".color[0];","}")),w.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+d+'".  '+r)}function r(e){w(!Array.isArray(l),"must not specify an array type for uniform"),n("typeof "+l+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){Array.isArray(l)?w(l.length===t,"must have length "+t):n(s.isArrayLike+"("+l+")&&"+l+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){w(!Array.isArray(l),"must not specify a value type"),n("typeof "+l+'==="function"&&'+l+'._reglType==="texture'+(3553===t?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(h){case Dn:r("number");break;case kn:i(2);break;case Cn:i(3);break;case Mn:i(4);break;case An:r("number");break;case Tn:i(2);break;case In:i(3);break;case Nn:i(4);break;case On:r("boolean");break;case Rn:i(2);break;case Pn:i(3);break;case Gn:case Ln:i(4);break;case Un:i(9);break;case zn:i(16);break;case Bn:o(3553);break;case jn:o(34067)}}));var E=1;switch(h){case Bn:case jn:var _=t.def(l,"._texture");t(u,".uniform1i(",g,",",_,".bind());"),t.exit(_,".unbind();");continue;case Dn:case On:a="1i";break;case kn:case Rn:a="2i",E=2;break;case Cn:case Pn:a="3i",E=3;break;case Mn:case Gn:a="4i",E=4;break;case An:a="1f";break;case Tn:a="2f",E=2;break;case In:a="3f",E=3;break;case Nn:a="4f",E=4;break;case Ln:a="Matrix2fv";break;case Un:a="Matrix3fv";break;case zn:a="Matrix4fv"}if(t(u,".uniform",a,"(",g,","),"M"===a.charAt(0)){var x=Math.pow(h-Ln+2,2),S=e.global.def("new Float32Array(",x,")");Array.isArray(l)?t("false,(",P(x,(function(e){return S+"["+e+"]="+l[e]})),",",S,")"):t("false,(Array.isArray(",l,")||",l," instanceof Float32Array)?",l,":(",P(x,(function(e){return S+"["+e+"]="+l+"["+e+"]"})),",",S,")")}else E>1?t(P(E,(function(e){return Array.isArray(l)?l[e]:l+"["+e+"]"}))):(w(!Array.isArray(l),"uniform value must not be an array"),t(l));t(");")}}function W(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw;var u=function(){var i,u=s.elements,c=t;return u?((u.contextDep&&r.contextDynamic||u.propDep)&&(c=n),i=u.append(e,c)):i=c.def(a,".",fn),i&&c("if("+i+")"+o+".bindBuffer(34963,"+i+".buffer.buffer);"),i}();function c(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var l,f,d=c(dn),h=c(pn),p=function(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),w.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",hn),w.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof p){if(0===p)return}else n("if(",p,"){"),n.exit("}");y&&(l=c(gn),f=e.instancing);var g=u+".type",v=s.elements&&tr(s.elements);function m(){function e(){n(f,".drawElementsInstancedANGLE(",[d,p,g,h+"<<(("+g+"-5121)>>1)",l],");")}function t(){n(f,".drawArraysInstancedANGLE(",[d,h,p,l],");")}u?v?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}function b(){function e(){n(o+".drawElements("+[d,p,g,h+"<<(("+g+"-5121)>>1)"]+");")}function t(){n(o+".drawArrays("+[d,h,p]+");")}u?v?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}y&&("number"!=typeof l||l>=0)?"string"==typeof l?(n("if(",l,">0){"),m(),n("}else if(",l,"<0){"),b(),n("}")):m():b()}function H(e,t,n,r,i){var o=O(),a=o.proc("body",i);return w.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),y&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function X(e,t,n,r){B(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),F(e,t,n,r.attributes,(function(){return!0}))),V(e,t,n,r.uniforms,(function(){return!0})),W(e,t,t,n)}function q(e,t,n,r){function i(){return!0}e.batchId="a1",B(e,t),F(e,t,n,r.attributes,i),V(e,t,n,r.uniforms,i),W(e,t,t,n)}function Y(e,t,n,r){B(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),u=e.scope();function c(e){return e.contextDep&&i||e.propDep}function l(e){return!c(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&G(e,u,n.context),n.needsFramebuffer&&L(e,u,n.framebuffer),z(e,u,n.state,c),n.profile&&c(n.profile)&&j(e,u,n,!1,!0),r)n.useVAO?n.drawVAO?c(n.drawVAO)?u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),F(e,s,n,r.attributes,l),F(e,u,n,r.attributes,c)),V(e,s,n,r.uniforms,l),V(e,u,n,r.uniforms,c),W(e,s,u,n);else{var f=e.global.def("{}"),d=n.shader.progVar.append(e,u),h=u.def(d,".id"),p=u.def(f,"[",h,"]");u(e.shared.gl,".useProgram(",d,".program);","if(!",p,"){",p,"=",f,"[",h,"]=",e.link((function(t){return H(q,e,n,t,2)})),"(",d,");}",p,".call(this,a0[",o,"],",o,");")}}function $(e,t,n){var r=t.static[n];if(r&&function(e){if("object"==typeof e&&!he(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(D.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,u=!1,c=e.global.def("{}");o.forEach((function(t){var n=r[t];if(D.isDynamic(n)){"function"==typeof n&&(n=r[t]=D.unbox(n));var o=rr(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(c,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new D.DynamicVariable(4,{thisDep:a,contextDep:s,propDep:u,ref:c,append:function(e,t){o.forEach((function(n){var i=r[n];if(D.isDynamic(i)){var o=e.invoke(t,i);t(c,".",n,"=",o,";")}}))}}),delete t.static[n]}}return{next:_,current:E,procs:function(){var e=O(),t=e.proc("poll"),n=e.proc("refresh"),o=e.block();t(o),n(o);var a,s=e.shared,u=s.gl,c=s.next,l=s.current;o(l,".dirty=false;"),L(e,t),L(e,n,null,!0),y&&(a=e.link(y)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var f=0;f<i.maxAttributes;++f){var d=n.def(s.attributes,"[",f,"]"),h=e.cond(d,".buffer");h.then(u,".enableVertexAttribArray(",f,");",u,".bindBuffer(",Sn,",",d,".buffer.buffer);",u,".vertexAttribPointer(",f,",",d,".size,",d,".type,",d,".normalized,",d,".stride,",d,".offset);").else(u,".disableVertexAttribArray(",f,");",u,".vertexAttrib4f(",f,",",d,".x,",d,".y,",d,".z,",d,".w);",d,".buffer=null;"),n(h),y&&n(a,".vertexAttribDivisorANGLE(",f,",",d,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(S).forEach((function(r){var i=S[r],a=o.def(c,".",r),s=e.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",l,".",r,"=",a,";"),n(s),t("if(",a,"!==",l,".",r,"){",s,"}")})),Object.keys(A).forEach((function(r){var i,a,s=A[r],f=E[r],d=e.block();if(d(u,".",s,"("),he(f)){var h=f.length;i=e.global.def(c,".",r),a=e.global.def(l,".",r),d(P(h,(function(e){return i+"["+e+"]"})),");",P(h,(function(e){return a+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",P(h,(function(e){return i+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",d,"}")}else i=o.def(c,".",r),a=o.def(l,".",r),d(i,");",l,".",r,"=",i,";"),t("if(",i,"!==",a,"){",d,"}");n(d)})),e.compile()}(),compile:function(e,r,i,o,a){var s=O();s.stats=s.link(a),Object.keys(r.static).forEach((function(e){$(s,r,e)})),wn.forEach((function(t){$(s,e,t)}));var u=R(e,r,i,o,s);return function(e,t){var n=e.proc("draw",1);B(e,n),G(e,n,t.context),L(e,n,t.framebuffer),U(e,n,t),z(e,n,t.state),j(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)X(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return H(X,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(s,u),function(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}G(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),Qn(Object.keys(t.state)).forEach((function(n){var o=t.state[n].append(e,r);he(o)?o.forEach((function(t,i){r.set(e.next[n],"["+i+"]",t)})):r.set(i.next,"."+n,o)})),j(e,r,t,!0,!0),[fn,pn,hn,gn,dn].forEach((function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))})),Object.keys(t.uniforms).forEach((function(o){var a=t.uniforms[o].append(e,r);Array.isArray(a)&&(a="["+a.join()+"]"),r.set(i.uniforms,"["+n.id(o)+"]",a)})),Object.keys(t.attributes).forEach((function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new v).forEach((function(e){r.set(o,"."+e,i[e])}))})),t.scopeVAO&&r.set(i.vao,".targetVAO",t.scopeVAO.append(e,r)),a(cn),a(ln),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}(s,u),function(e,t){var n=e.proc("batch",2);e.batchId="0",B(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(G(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||L(e,n,o)):L(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),U(e,n,t),z(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||j(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)Y(e,n,t,null);else{var c=u.append(e,n);if(n(e.shared.gl,".useProgram(",c,".program);"),t.shader.program)Y(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var l=e.global.def("{}"),f=n.def(c,".id"),d=n.def(l,"[",f,"]");n(e.cond(d).then(d,".call(this,a0,a1);").else(d,"=",l,"[",f,"]=",e.link((function(n){return H(Y,e,t,n,2)})),"(",c,");",d,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(s,u),t(s.compile(),{destroy:function(){u.shader.program.destroy()}})}}}var ar=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var u=[];function c(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,u.push(r)}var l=[],f=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),c(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:c,update:function(){var e,n,o=i.length;if(0!==o){f.length=Math.max(f.length,o+1),l.length=Math.max(l.length,o+1),l[0]=0,f[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var c=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(c,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(c,34918),r(c)):i[e++]=c,l[n+1]=a,f[n+1]=e}for(i.length=e,e=0,n=0;n<u.length;++n){var d=u[n],h=d.startQueryIndex,p=d.endQueryIndex;d.sum+=l[p]-l[h];var g=f[h],v=f[p];v===g?(d.stats.gpuTime+=d.sum/1e6,s(d)):(d.startQueryIndex=g,d.endQueryIndex=v,u[e++]=d)}u.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},sr="webglcontextlost",ur="webglcontextrestored";function cr(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(n){var r=R(n);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),s=function(e,t){var n={};function r(t){w.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}(i,r);if(!s)return null;var u,c,l=(u={"":0},c=[""],{id:function(e){var t=u[e];return t||(t=u[e]=c.length,c.push(e),t)},str:function(e){return c[e]}}),f={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},d=s.extensions,h=ar(0,d),p=C(),g=i.drawingBufferWidth,v=i.drawingBufferHeight,m={tick:0,time:0,viewportWidth:g,viewportHeight:v,framebufferWidth:g,framebufferHeight:v,drawingBufferWidth:g,drawingBufferHeight:v,pixelRatio:r.pixelRatio},y=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(z,a),e.texImage2D(z,0,B,1,1,0,B,j,null);var s=e.createFramebuffer();if(e.bindFramebuffer(F,s),e.framebufferTexture2D(F,36064,z,a,0),e.bindTexture(z,null),36053!==e.checkFramebufferStatus(F))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=U.allocType(j,4);e.readPixels(0,0,1,1,B,j,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),U.freeType(u)}}var c=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var l=e.createTexture(),f=U.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,l),e.texImage2D(34069,0,B,3,3,0,B,5121,f),U.freeType(f),e.bindTexture(34067,null),e.deleteTexture(l),c=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:c}}(i,d),b=function(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=Q,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){f(this)};var u=[];function c(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function l(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||ee,n.length>0)if(Array.isArray(n[0])){s=J(n);for(var l=1,f=1;f<s.length;++f)l*=s[f];t.dimension=l,c(t,u=Z(n,s,t.dtype),r),a?t.persistentData=u:U.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var d=U.allocType(t.dtype,n.length);re(d,n),c(t,d,r),a?t.persistentData=d:U.freeType(d)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||ne(n[0])||ee,c(t,u=Z(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:U.freeType(u)):w.raise("invalid buffer data")}else if(e(n))t.dtype=i||ne(n),t.dimension=o,c(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(V(n)){s=n.shape;var h=n.stride,p=n.offset,g=0,v=0,m=0,y=0;1===s.length?(g=s[0],v=1,m=h[0],y=0):2===s.length?(g=s[0],v=s[1],m=h[0],y=h[1]):w.raise("invalid shape"),t.dtype=i||ne(n.data)||ee,t.dimension=v;var b=U.allocType(t.dtype,g*v);ie(b,n.data,g,v,m,y,p),c(t,b,r),a?t.persistentData=b:U.freeType(b)}else n instanceof ArrayBuffer?(t.dtype=Q,t.dimension=o,c(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):w.raise("invalid buffer data")}function f(e){n.bufferCount--,i(e);var r=e.buffer;w(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:function(i,o,u,c){n.bufferCount++;var d=new s(o);function h(n){var i=35044,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||V(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(w.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(w(null===o||Array.isArray(o)||e(o)||V(o),"invalid data for buffer"),o=n.data),"usage"in n&&(w.parameter(n.usage,$,"invalid buffer usage"),i=$[n.usage]),"type"in n&&(w.parameter(n.type,K,"invalid buffer type"),s=K[n.type]),"dimension"in n&&(w.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(w.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),d.bind(),o?l(d,o,i,s,u,c):(a&&t.bufferData(d.type,a,i),d.dtype=s||Q,d.usage=i,d.dimension=u,d.byteLength=a),r.profile&&(d.stats.size=d.byteLength*te[d.dtype]),h}function p(e,n){w(n+e.byteLength<=d.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+d.byteLength),t.bufferSubData(d.type,n,e)}return a[d.id]=d,u||h(i),h._reglType="buffer",h._buffer=d,h.subdata=function(t,n){var r,i=0|(n||0);if(d.bind(),e(t)||t instanceof ArrayBuffer)p(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=U.allocType(d.dtype,t.length);re(o,t),p(o,i),U.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=J(t);var a=Z(t,r,d.dtype);p(a,i),U.freeType(a)}else w.raise("invalid buffer data")}else if(V(t)){r=t.shape;var s=t.stride,u=0,c=0,l=0,f=0;1===r.length?(u=r[0],c=1,l=s[0],f=0):2===r.length?(u=r[0],c=r[1],l=s[0],f=s[1]):w.raise("invalid shape");var g=Array.isArray(t.data)?d.dtype:ne(t.data),v=U.allocType(g,u*c);ie(v,t.data,u,c,l,f,t.offset),p(v,i),U.freeType(v)}else w.raise("invalid data for buffer subdata");return h},r.profile&&(h.stats=d.stats),h.destroy=function(){f(d)},h},createStream:function(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),l(n,t,35040,0,1,!1),n},destroyStream:function(e){u.push(e)},clear:function(){W(a).forEach(f),u.forEach(f)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){W(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:l}}(i,f,r,(function(e){return E.destroyBuffer(e)})),E=function(t,n,r,i,o){for(var a=r.maxAttributes,s=new Array(a),u=0;u<a;++u)s[u]=new Tt;var c=0,l={},f={Record:Tt,scope:{},state:s,currentVAO:null,targetVAO:null,restore:d()?function(){d()&&W(l).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(t){var r=new p;function s(t){w(Array.isArray(t),"arguments to vertex array constructor must be an array"),w(t.length<a,"too many attributes"),w(t.length>0,"must specify at least one attribute");var i={},u=r.attributes;u.length=t.length;for(var c=0;c<t.length;++c){var l,f=t[c],d=u[c]=new Tt,h=f.data||f;Array.isArray(h)||e(h)||V(h)?(r.buffers[c]&&(l=r.buffers[c],e(h)&&l._buffer.byteLength>=h.byteLength?l.subdata(h):(l.destroy(),r.buffers[c]=null)),r.buffers[c]||(l=r.buffers[c]=o.create(f,34962,!1,!0)),d.buffer=o.getBuffer(l),d.size=0|d.buffer.dimension,d.normalized=!1,d.type=d.buffer.dtype,d.offset=0,d.stride=0,d.divisor=0,d.state=1,i[c]=1):o.getBuffer(f)?(d.buffer=o.getBuffer(f),d.size=0|d.buffer.dimension,d.normalized=!1,d.type=d.buffer.dtype,d.offset=0,d.stride=0,d.divisor=0,d.state=1):o.getBuffer(f.buffer)?(d.buffer=o.getBuffer(f.buffer),d.size=0|(+f.size||d.buffer.dimension),d.normalized=!!f.normalized||!1,"type"in f?(w.parameter(f.type,K,"invalid buffer type"),d.type=K[f.type]):d.type=d.buffer.dtype,d.offset=0|(f.offset||0),d.stride=0|(f.stride||0),d.divisor=0|(f.divisor||0),d.state=1,w(d.size>=1&&d.size<=4,"size must be between 1 and 4"),w(d.offset>=0,"invalid offset"),w(d.stride>=0&&d.stride<=255,"stride must be between 0 and 255"),w(d.divisor>=0,"divisor must be positive"),w(!d.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in f?(w(c>0,"first attribute must not be a constant"),d.x=+f.x||0,d.y=+f.y||0,d.z=+f.z||0,d.w=+f.w||0,d.state=2):w(!1,"invalid attribute spec for location "+c)}for(var p=0;p<r.buffers.length;++p)!i[p]&&r.buffers[p]&&(r.buffers[p].destroy(),r.buffers[p]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.destroy()},s._vao=r,s._reglType="vao",s(t)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var n=0;n<s.length;++n){var r=s[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}},setVAO:d()?function(e){if(e!==f.currentVAO){var t=d();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),f.currentVAO=e}}:function(e){if(e!==f.currentVAO){if(e)e.bindAttrs();else for(var n=h(),r=0;r<s.length;++r){var i=s[r];i.buffer?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}f.currentVAO=e}},clear:d()?function(){W(l).forEach((function(e){e.destroy()}))}:function(){}};function d(){return n.oes_vertex_array_object}function h(){return n.angle_instanced_arrays}function p(){this.id=++c,this.attributes=[];var e=d();this.vao=e?e.createVertexArrayOES():null,l[this.id]=this,this.buffers=[]}return p.prototype.bindAttrs=function(){for(var e=h(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(34962,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<a;++o)t.disableVertexAttribArray(o)},p.prototype.refresh=function(){var e=d();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),f.currentVAO=this)},p.prototype.destroy=function(){if(this.vao){var e=d();this===f.currentVAO&&(f.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}l[this.id]&&(delete l[this.id],i.vaoCount-=1)},f}(i,d,y,f,b),_=function(t,n,r,i){var o={},a=0,s={uint8:ae,uint16:se};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=ue),u.prototype.bind=function(){this.buffer.bind()};var c=[];function l(i,o,a,s,u,c,l){var f;if(i.buffer.bind(),o){var d=l;l||e(o)&&(!V(o)||e(o.data))||(d=n.oes_element_index_uint?ue:se),r._initBuffer(i.buffer,o,a,d,3)}else t.bufferData(ce,c,a),i.buffer.dtype=f||ae,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=c;if(f=l,!l){switch(i.buffer.dtype){case ae:case 5120:f=ae;break;case se:case 5122:f=se;break;case ue:case 5124:f=ue;break;default:w.raise("unsupported type for element array")}i.buffer.dtype=f}i.type=f,w(f!==ue||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var h=u;h<0&&(h=i.buffer.byteLength,f===se?h>>=1:f===ue&&(h>>=2)),i.vertCount=h;var p=s;if(s<0){p=4;var g=i.buffer.dimension;1===g&&(p=0),2===g&&(p=1),3===g&&(p=4)}i.primType=p}function f(e){i.elementsCount--,w(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,n){var o=r.create(null,ce,!0),a=new u(o._buffer);function c(t){if(t)if("number"==typeof t)o(t),a.primType=4,a.vertCount=0|t,a.type=ae;else{var n=null,r=35044,i=-1,u=-1,f=0,d=0;Array.isArray(t)||e(t)||V(t)?n=t:(w.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,w(Array.isArray(n)||e(n)||V(n),"invalid data for element buffer")),"usage"in t&&(w.parameter(t.usage,$,"invalid element buffer usage"),r=$[t.usage]),"primitive"in t&&(w.parameter(t.primitive,oe,"invalid element buffer primitive"),i=oe[t.primitive]),"count"in t&&(w("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(w.parameter(t.type,s,"invalid buffer type"),d=s[t.type]),"length"in t?f=0|t.length:(f=u,d===se||5122===d?f*=2:d!==ue&&5124!==d||(f*=4))),l(a,n,r,i,u,f,d)}else o(),a.primType=4,a.vertCount=0,a.type=ae;return c}return i.elementsCount++,c(t),c._reglType="elements",c._elements=a,c.subdata=function(e,t){return o.subdata(e,t),c},c.destroy=function(){f(a)},c},createStream:function(e){var t=c.pop();return t||(t=new u(r.create(null,ce,!0,!1)._buffer)),l(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){c.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){W(o).forEach(f)}}}(i,d,b,f),x=function(e,n,r,i){var o={},a={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function u(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function c(t,r,i){var s=35632===t?o:a,u=s[r];if(!u){var c=n.str(r);u=e.createShader(t),e.shaderSource(u,c),e.compileShader(u),w.shaderError(e,u,c,t,i),s[r]=u}return u}var l={},f=[],d=0;function h(e,t){this.id=d++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(t,r,o){var a,l,f=c(35632,t.fragId),d=c(35633,t.vertId),h=t.program=e.createProgram();if(e.attachShader(h,f),e.attachShader(h,d),o)for(a=0;a<o.length;++a){var p=o[a];e.bindAttribLocation(h,p[0],p[1])}e.linkProgram(h),w.linkError(e,h,n.str(t.fragId),n.str(t.vertId),r);var g=e.getProgramParameter(h,35718);i.profile&&(t.stats.uniformsCount=g);var v=t.uniforms;for(a=0;a<g;++a)if(l=e.getActiveUniform(h,a))if(l.size>1)for(var m=0;m<l.size;++m){var y=l.name.replace("[0]","["+m+"]");u(v,new s(y,n.id(y),e.getUniformLocation(h,y),l))}else u(v,new s(l.name,n.id(l.name),e.getUniformLocation(h,l.name),l));var b=e.getProgramParameter(h,35721);i.profile&&(t.stats.attributesCount=b);var E=t.attributes;for(a=0;a<b;++a)(l=e.getActiveAttrib(h,a))&&u(E,new s(l.name,n.id(l.name),e.getAttribLocation(h,l.name),l))}return i.profile&&(r.getMaxUniformsCount=function(){var e=0;return f.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return f.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);W(o).forEach(t),o={},W(a).forEach(t),a={},f.forEach((function(t){e.deleteProgram(t.program)})),f.length=0,l={},r.shaderCount=0},program:function(n,i,s,u){w.command(n>=0,"missing vertex shader",s),w.command(i>=0,"missing fragment shader",s);var c=l[i];c||(c=l[i]={});var d=c[n];if(d&&(d.refCount++,!u))return d;var g=new h(i,n);return r.shaderCount++,p(g,s,u),d||(c[n]=g),f.push(g),t(g,{destroy:function(){if(g.refCount--,g.refCount<=0){e.deleteProgram(g.program);var t=f.indexOf(g);f.splice(t,1),r.shaderCount--}c[g.vertId].refCount<=0&&(e.deleteShader(a[g.vertId]),delete a[g.vertId],delete l[g.fragId][g.vertId]),Object.keys(l[g.fragId]).length||(e.deleteShader(o[g.fragId]),delete o[g.fragId],delete l[g.fragId])}})},restore:function(){o={},a={};for(var e=0;e<f.length;++e)p(f[e],null,f[e].attributes.map((function(e){return[e.location,e.name]})))},shader:c,frag:-1,vert:-1}}(i,l,f,r),S=dt(i,d,y,(function(){I.procs.poll()}),m,f,r),A=function(e,t,n,r,i){var o={rgba4:pt,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach((function(e){var t=o[e];a[t]=e}));var s=0,u={};function c(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=pt,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function l(t){var n=t.renderbuffer;w(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(ht,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete u[t.id],r.renderbufferCount--}return c.prototype.decRef=function(){--this.refCount<=0&&l(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach((function(t){e+=u[t].stats.size})),e}),{create:function(t,s){var l=new c(e.createRenderbuffer());function f(t,r){var s=0,u=0,c=pt;if("object"==typeof t&&t){var d=t;if("shape"in d){var h=d.shape;w(Array.isArray(h)&&h.length>=2,"invalid renderbuffer shape"),s=0|h[0],u=0|h[1]}else"radius"in d&&(s=u=0|d.radius),"width"in d&&(s=0|d.width),"height"in d&&(u=0|d.height);"format"in d&&(w.parameter(d.format,o,"invalid renderbuffer format"),c=o[d.format])}else"number"==typeof t?(s=0|t,u="number"==typeof r?0|r:s):t?w.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(w(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==l.width||u!==l.height||c!==l.format)return f.width=l.width=s,f.height=l.height=u,l.format=c,e.bindRenderbuffer(ht,l.renderbuffer),e.renderbufferStorage(ht,c,s,u),w(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=vt(l.format,l.width,l.height)),f.format=a[l.format],f}return u[l.id]=l,r.renderbufferCount++,f(t,s),f.resize=function(t,r){var o=0|t,a=0|r||o;return o===l.width&&a===l.height||(w(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),f.width=l.width=o,f.height=l.height=a,e.bindRenderbuffer(ht,l.renderbuffer),e.renderbufferStorage(ht,l.format,o,a),w(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=vt(l.format,l.width,l.height))),f},f._reglType="renderbuffer",f._renderbuffer=l,i.profile&&(f.stats=l.stats),f.destroy=function(){l.decRef()},f},clear:function(){W(u).forEach(l)},restore:function(){W(u).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(ht,t.renderbuffer),e.renderbufferStorage(ht,t.format,t.width,t.height)})),e.bindRenderbuffer(ht,null)}}}(i,d,y,f,r),T=function(e,n,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],c=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&c.push("srgba"),n.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&c.push("rgba32f");var l=["uint8"];function f(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function d(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function h(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);w(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;w(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function p(t,n){n&&(n.texture?e.framebufferTexture2D(mt,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(mt,t,yt,n.renderbuffer._renderbuffer.renderbuffer))}function g(e){var t=bt,n=null,r=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),w.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,w(t===bt)):"textureCube"===o?(n=i,w(t>=Et&&t<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,t=yt):w.raise("invalid regl object for attachment"),new f(t,n,r)}function v(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new f(bt,s,null)}var u=o.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new f(yt,null,u)}function m(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&l.push("half float","float16"),n.oes_texture_float&&l.push("float","float32");var b=0,E={};function _(){this.id=b++,E[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function x(e){e.colorAttachments.forEach(d),d(e.depthAttachment),d(e.stencilAttachment),d(e.depthStencilAttachment)}function S(t){var n=t.framebuffer;w(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete E[t.id]}function A(t){var n;e.bindFramebuffer(mt,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)p(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(mt,36064+n,bt,null,0);e.framebufferTexture2D(mt,33306,bt,null,0),e.framebufferTexture2D(mt,36096,bt,null,0),e.framebufferTexture2D(mt,36128,bt,null,0),p(36096,t.depthAttachment),p(36128,t.stencilAttachment),p(33306,t.depthStencilAttachment);var o=e.checkFramebufferStatus(mt);e.isContextLost()||36053===o||w.raise("framebuffer configuration not supported, status = "+At[o]),e.bindFramebuffer(mt,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function T(e,i){var o=new _;function f(e,t){var i;w(s.next!==o,"can not update framebuffer which is currently in use");var a=0,d=0,p=!0,y=!0,b=null,E=!0,_="rgba",S="uint8",T=1,I=null,N=null,D=null,k=!1;if("number"==typeof e)a=0|e,d=0|t||a;else if(e){w.type(e,"object","invalid arguments for framebuffer");var C=e;if("shape"in C){var M=C.shape;w(Array.isArray(M)&&M.length>=2,"invalid shape for framebuffer"),a=M[0],d=M[1]}else"radius"in C&&(a=d=C.radius),"width"in C&&(a=C.width),"height"in C&&(d=C.height);("color"in C||"colors"in C)&&(b=C.color||C.colors,Array.isArray(b)&&w(1===b.length||n.webgl_draw_buffers,"multiple render targets not supported")),b||("colorCount"in C&&(T=0|C.colorCount,w(T>0,"invalid color buffer count")),"colorTexture"in C&&(E=!!C.colorTexture,_="rgba4"),"colorType"in C&&(S=C.colorType,E?(w(n.oes_texture_float||!("float"===S||"float32"===S),"you must enable OES_texture_float in order to use floating point framebuffer objects"),w(n.oes_texture_half_float||!("half float"===S||"float16"===S),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===S||"float16"===S?(w(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),_="rgba16f"):"float"!==S&&"float32"!==S||(w(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),_="rgba32f"),w.oneOf(S,l,"invalid color type")),"colorFormat"in C&&(_=C.colorFormat,u.indexOf(_)>=0?E=!0:c.indexOf(_)>=0?E=!1:E?w.oneOf(C.colorFormat,u,"invalid color format for texture"):w.oneOf(C.colorFormat,c,"invalid color format for renderbuffer"))),("depthTexture"in C||"depthStencilTexture"in C)&&(k=!(!C.depthTexture&&!C.depthStencilTexture),w(!k||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in C&&("boolean"==typeof C.depth?p=C.depth:(I=C.depth,y=!1)),"stencil"in C&&("boolean"==typeof C.stencil?y=C.stencil:(N=C.stencil,p=!1)),"depthStencil"in C&&("boolean"==typeof C.depthStencil?p=y=C.depthStencil:(D=C.depthStencil,p=!1,y=!1))}else a=d=1;var O=null,R=null,P=null,G=null;if(Array.isArray(b))O=b.map(g);else if(b)O=[g(b)];else for(O=new Array(T),i=0;i<T;++i)O[i]=v(a,d,E,_,S);w(n.webgl_draw_buffers||O.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),w(O.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||O[0].width,d=d||O[0].height,I?R=g(I):p&&!y&&(R=v(a,d,k,"depth","uint32")),N?P=g(N):y&&!p&&(P=v(a,d,!1,"stencil","uint8")),D?G=g(D):!I&&!N&&y&&p&&(G=v(a,d,k,"depth stencil","depth stencil")),w(!!I+!!N+!!D<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var L=null;for(i=0;i<O.length;++i)if(h(O[i],a,d),w(!O[i]||O[i].texture&&_t.indexOf(O[i].texture._texture.format)>=0||O[i].renderbuffer&&St.indexOf(O[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),O[i]&&O[i].texture){var U=xt[O[i].texture._texture.format]*wt[O[i].texture._texture.type];null===L?L=U:w(L===U,"all color attachments much have the same number of bits per pixel.")}return h(R,a,d),w(!R||R.texture&&6402===R.texture._texture.format||R.renderbuffer&&33189===R.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),h(P,a,d),w(!P||P.renderbuffer&&36168===P.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),h(G,a,d),w(!G||G.texture&&34041===G.texture._texture.format||G.renderbuffer&&34041===G.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),x(o),o.width=a,o.height=d,o.colorAttachments=O,o.depthAttachment=R,o.stencilAttachment=P,o.depthStencilAttachment=G,f.color=O.map(m),f.depth=m(R),f.stencil=m(P),f.depthStencil=m(G),f.width=o.width,f.height=o.height,A(o),f}return a.framebufferCount++,f(e,i),t(f,{resize:function(e,t){w(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return f;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=f.width=n,o.height=f.height=r,A(o),f},_reglType:"framebuffer",_framebuffer:o,destroy:function(){S(o),x(o)},use:function(e){s.setFBO({framebuffer:f},e)}})}return t(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof _)return t}return null},create:T,createCube:function(e){var o=Array(6);function a(e){var r;w(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var c,f={color:null},d=0,h=null,p="rgba",g="uint8",v=1;if("number"==typeof e)d=0|e;else if(e){w.type(e,"object","invalid arguments for framebuffer");var m=e;if("shape"in m){var y=m.shape;w(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),w(y[0]===y[1],"cube framebuffer must be square"),d=y[0]}else"radius"in m&&(d=0|m.radius),"width"in m?(d=0|m.width,"height"in m&&w(m.height===d,"must be square")):"height"in m&&(d=0|m.height);("color"in m||"colors"in m)&&(h=m.color||m.colors,Array.isArray(h)&&w(1===h.length||n.webgl_draw_buffers,"multiple render targets not supported")),h||("colorCount"in m&&(v=0|m.colorCount,w(v>0,"invalid color buffer count")),"colorType"in m&&(w.oneOf(m.colorType,l,"invalid color type"),g=m.colorType),"colorFormat"in m&&(p=m.colorFormat,w.oneOf(m.colorFormat,u,"invalid color format for texture"))),"depth"in m&&(f.depth=m.depth),"stencil"in m&&(f.stencil=m.stencil),"depthStencil"in m&&(f.depthStencil=m.depthStencil)}else d=1;if(h)if(Array.isArray(h))for(c=[],r=0;r<h.length;++r)c[r]=h[r];else c=[h];else{c=Array(v);var b={radius:d,format:p,type:g};for(r=0;r<v;++r)c[r]=i.createCube(b)}for(f.color=Array(c.length),r=0;r<c.length;++r){var E=c[r];w("function"==typeof E&&"textureCube"===E._reglType,"invalid cube map"),d=d||E.width,w(E.width===d&&E.height===d,"invalid cube map shape"),f.color[r]={target:Et,data:c[r]}}for(r=0;r<6;++r){for(var _=0;_<c.length;++_)f.color[_].target=Et+r;r>0&&(f.depth=o[0].depth,f.stencil=o[0].stencil,f.depthStencil=o[0].depthStencil),o[r]?o[r](f):o[r]=T(f)}return t(a,{width:d,height:d,color:c})}return a(e),t(a,{faces:o,resize:function(e){var t,n=0|e;if(w(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})},clear:function(){W(E).forEach(S)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,W(E).forEach((function(t){t.framebuffer=e.createFramebuffer(),A(t)}))}})}(i,d,y,S,A,f),I=or(i,l,d,y,b,_,0,T,{},E,x,{elements:null,primitive:4,count:-1,offset:0,instances:-1},m,h,r),N=Dt(i,T,I.procs.poll,m,o,d,y),M=I.next,O=i.canvas,P=[],G=[],L=[],H=[r.onDestroy],X=null;function q(){if(0===P.length)return h&&h.update(),void(X=null);X=k.next(q),ye();for(var e=P.length-1;e>=0;--e){var t=P[e];t&&t(m,null,0)}i.flush(),h&&h.update()}function Y(){!X&&P.length>0&&(X=k.next(q))}function le(){X&&(k.cancel(q),X=null)}function fe(e){e.preventDefault(),a=!0,le(),G.forEach((function(e){e()}))}function de(e){i.getError(),a=!1,s.restore(),x.restore(),b.restore(),S.restore(),A.restore(),T.restore(),E.restore(),h&&h.restore(),I.procs.refresh(),Y(),L.forEach((function(e){e()}))}function he(e){function n(e,t){var n={},r={};return Object.keys(e).forEach((function(i){var o=e[i];if(D.isDynamic(o))r[i]=D.unbox(o,i);else{if(t&&Array.isArray(o))for(var a=0;a<o.length;++a)if(D.isDynamic(o[a]))return void(r[i]=D.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}w(!!e,"invalid args to regl({...})"),w.type(e,"object","invalid args to regl({...})");var r=n(e.context||{},!0),i=n(e.uniforms||{},!0),o=n(e.attributes||{},!1),s=n(function(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}(e),!1),u={gpuTime:0,cpuTime:0,count:0},c=I.compile(s,o,i,r,u),l=c.draw,f=c.batch,d=c.scope,h=[];return t((function(e,t){var n;if(a&&w.raise("context lost"),"function"==typeof e)return d.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)d.call(this,null,t,n);else{if(!Array.isArray(e))return d.call(this,e,t,0);for(n=0;n<e.length;++n)d.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return f.call(this,function(e){for(;h.length<e;)h.push(null);return h}(0|e),0|e)}else{if(!Array.isArray(e))return l.call(this,e);if(e.length)return f.call(this,e,e.length)}}),{stats:u,destroy:function(){c.destroy()}})}O&&(O.addEventListener(sr,fe,!1),O.addEventListener(ur,de,!1));var pe=T.setFBO=he({framebuffer:D.define.call(null,1,"framebuffer")});function ge(e,t){var n=0;I.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(i.clearDepth(+t.depth),n|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=1024),w(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function ve(e){return w.type(e,"function","regl.frame() callback must be a function"),P.push(e),Y(),{cancel:function(){var t=cr(P,e);w(t>=0,"cannot cancel a frame twice"),P[t]=function e(){var t=cr(P,e);P[t]=P[P.length-1],P.length-=1,P.length<=0&&le()}}}}function me(){var e=M.viewport,t=M.scissor_box;e[0]=e[1]=t[0]=t[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function ye(){m.tick+=1,m.time=Ee(),me(),I.procs.poll()}function be(){S.refresh(),me(),I.procs.refresh(),h&&h.update()}function Ee(){return(C()-p)/1e3}be();var _e=t(he,{clear:function(e){if(w("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)pe(t({framebuffer:e.framebuffer.faces[n]},e),ge);else pe(e,ge);else ge(0,e)},prop:D.define.bind(null,1),context:D.define.bind(null,2),this:D.define.bind(null,3),draw:he({}),buffer:function(e){return b.create(e,34962,!1,!1)},elements:function(e){return _.create(e,!1)},texture:S.create2D,cube:S.createCube,renderbuffer:A.create,framebuffer:T.create,framebufferCube:T.createCube,vao:E.createVAO,attributes:o,frame:ve,on:function(e,t){var n;switch(w.type(t,"function","listener callback must be a function"),e){case"frame":return ve(t);case"lost":n=G;break;case"restore":n=L;break;case"destroy":n=H;break;default:w.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:y,hasExtension:function(e){return y.extensions.indexOf(e.toLowerCase())>=0},read:N,destroy:function(){P.length=0,le(),O&&(O.removeEventListener(sr,fe),O.removeEventListener(ur,de)),x.clear(),T.clear(),A.clear(),S.clear(),_.clear(),b.clear(),E.clear(),h&&h.clear(),H.forEach((function(e){e()}))},_gl:i,_refresh:be,poll:function(){ye(),h&&h.update()},now:Ee,stats:f});return r.onDone(null,_e),_e}}()},7745:(e,t,n)=>{var r=n(8292);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,n(8159).Z)("597ae84e",r,!0,{})},8159:(e,t,n)=>{"use strict";function r(e,t){for(var n=[],r={},i=0;i<t.length;i++){var o=t[i],a=o[0],s={id:e+":"+i,css:o[1],media:o[2],sourceMap:o[3]};r[a]?r[a].parts.push(s):n.push(r[a]={id:a,parts:[s]})}return n}n.d(t,{Z:()=>p});var i="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!i)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},a=i&&(document.head||document.getElementsByTagName("head")[0]),s=null,u=0,c=!1,l=function(){},f=null,d="data-vue-ssr-id",h="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function p(e,t,n,i){c=n,f=i||{};var a=r(e,t);return g(a),function(t){for(var n=[],i=0;i<a.length;i++){var s=a[i];(u=o[s.id]).refs--,n.push(u)}for(t?g(a=r(e,t)):a=[],i=0;i<n.length;i++){var u;if(0===(u=n[i]).refs){for(var c=0;c<u.parts.length;c++)u.parts[c]();delete o[u.id]}}}}function g(e){for(var t=0;t<e.length;t++){var n=e[t],r=o[n.id];if(r){r.refs++;for(var i=0;i<r.parts.length;i++)r.parts[i](n.parts[i]);for(;i<n.parts.length;i++)r.parts.push(m(n.parts[i]));r.parts.length>n.parts.length&&(r.parts.length=n.parts.length)}else{var a=[];for(i=0;i<n.parts.length;i++)a.push(m(n.parts[i]));o[n.id]={id:n.id,refs:1,parts:a}}}}function v(){var e=document.createElement("style");return e.type="text/css",a.appendChild(e),e}function m(e){var t,n,r=document.querySelector("style["+d+'~="'+e.id+'"]');if(r){if(c)return l;r.parentNode.removeChild(r)}if(h){var i=u++;r=s||(s=v()),t=E.bind(null,r,i,!1),n=E.bind(null,r,i,!0)}else r=v(),t=_.bind(null,r),n=function(){r.parentNode.removeChild(r)};return t(e),function(r){if(r){if(r.css===e.css&&r.media===e.media&&r.sourceMap===e.sourceMap)return;t(e=r)}else n()}}var y,b=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join("\n")});function E(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=b(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}function _(e,t){var n=t.css,r=t.media,i=t.sourceMap;if(r&&e.setAttribute("media",r),f.ssrId&&e.setAttribute(d,t.id),i&&(n+="\n/*# sourceURL="+i.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},5142:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=5142,e.exports=t},9649:(e,t,n)=>{var r=n(8114).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function d(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),s=new N(r||[]);return a(o,"_invoke",{value:S(e,n,s)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var p={};function g(){}function v(){}function m(){}var y={};f(y,u,(function(){return this}));var b=Object.getPrototypeOf,E=b&&b(b(D([])));E&&E!==n&&o.call(E,u)&&(y=E);var _=m.prototype=g.prototype=Object.create(y);function x(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(i,a,s,u){var c=h(e[i],e,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==r(f)&&o.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;a(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function S(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=A(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=h(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function A(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=h(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:k}}function k(){return{value:void 0,done:!0}}return v.prototype=m,a(_,"constructor",{value:m,configurable:!0}),a(m,"constructor",{value:v,configurable:!0}),v.displayName=f(m,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,f(e,l,"GeneratorFunction")),e.prototype=Object.create(_),e},t.awrap=function(e){return{__await:e}},x(w.prototype),f(w.prototype,c,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new w(d(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(_),f(_,l,"Generator"),f(_,u,(function(){return this})),f(_,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=D,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:D(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},8114:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},2975:(e,t,n)=>{var r=n(9649)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";var e;n.r(r),n.d(r,{default:()=>t}),n(7745);const t={install:function(t,r){return e?console.error("already installed."):(e=t,r({routes:n(2267).Z,store:n(6625).Z(e),config:n(6835).Z,locales:n(380).Z,components:n(6418).Z}))}}})(),window["a-antvlayout"]=r})();
//# sourceMappingURL=front.js.map