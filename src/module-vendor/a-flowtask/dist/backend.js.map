{"version":3,"file":"backend.js","mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;;;;ACHA,mBAAmB,mBAAO,CAAC,IAAoC;AAC/D,mBAAmB,mBAAO,CAAC,IAAoC;AAC/D,mBAAmB,mBAAO,CAAC,GAAoC;;AAE/D;AACA;AACA;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,eAAe;AACjC,iCAAiC,yBAAyB;AAC1D;;AAEA,mBAAmB,4CAA4C;AAC/D,uCAAuC,iCAAiC;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAkB,kBAAkB;AACpC;AACA,0DAA0D,kBAAkB;AAC5E;AACA;;AAEA,qBAAqB,oCAAoC;AACzD;AACA,0DAA0D,kBAAkB;AAC5E,qCAAqC,kBAAkB;AACvD;;AAEA,+BAA+B,0BAA0B;AACzD;AACA,0DAA0D,iCAAiC;AAC3F,+CAA+C,QAAQ;AACvD;;AAEA,sBAAsB,kBAAkB;AACxC;AACA,0DAA0D,kBAAkB;AAC5E;AACA;;AAEA,kCAAkC,0BAA0B;AAC5D;AACA,0DAA0D,kBAAkB;AAC5E,kDAAkD,QAAQ;AAC1D;;AAEA,mBAAmB,kBAAkB;AACrC;AACA,0DAA0D,kBAAkB;AAC5E;AACA;;AAEA,uBAAuB,0BAA0B;AACjD;AACA,0DAA0D,kBAAkB;AAC5E,uCAAuC,QAAQ;AAC/C;;AAEA;AACA,qBAAqB,kBAAkB;AACvC;AACA,0DAA0D,iCAAiC;AAC3F;AACA;;AAEA;AACA,qBAAqB,kBAAkB;AACvC;AACA,0DAA0D,kCAAkC;AAC5F;AACA;;AAEA,oBAAoB,0BAA0B;AAC9C;AACA,0DAA0D,kBAAkB;AAC5E,oCAAoC,QAAQ;AAC5C;;AAEA,0BAA0B,kBAAkB;AAC5C;AACA,0DAA0D,kBAAkB;AAC5E;AACA;;AAEA,uBAAuB,0BAA0B;AACjD;AACA,0DAA0D,kBAAkB;AAC5E,uCAAuC,QAAQ;AAC/C;;AAEA,6BAA6B,kBAAkB;AAC/C;AACA,0DAA0D,kBAAkB;AAC5E;AACA;;AAEA,qBAAqB,cAAc;AACnC;AACA,+CAA+C,cAAc;AAC7D;AACA;AACA,+CAA+C,iCAAiC;AAChF;AACA,iDAAiD,0BAA0B;AAC3E;AACA,eAAe;AACf;AACA;;AAEA;AACA;;;;;;;;AClIA;AACA;AACA;AACA,+BAA+B,YAAY;AAC3C;AACA;AACA;AACA,mEAAmE,YAAY;AAC/E,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA,oDAAoD,cAAc;AAClE;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,wDAAwD,cAAc;AACtE;AACA,QAAQ;AACR;AACA;AACA,wDAAwD,cAAc;AACtE;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,uBAAuB;AACjF;AACA,QAAQ;AACR;AACA;AACA,0DAA0D,uBAAuB;AACjF;AACA;AACA;AACA;;AAEA,sCAAsC,cAAc;AACpD;AACA;AACA;;AAEA,wCAAwC,uBAAuB;AAC/D;AACA,gDAAgD,kDAAkD;AAClG;;AAEA,kCAAkC,yDAAyD;AAC3F;AACA;AACA;AACA;AACA;AACA,mEAAmE,cAAc;AACjF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,iCAAiC,yCAAyC;AAC1E;AACA;;AAEA,yCAAyC,cAAc;AACvD;AACA;AACA;AACA;AACA,eAAe,uBAAuB;AACtC;AACA,SAAS;AACT,OAAO;AACP;;AAEA,kBAAkB,WAAW,wCAAwC,qCAAqC;AAC1G;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA,mCAAmC;AACnC;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,8BAA8B,2BAA2B;AACzD;AACA;AACA;AACA,kDAAkD,gBAAgB;AAClE,QAAQ;AACR,yDAAyD,YAAY;AACrE;AACA;AACA;AACA,uEAAuE,0CAA0C;AACjH;AACA,+CAA+C,cAAc;AAC7D,yBAAyB,yBAAyB;AAClD;AACA;;AAEA,2BAA2B,cAAc;AACzC,wCAAwC,wBAAwB;AAChE;AACA,OAAO;AACP;AACA;;AAEA,gCAAgC,oCAAoC;AACpE,+CAA+C,cAAc;AAC7D,wBAAwB,sBAAsB;AAC9C;AACA;;AAEA,6BAA6B,cAAc;AAC3C;AACA;AACA;AACA;AACA;AACA;;AAEA,0BAA0B,cAAc;AACxC;AACA;AACA;AACA,iBAAiB,YAAY;AAC7B,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,wCAAwC,YAAY;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kBAAkB,YAAY;AAC9B,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kBAAkB,YAAY;AAC9B,SAAS;AACT;AACA;AACA;;AAEA;AACA;;;;;;;;ACxOA;AACA;AACA;AACA,2BAA2B,cAAc;AACzC;AACA,6CAA6C,6BAA6B;AAC1E;AACA;AACA;AACA;AACA;;AAEA,2BAA2B,gBAAgB;AAC3C;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,0BAA0B;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,6BAA6B,IAAI,uBAAuB;AAC/E,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,0BAA0B;AAC1B,oBAAoB;AACpB;AACA;AACA;AACA,uEAAuE,YAAY;AACnF;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,iEAAiE,cAAc;AAC/E;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,8DAA8D,kCAAkC;AAChG;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;;AAEA,mCAAmC,kCAAkC;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yFAAyF,gBAAgB;AACzG;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,0EAA0E,gBAAgB;AAC1F;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,6CAA6C,iDAAiD;AAC9F;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACvRA,qCAAqC,mBAAO,CAAC,IAA2C;;AAExF;AACA;;AAEA;AACA;;;;;;;;ACNA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;ACtBA,qCAAqC,mBAAO,CAAC,IAA2C;;AAExF;AACA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,yBAAyB;AAC5C;AACA,mCAAmC,iBAAiB;AACpD,QAAQ;AACR,uCAAuC,iBAAiB;AACxD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA,wCAAwC,kBAAkB;AAC1D;AACA;AACA,oBAAoB,WAAW;AAC/B;AACA,SAAS;AACT;AACA;;AAEA,0BAA0B,iBAAiB;AAC3C;AACA;AACA;AACA;AACA,4DAA4D,UAAU,GAAG,QAAQ;AACjF;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA,mBAAmB,cAAc;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,0BAA0B;AACpF;AACA;AACA;AACA;;AAEA;AACA,cAAc,2BAA2B;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,MAAM;AAC3B,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA,cAAc,aAAa;AAC3B;AACA,uDAAuD,iCAAiC;AACxF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,cAAc,aAAa;AAC3B,yCAAyC,mBAAmB;AAC5D;;AAEA,8BAA8B,iBAAiB;AAC/C;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;;;;;;;;AC1KA;AACA;AACA;AACA;;;;;;;;ACHA;AACA;AACA,kBAAkB,+BAA+B;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;AC3BA,mBAAmB,mBAAO,CAAC,GAAwC;AACnE,oCAAoC,mBAAO,CAAC,IAAyD;AACrG,2BAA2B,mBAAO,CAAC,IAAgD;AACnF,4BAA4B,mBAAO,CAAC,IAAiD;AACrF,uBAAuB,mBAAO,CAAC,IAA4C;AAC3E,0BAA0B,mBAAO,CAAC,GAA+C;AACjF,uBAAuB,mBAAO,CAAC,IAA4C;AAC3E,sBAAsB,mBAAO,CAAC,IAA2C;AACzE,wBAAwB,mBAAO,CAAC,IAA6C;AAC7E,yBAAyB,mBAAO,CAAC,GAA8C;AAC/E,4BAA4B,mBAAO,CAAC,IAAiD;AACrF,wBAAwB,mBAAO,CAAC,IAA6C;;AAE7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC/BA;AACA;AACA;AACA,kBAAkB,cAAc;AAChC;AACA;AACA;AACA;AACA;AACA,8CAA8C,wBAAwB;AACtE;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC3BA;AACA;AACA;AACA,gCAAgC,QAAQ;AACxC;AACA;AACA;AACA;AACA;AACA,iDAAiD,8DAA8D;AAC/G;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,gBAAgB;AACxD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA,iEAAiE,iCAAiC;AAClG;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA,mCAAmC,QAAQ;AAC3C;AACA;AACA;AACA;AACA;AACA,oDAAoD,gBAAgB;AACpE;AACA,iDAAiD,QAAQ;AACzD;AACA;AACA;;AAEA,0CAA0C,QAAQ;AAClD;AACA,iEAAiE,iCAAiC;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,gBAAgB;AACxD,+CAA+C,YAAY;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;;;;;AClGA;AACA;AACA;AACA,wBAAwB,QAAQ;AAChC;AACA;AACA;AACA;AACA;AACA,yCAAyC,8DAA8D;AACvG;AACA,sCAAsC,QAAQ;AAC9C;;AAEA,+BAA+B,QAAQ;AACvC;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,OAAO,UAAU;AAC1D;AACA;AACA;AACA;AACA,wCAAwC,gBAAgB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC,sCAAsC,iDAAiD;AACvF;AACA,yCAAyC,yCAAyC;AAClF;AACA;AACA;AACA;;;;;;;;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,gBAAgB;AAClE;AACA;AACA;AACA;AACA,qDAAqD;AACrD;AACA;AACA;AACA,4DAA4D;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,iCAAiC;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;;;;;;;;ACvFA;AACA;AACA;AACA,sBAAsB,kBAAkB;AACxC;AACA;AACA;AACA;AACA;AACA,uCAAuC,sEAAsE;AAC7G;AACA;AACA,wCAAwC,UAAU;AAClD;AACA;AACA;AACA,sCAAsC,QAAQ;AAC9C;AACA;AACA;AACA;AACA,sCAAsC,gBAAgB;AACtD,SAAS;AACT;AACA;AACA;AACA;;AAEA,2BAA2B,gBAAgB;AAC3C;AACA;AACA;AACA,qBAAqB,wBAAwB,0BAA0B,WAAW;AAClF;AACA;AACA;AACA;AACA;AACA,uBAAuB,YAAY;AACnC;AACA;AACA,yBAAyB,SAAS,QAAQ,cAAc;AACxD,WAAW;AACX,SAAS;AACT,OAAO;AACP;;AAEA,+BAA+B,UAAU;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,QAAQ;AACvB;AACA,mBAAmB,qBAAqB;AACxC;AACA,OAAO;AACP;;AAEA,6BAA6B,QAAQ;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,wDAAwD,2BAA2B;AACnF;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,wDAAwD,8BAA8B;AACtF;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACvIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC5DA;AACA;AACA;AACA;AACA,qBAAqB,QAAQ;AAC7B;AACA;AACA;AACA;AACA;AACA,sCAAsC,8DAA8D;AACpG;AACA,mCAAmC,QAAQ;AAC3C;AACA;AACA;;AAEA;AACA;AACA,4BAA4B,QAAQ;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C,8DAA8D;AAC1G;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,kCAAkC;AACtF;AACA,wCAAwC,eAAe;AACvD,+CAA+C,uBAAuB;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACrGA,eAAe,mBAAO,CAAC,IAAsB;AAC7C,gBAAgB,mBAAO,CAAC,IAAuB;;AAE/C;AACA;AACA;AACA,iBAAiB,sBAAsB;AACvC;AACA,sDAAsD,sBAAsB;AAC5E;AACA,gCAAgC,kBAAkB;AAClD;AACA;AACA;;AAEA,kBAAkB,yBAAyB;AAC3C;AACA,gCAAgC,wCAAwC;AACxE;;AAEA,4BAA4B,sBAAsB;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD,mCAAmC;AACtF,uDAAuD,oBAAoB;AAC3E,yBAAyB,8CAA8C,IAAI;AAC3E;AACA;AACA,UAAU;AACV,sDAAsD,qBAAqB,cAAc,WAAW;AACpG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;;AAEA,yBAAyB,2BAA2B;AACpD;AACA;AACA;AACA;AACA,oEAAoE,gBAAgB;AACpF;AACA,gFAAgF,YAAY;AAC5F;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C,sCAAsC;AACrF;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,oBAAoB,QAAQ;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,wDAAwD,iCAAiC;AACzF;AACA;AACA;AACA;;;;;;;;AClHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,gBAAgB;AACrD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,gBAAgB;AACxD,+CAA+C,YAAY;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;;;;;;;AC/DA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;;AAEA;AACA;AACA;AACA;AACA,4CAA4C,cAAc;AAC1D;;AAEA;AACA,4CAA4C,eAAe;AAC3D;;AAEA,8BAA8B,MAAM;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,MAAM;AACjD;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA,mBAAmB,QAAQ;AAC3B,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;;AAEA;AACA,qCAAqC,cAAc;AACnD;;AAEA;AACA,qCAAqC,eAAe;AACpD;;AAEA;AACA,uBAAuB,MAAM;AAC7B;AACA;AACA,iEAAiE,iCAAiC;AAClG;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,gCAAgC;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,4BAA4B;AAC9C;AACA;AACA,qCAAqC,6CAA6C;AAClF;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC,OAAO;AACP;AACA;AACA;AACA;AACA;;;;;;;;AC/IA;AACA;AACA;AACA;AACA,wBAAwB,QAAQ;AAChC;AACA;AACA;AACA;AACA;AACA,yCAAyC,8DAA8D;AACvG;AACA,sCAAsC,QAAQ;AAC9C;AACA;AACA;;AAEA;AACA;AACA,+BAA+B,QAAQ;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C,8DAA8D;AAC7G;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,qCAAqC;AACzF;AACA,wCAAwC,eAAe;AACvD,+CAA+C,uBAAuB;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACrGA;AACA;AACA,kBAAkB,qDAAqD;AACvE;AACA;AACA;;AAEA;AACA;AACA,qCAAqC,4CAA4C;AACjF;AACA,mCAAmC,4CAA4C;AAC/E;;AAEA,qBAAqB,4CAA4C;AACjE;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,gCAAgC,OAAO;AACvC;AACA;;AAEA;AACA;AACA,8CAA8C,UAAU;AACxD,QAAQ;AACR;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,6BAA6B,eAAe;AAC5C;AACA;AACA;AACA;;AAEA,YAAY;AACZ;AACA,qCAAqC;AACrC,eAAe;AACf;;AAEA,YAAY;AACZ,YAAY;AACZ;;AAEA;AACA;AACA;;AAEA,qBAAqB,4CAA4C;AACjE;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,gCAAgC,OAAO;AACvC;AACA;;AAEA;AACA;AACA,8CAA8C,UAAU;AACxD,QAAQ;AACR;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,6BAA6B,eAAe;AAC5C;AACA;AACA;AACA;;AAEA,YAAY;AACZ;AACA,qCAAqC;AACrC,eAAe;AACf;;AAEA,YAAY;AACZ,YAAY;AACZ;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;AC5IA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,UAAU;AAC3C;AACA;AACA,4BAA4B,UAAU;AACtC;AACA;AACA,4BAA4B,UAAU;AACtC;AACA;AACA,4BAA4B,UAAU;AACtC;AACA;AACA,sBAAsB,gBAAgB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,UAAU;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,UAAU;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,UAAU;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,oCAAoC;AACpE;AACA;AACA,mEAAmE,iCAAiC;AACpG;AACA,wDAAwD,cAAc;AACtE;AACA,qBAAqB,qBAAqB;AAC1C;AACA,4CAA4C,gBAAgB;AAC5D;AACA,+BAA+B,8BAA8B;AAC7D;AACA;AACA,6BAA6B,gBAAgB;AAC7C;AACA;AACA;AACA;AACA;AACA,sBAAsB,gBAAgB;AACtC;AACA,mCAAmC,UAAU;AAC7C;AACA,6BAA6B,gBAAgB;AAC7C;AACA,sCAAsC,UAAU;AAChD;AACA,4BAA4B,UAAU;AACtC;AACA,kCAAkC,gBAAgB;AAClD;AACA,oCAAoC,gBAAgB;AACpD;AACA,uBAAuB,qDAAqD;AAC5E;AACA;AACA,wCAAwC,UAAU;AAClD;AACA,6BAA6B,gBAAgB;AAC7C;AACA,sCAAsC,UAAU;AAChD;AACA;AACA,8BAA8B,UAAU;AACxC;AACA;AACA,uDAAuD,sBAAsB;AAC7E;AACA;AACA;AACA;AACA;AACA,kBAAkB,gBAAgB;AAClC;AACA,6BAA6B,gBAAgB;AAC7C;AACA,sCAAsC,UAAU;AAChD;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,qBAAqB,6DAA6D;AAClF;AACA;AACA,wCAAwC,UAAU;AAClD;AACA,6BAA6B,gBAAgB;AAC7C;AACA,sCAAsC,UAAU;AAChD;AACA;AACA,8BAA8B,UAAU;AACxC;AACA;AACA,uDAAuD,sBAAsB;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA,mBAAmB,gBAAgB;AACnC;AACA,mCAAmC,UAAU;AAC7C;AACA,6BAA6B,gBAAgB;AAC7C;AACA,sCAAsC,UAAU;AAChD;AACA,4BAA4B,UAAU;AACtC;AACA,oBAAoB,qDAAqD;AACzE;AACA;AACA,6BAA6B,gBAAgB;AAC7C;AACA,sCAAsC,UAAU;AAChD;AACA;AACA,8BAA8B,UAAU;AACxC;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,sBAAsB;AAC7E;AACA;AACA;AACA;AACA,0BAA0B,qCAAqC;AAC/D;AACA,6BAA6B,gBAAgB;AAC7C;AACA,4BAA4B,UAAU;AACtC;AACA,4BAA4B,UAAU;AACtC;AACA,uDAAuD,sBAAsB;AAC7E;AACA;AACA;AACA;AACA,2CAA2C,mDAAmD;AAC9F;AACA;AACA;AACA;AACA,uBAAuB,qDAAqD;AAC5E;AACA;AACA,6BAA6B,gBAAgB;AAC7C;AACA,sCAAsC,UAAU;AAChD;AACA;AACA,8BAA8B,UAAU;AACxC;AACA;AACA,uDAAuD,sBAAsB;AAC7E;AACA;AACA;AACA;AACA;AACA,6BAA6B,qCAAqC;AAClE;AACA,6BAA6B,gBAAgB;AAC7C;AACA,4BAA4B,UAAU;AACtC;AACA,4BAA4B,UAAU;AACtC;AACA,uDAAuD,sBAAsB;AAC7E;AACA;AACA;AACA;AACA;AACA,2CAA2C,sDAAsD;AACjG;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;AC/NA;AACA;AACA;AACA;AACA,cAAc,OAAO;AACrB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;;;;;;;;AChBA;AACA;AACA;AACA;AACA,cAAc,OAAO;AACrB;AACA;AACA;AACA;AACA,uBAAuB,eAAe;AACtC,OAAO;AACP;AACA;AACA;;AAEA;AACA;;;;;;;;AChBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;;;;;;;AC1GA,uBAAuB,mBAAO,CAAC,IAA2B;AAC1D,+BAA+B,mBAAO,CAAC,IAAoC;AAC3E,6BAA6B,mBAAO,CAAC,IAAkC;AACvE,iCAAiC,mBAAO,CAAC,IAAsC;AAC/E,yBAAyB,mBAAO,CAAC,IAA8B;AAC/D,sBAAsB,mBAAO,CAAC,IAA2B;AACzD,uBAAuB,mBAAO,CAAC,IAA2B;AAC1D,mBAAmB,mBAAO,CAAC,IAAuB;AAClD,qBAAqB,mBAAO,CAAC,IAAyB;AACtD,2BAA2B,mBAAO,CAAC,IAA+B;AAClE,2BAA2B,mBAAO,CAAC,IAA+B;AAClE,0BAA0B,mBAAO,CAAC,IAA+B;;AAEjE;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACxEA,iBAAiB,mBAAO,CAAC,IAAU;AACnC;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;;AAEP;AACA,2CAA2C,SAAS;AACpD;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;;AAEP;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,4CAA4C,+BAA+B;AAC3E;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,uCAAuC,cAAc;AACrD;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,wBAAwB,SAAS;AACjC,8CAA8C,iCAAiC;AAC/E;AACA,uCAAuC,SAAS;AAChD;;AAEA,yBAAyB,SAAS;AAClC,cAAc,sBAAsB;AACpC;AACA;AACA,QAAQ;AACR;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,SAAS;AACjD;;AAEA,8BAA8B,SAAS;AACvC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,4CAA4C,+BAA+B;AAC3E;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,mCAAmC,4BAA4B;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACzJA,oBAAoB,uBAAuB;AAC3C;AACA,kBAAkB,mCAAmC;AACrD;AACA;AACA;AACA;;AAEA,2BAA2B,iBAAiB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;;;;;;;ACrBA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAsB,sBAAsB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AClCA;AACA;AACA;AACA;AACA;;;;;;;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;;;;;;;;ACzDA,iBAAiB,mBAAO,CAAC,IAAe;;AAExC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;AC5CA;AACA;AACA;AACA;AACA;;;;;;;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AClBA;AACA,WAAW,mBAAO,CAAC,IAAmB;AACtC,WAAW,mBAAO,CAAC,IAAmB;AACtC;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;AC9BA,uBAAuB,mBAAO,CAAC,IAA4B;AAC3D,yBAAyB,mBAAO,CAAC,IAA8B;;AAE/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA,cAAc,qBAAqB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA,cAAc,qBAAqB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;;;;;;;AC/JA,aAAa,mBAAO,CAAC,GAAsB;AAC3C,iBAAiB,mBAAO,CAAC,GAA0B;;AAEnD;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACTA,eAAe,mBAAO,CAAC,IAAoB;AAC3C,gBAAgB,mBAAO,CAAC,EAAqB;AAC7C,eAAe,mBAAO,CAAC,IAAoB;;AAE3C;AACA;AACA,eAAe,mBAAO,CAAC,IAAW;AAClC;AACA,gBAAgB,mBAAO,CAAC,IAAY;AACpC;AACA,iBAAiB,mBAAO,CAAC,IAAa;AACtC;AACA,sBAAsB,mBAAO,CAAC,IAAkB;AAChD;AACA,mBAAmB,mBAAO,CAAC,IAAe;AAC1C;AACA,iBAAiB,mBAAO,CAAC,IAAa;AACtC;AACA,eAAe,mBAAO,CAAC,GAAW;;AAElC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AChCA;AACA,kBAAkB,mBAAO,CAAC,IAAgC;AAC1D,oBAAoB,mBAAO,CAAC,IAAwB;AACpD;AACA;AACA,eAAe;AACf,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP,kBAAkB;AAClB;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;AC9CA;AACA;AACA;AACA,mBAAmB,sDAAsD,wBAAwB;AACjG;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA,mBAAmB,+BAA+B,wBAAwB;AAC1E;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA,mBAAmB,sCAAsC,yBAAyB;AAClF;AACA;AACA;AACA;;;;;;;;ACPA,wCAAwC,mBAAO,CAAC,IAA4C;AAC5F,iBAAiB,mBAAO,CAAC,IAAqB;AAC9C,wBAAwB,mBAAO,CAAC,GAA4B;;AAE5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACXA;AACA;AACA;AACA,MAAM,uDAAuD;AAC7D;AACA,MAAM,6DAA6D;AACnE,MAAM,4DAA4D;AAClE,MAAM,wFAAwF;AAC9F,MAAM,2FAA2F;AACjG,MAAM,yEAAyE;AAC/E,MAAM,gEAAgE;AACtE,MAAM,wGAAwG;AAC9G,MAAM,yFAAyF;AAC/F,MAAM,6FAA6F;AACnG,MAAM,+DAA+D;AACrE,MAAM,+DAA+D;AACrE,MAAM,wEAAwE;AAC9E,MAAM,8DAA8D;AACpE,MAAM,oEAAoE;AAC1E,MAAM,2EAA2E;AACjF,MAAM,iEAAiE;AACvE,MAAM,uEAAuE;AAC7E;AACA;AACA;;;;;;;;ACxBA;AACA;AACA,iBAAiB,cAAc;AAC/B,qDAAqD,cAAc;AACnE;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA,mBAAmB,eAAe;AAClC,mDAAmD,eAAe;AAClE;;AAEA,kBAAkB,eAAe;AACjC,kDAAkD,eAAe;AACjE;;AAEA,kBAAkB,kBAAkB;AACpC,kDAAkD,kBAAkB;AACpE;;AAEA,qBAAqB,oCAAoC;AACzD,qDAAqD,oCAAoC;AACzF;;AAEA,+BAA+B,0BAA0B;AACzD,+DAA+D,0BAA0B;AACzF;;AAEA,sBAAsB,kBAAkB;AACxC,sDAAsD,kBAAkB;AACxE;;AAEA,kCAAkC,0BAA0B;AAC5D,kEAAkE,0BAA0B;AAC5F;;AAEA,mBAAmB,kBAAkB;AACrC,mDAAmD,kBAAkB;AACrE;;AAEA,uBAAuB,0BAA0B;AACjD,uDAAuD,0BAA0B;AACjF;;AAEA,qBAAqB,kBAAkB;AACvC,qDAAqD,kBAAkB;AACvE;;AAEA,qBAAqB,kBAAkB;AACvC,qDAAqD,kBAAkB;AACvE;;AAEA,8BAA8B,0BAA0B;AACxD;AACA,2DAA2D,gBAAgB;AAC3E,gDAAgD,gBAAgB;AAChE;AACA,sDAAsD,QAAQ;AAC9D;;AAEA,oBAAoB,0BAA0B;AAC9C,oDAAoD,0BAA0B;AAC9E;;AAEA,0BAA0B,kBAAkB;AAC5C,0DAA0D,kBAAkB;AAC5E;;AAEA,iCAAiC,0BAA0B;AAC3D;AACA,2DAA2D,gBAAgB;AAC3E,mDAAmD,gBAAgB;AACnE;AACA,sDAAsD,QAAQ;AAC9D;;AAEA,uBAAuB,0BAA0B;AACjD,uDAAuD,0BAA0B;AACjF;;AAEA,6BAA6B,kBAAkB;AAC/C,6DAA6D,kBAAkB;AAC/E;AACA;AACA;AACA;;;;;;;;AC/EA,aAAa,mBAAO,CAAC,IAAmB;AACxC,iBAAiB,mBAAO,CAAC,IAAuB;;AAEhD;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACTA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;UEtBA;UACA;UACA;UACA","sources":["webpack://egg-born-module-a-flowtask/./backend/src/aops.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/bean.flowTask.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/bean.flowTask/bean.flowTask_0.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/bean.flowTask/bean.flowTask_1.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/bean.flowTask/bean.flowTask_2.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/flow.node.activityUserTask.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/flow.node.endEventAtom.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/flow.node.startEventAtom.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/io.message.workflow.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.context.task.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_0.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_appendHandleRemark.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_assignees.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_cancelFlow.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_claim.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_complete.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_event.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_forward.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_init.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_recall.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_schema.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.flow.task/local.flow.task_substitute.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.procedure.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/local.right.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/stats.taskClaimings.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/stats.taskHandlings.js","webpack://egg-born-module-a-flowtask/./backend/src/bean/version.manager.js","webpack://egg-born-module-a-flowtask/./backend/src/beans.js","webpack://egg-born-module-a-flowtask/./backend/src/common/flowNodeActivityUserTaskBase.js","webpack://egg-born-module-a-flowtask/./backend/src/common/utils.js","webpack://egg-born-module-a-flowtask/./backend/src/common/vars.js","webpack://egg-born-module-a-flowtask/./backend/src/config/config.js","webpack://egg-born-module-a-flowtask/./backend/src/config/errors.js","webpack://egg-born-module-a-flowtask/./backend/src/config/flow/defaults.js","webpack://egg-born-module-a-flowtask/./backend/src/config/flow/nodes.js","webpack://egg-born-module-a-flowtask/./backend/src/config/locale/en-us.js","webpack://egg-born-module-a-flowtask/./backend/src/config/locale/zh-cn.js","webpack://egg-born-module-a-flowtask/./backend/src/config/locales.js","webpack://egg-born-module-a-flowtask/./backend/src/config/validation/schema/activityUserTask.js","webpack://egg-born-module-a-flowtask/./backend/src/config/validation/schema/startEventAtom.js","webpack://egg-born-module-a-flowtask/./backend/src/config/validation/schemas.js","webpack://egg-born-module-a-flowtask/./backend/src/controller/flow.js","webpack://egg-born-module-a-flowtask/./backend/src/controller/flowTask.js","webpack://egg-born-module-a-flowtask/./backend/src/controllers.js","webpack://egg-born-module-a-flowtask/./backend/src/main.js","webpack://egg-born-module-a-flowtask/./backend/src/meta.js","webpack://egg-born-module-a-flowtask/./backend/src/model/flowNodeStartEventAtomCondition.js","webpack://egg-born-module-a-flowtask/./backend/src/model/flowTask.js","webpack://egg-born-module-a-flowtask/./backend/src/model/flowTaskHistory.js","webpack://egg-born-module-a-flowtask/./backend/src/models.js","webpack://egg-born-module-a-flowtask/./backend/src/routes.js","webpack://egg-born-module-a-flowtask/./backend/src/service/flow.js","webpack://egg-born-module-a-flowtask/./backend/src/service/flowTask.js","webpack://egg-born-module-a-flowtask/./backend/src/services.js","webpack://egg-born-module-a-flowtask/external commonjs2 \"require3\"","webpack://egg-born-module-a-flowtask/webpack/bootstrap","webpack://egg-born-module-a-flowtask/webpack/before-startup","webpack://egg-born-module-a-flowtask/webpack/startup","webpack://egg-born-module-a-flowtask/webpack/after-startup"],"sourcesContent":["module.exports = app => {\n  const aops = {};\n  return aops;\n};\n","const flowTask_0 = require('./bean.flowTask/bean.flowTask_0.js');\nconst flowTask_1 = require('./bean.flowTask/bean.flowTask_1.js');\nconst flowTask_2 = require('./bean.flowTask/bean.flowTask_2.js');\n\nmodule.exports = ctx => {\n  return ctx.app.meta.util.mixinClasses(flowTask_0, [flowTask_1, flowTask_2], ctx);\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    get modelFlowTask() {\n      return ctx.model.module(moduleInfo.relativeName).flowTask;\n    }\n    get modelFlowTaskHistory() {\n      return ctx.model.module(moduleInfo.relativeName).flowTaskHistory;\n    }\n    get localRight() {\n      return ctx.bean._getBean(moduleInfo.relativeName, 'local.right');\n    }\n    get sqlProcedure() {\n      return ctx.bean._getBean(moduleInfo.relativeName, 'local.procedure');\n    }\n\n    async count({ options, user }) {\n      return await this.select({ options, user, count: 1 });\n    }\n\n    async select({ options, user, pageForce = true, count = 0 }) {\n      const tasks = await this._list({ options, user, pageForce, count });\n      // loop\n      for (const task of tasks) {\n        // locale\n        task.flowNodeNameLocale = ctx.text(task.flowNodeName);\n        if (task.flowNodeRemark) {\n          task.flowNodeRemarkLocale = ctx.text(task.flowNodeRemark);\n        }\n        if (task.handleRemark) {\n          task.handleRemarkLocale = ctx.text(task.handleRemark);\n        }\n      }\n      return tasks;\n    }\n\n    async claim({ flowTaskId, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user });\n      return await taskInstance._claim();\n    }\n\n    async complete({ flowTaskId, handle, formAtom, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user });\n      await taskInstance._complete({ handle, formAtom });\n    }\n\n    async appendHandleRemark({ flowTaskId, handle, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user, history: true });\n      await taskInstance._appendHandleRemark({ handle });\n    }\n\n    async assignees({ flowTaskId, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user });\n      return await taskInstance._assignees();\n    }\n\n    async assigneesConfirmation({ flowTaskId, handle, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user });\n      await taskInstance._assigneesConfirmation({ handle });\n    }\n\n    async recall({ flowTaskId, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user });\n      await taskInstance._recall();\n    }\n\n    async cancelFlow({ flowTaskId, handle, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user });\n      await taskInstance._cancelFlow({ handle });\n    }\n\n    // from history\n    async viewAtom({ flowTaskId, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user, history: true });\n      return await taskInstance._viewAtom();\n    }\n\n    // from runtime\n    async editAtom({ flowTaskId, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user, history: false });\n      return await taskInstance._editAtom();\n    }\n\n    async forward({ flowTaskId, handle, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user });\n      await taskInstance._forward({ handle });\n    }\n\n    async forwardRecall({ flowTaskId, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user });\n      await taskInstance._forwardRecall();\n    }\n\n    async substitute({ flowTaskId, handle, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user });\n      await taskInstance._substitute({ handle });\n    }\n\n    async substituteRecall({ flowTaskId, user }) {\n      // taskInstance\n      const taskInstance = await this._loadTaskInstance({ flowTaskId, user });\n      await taskInstance._substituteRecall();\n    }\n\n    async flowData({ flowId, user }) {\n      // flow\n      const flow = await this._flowData_flow({ flowId, user });\n      if (!flow) return null;\n      // atom\n      const atom = await this._flowData_atom({ flowId, atomId: flow.flowAtomId });\n      // tasks\n      const tasks = await this._flowData_tasks({ flow, atom, flowId, user });\n      // ok\n      return { flow, atom, tasks };\n    }\n  }\n\n  return FlowTask;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    async _nodeDoneCheckLock({ flowNodeId }) {\n      // load flow node\n      let nodeInstance;\n      try {\n        nodeInstance = await ctx.bean.flow._loadFlowNodeInstance({ flowNodeId });\n      } catch (err) {}\n      if (!nodeInstance) {\n        // here means done\n        return;\n      }\n      // options\n      const options = this._getNodeDefOptionsTask({ nodeInstance });\n      // completionCondition\n      const completionCondition = options.completionCondition;\n      // task count\n      const taskCountTotal = await this.modelFlowTask.count({\n        flowNodeId,\n        ignoreMark: 0,\n      });\n      if (taskCountTotal === 0) {\n        // means node has been checked and done\n        // XX //   should throw error to deny the db changed for tasks has been deleted.\n        // XX ctx.throw.module('a-flow', 1004, flowNodeId);\n        // neednot throw error for this method is called in ctx.tail\n        return;\n      }\n      const taskCountPassed = await this.modelFlowTask.count({\n        flowNodeId,\n        flowTaskStatus: 1,\n        handleStatus: 1,\n        ignoreMark: 0,\n      });\n      const taskCountRejected = await this.modelFlowTask.count({\n        flowNodeId,\n        flowTaskStatus: 1,\n        handleStatus: 2,\n        ignoreMark: 0,\n      });\n      // check passed\n      if (typeof completionCondition.passed === 'number' || completionCondition.passed.indexOf('%') === -1) {\n        // absolute value\n        if (taskCountPassed >= parseInt(completionCondition.passed)) {\n          return await this._nodeDoneCheckLock_passed({ nodeInstance });\n        }\n      } else {\n        // percent value\n        if (taskCountPassed / taskCountTotal >= parseInt(completionCondition.passed) / 100) {\n          return await this._nodeDoneCheckLock_passed({ nodeInstance });\n        }\n      }\n      // check rejected\n      if (typeof completionCondition.rejected === 'number' || completionCondition.rejected.indexOf('%') === -1) {\n        // absolute value\n        if (taskCountRejected >= parseInt(completionCondition.rejected)) {\n          return await this._nodeDoneCheckLock_rejected({ nodeInstance, options });\n        }\n      } else {\n        // percent value\n        if (taskCountRejected / taskCountTotal >= parseInt(completionCondition.rejected) / 100) {\n          return await this._nodeDoneCheckLock_rejected({ nodeInstance, options });\n        }\n      }\n      // here means not done\n    }\n\n    async _nodeDoneCheckLock_passed({ nodeInstance }) {\n      // next stage of flow node: end\n      return await nodeInstance.end();\n    }\n\n    async _nodeDoneCheckLock_rejected({ nodeInstance, options }) {\n      // rejectedNode\n      return await this._gotoFlowNodePrevious({ nodeInstance, rejectedNode: options.rejectedNode });\n    }\n\n    async _gotoFlowNodePrevious({ nodeInstance, rejectedNode, flowNodeRemark = 'Rejected' }) {\n      // flowNodeId\n      const flowNodeId = nodeInstance.contextNode._flowNodeId;\n      // rejectedNode\n      if (!rejectedNode) {\n        // find previous task node\n        const flowNode = await this._findFlowNodeHistoryPrevious({ nodeInstance });\n        if (!flowNode) ctx.throw.module('a-flow', 1006, flowNodeId);\n        rejectedNode = flowNode.flowNodeDefId;\n      }\n      // nodeInstancePrev\n      const nodeInstancePrev = await nodeInstance.flowInstance._findNodeInstanceNext({\n        nodeDefId: rejectedNode,\n        flowNodeIdPrev: flowNodeId,\n      });\n      // clear & enter\n      await nodeInstance.clear({ flowNodeHandleStatus: 2, flowNodeRemark });\n      return await nodeInstancePrev.enter();\n    }\n\n    async _findFlowNodeHistoryPrevious({ nodeInstance }) {\n      // flowNodeId\n      const flowNodeId = nodeInstance.contextNode._flowNodeId;\n      return await nodeInstance.flowInstance._findFlowNodeHistoryPrevious({\n        flowNodeId,\n        cb: ({ /* flowNode*/ nodeDef }) => {\n          return nodeDef.type.indexOf('startEventAtom') > -1 || nodeDef.type.indexOf('activityUserTask') > -1;\n        },\n      });\n    }\n\n    async _list({ options: { where, orders, page, mode, history = 0 }, user, pageForce = true, count = 0 }) {\n      // special for mode\n      if (mode === 'claimings') {\n        where['a.flowTaskStatus'] = 0;\n        where['a.timeClaimed'] = null;\n        history = 0;\n      } else if (mode === 'handlings') {\n        where['a.flowTaskStatus'] = 0;\n        where['a.timeClaimed'] = { op: 'notNull' };\n        history = 0;\n      } else if (mode === 'completeds') {\n        where['a.flowTaskStatus'] = 1;\n        history = 1;\n      }\n      // page\n      page = ctx.bean.util.page(page, pageForce);\n      // select\n      const sql = this.sqlProcedure.selectTasks({\n        iid: ctx.instance.id,\n        userIdWho: user ? user.id : 0,\n        where,\n        orders,\n        page,\n        count,\n        history,\n      });\n      const res = await ctx.model.query(sql);\n      return count ? res[0]._count : res;\n    }\n\n    async _loadTaskInstance({ flowTaskId, user, history }) {\n      // get\n      let flowTask;\n      if (!history) {\n        flowTask = await this.modelFlowTask.get({ id: flowTaskId });\n      } else {\n        flowTask = await this.modelFlowTaskHistory.get({ flowTaskId });\n      }\n      if (!flowTask) ctx.throw.module(moduleInfo.relativeName, 1001, flowTaskId);\n      // load flow node\n      const nodeInstance = await ctx.bean.flow._loadFlowNodeInstance({ flowNodeId: flowTask.flowNodeId, history });\n      // load task\n      const task = this._createTaskInstance2({ nodeInstance });\n      await task._load({ flowTask, user, history });\n      return task;\n    }\n\n    _createTaskInstance2({ nodeInstance }) {\n      const task = ctx.bean._newBean(`${moduleInfo.relativeName}.local.flow.task`, {\n        nodeInstance,\n      });\n      return task;\n    }\n\n    async _createTaskInstance({ nodeInstance, userIdAssignee, user }) {\n      const task = this._createTaskInstance2({ nodeInstance });\n      await task.init({ userIdAssignee, user });\n      return task;\n    }\n\n    _getNodeDefOptionsTask({ nodeInstance }) {\n      // nodeDef\n      const nodeDef = nodeInstance.contextNode._nodeDef;\n      // options\n      const options = nodeInstance.getNodeDefOptions();\n      return nodeDef.type.indexOf('startEventAtom') > -1 ? options.task : options;\n    }\n\n    async _clearRemains({ nodeInstance }) {\n      const flowNodeId = nodeInstance.contextNode._flowNodeId;\n      // notify\n      const _tasks = await this.modelFlowTask.select({\n        where: { flowNodeId },\n      });\n      for (const _task of _tasks) {\n        this._notifyTaskClaimings(_task.userIdAssignee);\n        this._notifyTaskHandlings(_task.userIdAssignee);\n      }\n      // flowTask delete\n      await this.modelFlowTask.delete({ flowNodeId });\n      // flowTaskHistory\n      //   1. delete specificFlag=2\n      await ctx.model.query(\n        `\n        update aFlowTaskHistory set deleted=1\n          where iid=? and deleted=0 and flowNodeId=? and flowTaskStatus=0 and specificFlag=2 \n        `,\n        [ctx.instance.id, flowNodeId]\n      );\n      //   2. close\n      //    flowTaskStatus:1\n      //    handleStatus: not changed\n      await ctx.model.query(\n        `\n        update aFlowTaskHistory set flowTaskStatus=1\n          where iid=? and deleted=0 and flowNodeId=? and flowTaskStatus=0\n        `,\n        [ctx.instance.id, flowNodeId]\n      );\n    }\n\n    _notifyTaskClaimings(userId) {\n      if (userId) {\n        ctx.bean.stats.notify({\n          module: moduleInfo.relativeName,\n          name: 'taskClaimings',\n          user: { id: userId },\n        });\n      }\n    }\n\n    _notifyTaskHandlings(userId) {\n      if (userId) {\n        ctx.bean.stats.notify({\n          module: moduleInfo.relativeName,\n          name: 'taskHandlings',\n          user: { id: userId },\n        });\n      }\n    }\n  }\n\n  return FlowTask;\n};\n","module.exports = ctx => {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    async _flowData_flow({ flowId, user }) {\n      // select flow\n      const flow = await ctx.bean.flow.get({ flowId, history: true, user });\n      // not throw error\n      // if (!flow) ctx.throw(404);\n      // ok\n      return flow;\n    }\n\n    async _flowData_atom({ flowId, atomId }) {\n      // only read basic info\n      //   a.atomFlowId = {flowId}\n      const atom = await ctx.model.queryOne(\n        `\n        select a.*,a.id as atomId,b.module,b.atomClassName from aAtom a\n           left join aAtomClass b on a.atomClassId=b.id\n             where a.deleted=0 and a.iid=? and a.id=?\n                   and a.atomFlowId=?\n        `,\n        [ctx.instance.id, atomId, flowId]\n      );\n      return atom;\n    }\n\n    async _flowData_tasks({ flow, atom, flowId, user }) {\n      // select tasks\n      let tasks = await ctx.bean.flowTask.select({\n        options: {\n          where: {\n            'a.flowId': flowId,\n            'b.flowNodeType': [\n              'a-flowtask:startEventAtom',\n              'a-flowtask:activityUserTask',\n              'startEventAtom',\n              'activityUserTask',\n            ],\n            __or__: [{ 'a.userIdAssignee': user.id }, { 'a.flowTaskHidden': 0 }],\n          },\n          orders: [\n            ['a.flowNodeId', 'desc'],\n            // ['a.specificFlag', 'desc'], // need not\n            ['a.flowTaskStatus', 'asc'],\n            ['a.createdAt', 'desc'],\n          ],\n          history: 1,\n        },\n        user: null,\n        pageForce: false,\n      });\n      // flowOld\n      const flowOld = !atom || atom.atomFlowId !== flow.flowId;\n      // nodeInstances\n      const nodeInstances = {\n        _nodeInstances: {},\n        _options: {},\n        async get(flowNodeId) {\n          let nodeInstance = this._nodeInstances[flowNodeId];\n          if (!nodeInstance) {\n            nodeInstance = await ctx.bean.flow._loadFlowNodeInstance({ flowNodeId });\n            this._nodeInstances[flowNodeId] = nodeInstance;\n          }\n          return nodeInstance;\n        },\n        async getOptions(flowNodeId) {\n          let options = this._options[flowNodeId];\n          if (!options) {\n            const nodeInstance = await this.get(flowNodeId);\n            options = ctx.bean.flowTask._getNodeDefOptionsTask({ nodeInstance });\n            this._options[flowNodeId] = options;\n          }\n          return options;\n        },\n      };\n      // map\n      tasks = tasks.map(task => {\n        if (task.flowTaskIdSubstituteTo) {\n          const taskTo = tasks.find(item => item.flowTaskId === task.flowTaskIdSubstituteTo);\n          if (user.id !== task.userIdAssignee && user.id !== taskTo.userIdAssignee) {\n            taskTo.__remove = true;\n            return {\n              ...task,\n              timeHandled: taskTo.timeHandled,\n              handleStatus: taskTo.handleStatus,\n              handleRemark: taskTo.handleRemark,\n              handleRemarkLocale: taskTo.handleRemarkLocale,\n              flowTaskIdSubstituteTo: 0,\n              ignoreMark: 0,\n            };\n          }\n        }\n        return task;\n      });\n      // filter\n      tasks = tasks.filter(task => {\n        if (task.__remove) return false;\n        if ((task.specificFlag === 1 || task.specificFlag === 2) && task.userIdAssignee !== user.id) return false;\n        return true;\n      });\n      // loop\n      for (const task of tasks) {\n        // actions\n        if (task.userIdAssignee === user.id && !flowOld) {\n          task._actions = await this._flowData_task_actions({ nodeInstances, tasks, task, user });\n        }\n      }\n      return tasks;\n    }\n\n    async _flowData_task_checkRight(fn) {\n      try {\n        await fn;\n        return true;\n      } catch (err) {\n        return false;\n      }\n    }\n\n    async _flowData_task_actions({ nodeInstances, tasks, task, user }) {\n      // info\n      const isDone = task.flowTaskStatus === 1;\n      // actions\n      const actions = [];\n      const flowTask = task;\n      let res;\n      // 1. assigneesConfirmation\n      res = await this._flowData_task_checkRight(this.localRight.assigneesConfirmation({ flowTask, user }));\n      if (res) {\n        actions.push({\n          name: 'assigneesConfirmation',\n        });\n        // only one action\n        return actions;\n      }\n      // 2. recall\n      res = await this._flowData_task_checkRight(this.localRight.recall({ flowTask, user }));\n      if (res) {\n        actions.push({\n          name: 'recall',\n        });\n        // only one action\n        return actions;\n      }\n      // 3. claim\n      if (!isDone && !task.timeClaimed) {\n        const options = await nodeInstances.getOptions(task.flowNodeId);\n        actions.push({\n          name: 'claim',\n          options: {\n            bidding: options.bidding,\n          },\n        });\n      }\n      // 3. handleTask\n      res = await this._flowData_task_checkRight(\n        this.localRight.complete({\n          flowTask,\n          user,\n          handle: null,\n          getOptions: async () => {\n            return await nodeInstances.getOptions(task.flowNodeId);\n          },\n          disableCheckTimeClaimed: true,\n        })\n      );\n      if (res) {\n        const options = await nodeInstances.getOptions(task.flowNodeId);\n        actions.push({\n          name: 'handleTask',\n          options: {\n            allowPassTask: options.allowPassTask,\n            allowRejectTask: options.allowRejectTask,\n          },\n        });\n      }\n      // 4. cancelFlow\n      res = await this._flowData_task_checkRight(\n        this.localRight.cancelFlow({\n          flowTask,\n          user,\n          getOptions: async () => {\n            return await nodeInstances.getOptions(task.flowNodeId);\n          },\n          disableCheckTimeClaimed: true,\n        })\n      );\n      if (res) {\n        actions.push({\n          name: 'cancelFlow',\n        });\n      }\n      // 5. viewAtom\n      actions.push({\n        name: 'viewAtom',\n      });\n      // 6. appendHandleRemark\n      res = await this._flowData_task_checkRight(\n        this.localRight.appendHandleRemark({ flowTask, user, flowNodeType: task.flowNodeType })\n      );\n      if (res) {\n        actions.push({\n          name: 'appendHandleRemark',\n        });\n      }\n      // 7.1 allowForward: forward\n      res = await this._flowData_task_checkRight(\n        this.localRight.forward({\n          flowTask,\n          user,\n          getOptions: async () => {\n            return await nodeInstances.getOptions(task.flowNodeId);\n          },\n          disableCheckTimeClaimed: true,\n        })\n      );\n      if (res) {\n        actions.push({\n          name: 'forward',\n        });\n      }\n      // 7.2 allowForward: forwardRecall\n      res = await this._flowData_task_checkRight(\n        this.localRight.forwardRecall({\n          flowTask,\n          user,\n          getOptions: async () => {\n            return await nodeInstances.getOptions(task.flowNodeId);\n          },\n          getTask: flowTaskIdForwardTo => {\n            return tasks.find(item => item.flowTaskId === flowTaskIdForwardTo);\n          },\n        })\n      );\n      if (res) {\n        actions.push({\n          name: 'forwardRecall',\n        });\n      }\n      // 8.1 allowSubstitute: substitute\n      res = await this._flowData_task_checkRight(\n        this.localRight.substitute({\n          flowTask,\n          user,\n          getOptions: async () => {\n            return await nodeInstances.getOptions(task.flowNodeId);\n          },\n          disableCheckTimeClaimed: true,\n        })\n      );\n      if (res) {\n        actions.push({\n          name: 'substitute',\n        });\n      }\n      // 8.2 allowSubstitute: substituteRecall\n      res = await this._flowData_task_checkRight(\n        this.localRight.substituteRecall({\n          flowTask,\n          user,\n          getOptions: async () => {\n            return await nodeInstances.getOptions(task.flowNodeId);\n          },\n          getTask: flowTaskIdSubstituteTo => {\n            return tasks.find(item => item.flowTaskId === flowTaskIdSubstituteTo);\n          },\n        })\n      );\n      if (res) {\n        actions.push({\n          name: 'substituteRecall',\n        });\n      }\n      // ok\n      return actions;\n    }\n  }\n  return FlowTask;\n};\n","const FlowNodeActivityUserTaskBase = require('../common/flowNodeActivityUserTaskBase.js');\n\nmodule.exports = ctx => {\n  class FlowNode extends FlowNodeActivityUserTaskBase(ctx) {}\n\n  return FlowNode;\n};\n","module.exports = ctx => {\n  class FlowNode extends ctx.app.meta.FlowNodeBase {\n    constructor(options) {\n      super(ctx, options);\n    }\n\n    async onNodeLeave() {\n      await super.onNodeLeave();\n      // end\n      await this.flowInstance._endFlow({\n        flowHandleStatus: 1,\n        flowRemark: 'End',\n        atom: {\n          submit: true,\n        },\n      });\n      // also true\n      return true;\n    }\n  }\n\n  return FlowNode;\n};\n","const FlowNodeActivityUserTaskBase = require('../common/flowNodeActivityUserTaskBase.js');\n\nmodule.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowNode extends FlowNodeActivityUserTaskBase(ctx) {\n    get modelCondition() {\n      return ctx.model.module(moduleInfo.relativeName).flowNodeStartEventAtomCondition;\n    }\n\n    async deploy({ deploy, flowDefId, node }) {\n      if (deploy) {\n        await this._addCondition({ flowDefId, node });\n      } else {\n        await this._deleteCondition2({ flowDefId, node });\n      }\n    }\n\n    async onNodeDoing() {\n      // super\n      await super.onNodeDoing();\n      // auto handle\n      await this._autoHandle();\n      // break\n      return false;\n    }\n\n    async _autoHandle() {\n      const flowId = this.context._flowId;\n      // select\n      const tasks = await ctx.bean.flowTask.select({\n        options: {\n          where: {\n            'a.flowId': flowId,\n            'a.flowTaskStatus': 0,\n          },\n          history: 0,\n        },\n      });\n      const task = tasks[0];\n      const flowTaskId = task.id;\n      const user = { id: task.userIdAssignee };\n      // complete automatically only on first-in\n      if (this.contextNode._flowNode.flowNodeIdPrev === 0) {\n        //  claim automatically\n        await ctx.bean.flowTask.claim({ flowTaskId, user });\n        await ctx.bean.flowTask.complete({\n          flowTaskId,\n          handle: { status: 1 },\n          user,\n        });\n      }\n    }\n\n    async _addCondition({ flowDefId, node }) {\n      const atom = node.options && node.options.atom;\n      if (!atom || !atom.module || !atom.atomClassName) {\n        // donot delete condition\n        // throw error\n        throw new Error(`atom not set for startEventAtom: ${flowDefId}.${node.id}`);\n      }\n      // atomClass\n      const atomClass = await ctx.bean.atomClass.get({\n        module: atom.module,\n        atomClassName: atom.atomClassName,\n        atomClassIdParent: atom.atomClassIdParent || 0,\n      });\n      const conditionExpression = node.options.conditionExpression;\n      // get condition\n      const startEventId = node.id;\n      const _condition = await this.modelCondition.get({\n        flowDefId,\n        startEventId,\n      });\n      if (_condition) {\n        // update\n        _condition.atomClassId = atomClass.id;\n        _condition.conditionExpression = conditionExpression;\n        await this.modelCondition.update(_condition);\n      } else {\n        // insert\n        await this.modelCondition.insert({\n          flowDefId,\n          startEventId,\n          atomClassId: atomClass.id,\n          conditionExpression,\n        });\n      }\n    }\n\n    async _match({ atom, userId }) {\n      // order by atomStatic/conditionExpression\n      const list = await ctx.model.query(\n        `\n          select a.* from aFlowNodeStartEventAtomCondition a\n            left join aFlowDef b on a.flowDefId=b.id\n            left join aAtom c on b.atomId=c.id\n            where a.iid=? and a.atomClassId=?\n            order by c.atomStatic asc, a.conditionExpression desc\n        `,\n        [ctx.instance.id, atom.atomClassId]\n      );\n      for (const _condition of list) {\n        const flowInstance = await this._matchCondition({ _condition, atom, userId });\n        if (flowInstance) return flowInstance;\n      }\n      return null;\n    }\n\n    async _matchCondition(context) {\n      const { _condition, atom, userId } = context;\n      // check if valid\n      if (!(await this._checkConditionValid(context))) {\n        await this._deleteCondition(context);\n        return null;\n      }\n      // match conditionExpression\n      const conditionActive = _condition.conditionExpression;\n      if (conditionActive) {\n        const res = ctx.bean.flow.evaluateExpression({\n          expression: conditionActive,\n          globals: { atom },\n        });\n        if (!res) return null;\n      }\n      // start\n      const flowInstance = await ctx.bean.flow.startById({\n        flowDefId: _condition.flowDefId,\n        startEventId: _condition.startEventId,\n        flowUserId: userId,\n        flowAtomId: atom.atomId,\n      });\n      // ok\n      return flowInstance;\n    }\n\n    async _checkConditionValid(context) {\n      const { _condition } = context;\n      // flowDef\n      const flowDef = await ctx.bean.flowDef.getById({ flowDefId: _condition.flowDefId });\n      if (!flowDef) return false;\n      // atomDisabled\n      if (flowDef.atomDisabled === 1) return false;\n      // content\n      const content = flowDef.content ? JSON.parse(flowDef.content) : null;\n      if (!content) return false;\n      const nodeConfig = content.process.nodes.find(item => item.id === _condition.startEventId);\n      if (!nodeConfig) return false;\n      // check if changed\n      const conditionActive = _condition.conditionExpression;\n      const conditionConfig = nodeConfig.options && nodeConfig.options.conditionExpression;\n      if (conditionActive !== conditionConfig) return false;\n      // ok\n      return true;\n    }\n\n    async _deleteCondition(context) {\n      const { _condition } = context;\n      await this.modelCondition.delete({ id: _condition.id });\n    }\n\n    async _deleteCondition2({ flowDefId, node }) {\n      const startEventId = node.id;\n      await this.modelCondition.delete({\n        flowDefId,\n        startEventId,\n      });\n    }\n  }\n\n  return FlowNode;\n};\n","module.exports = ctx => {\n  class IOMessage extends ctx.app.meta.IOMessageBase(ctx) {}\n  return IOMessage;\n};\n","module.exports = ctx => {\n  class ContextTask {\n    constructor({ context, contextNode, nodeDef }) {\n      this.context = context;\n      this.contextNode = contextNode;\n      this._nodeDef = nodeDef;\n      //\n      this._flowTaskId = null;\n      this._flowTask = null;\n      this._flowTaskHistory = null;\n      this._taskVars = null;\n      //\n      this._utils = null;\n      //\n      this._user = null;\n    }\n\n    get vars() {\n      return this._taskVars;\n    }\n\n    get utils() {\n      return this._utils;\n    }\n  }\n\n  return ContextTask;\n};\n","const flowTask_0 = require('./local.flow.task/local.flow.task_0.js');\nconst flowTask_appendHandleRemark = require('./local.flow.task/local.flow.task_appendHandleRemark.js');\nconst flowTask_assignees = require('./local.flow.task/local.flow.task_assignees.js');\nconst flowTask_cancelFlow = require('./local.flow.task/local.flow.task_cancelFlow.js');\nconst flowTask_claim = require('./local.flow.task/local.flow.task_claim.js');\nconst flowTask_complete = require('./local.flow.task/local.flow.task_complete.js');\nconst flowTask_event = require('./local.flow.task/local.flow.task_event.js');\nconst flowTask_init = require('./local.flow.task/local.flow.task_init.js');\nconst flowTask_recall = require('./local.flow.task/local.flow.task_recall.js');\nconst flowTask_forward = require('./local.flow.task/local.flow.task_forward.js');\nconst flowTask_substitute = require('./local.flow.task/local.flow.task_substitute.js');\nconst flowTask_schema = require('./local.flow.task/local.flow.task_schema.js');\n\nmodule.exports = ctx => {\n  return ctx.app.meta.util.mixinClasses(\n    flowTask_0,\n    [\n      flowTask_appendHandleRemark,\n      flowTask_assignees,\n      flowTask_cancelFlow,\n      flowTask_claim,\n      flowTask_complete,\n      flowTask_event,\n      flowTask_init,\n      flowTask_recall,\n      flowTask_forward,\n      flowTask_substitute,\n      flowTask_schema,\n    ],\n    ctx\n  );\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    constructor({ nodeInstance }) {\n      this.nodeInstance = nodeInstance;\n      this.flowInstance = nodeInstance.flowInstance;\n      this.context = nodeInstance.context;\n      this.contextNode = nodeInstance.contextNode;\n      // context\n      this.contextTask = ctx.bean._newBean(`${moduleInfo.relativeName}.local.context.task`, {\n        context: nodeInstance.context,\n        contextNode: nodeInstance.contextNode,\n        nodeDef: nodeInstance.contextNode._nodeDef,\n      });\n    }\n\n    get modelFlowTask() {\n      return ctx.model.module(moduleInfo.relativeName).flowTask;\n    }\n    get modelFlowTaskHistory() {\n      return ctx.model.module(moduleInfo.relativeName).flowTaskHistory;\n    }\n    get localRight() {\n      return ctx.bean._getBean(moduleInfo.relativeName, 'local.right');\n    }\n  }\n  return FlowTask;\n};\n","module.exports = ctx => {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    async _appendHandleRemark({ handle }) {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTaskHistory;\n      // check right\n      await this.localRight.appendHandleRemark({ flowTask, user, flowNodeType: this.contextTask._nodeDef.type });\n      // only update flowTaskHistory\n      this.contextTask._flowTaskHistory.handleRemark = handle.remark;\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n    }\n  }\n  return FlowTask;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    async _assignees() {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      // check right\n      await this.localRight.assignees({ flowTask, user });\n      // handle\n      return await this._assignees_handle();\n    }\n\n    async _assignees_handle() {\n      // assignees\n      const assignees = this.contextNode.vars.get('_assignees');\n      // users\n      let users;\n      if (!assignees || assignees.length === 0) {\n        users = [];\n      } else {\n        users = await ctx.bean.user.select({\n          options: {\n            where: {\n              'a.disabled': 0,\n              'a.id': assignees,\n            },\n            orders: [['a.userName', 'asc']],\n            removePrivacy: true,\n          },\n        });\n      }\n      // options\n      const options = ctx.bean.flowTask._getNodeDefOptionsTask({ nodeInstance: this.nodeInstance });\n      // ok\n      return {\n        users,\n        options: {\n          confirmationAllowAppend: options.confirmationAllowAppend,\n        },\n      };\n    }\n\n    async _assigneesConfirmation({ handle }) {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      // check right\n      await this.localRight.assigneesConfirmation({ flowTask, user });\n      // handle\n      await this._assigneesConfirmation_handle({ handle });\n      // notify\n      this._notifyTaskHandlings(flowTask.userIdAssignee);\n    }\n\n    async _assigneesConfirmation_handle({ handle }) {\n      // options\n      const options = ctx.bean.flowTask._getNodeDefOptionsTask({ nodeInstance: this.nodeInstance });\n      // flowTaskHistory update\n      this.contextTask._flowTaskHistory.flowTaskStatus = 1;\n      this.contextTask._flowTaskHistory.timeHandled = new Date();\n      this.contextTask._flowTaskHistory.handleStatus = handle.status;\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n      // delete flowTask and flowTaskHistory\n      const flowTaskId = this.contextTask._flowTaskId;\n      await this.modelFlowTask.delete({ id: flowTaskId });\n      await this.modelFlowTaskHistory.delete({ flowTaskId });\n      // passed\n      if (handle.status === 1) {\n        // assignees\n        const assignees = await this.flowInstance._parseAssignees(handle.assignees);\n        if (!assignees || assignees.length === 0) {\n          ctx.throw.module(moduleInfo.relativeName, 1008, flowTaskId);\n        }\n        // check confirmationAllowAppend\n        if (!options.confirmationAllowAppend) {\n          const assigneesOld = this.contextNode.vars.get('_assignees');\n          if (!new Set(assigneesOld).isSuperset(new Set(assignees))) {\n            ctx.throw.module(moduleInfo.relativeName, 1009, flowTaskId);\n          }\n        }\n        // save var: _assigneesConfirmation\n        this.contextNode.vars.set('_assigneesConfirmation', assignees);\n        // next stage of flow node: begin\n        return await this.nodeInstance.begin();\n      }\n      // reject\n      if (handle.status === 2) {\n        return await ctx.bean.flowTask._gotoFlowNodePrevious({\n          nodeInstance: this.nodeInstance,\n          rejectedNode: null,\n        });\n      }\n    }\n  }\n  return FlowTask;\n};\n","module.exports = ctx => {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    async _cancelFlow({ handle }) {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      // check right\n      await this.localRight.cancelFlow({ flowTask, user, getOptions: () => this._getNodeOptionsTask() });\n      // handle\n      await this._cancelFlow_handle({ handle });\n    }\n\n    async _cancelFlow_handle({ handle }) {\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      const flowTaskId = flowTask.id;\n      // close draft\n      const atomId = this.context._flow.flowAtomId;\n      if (atomId) {\n        await ctx.bean.atom.closeDraft({ key: { atomId } });\n      }\n      // notify\n      this._notifyTaskHandlings(flowTask.userIdAssignee);\n      // delete flowTask\n      await this.modelFlowTask.delete({ id: flowTaskId });\n      // flowTaskHistory update\n      this.contextTask._flowTaskHistory.flowTaskStatus = 1;\n      this.contextTask._flowTaskHistory.timeHandled = new Date();\n      this.contextTask._flowTaskHistory.handleStatus = 3;\n      this.contextTask._flowTaskHistory.handleRemark = handle.remark;\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n      // node clear\n      //    not use handle.remark\n      const remark = 'Cancelled'; // handle.remark;\n      await this.nodeInstance.clear({ flowNodeHandleStatus: 3, flowNodeRemark: remark });\n      // end flow\n      await this.flowInstance._endFlow({ flowHandleStatus: 3, flowRemark: remark });\n    }\n  }\n  return FlowTask;\n};\n","module.exports = ctx => {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    async _claim() {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      const flowTaskId = flowTask.id;\n      // check right\n      const right = await this.localRight.claim({ flowTask, user });\n      if (right) return right;\n      // flowTask\n      const timeClaimed = new Date();\n      this.contextTask._flowTask.timeClaimed = timeClaimed;\n      this.contextTask._flowTask.flowTaskHidden = 0; // show\n      await this.modelFlowTask.update(this.contextTask._flowTask);\n      // history\n      this.contextTask._flowTaskHistory.timeClaimed = timeClaimed;\n      this.contextTask._flowTaskHistory.flowTaskHidden = 0; // show\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n      // delete recall task: (specificFlag=2)\n      const _taskRecall = await ctx.model.queryOne(\n        `\n          select id,userIdAssignee from aFlowTask\n            where iid=? and deleted=0 and flowNodeId=? and specificFlag=2\n          `,\n        [ctx.instance.id, flowTask.flowNodeId]\n      );\n      if (_taskRecall) {\n        this._notifyTaskHandlings(_taskRecall.userIdAssignee);\n        // delete task\n        await ctx.model.query(\n          `\n          delete from aFlowTask\n            where iid=? and id=?\n          `,\n          [ctx.instance.id, _taskRecall.id]\n        );\n        await ctx.model.query(\n          `\n          update aFlowTaskHistory set deleted=1\n            where iid=? and deleted=0 and flowTaskId=?\n          `,\n          [ctx.instance.id, _taskRecall.id]\n        );\n      }\n      // check if bidding\n      const options = ctx.bean.flowTask._getNodeDefOptionsTask({ nodeInstance: this.nodeInstance });\n      if (options.bidding) {\n        // notify\n        const _tasks = await ctx.model.query(\n          `\n          select id,userIdAssignee from aFlowTask\n            where iid=? and deleted=0 and flowNodeId=? and id<>? and (flowTaskStatus=0 and handleStatus=0)\n          `,\n          [ctx.instance.id, flowTask.flowNodeId, flowTaskId]\n        );\n        for (const _task of _tasks) {\n          this._notifyTaskClaimings(_task.userIdAssignee);\n        }\n        // delete other tasks\n        await ctx.model.query(\n          `\n          delete from aFlowTask\n            where iid=? and flowNodeId=? and id<>? and (flowTaskStatus=0 and handleStatus=0)\n          `,\n          [ctx.instance.id, flowTask.flowNodeId, flowTaskId]\n        );\n        await ctx.model.query(\n          `\n          update aFlowTaskHistory set deleted=1\n            where iid=? and deleted=0 and flowNodeId=? and flowTaskId<>? and (flowTaskStatus=0 and handleStatus=0)\n          `,\n          [ctx.instance.id, flowTask.flowNodeId, flowTaskId]\n        );\n      }\n      // event: task.claimed\n      await this.raiseEventClaimed();\n      // notify\n      this._notifyTaskClaimings(flowTask.userIdAssignee);\n      this._notifyTaskHandlings(flowTask.userIdAssignee);\n      // ok\n      return { timeClaimed };\n    }\n  }\n  return FlowTask;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    async _complete({ handle, formAtom }) {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      // check right\n      await this.localRight.complete({ flowTask, user, handle, getOptions: () => this._getNodeOptionsTask() });\n      // formAtom\n      if (formAtom) {\n        await this._complete_formAtom({ formAtom });\n      }\n      // handle\n      if (handle) {\n        await this._complete_handle({ handle });\n        // event: task.completed\n        await this.raiseEventCompleted();\n        // check if node done\n        ctx.tail(async () => {\n          await this._complete_tail({ flowTask, user });\n        });\n        // notify\n        this._notifyTaskHandlings(flowTask.userIdAssignee);\n      }\n    }\n\n    async _complete_tail({ flowTask, user }) {\n      const flowNodeId = flowTask.flowNodeId;\n      await ctx.app.meta.util.lock({\n        subdomain: ctx.subdomain,\n        resource: `${moduleInfo.relativeName}.flowTask.nodeDoneCheck.${flowNodeId}`,\n        fn: async () => {\n          return await ctx.app.meta.util.executeBean({\n            subdomain: ctx.subdomain,\n            beanModule: moduleInfo.relativeName,\n            beanFullName: 'flowTask',\n            context: { flowNodeId },\n            fn: '_nodeDoneCheckLock',\n            transaction: true,\n            ctxParent: { state: { user: { op: user } } },\n          });\n        },\n      });\n    }\n\n    async _complete_formAtom({ formAtom }) {\n      // schemaWrite\n      const schemaWrite = await this._getSchemaWrite();\n      if (!schemaWrite) return;\n      // write\n      const atomId = this.context._atom.atomId;\n      const user = this.contextTask._user;\n      await ctx.bean.atom.write({\n        key: { atomId },\n        item: formAtom,\n        options: { schema: schemaWrite },\n        user,\n      });\n    }\n\n    async _complete_handle({ handle }) {\n      const timeHandled = new Date();\n      // flowTask\n      this.contextTask._flowTask.flowTaskStatus = 1;\n      this.contextTask._flowTask.timeHandled = timeHandled;\n      this.contextTask._flowTask.handleStatus = handle.status;\n      this.contextTask._flowTask.handleRemark = handle.remark;\n      await this.modelFlowTask.update(this.contextTask._flowTask);\n      // flowTaskHistory\n      this.contextTask._flowTaskHistory.flowTaskStatus = 1;\n      this.contextTask._flowTaskHistory.timeHandled = timeHandled;\n      this.contextTask._flowTaskHistory.handleStatus = handle.status;\n      this.contextTask._flowTaskHistory.handleRemark = handle.remark;\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n      // special for forward\n      await this._complete_handle_checkForward();\n      // special for substitute\n      await this._complete_handle_checkSubstitute();\n    }\n\n    async _complete_handle_checkForward() {\n      let flowTaskIdForwardFrom = this.contextTask._flowTask.flowTaskIdForwardFrom;\n      if (!flowTaskIdForwardFrom) return;\n      while (flowTaskIdForwardFrom) {\n        const taskFrom = await this.modelFlowTask.get({ id: flowTaskIdForwardFrom });\n        await this.modelFlowTask.update({\n          id: flowTaskIdForwardFrom,\n          flowTaskStatus: 1,\n        });\n        await this.modelFlowTaskHistory.update(\n          {\n            flowTaskStatus: 1,\n          },\n          {\n            where: {\n              flowTaskId: flowTaskIdForwardFrom,\n            },\n          }\n        );\n        // notify\n        this._notifyTaskHandlings(taskFrom.userIdAssignee);\n        // next\n        flowTaskIdForwardFrom = taskFrom.flowTaskIdForwardFrom;\n      }\n    }\n\n    async _complete_handle_checkSubstitute() {\n      let flowTaskIdSubstituteFrom = this.contextTask._flowTask.flowTaskIdSubstituteFrom;\n      if (!flowTaskIdSubstituteFrom) return;\n      while (flowTaskIdSubstituteFrom) {\n        const taskFrom = await this.modelFlowTask.get({ id: flowTaskIdSubstituteFrom });\n        await this.modelFlowTask.update({\n          id: flowTaskIdSubstituteFrom,\n          flowTaskStatus: 1,\n        });\n        await this.modelFlowTaskHistory.update(\n          {\n            flowTaskStatus: 1,\n          },\n          {\n            where: {\n              flowTaskId: flowTaskIdSubstituteFrom,\n            },\n          }\n        );\n        // notify\n        this._notifyTaskHandlings(taskFrom.userIdAssignee);\n        // next\n        flowTaskIdSubstituteFrom = taskFrom.flowTaskIdSubstituteFrom;\n      }\n    }\n  }\n  return FlowTask;\n};\n","module.exports = ctx => {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    async raiseEventCreated() {\n      await this.nodeInstance.change({\n        event: 'created',\n        taskInstance: this,\n      });\n      await this._saveVars();\n    }\n\n    async raiseEventClaimed() {\n      await this.nodeInstance.change({\n        event: 'claimed',\n        taskInstance: this,\n      });\n      await this._saveVars();\n    }\n\n    async raiseEventCompleted() {\n      await this.nodeInstance.change({\n        event: 'completed',\n        taskInstance: this,\n      });\n      await this._saveVars();\n    }\n\n    async _saveTaskVars() {\n      if (!this.contextTask._taskVars._dirty) return;\n      // flowTask\n      this.contextTask._flowTask.taskVars = JSON.stringify(this.contextTask._taskVars._vars);\n      // modelFlowTask maybe deleted when flowTaskStatus=1\n      if (this.contextTask._flowTaskHistory.flowTaskStatus === 0) {\n        await this.modelFlowTask.update(this.contextTask._flowTask);\n      }\n      // flowTask history\n      this.contextTask._flowTaskHistory.taskVars = this.contextTask._flowTask.taskVars;\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n      // done\n      this.contextTask._taskVars._dirty = false;\n    }\n\n    async _saveVars() {\n      // save taskVars\n      await this._saveTaskVars();\n      // save nodeVars\n      await this.nodeInstance._saveNodeVars();\n      // save flowVars\n      await this.flowInstance._saveFlowVars();\n    }\n\n    _notifyTaskClaimings(userId) {\n      ctx.bean.flowTask._notifyTaskClaimings(userId);\n    }\n\n    _notifyTaskHandlings(userId) {\n      ctx.bean.flowTask._notifyTaskHandlings(userId);\n    }\n  }\n  return FlowTask;\n};\n","module.exports = ctx => {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    // handle: assignee/remark\n    async _forward({ handle }) {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      // check right\n      await this.localRight.forward({ flowTask, user, getOptions: () => this._getNodeOptionsTask() });\n      // handle\n      await this._forward_handle({ handle });\n      // need not notify\n      // this._notifyTaskHandlings(flowTask.userIdAssignee);\n    }\n\n    // 1. create a new task\n    // 2. update handleStatus/handleRemark\n    async _forward_handle({ handle }) {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      const flowTaskId = flowTask.id;\n      // 1. create a new task\n      const taskInstance = await ctx.bean.flowTask._createTaskInstance({\n        nodeInstance: this.nodeInstance,\n        userIdAssignee: handle.assignee,\n        user,\n      });\n      // specificFlag: 4\n      taskInstance.contextTask._flowTask.specificFlag = 4;\n      taskInstance.contextTask._flowTask.flowTaskIdForwardFrom = flowTaskId;\n      await taskInstance.modelFlowTask.update(taskInstance.contextTask._flowTask);\n      // history\n      taskInstance.contextTask._flowTaskHistory.specificFlag = 4;\n      taskInstance.contextTask._flowTaskHistory.flowTaskIdForwardFrom = flowTaskId;\n      await taskInstance.modelFlowTaskHistory.update(taskInstance.contextTask._flowTaskHistory);\n      // notify\n      taskInstance._notifyTaskClaimings(taskInstance.contextTask._flowTask.userIdAssignee);\n      // 2. update\n      // flowTask\n      const flowTaskIdForwardTo = taskInstance.contextTask._flowTask.id;\n      const timeHandled = new Date();\n      this.contextTask._flowTask.timeHandled = timeHandled;\n      this.contextTask._flowTask.handleStatus = 4;\n      this.contextTask._flowTask.handleRemark = handle.remark;\n      this.contextTask._flowTask.flowTaskIdForwardTo = flowTaskIdForwardTo;\n      this.contextTask._flowTask.ignoreMark = 1;\n      await this.modelFlowTask.update(this.contextTask._flowTask);\n      // flowTaskHistory update\n      this.contextTask._flowTaskHistory.timeHandled = timeHandled;\n      this.contextTask._flowTaskHistory.handleStatus = 4;\n      this.contextTask._flowTaskHistory.handleRemark = handle.remark;\n      this.contextTask._flowTaskHistory.flowTaskIdForwardTo = flowTaskIdForwardTo;\n      this.contextTask._flowTaskHistory.ignoreMark = 1;\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n    }\n\n    async _forwardRecall() {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      // check right\n      await this.localRight.forwardRecall({ flowTask, user, getOptions: () => this._getNodeOptionsTask() });\n      // handle\n      await this._forwardRecall_handle();\n    }\n\n    // 1. delete task\n    // 2. update task\n    async _forwardRecall_handle() {\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      // 1. delete task\n      const taskTo = await this.modelFlowTask.get({ id: flowTask.flowTaskIdForwardTo });\n      // delete flowTask and flowTaskHistory\n      await this.modelFlowTask.delete({ id: taskTo.id });\n      await this.modelFlowTaskHistory.delete({ flowTaskId: taskTo.id });\n      // notify\n      this._notifyTaskClaimings(taskTo.userIdAssignee);\n      // 2. update\n      // flowTask\n      this.contextTask._flowTask.timeHandled = null;\n      this.contextTask._flowTask.handleStatus = 0;\n      this.contextTask._flowTask.handleRemark = null;\n      this.contextTask._flowTask.flowTaskIdForwardTo = 0;\n      this.contextTask._flowTask.ignoreMark = 0;\n      await this.modelFlowTask.update(this.contextTask._flowTask);\n      // flowTaskHistory update\n      this.contextTask._flowTaskHistory.timeHandled = null;\n      this.contextTask._flowTaskHistory.handleStatus = 0;\n      this.contextTask._flowTaskHistory.handleRemark = null;\n      this.contextTask._flowTaskHistory.flowTaskIdForwardTo = 0;\n      this.contextTask._flowTaskHistory.ignoreMark = 0;\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n    }\n  }\n  return FlowTask;\n};\n","const VarsFn = require('../../common/vars.js');\nconst UtilsFn = require('../../common/utils.js');\n\nmodule.exports = ctx => {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    async init({ userIdAssignee, user }) {\n      // create flowTask\n      const flowTaskId = await this._createFlowTask({ userIdAssignee, user });\n      // context init\n      await this._contextInit({ flowTaskId, user });\n      // event\n      await this.raiseEventCreated();\n    }\n\n    async _load({ flowTask, user, history }) {\n      // context init\n      await this._contextInit({ flowTaskId: flowTask.id, user, history });\n    }\n\n    async _createFlowTask({ userIdAssignee, user }) {\n      // flowTask\n      const data = {\n        flowId: this.context._flowId,\n        flowNodeId: this.contextNode._flowNodeId,\n        flowTaskStatus: 0,\n        userIdAssignee,\n        specificFlag: 0,\n        taskVars: '{}',\n      };\n      const res = await this.modelFlowTask.insert(data);\n      const flowTaskId = res.insertId;\n      // flowTaskHistory\n      data.flowTaskId = flowTaskId;\n      await this.modelFlowTaskHistory.insert(data);\n      // notify\n      this._notifyTaskClaimings(userIdAssignee);\n      // publish uniform message\n      if (userIdAssignee !== user.id) {\n        const userFlow = await ctx.bean.user.get({ id: this.context._flow.flowUserId });\n        const userAssignee = await ctx.bean.user.get({ id: userIdAssignee });\n        const title = `${ctx.text.locale(userAssignee.locale, 'Task')} - ${ctx.text.locale(\n          userAssignee.locale,\n          this.contextNode._flowNode.flowNodeName\n        )}`;\n        const actionPath = `/a/flowtask/flow?flowId=${this.context._flowId}&flowTaskId=${flowTaskId}`;\n        const message = {\n          userIdTo: userIdAssignee,\n          content: {\n            issuerId: userFlow.id,\n            issuerName: userFlow.userName,\n            issuerAvatar: userFlow.avatar,\n            title,\n            body: this.context._flow.flowName,\n            actionPath,\n            params: {\n              flowId: this.context._flowId,\n              flowTaskId,\n            },\n          },\n        };\n        // jump out of the transaction\n        ctx.tail(async () => {\n          await ctx.bean.io.publish({\n            message,\n            messageClass: {\n              module: 'a-flow',\n              messageClassName: 'workflow',\n            },\n          });\n        });\n      }\n      // ok\n      return flowTaskId;\n    }\n\n    async _contextInit({ flowTaskId, user, history }) {\n      // flowTaskId\n      this.contextTask._flowTaskId = flowTaskId;\n      // flowTask\n      if (!history) {\n        this.contextTask._flowTask = await this.modelFlowTask.get({ id: flowTaskId });\n      }\n      this.contextTask._flowTaskHistory = await this.modelFlowTaskHistory.get({ flowTaskId });\n      // taskVars\n      this.contextTask._taskVars = new (VarsFn())();\n      this.contextTask._taskVars._vars = this.contextTask._flowTaskHistory.taskVars\n        ? JSON.parse(this.contextTask._flowTaskHistory.taskVars)\n        : {};\n      // utils\n      this.contextTask._utils = new (UtilsFn({ ctx, flowInstance: this.flowInstance }))({\n        context: this.context,\n        contextNode: this.contextNode,\n        contextTask: this.contextTask,\n      });\n      // user\n      this.contextTask._user = user;\n    }\n\n    async _hidden({ hidden }) {\n      // flowTask\n      const flowTaskHidden = hidden ? 1 : 0;\n      this.contextTask._flowTask.flowTaskHidden = flowTaskHidden;\n      await this.modelFlowTask.update(this.contextTask._flowTask);\n      // history\n      this.contextTask._flowTaskHistory.flowTaskHidden = flowTaskHidden;\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n    }\n\n    _getNodeOptionsTask() {\n      return ctx.bean.flowTask._getNodeDefOptionsTask({ nodeInstance: this.nodeInstance });\n    }\n  }\n  return FlowTask;\n};\n","module.exports = ctx => {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    async _recall() {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      // check right\n      await this.localRight.recall({ flowTask, user });\n      // handle\n      await this._recall_handle();\n      // notify\n      this._notifyTaskHandlings(flowTask.userIdAssignee);\n    }\n\n    async _recall_handle() {\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      const flowTaskId = flowTask.id;\n      // flowTaskHistory update\n      this.contextTask._flowTaskHistory.flowTaskStatus = 1;\n      this.contextTask._flowTaskHistory.timeHandled = new Date();\n      this.contextTask._flowTaskHistory.handleStatus = 1;\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n      // delete flowTask and flowTaskHistory\n      await this.modelFlowTask.delete({ id: flowTaskId });\n      await this.modelFlowTaskHistory.delete({ flowTaskId });\n      // notify\n      const _tasks = await ctx.model.query(\n        `\n          select id,userIdAssignee from aFlowTask\n            where iid=? and deleted=0 and flowNodeId=? and id<>?\n          `,\n        [ctx.instance.id, flowTask.flowNodeId, flowTaskId]\n      );\n      for (const _task of _tasks) {\n        this._notifyTaskClaimings(_task.userIdAssignee);\n      }\n      // delete other tasks\n      await ctx.model.query(\n        `\n          delete from aFlowTask\n            where iid=? and flowNodeId=? and id<>?\n          `,\n        [ctx.instance.id, flowTask.flowNodeId, flowTaskId]\n      );\n      await ctx.model.query(\n        `\n          update aFlowTaskHistory set deleted=1\n            where iid=? and deleted=0 and flowNodeId=? and flowTaskId<>?\n          `,\n        [ctx.instance.id, flowTask.flowNodeId, flowTaskId]\n      );\n      // recall\n      return await ctx.bean.flowTask._gotoFlowNodePrevious({\n        nodeInstance: this.nodeInstance,\n        rejectedNode: null,\n        flowNodeRemark: 'Recalled',\n      });\n    }\n  }\n  return FlowTask;\n};\n","const require3 = require('require3');\nconst extend = require3('extend2');\n\nmodule.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    async _viewAtom() {\n      return await this._getAtomAndSchema({ mode: 'read' });\n    }\n\n    async _editAtom() {\n      return await this._getAtomAndSchema({ mode: 'write' });\n    }\n\n    async _getAtomAndSchema({ mode }) {\n      // user/atom\n      const user = this.contextTask._user;\n      const atom = this.context._atom;\n      // flowTask\n      const flowTask = this.contextTask._flowTaskHistory;\n      const flowTaskId = flowTask.flowTaskId;\n      // must be the same user\n      if (user && user.id !== 0 && user.id !== flowTask.userIdAssignee) {\n        ctx.throw.module(moduleInfo.relativeName, 1002, flowTaskId);\n      }\n      // must be the same flowId, means not outdated\n      if (atom.atomFlowId !== this.context._flowId) ctx.throw.module('a-flow', 1009, this.context._flowId);\n      // special for write\n      if (mode === 'write') {\n        // check handled\n        if (flowTask.flowTaskStatus !== 0) ctx.throw.module(moduleInfo.relativeName, 1005, flowTaskId);\n      }\n      // schema\n      let schema = await this._getSchema({ mode });\n      if (!schema) return null;\n      // item\n      const item = extend(true, {}, atom);\n      // validate\n      await ctx.bean.validation._validate({\n        data: item,\n        options: { schema },\n      });\n      // get real schema\n      schema = ctx.bean.validation.getSchema(schema);\n      // basic fields\n      const fields = await ctx.bean.atom.modelAtom.columns();\n      fields.atomId = {};\n      fields.module = {};\n      fields.atomClassName = {};\n      fields.atomNameLocale = {};\n      fields.atomCategoryName = {};\n      fields.atomCategoryNameLocale = {};\n      fields.flowNodeNameCurrent = {};\n      fields.flowNodeNameCurrentLocale = {};\n      fields._meta = {};\n      for (const field in fields) {\n        if (item[field] === undefined && atom[field] !== undefined) {\n          item[field] = atom[field];\n        }\n      }\n      // ok\n      return { schema, item };\n    }\n\n    async _getSchemaRead() {\n      return await this._getSchema({ mode: 'read' });\n    }\n\n    async _getSchemaWrite() {\n      return await this._getSchema({ mode: 'write' });\n    }\n\n    // mode: read/write\n    async _getSchema({ mode }) {\n      const module = this.context._atom.module;\n      // options\n      const options = ctx.bean.flowTask._getNodeDefOptionsTask({ nodeInstance: this.nodeInstance });\n      const fields = options.schema && options.schema[mode];\n      if (!fields) return null;\n      // { module, validator, schema }\n      if (fields && !Array.isArray(fields) && typeof fields === 'object') {\n        return {\n          module: fields.module,\n          validator: fields.validator,\n          schema: fields.schema,\n        };\n      }\n      // base\n      let schemaBase = await this._getSchemaBase();\n      // full read/write\n      if (fields === true && schemaBase) {\n        return {\n          module: schemaBase.module,\n          validator: schemaBase.validator,\n        };\n      }\n      if (!schemaBase) {\n        schemaBase = {\n          module,\n          schema: { type: 'object', properties: {} },\n        };\n      }\n      // some fields\n      const propertiesBase = schemaBase.schema.properties;\n      // properties\n      const properties = {};\n      for (const field of fields) {\n        if (typeof field === 'string') {\n          if (propertiesBase[field]) {\n            properties[field] = propertiesBase[field];\n          }\n        } else {\n          // { name, property }\n          properties[field.name] = field.property;\n        }\n      }\n      // schema\n      let schema = {\n        module,\n        schema: { type: 'object', properties },\n      };\n      // listener\n      const methodName = `getSchema${mode.replace(mode[0], mode[0].toUpperCase())}`;\n      const res = await this.flowInstance._flowListener[methodName](this.contextTask, this.contextNode, {\n        schemaBase,\n        schema,\n      });\n      if (res) {\n        schema = res;\n      }\n      // ok\n      return schema;\n    }\n\n    async _getSchemaBase() {\n      const atomClassId = this.context._atom.atomClassId;\n      const schema = await ctx.bean.atom.schema({\n        atomClass: { id: atomClassId },\n      });\n      return schema;\n    }\n  }\n  return FlowTask;\n};\n","module.exports = ctx => {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowTask {\n    // handle: assignee/remark\n    async _substitute({ handle }) {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      // check right\n      await this.localRight.substitute({ flowTask, user, getOptions: () => this._getNodeOptionsTask() });\n      // handle\n      await this._substitute_handle({ handle });\n      // need not notify\n      // this._notifyTaskHandlings(flowTask.userIdAssignee);\n    }\n\n    // 1. create a new task\n    // 2. update handleStatus/handleRemark\n    async _substitute_handle({ handle }) {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      const flowTaskId = flowTask.id;\n      // 1. create a new task\n      const taskInstance = await ctx.bean.flowTask._createTaskInstance({\n        nodeInstance: this.nodeInstance,\n        userIdAssignee: handle.assignee,\n        user,\n      });\n      // specificFlag: 5\n      taskInstance.contextTask._flowTask.specificFlag = 5;\n      taskInstance.contextTask._flowTask.flowTaskIdSubstituteFrom = flowTaskId;\n      await taskInstance.modelFlowTask.update(taskInstance.contextTask._flowTask);\n      // history\n      taskInstance.contextTask._flowTaskHistory.specificFlag = 5;\n      taskInstance.contextTask._flowTaskHistory.flowTaskIdSubstituteFrom = flowTaskId;\n      await taskInstance.modelFlowTaskHistory.update(taskInstance.contextTask._flowTaskHistory);\n      // notify\n      taskInstance._notifyTaskClaimings(taskInstance.contextTask._flowTask.userIdAssignee);\n      // 2. update\n      // flowTask\n      const flowTaskIdSubstituteTo = taskInstance.contextTask._flowTask.id;\n      const timeHandled = new Date();\n      this.contextTask._flowTask.timeHandled = timeHandled;\n      this.contextTask._flowTask.handleStatus = 5;\n      this.contextTask._flowTask.handleRemark = handle.remark;\n      this.contextTask._flowTask.flowTaskIdSubstituteTo = flowTaskIdSubstituteTo;\n      this.contextTask._flowTask.ignoreMark = 1;\n      await this.modelFlowTask.update(this.contextTask._flowTask);\n      // flowTaskHistory update\n      this.contextTask._flowTaskHistory.timeHandled = timeHandled;\n      this.contextTask._flowTaskHistory.handleStatus = 5;\n      this.contextTask._flowTaskHistory.handleRemark = handle.remark;\n      this.contextTask._flowTaskHistory.flowTaskIdSubstituteTo = flowTaskIdSubstituteTo;\n      this.contextTask._flowTaskHistory.ignoreMark = 1;\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n    }\n\n    async _substituteRecall() {\n      // user\n      const user = this.contextTask._user;\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      // check right\n      await this.localRight.substituteRecall({ flowTask, user, getOptions: () => this._getNodeOptionsTask() });\n      // handle\n      await this._substituteRecall_handle();\n    }\n\n    // 1. delete task\n    // 2. update task\n    async _substituteRecall_handle() {\n      // flowTask\n      const flowTask = this.contextTask._flowTask;\n      // 1. delete task\n      const taskTo = await this.modelFlowTask.get({ id: flowTask.flowTaskIdSubstituteTo });\n      // delete flowTask and flowTaskHistory\n      await this.modelFlowTask.delete({ id: taskTo.id });\n      await this.modelFlowTaskHistory.delete({ flowTaskId: taskTo.id });\n      // notify\n      this._notifyTaskClaimings(taskTo.userIdAssignee);\n      // 2. update\n      // flowTask\n      this.contextTask._flowTask.timeHandled = null;\n      this.contextTask._flowTask.handleStatus = 0;\n      this.contextTask._flowTask.handleRemark = null;\n      this.contextTask._flowTask.flowTaskIdSubstituteTo = 0;\n      this.contextTask._flowTask.ignoreMark = 0;\n      await this.modelFlowTask.update(this.contextTask._flowTask);\n      // flowTaskHistory update\n      this.contextTask._flowTaskHistory.timeHandled = null;\n      this.contextTask._flowTaskHistory.handleStatus = 0;\n      this.contextTask._flowTaskHistory.handleRemark = null;\n      this.contextTask._flowTaskHistory.flowTaskIdSubstituteTo = 0;\n      this.contextTask._flowTaskHistory.ignoreMark = 0;\n      await this.modelFlowTaskHistory.update(this.contextTask._flowTaskHistory);\n    }\n  }\n  return FlowTask;\n};\n","module.exports = ctx => {\n  class Procedure {\n    selectTasks({ iid, userIdWho, where, orders, page, count, history }) {\n      iid = parseInt(iid);\n      userIdWho = parseInt(userIdWho);\n      history = parseInt(history);\n\n      // history\n      if (history === 0) {\n        return this._selectTasks_0({ iid, userIdWho, where, orders, page, count });\n      }\n      return this._selectTasks_1({ iid, userIdWho, where, orders, page, count });\n    }\n\n    _selectTasks_0({ iid, userIdWho, where, orders, page, count }) {\n      // -- tables\n      // -- a: aFlowTask\n      // -- b: aFlowNode\n      // -- c: aFlow\n      // -- d: aUser\n      // -- e: aUser(for flowUserId)\n\n      // for safe\n      where = where ? ctx.model._where(where) : null;\n      orders = orders ? ctx.model._orders(orders) : null;\n      const limit = page ? ctx.model._limit(page.size, page.index) : null;\n\n      // vars\n      let _userWhere;\n\n      //\n      const _where = where ? `${where} AND` : ' WHERE';\n      const _orders = orders || '';\n      const _limit = limit || '';\n\n      // user\n      if (userIdWho !== 0) {\n        _userWhere = ` and a.userIdAssignee=${userIdWho}`;\n      } else {\n        _userWhere = '';\n      }\n\n      // fields\n      let _selectFields;\n      if (count) {\n        _selectFields = 'count(*) as _count';\n      } else {\n        _selectFields = `a.*,a.id as flowTaskId,\n            b.flowNodeDefId,b.flowNodeName,b.flowNodeType,\n            c.flowDefId,c.flowDefKey,c.flowDefRevision,c.flowName,c.flowStatus,c.flowAtomId,c.flowNodeIdCurrent,c.flowUserId,\n            d.userName,d.avatar,\n            e.userName as flowUserName,e.avatar as flowUserAvatar\n          `;\n      }\n\n      // sql\n      const _sql = `select ${_selectFields} from aFlowTask a\n            inner join aFlowNode b on a.flowNodeId=b.id\n            inner join aFlow c on a.flowId=c.id\n            left join aUser d on a.userIdAssignee=d.id\n            left join aUser e on c.flowUserId=e.id\n\n          ${_where}\n           (\n             a.deleted=0 and a.iid=${iid}\n             ${_userWhere}\n           )\n\n          ${count ? '' : _orders}\n          ${count ? '' : _limit}\n        `;\n\n      // ok\n      return _sql;\n    }\n\n    _selectTasks_1({ iid, userIdWho, where, orders, page, count }) {\n      // -- tables\n      // -- a: aFlowTaskHistory\n      // -- b: aFlowNodeHistory\n      // -- c: aFlowHistory\n      // -- d: aUser\n      // -- e: aUser(for flowUserId)\n\n      // for safe\n      where = where ? ctx.model._where(where) : null;\n      orders = orders ? ctx.model._orders(orders) : null;\n      const limit = page ? ctx.model._limit(page.size, page.index) : null;\n\n      // vars\n      let _userWhere;\n\n      //\n      const _where = where ? `${where} AND` : ' WHERE';\n      const _orders = orders || '';\n      const _limit = limit || '';\n\n      // user\n      if (userIdWho !== 0) {\n        _userWhere = ` and a.userIdAssignee=${userIdWho}`;\n      } else {\n        _userWhere = '';\n      }\n\n      // fields\n      let _selectFields;\n      if (count) {\n        _selectFields = 'count(*) as _count';\n      } else {\n        _selectFields = `a.*,\n            b.flowNodeDefId,b.flowNodeName,b.flowNodeType,b.flowNodeStatus,b.flowNodeHandleStatus,b.flowNodeRemark,b.timeDone,\n            c.flowDefId,c.flowDefKey,c.flowDefRevision,c.flowName,c.flowStatus,c.flowAtomId,c.flowNodeIdCurrent,c.flowUserId,\n            d.userName,d.avatar,\n            e.userName as flowUserName,e.avatar as flowUserAvatar\n          `;\n      }\n\n      // sql\n      const _sql = `select ${_selectFields} from aFlowTaskHistory a\n            inner join aFlowNodeHistory b on a.flowNodeId=b.flowNodeId\n            inner join aFlowHistory c on a.flowId=c.flowId\n            left join aUser d on a.userIdAssignee=d.id\n            left join aUser e on c.flowUserId=e.id\n\n          ${_where}\n           (\n             a.deleted=0 and a.iid=${iid}\n             ${_userWhere}\n           )\n\n          ${count ? '' : _orders}\n          ${count ? '' : _limit}\n        `;\n\n      // ok\n      return _sql;\n    }\n  }\n\n  return Procedure;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Right {\n    get modelFlowTask() {\n      return ctx.model.module(moduleInfo.relativeName).flowTask;\n    }\n    _check_specificFlag_normal({ flowTask }) {\n      if (flowTask.specificFlag === 1 || flowTask.specificFlag === 2) ctx.throw(403);\n    }\n    _check_specificFlag_0({ flowTask }) {\n      if (flowTask.specificFlag !== 0) ctx.throw(403);\n    }\n    _check_specificFlag_1({ flowTask }) {\n      if (flowTask.specificFlag !== 1) ctx.throw(403);\n    }\n    _check_specificFlag_2({ flowTask }) {\n      if (flowTask.specificFlag !== 2) ctx.throw(403);\n    }\n    _check_sameUser({ flowTask, user }) {\n      const flowTaskId = flowTask.flowTaskId || flowTask.id;\n      // must be the same user\n      if (user && user.id !== 0 && user.id !== flowTask.userIdAssignee) {\n        ctx.throw.module(moduleInfo.relativeName, 1002, flowTaskId);\n      }\n    }\n    _check_notDone({ flowTask }) {\n      const flowTaskId = flowTask.flowTaskId || flowTask.id;\n      // not complete\n      if (flowTask.flowTaskStatus === 1) {\n        ctx.throw.module(moduleInfo.relativeName, 1005, flowTaskId);\n      }\n    }\n    _check_notDoneAndHandled({ flowTask }) {\n      const flowTaskId = flowTask.flowTaskId || flowTask.id;\n      // not complete and not handled\n      if (flowTask.flowTaskStatus === 1 || flowTask.handleStatus !== 0) {\n        ctx.throw.module(moduleInfo.relativeName, 1005, flowTaskId);\n      }\n    }\n    _check_claimed({ flowTask }) {\n      const flowTaskId = flowTask.flowTaskId || flowTask.id;\n      // timeClaimed first\n      if (!flowTask.timeClaimed) {\n        ctx.throw.module(moduleInfo.relativeName, 1004, flowTaskId);\n      }\n    }\n    async _getNodeOptionsTask({ getOptions, flowTask, nodeInstance }) {\n      if (getOptions) return await getOptions();\n      if (!nodeInstance) {\n        nodeInstance = await ctx.bean.flow._loadFlowNodeInstance({ flowNodeId: flowTask.flowNodeId });\n      }\n      return ctx.bean.flowTask._getNodeDefOptionsTask({ nodeInstance });\n    }\n    async _getTask({ getTask, flowTaskId }) {\n      if (getTask) return await getTask(flowTaskId);\n      return await this.modelFlowTask.get({ id: flowTaskId });\n    }\n    async appendHandleRemark({ flowTask, user, flowNodeType }) {\n      const flowTaskId = flowTask.flowTaskId || flowTask.id;\n      // must be the same user\n      this._check_sameUser({ flowTask, user });\n      // more check\n      if (flowNodeType !== 'startEventAtom' || flowTask.flowTaskStatus !== 1 || flowTask.handleRemark) {\n        ctx.throw.module(moduleInfo.relativeName, 1011, flowTaskId);\n      }\n    }\n    async assignees({ flowTask, user }) {\n      // specificFlag must be 1\n      this._check_specificFlag_1({ flowTask });\n      // must be the same user\n      this._check_sameUser({ flowTask, user });\n      // not complete\n      this._check_notDoneAndHandled({ flowTask });\n      // timeClaimed first\n      this._check_claimed({ flowTask });\n    }\n    async assigneesConfirmation({ flowTask, user }) {\n      // same as assignees\n      return await this.assignees({ flowTask, user });\n    }\n    async cancelFlow({ flowTask, user, getOptions, disableCheckTimeClaimed }) {\n      const flowTaskId = flowTask.flowTaskId || flowTask.id;\n      // specificFlag must be normal\n      this._check_specificFlag_normal({ flowTask });\n      // must be the same user\n      this._check_sameUser({ flowTask, user });\n      // not complete\n      this._check_notDoneAndHandled({ flowTask });\n      // timeClaimed first\n      if (!disableCheckTimeClaimed) {\n        this._check_claimed({ flowTask });\n      }\n      // options\n      const options = await this._getNodeOptionsTask({ getOptions, flowTask });\n      // check if allowCancelFlow\n      if (!options.allowCancelFlow) {\n        ctx.throw.module(moduleInfo.relativeName, 1010, flowTaskId);\n      }\n    }\n    async claim({ flowTask, user }) {\n      // must be the same user\n      this._check_sameUser({ flowTask, user });\n      // not complete\n      this._check_notDoneAndHandled({ flowTask });\n      // check: not throw error\n      // if (flowTask.timeClaimed) ctx.throw.module(moduleInfo.relativeName, 1003, flowTaskId);\n      if (flowTask.timeClaimed) {\n        return { timeClaimed: flowTask.timeClaimed };\n      }\n    }\n    async complete({ flowTask, user, handle, getOptions, disableCheckTimeClaimed }) {\n      const flowTaskId = flowTask.flowTaskId || flowTask.id;\n      // specificFlag must be normal\n      this._check_specificFlag_normal({ flowTask });\n      // must be the same user\n      this._check_sameUser({ flowTask, user });\n      // not complete\n      this._check_notDoneAndHandled({ flowTask });\n      // timeClaimed first\n      if (!disableCheckTimeClaimed) {\n        this._check_claimed({ flowTask });\n      }\n      // options\n      const options = await this._getNodeOptionsTask({ getOptions, flowTask });\n      // check if pass/reject\n      if (handle) {\n        if (handle.status === 1 && !options.allowPassTask) {\n          ctx.throw.module(moduleInfo.relativeName, 1006, flowTaskId);\n        }\n        if (handle.status === 2 && !options.allowRejectTask) {\n          ctx.throw.module(moduleInfo.relativeName, 1007, flowTaskId);\n        }\n      } else if (!options.allowPassTask && !options.allowRejectTask) {\n        ctx.throw(403);\n      }\n    }\n    async recall({ flowTask, user }) {\n      // specificFlag must be 2\n      this._check_specificFlag_2({ flowTask });\n      // must be the same user\n      this._check_sameUser({ flowTask, user });\n      // not complete\n      this._check_notDoneAndHandled({ flowTask });\n      // timeClaimed first\n      this._check_claimed({ flowTask });\n    }\n    async forward({ flowTask, user, getOptions, disableCheckTimeClaimed }) {\n      const flowTaskId = flowTask.flowTaskId || flowTask.id;\n      // must be the same user\n      this._check_sameUser({ flowTask, user });\n      // not complete\n      this._check_notDoneAndHandled({ flowTask });\n      // timeClaimed first\n      if (!disableCheckTimeClaimed) {\n        this._check_claimed({ flowTask });\n      }\n      // check if flowTaskIdSubstituteFrom\n      if (flowTask.flowTaskIdSubstituteFrom) {\n        ctx.throw(403);\n      }\n      // options\n      const options = await this._getNodeOptionsTask({ getOptions, flowTask });\n      if (!options.allowForward || flowTask.flowTaskIdForwardTo) {\n        ctx.throw.module(moduleInfo.relativeName, 1012, flowTaskId);\n      }\n    }\n    async forwardRecall({ flowTask, user, getOptions, getTask }) {\n      // must be the same user\n      this._check_sameUser({ flowTask, user });\n      // not complete\n      this._check_notDone({ flowTask });\n      // timeClaimed first\n      this._check_claimed({ flowTask });\n      // options\n      const options = await this._getNodeOptionsTask({ getOptions, flowTask });\n      if (!options.allowForward || !flowTask.flowTaskIdForwardTo) {\n        ctx.throw(403);\n      }\n      // check if claimed\n      const taskTo = await this._getTask({ getTask, flowTaskId: flowTask.flowTaskIdForwardTo });\n      if (taskTo.timeClaimed) {\n        ctx.throw(403);\n      }\n    }\n    async substitute({ flowTask, user, getOptions, disableCheckTimeClaimed }) {\n      const flowTaskId = flowTask.flowTaskId || flowTask.id;\n      // must be the same user\n      this._check_sameUser({ flowTask, user });\n      // not complete\n      this._check_notDoneAndHandled({ flowTask });\n      // timeClaimed first\n      if (!disableCheckTimeClaimed) {\n        this._check_claimed({ flowTask });\n      }\n      // options\n      const options = await this._getNodeOptionsTask({ getOptions, flowTask });\n      // allowed only once, so should check flowTaskIdSubstituteFrom\n      if (!options.allowSubstitute || flowTask.flowTaskIdSubstituteFrom || flowTask.flowTaskIdSubstituteTo) {\n        ctx.throw.module(moduleInfo.relativeName, 1013, flowTaskId);\n      }\n    }\n    async substituteRecall({ flowTask, user, getOptions, getTask }) {\n      // must be the same user\n      this._check_sameUser({ flowTask, user });\n      // not complete\n      this._check_notDone({ flowTask });\n      // timeClaimed first\n      this._check_claimed({ flowTask });\n      // options\n      const options = await this._getNodeOptionsTask({ getOptions, flowTask });\n      // allowed only once, so should check flowTaskIdSubstituteFrom\n      if (!options.allowSubstitute || flowTask.flowTaskIdSubstituteFrom || !flowTask.flowTaskIdSubstituteTo) {\n        ctx.throw(403);\n      }\n      // check if claimed\n      const taskTo = await this._getTask({ getTask, flowTaskId: flowTask.flowTaskIdSubstituteTo });\n      if (taskTo.timeClaimed) {\n        ctx.throw(403);\n      }\n    }\n  }\n\n  return Right;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Stats {\n    async execute(context) {\n      const { user } = context;\n      const modelFlowTask = ctx.model.module(moduleInfo).flowTask;\n      const count = await modelFlowTask.count({\n        userIdAssignee: user.id,\n        flowTaskStatus: 0,\n        timeClaimed: null,\n      });\n      return count;\n    }\n  }\n\n  return Stats;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Stats {\n    async execute(context) {\n      const { user } = context;\n      const modelFlowTask = ctx.model.module(moduleInfo).flowTask;\n      const count = await modelFlowTask.count({\n        userIdAssignee: user.id,\n        flowTaskStatus: 0,\n        timeClaimed: { op: 'notNull' },\n      });\n      return count;\n    }\n  }\n\n  return Stats;\n};\n","module.exports = app => {\n  class Version extends app.meta.BeanBase {\n    async update(options) {\n      if (options.version === 1) {\n        let sql;\n\n        // create table: aFlowNodeStartEventAtomCondition\n        sql = `\n          CREATE TABLE aFlowNodeStartEventAtomCondition (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            flowDefId int(11) DEFAULT '0',\n            startEventId varchar(255) DEFAULT NULL,\n            atomClassId int(11) DEFAULT '0',\n            conditionExpression TEXT DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n\n        // create table: aFlowTask\n        sql = `\n          CREATE TABLE aFlowTask (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            flowId int(11) DEFAULT '0',\n            flowNodeId int(11) DEFAULT '0',\n            flowTaskStatus int(11) DEFAULT '0',\n            flowTaskHidden int(11) DEFAULT '0',\n            userIdAssignee int(11) DEFAULT '0',\n            specificFlag int(11) DEFAULT '0',\n            handleStatus int(11) DEFAULT '0',\n            handleRemark TEXT DEFAULT NULL,\n            timeClaimed timestamp DEFAULT NULL,\n            timeHandled timestamp DEFAULT NULL,\n            taskVars JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n\n        // create table: aFlowTaskHistory\n        sql = `\n          CREATE TABLE aFlowTaskHistory (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            flowId int(11) DEFAULT '0',\n            flowTaskId int(11) DEFAULT '0',\n            flowNodeId int(11) DEFAULT '0',\n            flowTaskStatus int(11) DEFAULT '0',\n            flowTaskHidden int(11) DEFAULT '0',\n            userIdAssignee int(11) DEFAULT '0',\n            specificFlag int(11) DEFAULT '0',\n            handleStatus int(11) DEFAULT '0',\n            handleRemark TEXT DEFAULT NULL,\n            timeClaimed timestamp DEFAULT NULL,\n            timeHandled timestamp DEFAULT NULL,\n            taskVars JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n      }\n\n      if (options.version === 2) {\n        let sql;\n\n        // aFlowTask\n        sql = `\n          ALTER TABLE aFlowTask\n            ADD COLUMN ignoreMark int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdForwardFrom int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdForwardTo int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdSubstituteFrom int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdSubstituteTo int(11) DEFAULT '0'\n                `;\n        await this.ctx.model.query(sql);\n\n        // aFlowTaskHistory\n        sql = `\n          ALTER TABLE aFlowTaskHistory\n            ADD COLUMN ignoreMark int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdForwardFrom int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdForwardTo int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdSubstituteFrom int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdSubstituteTo int(11) DEFAULT '0'\n                `;\n        await this.ctx.model.query(sql);\n      }\n    }\n\n    async init(options) {}\n\n    async test() {}\n  }\n\n  return Version;\n};\n","const versionManager = require('./bean/version.manager.js');\nconst flowNodeStartEventAtom = require('./bean/flow.node.startEventAtom.js');\nconst flowNodeEndEventAtom = require('./bean/flow.node.endEventAtom.js');\nconst flowNodeActivityUserTask = require('./bean/flow.node.activityUserTask.js');\nconst localContextTask = require('./bean/local.context.task.js');\nconst localFlowTask = require('./bean/local.flow.task.js');\nconst localProcedure = require('./bean/local.procedure.js');\nconst localRight = require('./bean/local.right.js');\nconst beanFlowTask = require('./bean/bean.flowTask.js');\nconst statsTaskClaimings = require('./bean/stats.taskClaimings.js');\nconst statsTaskHandlings = require('./bean/stats.taskHandlings.js');\nconst ioMessageWorkflow = require('./bean/io.message.workflow.js');\n\nmodule.exports = app => {\n  const beans = {\n    // version\n    'version.manager': {\n      mode: 'app',\n      bean: versionManager,\n    },\n    // flow\n    'flow.node.startEventAtom': {\n      mode: 'ctx',\n      bean: flowNodeStartEventAtom,\n    },\n    'flow.node.endEventAtom': {\n      mode: 'ctx',\n      bean: flowNodeEndEventAtom,\n    },\n    'flow.node.activityUserTask': {\n      mode: 'ctx',\n      bean: flowNodeActivityUserTask,\n    },\n    // local\n    'local.context.task': {\n      mode: 'ctx',\n      bean: localContextTask,\n    },\n    'local.flow.task': {\n      mode: 'ctx',\n      bean: localFlowTask,\n    },\n    'local.procedure': {\n      mode: 'ctx',\n      bean: localProcedure,\n    },\n    'local.right': {\n      mode: 'ctx',\n      bean: localRight,\n    },\n    // global\n    flowTask: {\n      mode: 'ctx',\n      bean: beanFlowTask,\n      global: true,\n    },\n    // stats\n    'stats.taskClaimings': {\n      mode: 'ctx',\n      bean: statsTaskClaimings,\n    },\n    'stats.taskHandlings': {\n      mode: 'ctx',\n      bean: statsTaskHandlings,\n    },\n    // io\n    'io.message.workflow': {\n      mode: 'ctx',\n      bean: ioMessageWorkflow,\n    },\n  };\n  return beans;\n};\n","const require3 = require('require3');\nconst assert = require3('assert');\n\nmodule.exports = ctx => {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class FlowNodeActivityUserTaskBase extends ctx.app.meta.FlowNodeBase {\n    constructor(options) {\n      super(ctx, options);\n    }\n\n    async onNodeEnter() {\n      // super\n      let res = await super.onNodeEnter();\n      if (!res) return res;\n\n      // options\n      const options = ctx.bean.flowTask._getNodeDefOptionsTask({\n        nodeInstance: this.nodeInstance,\n      });\n\n      // prepare assignees\n      res = await this._prepareAssignees({ options });\n      if (!res) return false;\n\n      // ok\n      return true;\n    }\n\n    async onNodeBegin() {\n      // super\n      const res = await super.onNodeBegin();\n      if (!res) return res;\n\n      // options\n      const options = ctx.bean.flowTask._getNodeDefOptionsTask({\n        nodeInstance: this.nodeInstance,\n      });\n\n      // user\n      const user = this.flowInstance._getOpUser();\n\n      // var: _assigneesConfirmation\n      const assignees = this.contextNode.vars.get('_assigneesConfirmation');\n      assert(assignees && assignees.length > 0);\n\n      // recall\n      if (options.allowRecall) {\n        const taskInstance = await ctx.bean.flowTask._createTaskInstance({\n          nodeInstance: this.nodeInstance,\n          userIdAssignee: user.id,\n          user,\n        });\n        await this._taskConfirmationClaim({ taskInstance, specificFlag: 2 });\n      }\n\n      // create tasks\n      for (const userIdAssignee of assignees) {\n        const taskInstance = await ctx.bean.flowTask._createTaskInstance({\n          nodeInstance: this.nodeInstance,\n          userIdAssignee,\n          user,\n        });\n        if (!options.showAssignees) {\n          await taskInstance._hidden({ hidden: true });\n        }\n      }\n\n      // ok\n      return true;\n    }\n\n    async onNodeDoing() {\n      // super\n      const res = await super.onNodeDoing();\n      if (!res) return res;\n\n      // break\n      return false;\n    }\n\n    async onNodeClear({ options }) {\n      await ctx.bean.flowTask._clearRemains({ nodeInstance: this.nodeInstance });\n      // super\n      return await super.onNodeClear({ options });\n    }\n\n    async onNodeChange({ options }) {\n      const { event, taskInstance } = options;\n      if (event === 'created') {\n        await taskInstance.flowInstance._flowListener.onTaskCreated(taskInstance.contextTask, taskInstance.contextNode);\n      } else if (event === 'claimed') {\n        await taskInstance.flowInstance._flowListener.onTaskClaimed(taskInstance.contextTask, taskInstance.contextNode);\n      } else if (event === 'completed') {\n        await taskInstance.flowInstance._flowListener.onTaskCompleted(\n          taskInstance.contextTask,\n          taskInstance.contextNode\n        );\n      }\n      // super\n      return await super.onNodeChange({ options });\n    }\n\n    async _prepareAssignees({ options }) {\n      // check var: _assigneesConfirmation\n      let assignees = this.contextNode.vars.get('_assigneesConfirmation');\n      if (assignees && assignees.length > 0) return true;\n\n      // check var: _assignees\n      this.contextNode.vars.get('_assignees');\n      if (!assignees || assignees.length === 0) {\n        // assignees\n        assignees = await this.flowInstance._parseAssignees(options.assignees);\n      }\n\n      // confirmation\n      if (assignees.length === 0 || options.confirmation) {\n        // save var: _assignees\n        this.contextNode.vars.set('_assignees', assignees);\n        // user\n        const user = this.flowInstance._getOpUser();\n        const taskInstance = await ctx.bean.flowTask._createTaskInstance({\n          nodeInstance: this.nodeInstance,\n          userIdAssignee: user.id,\n          user,\n        });\n        await this._taskConfirmationClaim({ taskInstance, specificFlag: 1 });\n        // break\n        return false;\n      }\n\n      // save var: _assigneesConfirmation\n      this.contextNode.vars.set('_assigneesConfirmation', assignees);\n\n      // ok\n      return true;\n    }\n\n    async _taskConfirmationClaim({ taskInstance, specificFlag }) {\n      // specificFlag timeClaimed\n      const timeClaimed = new Date();\n      taskInstance.contextTask._flowTask.specificFlag = specificFlag;\n      taskInstance.contextTask._flowTask.timeClaimed = timeClaimed;\n      await taskInstance.modelFlowTask.update(taskInstance.contextTask._flowTask);\n      // history\n      taskInstance.contextTask._flowTaskHistory.specificFlag = specificFlag;\n      taskInstance.contextTask._flowTaskHistory.timeClaimed = timeClaimed;\n      await taskInstance.modelFlowTaskHistory.update(taskInstance.contextTask._flowTaskHistory);\n      // notify\n      taskInstance._notifyTaskClaimings(taskInstance.contextTask._flowTask.userIdAssignee);\n      taskInstance._notifyTaskHandlings(taskInstance.contextTask._flowTask.userIdAssignee);\n    }\n  }\n  return FlowNodeActivityUserTaskBase;\n};\n","module.exports = ({ ctx /* flowInstance*/ }) => {\n  class Utils {\n    constructor({ context, contextNode, contextTask }) {\n      this.context = context;\n      this.contextNode = contextNode;\n      this.contextTask = contextTask;\n    }\n\n    async executeService({ bean, parameter }) {\n      const globals = {};\n      if (this.context) globals.context = this.context;\n      if (this.contextNode) globals.contextNode = this.contextNode;\n      if (this.contextTask) globals.contextTask = this.contextTask;\n      return await ctx.bean.flow.executeService({\n        bean,\n        parameter,\n        globals,\n      });\n    }\n  }\n  return Utils;\n};\n","module.exports = () => {\n  class FlowVars {\n    constructor() {\n      this._vars = null;\n      this._dirty = false;\n    }\n\n    get(names) {\n      names = names.split('.');\n      let value = this._vars;\n      for (const name of names) {\n        value = value[name];\n        if (value === undefined) break;\n      }\n      return value;\n    }\n\n    set(names, value) {\n      names = names.split('.');\n      let obj = this._vars;\n      for (let i = 0; i < names.length - 1; i++) {\n        const name = names[i];\n        if (obj[name] === undefined) {\n          obj[name] = {};\n        }\n        obj = obj[name];\n      }\n      const name = names[names.length - 1];\n      obj[name] = value;\n      // dirty\n      this._dirty = true;\n    }\n  }\n  return FlowVars;\n};\n","// eslint-disable-next-line\nmodule.exports = appInfo => {\n  const config = {};\n  return config;\n};\n","// error code should start from 1001\nmodule.exports = {\n  1001: 'Task not Found: %s',\n  1002: 'Task cannot be accessed: %s',\n  1003: 'Task has been claimed: %s',\n  1004: 'Task should be claimed first: %s',\n  1005: 'Task has been handled: %s',\n  1006: 'Task cannot be passed: %s',\n  1007: 'Task cannot be rejected: %s',\n  1008: 'Task Assignees cannot be empty: %s',\n  1009: 'Task Assignees cannot be appended: %s',\n  1010: 'Flow cannot be cancelled: %s',\n  1011: 'Task Handle Remark cannot be appended: %s',\n  1012: 'Task has been forwarded: %s',\n  1013: 'Task has been substituted: %s',\n};\n","module.exports = {\n  startEventAtom: {\n    atom: null,\n    conditionExpression: null,\n    task: {\n      assignees: {\n        users: null,\n        roles: null,\n        vars: 'flowUser',\n      },\n      showAssignees: false,\n      confirmation: false,\n      confirmationAllowAppend: false,\n      bidding: false,\n      completionCondition: {\n        passed: 1,\n        rejected: '100%',\n      },\n      rejectedNode: null,\n      allowPassTask: true,\n      allowRejectTask: false,\n      allowCancelFlow: true,\n      allowRecall: false,\n      allowForward: false,\n      allowSubstitute: false,\n      schema: {\n        read: true,\n        write: true,\n      },\n    },\n  },\n  activityUserTask: {\n    assignees: {\n      users: null,\n      roles: null,\n      vars: null,\n    },\n    showAssignees: true,\n    confirmation: false,\n    confirmationAllowAppend: false,\n    bidding: false,\n    completionCondition: {\n      passed: 1,\n      rejected: '100%',\n    },\n    rejectedNode: null,\n    allowPassTask: true,\n    allowRejectTask: true,\n    allowCancelFlow: false,\n    allowRecall: true,\n    allowForward: false,\n    allowSubstitute: false,\n    schema: {\n      read: true,\n      write: false,\n    },\n  },\n};\n","const defaults = require('./defaults.js');\n\nmodule.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const nodes = {\n    // events\n    startEventAtom: {\n      title: 'StartEventAtom',\n      group: 'startEvent',\n      bean: 'startEventAtom',\n      icon: '/api/static/a/flowtask/bpmn/events/start-event-atom.svg',\n      validator: {\n        module: moduleInfo.relativeName,\n        validator: 'startEventAtom',\n      },\n    },\n    endEventAtom: {\n      title: 'EndEventAtom',\n      group: 'endEvent',\n      bean: 'endEventAtom',\n      icon: '/api/static/a/flowtask/bpmn/events/end-event-atom.svg',\n    },\n    // activities\n    activityUserTask: {\n      title: 'ActivityUserTask',\n      group: 'activity',\n      bean: 'activityUserTask',\n      icon: '/api/static/a/flowtask/bpmn/activities/activity-user-task.svg',\n      validator: {\n        module: moduleInfo.relativeName,\n        validator: 'activityUserTask',\n      },\n    },\n  };\n\n  for (const key in nodes) {\n    const node = nodes[key];\n    node.options = {};\n    if (defaults[key]) {\n      node.options.default = defaults[key];\n    }\n  }\n\n  return nodes;\n};\n","module.exports = {\n  StartEventAtom: 'StartEvent: Data Draft',\n  EndEventAtom: 'EndEvent: Data Submit',\n  ActivityUserTask: 'Activity: User Task',\n};\n","module.exports = {\n  Submitted: '已提交',\n  StartEventAtom: '数据起草开始事件',\n  EndEventAtom: '数据提交结束事件',\n  ActivityUserTask: '用户任务活动',\n  'Task not Found: %s': '任务未发现: %s',\n  'Task cannot be accessed: %s': '任务无权访问: %s',\n  'Task has been claimed: %s': '任务已被申领: %s',\n  'Task should be claimed first: %s': '任务必须先申领: %s',\n  'Task has been handled: %s': '任务已处理: %s',\n  'Task cannot be passed: %s': '任务无权被通过: %s',\n  'Task cannot be rejected: %s': '任务无权被拒绝: %s',\n  'Task Assignees cannot be empty: %s': '任务参与人不允许为空: %s',\n  'Task Assignees cannot be appended: %s': '任务参与人不允许追加: %s',\n  'Flow cannot be cancelled: %s': '流程无权被取消: %s',\n  'Task Handle Remark cannot be appended: %s': '任务处理意见不允许追加: %s',\n  'Task has been forwarded: %s': '任务已被转办: %s',\n  'Task has been substituted: %s': '任务已被代办: %s',\n};\n","module.exports = {\n  'en-us': require('./locale/en-us.js'),\n  'zh-cn': require('./locale/zh-cn.js'),\n};\n","module.exports = app => {\n  // const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const schemas = {};\n  // activityUserTask\n  schemas.activityUserTask = {\n    type: 'object',\n    properties: {\n      assignees: {\n        type: 'object',\n        ebType: 'component',\n        ebTitle: 'Assignees',\n        ebRender: {\n          module: 'a-flowchart',\n          name: 'renderAssignees',\n        },\n        notEmpty: true,\n      },\n      showAssignees: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Show Assignees',\n      },\n      confirmation: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Confirmation Assignees',\n      },\n      confirmationAllowAppend: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'ConfirmationAllowAppend',\n      },\n      bidding: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Bidding',\n      },\n      completionCondition: {\n        type: 'object',\n        ebType: 'json',\n        ebTitle: 'Completion Condition',\n        notEmpty: true,\n      },\n      rejectedNode: {\n        type: 'string',\n        ebType: 'component',\n        ebTitle: 'Rejected Node',\n        ebRender: {\n          module: 'a-flowchart',\n          name: 'renderRejectedNode',\n        },\n      },\n      allowPassTask: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Allow Pass Task',\n      },\n      allowRejectTask: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Allow Reject Task',\n      },\n      allowCancelFlow: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Allow Cancel Flow',\n      },\n      allowRecall: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Allow Recall',\n      },\n      allowForward: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Allow Forward',\n      },\n      allowSubstitute: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Allow Substitute',\n      },\n      schema: {\n        type: 'object',\n        ebType: 'component',\n        ebTitle: 'Field Permissions',\n        ebRender: {\n          module: 'a-flowchart',\n          name: 'renderSchemaFields',\n        },\n        notEmpty: true,\n      },\n    },\n  };\n  return schemas;\n};\n","module.exports = app => {\n  const schemas = {};\n  // startEventAtom\n  schemas.startEventAtom = {\n    type: 'object',\n    properties: {\n      atom: {\n        type: 'object',\n        ebType: 'atomClass',\n        ebTitle: 'Atom Class',\n        notEmpty: true,\n        ebParams: {\n          simple: 0,\n        },\n      },\n      conditionExpression: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Condition Expression',\n        ebTextarea: true,\n      },\n      task: {\n        type: 'object',\n        ebType: 'panel',\n        ebTitle: 'User Task Options',\n        $ref: 'activityUserTask',\n      },\n    },\n  };\n  return schemas;\n};\n","const startEventAtom = require('./schema/startEventAtom.js');\nconst activityUserTask = require('./schema/activityUserTask.js');\n\nmodule.exports = app => {\n  const schemas = {};\n  // startEventAtom\n  Object.assign(schemas, startEventAtom(app));\n  // activityUserTask\n  Object.assign(schemas, activityUserTask(app));\n  // ok\n  return schemas;\n};\n","module.exports = app => {\n  class FlowController extends app.Controller {\n    async data() {\n      const res = await this.ctx.service.flow.data({\n        flowId: this.ctx.request.body.flowId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n  }\n  return FlowController;\n};\n","module.exports = app => {\n  class FlowTaskController extends app.Controller {\n    // options\n    //   where, orders, page, history\n    async select() {\n      const options = this.ctx.request.body.options;\n      options.page = this.ctx.bean.util.page(options.page);\n      const items = await this.ctx.service.flowTask.select({\n        options,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.successMore(items, options.page.index, options.page.size);\n    }\n\n    async count() {\n      const options = this.ctx.request.body.options;\n      const count = await this.ctx.service.flowTask.count({\n        options,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(count);\n    }\n\n    async claim() {\n      const res = await this.ctx.service.flowTask.claim({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async complete() {\n      const res = await this.ctx.service.flowTask.complete({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        handle: this.ctx.request.body.handle,\n        formAtom: this.ctx.request.body.formAtom,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async appendHandleRemark() {\n      const res = await this.ctx.service.flowTask.appendHandleRemark({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        handle: this.ctx.request.body.handle,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async assignees() {\n      const res = await this.ctx.service.flowTask.assignees({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async assigneesConfirmation() {\n      const res = await this.ctx.service.flowTask.assigneesConfirmation({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        handle: this.ctx.request.body.handle,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async recall() {\n      const res = await this.ctx.service.flowTask.recall({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async cancelFlow() {\n      const res = await this.ctx.service.flowTask.cancelFlow({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        handle: this.ctx.request.body.handle,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async viewAtom() {\n      const res = await this.ctx.service.flowTask.viewAtom({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async editAtom() {\n      const res = await this.ctx.service.flowTask.editAtom({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async userSelectForward() {\n      const { flowTaskId, params } = this.ctx.request.body;\n      const user = this.ctx.state.user.op;\n      const page = params.page;\n      const items = await this.ctx.service.flowTask.userSelectForward({\n        flowTaskId,\n        params,\n        user,\n      });\n      this.ctx.successMore(items, page.index, page.size);\n    }\n\n    async forward() {\n      const res = await this.ctx.service.flowTask.forward({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        handle: this.ctx.request.body.handle,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async forwardRecall() {\n      const res = await this.ctx.service.flowTask.forwardRecall({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async userSelectSubstitute() {\n      const { flowTaskId, params } = this.ctx.request.body;\n      const user = this.ctx.state.user.op;\n      const page = params.page;\n      const items = await this.ctx.service.flowTask.userSelectSubstitute({\n        flowTaskId,\n        params,\n        user,\n      });\n      this.ctx.successMore(items, page.index, page.size);\n    }\n\n    async substitute() {\n      const res = await this.ctx.service.flowTask.substitute({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        handle: this.ctx.request.body.handle,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n\n    async substituteRecall() {\n      const res = await this.ctx.service.flowTask.substituteRecall({\n        flowTaskId: this.ctx.request.body.flowTaskId,\n        user: this.ctx.state.user.op,\n      });\n      this.ctx.success(res);\n    }\n  }\n  return FlowTaskController;\n};\n","const flow = require('./controller/flow.js');\nconst flowTask = require('./controller/flowTask.js');\n\nmodule.exports = app => {\n  const controllers = {\n    flow,\n    flowTask,\n  };\n  return controllers;\n};\n","const config = require('./config/config.js');\nconst locales = require('./config/locales.js');\nconst errors = require('./config/errors.js');\n\nmodule.exports = app => {\n  // aops\n  const aops = require('./aops.js')(app);\n  // beans\n  const beans = require('./beans.js')(app);\n  // routes\n  const routes = require('./routes.js')(app);\n  // controllers\n  const controllers = require('./controllers.js')(app);\n  // services\n  const services = require('./services.js')(app);\n  // models\n  const models = require('./models.js')(app);\n  // meta\n  const meta = require('./meta.js')(app);\n\n  return {\n    aops,\n    beans,\n    routes,\n    controllers,\n    services,\n    models,\n    config,\n    locales,\n    errors,\n    meta,\n  };\n};\n","module.exports = app => {\n  const schemas = require('./config/validation/schemas.js')(app);\n  const flowNodes = require('./config/flow/nodes.js')(app);\n  const meta = {\n    base: {\n      atoms: {},\n    },\n    validation: {\n      validators: {\n        // startEventAtom\n        startEventAtom: {\n          schemas: 'startEventAtom,activityUserTask',\n        },\n        // activityUserTask\n        activityUserTask: {\n          schemas: 'activityUserTask',\n        },\n      },\n      keywords: {},\n      schemas,\n    },\n    flow: {\n      nodes: flowNodes,\n    },\n    stats: {\n      providers: {\n        taskClaimings: {\n          user: true,\n          bean: 'taskClaimings',\n        },\n        taskHandlings: {\n          user: true,\n          bean: 'taskHandlings',\n        },\n        taskClaimingsHandlings: {\n          user: true,\n          bean: {\n            module: 'a-stats',\n            name: 'deps',\n          },\n          dependencies: ['a-flowtask:taskClaimings', 'a-flowtask:taskHandlings'],\n        },\n      },\n    },\n  };\n  return meta;\n};\n","module.exports = app => {\n  class FlowNodeStartEventAtomCondition extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aFlowNodeStartEventAtomCondition', options: { disableDeleted: true } });\n    }\n  }\n  return FlowNodeStartEventAtomCondition;\n};\n","module.exports = app => {\n  class FlowTask extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aFlowTask', options: { disableDeleted: true } });\n    }\n  }\n  return FlowTask;\n};\n","module.exports = app => {\n  class FlowTaskHistory extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aFlowTaskHistory', options: { disableDeleted: false } });\n    }\n  }\n  return FlowTaskHistory;\n};\n","const flowNodeStartEventAtomCondition = require('./model/flowNodeStartEventAtomCondition.js');\nconst flowTask = require('./model/flowTask.js');\nconst flowTaskHistory = require('./model/flowTaskHistory.js');\n\nmodule.exports = app => {\n  const models = {\n    flowNodeStartEventAtomCondition,\n    flowTask,\n    flowTaskHistory,\n  };\n  return models;\n};\n","module.exports = app => {\n  const routes = [\n    // flow\n    { method: 'post', path: 'flow/data', controller: 'flow' },\n    // task\n    { method: 'post', path: 'task/select', controller: 'flowTask' },\n    { method: 'post', path: 'task/count', controller: 'flowTask' },\n    { method: 'post', path: 'task/claim', controller: 'flowTask', middlewares: 'transaction' },\n    { method: 'post', path: 'task/complete', controller: 'flowTask', middlewares: 'transaction' },\n    { method: 'post', path: 'task/appendHandleRemark', controller: 'flowTask' },\n    { method: 'post', path: 'task/assignees', controller: 'flowTask' },\n    { method: 'post', path: 'task/assigneesConfirmation', controller: 'flowTask', middlewares: 'transaction' },\n    { method: 'post', path: 'task/recall', controller: 'flowTask', middlewares: 'transaction' },\n    { method: 'post', path: 'task/cancelFlow', controller: 'flowTask', middlewares: 'transaction' },\n    { method: 'post', path: 'task/viewAtom', controller: 'flowTask' },\n    { method: 'post', path: 'task/editAtom', controller: 'flowTask' },\n    { method: 'post', path: 'task/userSelectForward', controller: 'flowTask' },\n    { method: 'post', path: 'task/forward', controller: 'flowTask' },\n    { method: 'post', path: 'task/forwardRecall', controller: 'flowTask' },\n    { method: 'post', path: 'task/userSelectSubstitute', controller: 'flowTask' },\n    { method: 'post', path: 'task/substitute', controller: 'flowTask' },\n    { method: 'post', path: 'task/substituteRecall', controller: 'flowTask' },\n  ];\n  return routes;\n};\n","module.exports = app => {\n  class Flow extends app.Service {\n    async data({ flowId, user }) {\n      return await this.ctx.bean.flowTask.flowData({ flowId, user });\n    }\n  }\n  return Flow;\n};\n","module.exports = app => {\n  class FlowTask extends app.Service {\n    async select({ options, user }) {\n      return await this.ctx.bean.flowTask.select({ options, user });\n    }\n\n    async count({ options, user }) {\n      return await this.ctx.bean.flowTask.count({ options, user });\n    }\n\n    async claim({ flowTaskId, user }) {\n      return await this.ctx.bean.flowTask.claim({ flowTaskId, user });\n    }\n\n    async complete({ flowTaskId, handle, formAtom, user }) {\n      return await this.ctx.bean.flowTask.complete({ flowTaskId, handle, formAtom, user });\n    }\n\n    async appendHandleRemark({ flowTaskId, handle, user }) {\n      return await this.ctx.bean.flowTask.appendHandleRemark({ flowTaskId, handle, user });\n    }\n\n    async assignees({ flowTaskId, user }) {\n      return await this.ctx.bean.flowTask.assignees({ flowTaskId, user });\n    }\n\n    async assigneesConfirmation({ flowTaskId, handle, user }) {\n      return await this.ctx.bean.flowTask.assigneesConfirmation({ flowTaskId, handle, user });\n    }\n\n    async recall({ flowTaskId, user }) {\n      return await this.ctx.bean.flowTask.recall({ flowTaskId, user });\n    }\n\n    async cancelFlow({ flowTaskId, handle, user }) {\n      return await this.ctx.bean.flowTask.cancelFlow({ flowTaskId, handle, user });\n    }\n\n    async viewAtom({ flowTaskId, user }) {\n      return await this.ctx.bean.flowTask.viewAtom({ flowTaskId, user });\n    }\n\n    async editAtom({ flowTaskId, user }) {\n      return await this.ctx.bean.flowTask.editAtom({ flowTaskId, user });\n    }\n\n    async userSelectForward({ flowTaskId, params, user }) {\n      // check right\n      const flowTask = await this.ctx.model.flowTask.get({ id: flowTaskId });\n      await this.ctx.bean.local.right.forward({ flowTask, user });\n      // users\n      return await this.ctx.bean.user.selectGeneral({ params });\n    }\n\n    async forward({ flowTaskId, handle, user }) {\n      return await this.ctx.bean.flowTask.forward({ flowTaskId, handle, user });\n    }\n\n    async forwardRecall({ flowTaskId, user }) {\n      return await this.ctx.bean.flowTask.forwardRecall({ flowTaskId, user });\n    }\n\n    async userSelectSubstitute({ flowTaskId, params, user }) {\n      // check right\n      const flowTask = await this.ctx.model.flowTask.get({ id: flowTaskId });\n      await this.ctx.bean.local.right.substitute({ flowTask, user });\n      // users\n      return await this.ctx.bean.user.selectGeneral({ params });\n    }\n\n    async substitute({ flowTaskId, handle, user }) {\n      return await this.ctx.bean.flowTask.substitute({ flowTaskId, handle, user });\n    }\n\n    async substituteRecall({ flowTaskId, user }) {\n      return await this.ctx.bean.flowTask.substituteRecall({ flowTaskId, user });\n    }\n  }\n  return FlowTask;\n};\n","const flow = require('./service/flow.js');\nconst flowTask = require('./service/flowTask.js');\n\nmodule.exports = app => {\n  const services = {\n    flow,\n    flowTask,\n  };\n  return services;\n};\n","module.exports = require(\"require3\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(9421);\n",""],"names":[],"sourceRoot":""}