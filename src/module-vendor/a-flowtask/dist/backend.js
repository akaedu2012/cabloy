(()=>{var e={1129:e=>{e.exports=e=>({})},5504:(e,t,n)=>{const r=n(1521),a=n(3237),s=n(7221);e.exports=e=>e.app.meta.util.mixinClasses(r,[a,s],e)},1521:e=>{function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,s=function(){};return{s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(i)throw o}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,s){var o=e.apply(t,n);function c(e){r(o,a,s,c,i,"next",e)}function i(e){r(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>{const n=e.app.meta.mockUtil.parseInfoFromPackage(__dirname);return class{get modelFlowTask(){return e.model.module(n.relativeName).flowTask}get modelFlowTaskHistory(){return e.model.module(n.relativeName).flowTaskHistory}get localRight(){return e.bean._getBean(n.relativeName,"local.right")}get sqlProcedure(){return e.bean._getBean(n.relativeName,"local.procedure")}async count(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.options,a=e.user,n.next=3,t.select({options:r,user:a,count:1});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async select(n){var r=this;return a(regeneratorRuntime.mark((function a(){var s,o,c,i,u,l,d,f,w,m;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=n.options,o=n.user,c=n.pageForce,i=void 0===c||c,u=n.count,l=void 0===u?0:u,a.next=3,r._list({options:s,user:o,pageForce:i,count:l});case 3:d=a.sent,f=t(d);try{for(f.s();!(w=f.n()).done;)(m=w.value).flowNodeNameLocale=e.text(m.flowNodeName),m.flowNodeRemark&&(m.flowNodeRemarkLocale=e.text(m.flowNodeRemark)),m.handleRemark&&(m.handleRemarkLocale=e.text(m.handleRemark))}catch(e){f.e(e)}finally{f.f()}return a.abrupt("return",d);case 7:case"end":return a.stop()}}),a)})))()}async claim(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:a});case 3:return s=n.sent,n.next=6,s._claim();case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n)})))()}async complete(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.formAtom,o=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:o});case 3:return c=n.sent,n.next=6,c._complete({handle:a,formAtom:s});case 6:case"end":return n.stop()}}),n)})))()}async appendHandleRemark(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:s,history:!0});case 3:return o=n.sent,n.next=6,o._appendHandleRemark({handle:a});case 6:case"end":return n.stop()}}),n)})))()}async assignees(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:a});case 3:return s=n.sent,n.next=6,s._assignees();case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n)})))()}async assigneesConfirmation(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:s});case 3:return o=n.sent,n.next=6,o._assigneesConfirmation({handle:a});case 6:case"end":return n.stop()}}),n)})))()}async recall(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:a});case 3:return s=n.sent,n.next=6,s._recall();case 6:case"end":return n.stop()}}),n)})))()}async cancelFlow(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:s});case 3:return o=n.sent,n.next=6,o._cancelFlow({handle:a});case 6:case"end":return n.stop()}}),n)})))()}async viewAtom(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:a,history:!0});case 3:return s=n.sent,n.next=6,s._viewAtom();case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n)})))()}async editAtom(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:a,history:!1});case 3:return s=n.sent,n.next=6,s._editAtom();case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n)})))()}async forward(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:s});case 3:return o=n.sent,n.next=6,o._forward({handle:a});case 6:case"end":return n.stop()}}),n)})))()}async forwardRecall(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:a});case 3:return s=n.sent,n.next=6,s._forwardRecall();case 6:case"end":return n.stop()}}),n)})))()}async substitute(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:s});case 3:return o=n.sent,n.next=6,o._substitute({handle:a});case 6:case"end":return n.stop()}}),n)})))()}async substituteRecall(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t._loadTaskInstance({flowTaskId:r,user:a});case 3:return s=n.sent,n.next=6,s._substituteRecall();case 6:case"end":return n.stop()}}),n)})))()}async flowData(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowId,a=e.user,n.next=3,t._flowData_flow({flowId:r,user:a});case 3:if(s=n.sent){n.next=6;break}return n.abrupt("return",null);case 6:return n.next=8,t._flowData_atom({flowId:r,atomId:s.flowAtomId});case 8:return o=n.sent,n.next=11,t._flowData_tasks({flow:s,atom:o,flowId:r,user:a});case 11:return c=n.sent,n.abrupt("return",{flow:s,atom:o,tasks:c});case 13:case"end":return n.stop()}}),n)})))()}}}},3237:e=>{function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,s=function(){};return{s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(i)throw o}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,s){var o=e.apply(t,n);function c(e){r(o,a,s,c,i,"next",e)}function i(e){r(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>{const n=e.app.meta.mockUtil.parseInfoFromPackage(__dirname);return class{async _nodeDoneCheckLock(t){var n=this;return a(regeneratorRuntime.mark((function r(){var a,s,o,c,i,u,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=t.flowNodeId,r.prev=1,r.next=4,e.bean.flow._loadFlowNodeInstance({flowNodeId:a});case 4:s=r.sent,r.next=9;break;case 7:r.prev=7,r.t0=r.catch(1);case 9:if(s){r.next=11;break}return r.abrupt("return");case 11:return o=n._getNodeDefOptionsTask({nodeInstance:s}),c=o.completionCondition,r.next=15,n.modelFlowTask.count({flowNodeId:a,ignoreMark:0});case 15:if(0!==(i=r.sent)){r.next=18;break}return r.abrupt("return");case 18:return r.next=20,n.modelFlowTask.count({flowNodeId:a,flowTaskStatus:1,handleStatus:1,ignoreMark:0});case 20:return u=r.sent,r.next=23,n.modelFlowTask.count({flowNodeId:a,flowTaskStatus:1,handleStatus:2,ignoreMark:0});case 23:if(l=r.sent,"number"!=typeof c.passed&&-1!==c.passed.indexOf("%")){r.next=31;break}if(!(u>=parseInt(c.passed))){r.next=29;break}return r.next=28,n._nodeDoneCheckLock_passed({nodeInstance:s});case 28:return r.abrupt("return",r.sent);case 29:r.next=35;break;case 31:if(!(u/i>=parseInt(c.passed)/100)){r.next=35;break}return r.next=34,n._nodeDoneCheckLock_passed({nodeInstance:s});case 34:return r.abrupt("return",r.sent);case 35:if("number"!=typeof c.rejected&&-1!==c.rejected.indexOf("%")){r.next=42;break}if(!(l>=parseInt(c.rejected))){r.next=40;break}return r.next=39,n._nodeDoneCheckLock_rejected({nodeInstance:s,options:o});case 39:return r.abrupt("return",r.sent);case 40:r.next=46;break;case 42:if(!(l/i>=parseInt(c.rejected)/100)){r.next=46;break}return r.next=45,n._nodeDoneCheckLock_rejected({nodeInstance:s,options:o});case 45:return r.abrupt("return",r.sent);case 46:case"end":return r.stop()}}),r,null,[[1,7]])})))()}async _nodeDoneCheckLock_passed(e){return a(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.nodeInstance,t.next=3,n.end();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()}async _nodeDoneCheckLock_rejected(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.nodeInstance,a=e.options,n.next=3,t._gotoFlowNodePrevious({nodeInstance:r,rejectedNode:a.rejectedNode});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async _gotoFlowNodePrevious(t){var n=this;return a(regeneratorRuntime.mark((function r(){var a,s,o,c,i,u,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=t.nodeInstance,s=t.rejectedNode,o=t.flowNodeRemark,c=void 0===o?"Rejected":o,i=a.contextNode._flowNodeId,s){r.next=8;break}return r.next=5,n._findFlowNodeHistoryPrevious({nodeInstance:a});case 5:(u=r.sent)||e.throw.module("a-flow",1006,i),s=u.flowNodeDefId;case 8:return r.next=10,a.flowInstance._findNodeInstanceNext({nodeDefId:s,flowNodeIdPrev:i});case 10:return l=r.sent,r.next=13,a.clear({flowNodeHandleStatus:2,flowNodeRemark:c});case 13:return r.next=15,l.enter();case 15:return r.abrupt("return",r.sent);case 16:case"end":return r.stop()}}),r)})))()}async _findFlowNodeHistoryPrevious(e){return a(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.nodeInstance,r=n.contextNode._flowNodeId,t.next=4,n.flowInstance._findFlowNodeHistoryPrevious({flowNodeId:r,cb:e=>{let t=e.nodeDef;return t.type.indexOf("startEventAtom")>-1||t.type.indexOf("activityUserTask")>-1}});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))()}async _list(t){var n=this;return a(regeneratorRuntime.mark((function r(){var a,s,o,c,i,u,l,d,f,w,m,k,p,T;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=t.options,s=a.where,o=a.orders,c=a.page,i=a.mode,u=a.history,l=void 0===u?0:u,d=t.user,f=t.pageForce,w=void 0===f||f,m=t.count,k=void 0===m?0:m,"claimings"===i?(s["a.flowTaskStatus"]=0,s["a.timeClaimed"]=null,l=0):"handlings"===i?(s["a.flowTaskStatus"]=0,s["a.timeClaimed"]={op:"notNull"},l=0):"completeds"===i&&(s["a.flowTaskStatus"]=1,l=1),c=e.bean.util.page(c,w),p=n.sqlProcedure.selectTasks({iid:e.instance.id,userIdWho:d?d.id:0,where:s,orders:o,page:c,count:k,history:l}),r.next=6,e.model.query(p);case 6:return T=r.sent,r.abrupt("return",k?T[0]._count:T);case 8:case"end":return r.stop()}}),r)})))()}async _loadTaskInstance(t){var r=this;return a(regeneratorRuntime.mark((function a(){var s,o,c,i,u,l;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(s=t.flowTaskId,o=t.user,c=t.history){a.next=7;break}return a.next=4,r.modelFlowTask.get({id:s});case 4:i=a.sent,a.next=10;break;case 7:return a.next=9,r.modelFlowTaskHistory.get({flowTaskId:s});case 9:i=a.sent;case 10:return i||e.throw.module(n.relativeName,1001,s),a.next=13,e.bean.flow._loadFlowNodeInstance({flowNodeId:i.flowNodeId,history:c});case 13:return u=a.sent,l=r._createTaskInstance2({nodeInstance:u}),a.next=17,l._load({flowTask:i,user:o,history:c});case 17:return a.abrupt("return",l);case 18:case"end":return a.stop()}}),a)})))()}_createTaskInstance2(t){let r=t.nodeInstance;return e.bean._newBean("".concat(n.relativeName,".local.flow.task"),{nodeInstance:r})}async _createTaskInstance(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.nodeInstance,a=e.userIdAssignee,s=e.user,o=t._createTaskInstance2({nodeInstance:r}),n.next=4,o.init({userIdAssignee:a,user:s});case 4:return n.abrupt("return",o);case 5:case"end":return n.stop()}}),n)})))()}_getNodeDefOptionsTask(e){let t=e.nodeInstance;const n=t.contextNode._nodeDef,r=t.getNodeDefOptions();return n.type.indexOf("startEventAtom")>-1?r.task:r}async _clearRemains(n){var r=this;return a(regeneratorRuntime.mark((function a(){var s,o,c,i,u,l;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=n.nodeInstance,o=s.contextNode._flowNodeId,a.next=4,r.modelFlowTask.select({where:{flowNodeId:o}});case 4:c=a.sent,i=t(c);try{for(i.s();!(u=i.n()).done;)l=u.value,r._notifyTaskClaimings(l.userIdAssignee),r._notifyTaskHandlings(l.userIdAssignee)}catch(e){i.e(e)}finally{i.f()}return a.next=9,r.modelFlowTask.delete({flowNodeId:o});case 9:return a.next=11,e.model.query("\n        update aFlowTaskHistory set deleted=1\n          where iid=? and deleted=0 and flowNodeId=? and flowTaskStatus=0 and specificFlag=2 \n        ",[e.instance.id,o]);case 11:return a.next=13,e.model.query("\n        update aFlowTaskHistory set flowTaskStatus=1\n          where iid=? and deleted=0 and flowNodeId=? and flowTaskStatus=0\n        ",[e.instance.id,o]);case 13:case"end":return a.stop()}}),a)})))()}_notifyTaskClaimings(t){t&&e.bean.stats.notify({module:n.relativeName,name:"taskClaimings",user:{id:t}})}_notifyTaskHandlings(t){t&&e.bean.stats.notify({module:n.relativeName,name:"taskHandlings",user:{id:t}})}}}},7221:e=>{function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,s=function(){};return{s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(i)throw o}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function c(e){o(s,r,a,c,i,"next",e)}function i(e){o(s,r,a,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>class{async _flowData_flow(t){return c(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.flowId,a=t.user,n.next=3,e.bean.flow.get({flowId:r,history:!0,user:a});case 3:return s=n.sent,n.abrupt("return",s);case 5:case"end":return n.stop()}}),n)})))()}async _flowData_atom(t){return c(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.flowId,a=t.atomId,n.next=3,e.model.queryOne("\n        select a.*,a.id as atomId,b.module,b.atomClassName from aAtom a\n           left join aAtomClass b on a.atomClassId=b.id\n             where a.deleted=0 and a.iid=? and a.id=?\n                   and a.atomFlowId=?\n        ",[e.instance.id,a,r]);case 3:return s=n.sent,n.abrupt("return",s);case 5:case"end":return n.stop()}}),n)})))()}async _flowData_tasks(n){var r=this;return c(regeneratorRuntime.mark((function s(){var o,i,u,l,d,f,w,m,k,p;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o=n.flow,i=n.atom,u=n.flowId,l=n.user,s.next=3,e.bean.flowTask.select({options:{where:{"a.flowId":u,"b.flowNodeType":["a-flowtask:startEventAtom","a-flowtask:activityUserTask","startEventAtom","activityUserTask"],__or__:[{"a.userIdAssignee":l.id},{"a.flowTaskHidden":0}]},orders:[["a.flowNodeId","desc"],["a.flowTaskStatus","asc"],["a.createdAt","desc"]],history:1},user:null,pageForce:!1});case 3:d=s.sent,f=!i||i.atomFlowId!==o.flowId,w={_nodeInstances:{},_options:{},get:function(t){var n=this;return c(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=n._nodeInstances[t]){r.next=6;break}return r.next=4,e.bean.flow._loadFlowNodeInstance({flowNodeId:t});case 4:a=r.sent,n._nodeInstances[t]=a;case 6:return r.abrupt("return",a);case 7:case"end":return r.stop()}}),r)})))()},getOptions:function(t){var n=this;return c(regeneratorRuntime.mark((function r(){var a,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=n._options[t]){r.next=7;break}return r.next=4,n.get(t);case 4:s=r.sent,a=e.bean.flowTask._getNodeDefOptionsTask({nodeInstance:s}),n._options[t]=a;case 7:return r.abrupt("return",a);case 8:case"end":return r.stop()}}),r)})))()}},d=d.map((e=>{if(e.flowTaskIdSubstituteTo){const t=d.find((t=>t.flowTaskId===e.flowTaskIdSubstituteTo));if(l.id!==e.userIdAssignee&&l.id!==t.userIdAssignee)return t.__remove=!0,a(a({},e),{},{timeHandled:t.timeHandled,handleStatus:t.handleStatus,handleRemark:t.handleRemark,handleRemarkLocale:t.handleRemarkLocale,flowTaskIdSubstituteTo:0,ignoreMark:0})}return e})),d=d.filter((e=>!e.__remove&&(1!==e.specificFlag&&2!==e.specificFlag||e.userIdAssignee===l.id))),m=t(d),s.prev=9,m.s();case 11:if((k=m.n()).done){s.next=19;break}if((p=k.value).userIdAssignee!==l.id||f){s.next=17;break}return s.next=16,r._flowData_task_actions({nodeInstances:w,tasks:d,task:p,user:l});case 16:p._actions=s.sent;case 17:s.next=11;break;case 19:s.next=24;break;case 21:s.prev=21,s.t0=s.catch(9),m.e(s.t0);case 24:return s.prev=24,m.f(),s.finish(24);case 27:return s.abrupt("return",d);case 28:case"end":return s.stop()}}),s,null,[[9,21,24,27]])})))()}async _flowData_task_checkRight(e){return c(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e;case 3:return t.abrupt("return",!0);case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return",!1);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))()}async _flowData_task_actions(e){var t=this;return c(regeneratorRuntime.mark((function n(){var r,a,s,o,i,u,l,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.nodeInstances,a=e.tasks,s=e.task,o=e.user,i=1===s.flowTaskStatus,u=[],l=s,n.next=6,t._flowData_task_checkRight(t.localRight.assigneesConfirmation({flowTask:l,user:o}));case 6:if(!n.sent){n.next=10;break}return u.push({name:"assigneesConfirmation"}),n.abrupt("return",u);case 10:return n.next=12,t._flowData_task_checkRight(t.localRight.recall({flowTask:l,user:o}));case 12:if(!n.sent){n.next=16;break}return u.push({name:"recall"}),n.abrupt("return",u);case 16:if(i||s.timeClaimed){n.next=21;break}return n.next=19,r.getOptions(s.flowNodeId);case 19:d=n.sent,u.push({name:"claim",options:{bidding:d.bidding}});case 21:return n.next=23,t._flowData_task_checkRight(t.localRight.complete({flowTask:l,user:o,handle:null,getOptions:function(){var e=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getOptions(s.flowNodeId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),disableCheckTimeClaimed:!0}));case 23:if(!n.sent){n.next=29;break}return n.next=27,r.getOptions(s.flowNodeId);case 27:d=n.sent,u.push({name:"handleTask",options:{allowPassTask:d.allowPassTask,allowRejectTask:d.allowRejectTask}});case 29:return n.next=31,t._flowData_task_checkRight(t.localRight.cancelFlow({flowTask:l,user:o,getOptions:function(){var e=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getOptions(s.flowNodeId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),disableCheckTimeClaimed:!0}));case 31:return n.sent&&u.push({name:"cancelFlow"}),u.push({name:"viewAtom"}),n.next=36,t._flowData_task_checkRight(t.localRight.appendHandleRemark({flowTask:l,user:o,flowNodeType:s.flowNodeType}));case 36:return n.sent&&u.push({name:"appendHandleRemark"}),n.next=40,t._flowData_task_checkRight(t.localRight.forward({flowTask:l,user:o,getOptions:function(){var e=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getOptions(s.flowNodeId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),disableCheckTimeClaimed:!0}));case 40:return n.sent&&u.push({name:"forward"}),n.next=44,t._flowData_task_checkRight(t.localRight.forwardRecall({flowTask:l,user:o,getOptions:function(){var e=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getOptions(s.flowNodeId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getTask:e=>a.find((t=>t.flowTaskId===e))}));case 44:return n.sent&&u.push({name:"forwardRecall"}),n.next=48,t._flowData_task_checkRight(t.localRight.substitute({flowTask:l,user:o,getOptions:function(){var e=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getOptions(s.flowNodeId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),disableCheckTimeClaimed:!0}));case 48:return n.sent&&u.push({name:"substitute"}),n.next=52,t._flowData_task_checkRight(t.localRight.substituteRecall({flowTask:l,user:o,getOptions:function(){var e=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getOptions(s.flowNodeId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getTask:e=>a.find((t=>t.flowTaskId===e))}));case 52:return n.sent&&u.push({name:"substituteRecall"}),n.abrupt("return",u);case 55:case"end":return n.stop()}}),n)})))()}}},1630:(e,t,n)=>{const r=n(342);e.exports=e=>{class t extends(r(e)){}return t}},2463:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}e.exports=e=>{class n extends e.app.meta.FlowNodeBase{constructor(t){super(e,t)}async onNodeLeave(){var e,n=()=>super.onNodeLeave,r=this;return(e=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n().call(r);case 2:return e.next=4,r.flowInstance._endFlow({flowHandleStatus:1,flowRemark:"End",atom:{submit:!0}});case 4:return e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))})()}}return n}},6694:(e,t,n)=>{function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){s(o,r,a,c,i,"next",e)}function i(e){s(o,r,a,c,i,"throw",e)}c(void 0)}))}}const c=n(342);e.exports=e=>{const t=e.app.meta.mockUtil.parseInfoFromPackage(__dirname);class n extends(c(e)){get modelCondition(){return e.model.module(t.relativeName).flowNodeStartEventAtomCondition}async deploy(e){var t=this;return o(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.deploy,a=e.flowDefId,s=e.node,!r){n.next=6;break}return n.next=4,t._addCondition({flowDefId:a,node:s});case 4:n.next=8;break;case 6:return n.next=8,t._deleteCondition2({flowDefId:a,node:s});case 8:case"end":return n.stop()}}),n)})))()}async onNodeDoing(){var e=()=>super.onNodeDoing,t=this;return o(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e().call(t);case 2:return n.next=4,t._autoHandle();case 4:return n.abrupt("return",!1);case 5:case"end":return n.stop()}}),n)})))()}async _autoHandle(){var t=this;return o(regeneratorRuntime.mark((function n(){var r,a,s,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.context._flowId,n.next=3,e.bean.flowTask.select({options:{where:{"a.flowId":r,"a.flowTaskStatus":0},history:0}});case 3:if(a=n.sent,s=a[0],o=s.id,c={id:s.userIdAssignee},0!==t.contextNode._flowNode.flowNodeIdPrev){n.next=12;break}return n.next=10,e.bean.flowTask.claim({flowTaskId:o,user:c});case 10:return n.next=12,e.bean.flowTask.complete({flowTaskId:o,handle:{status:1},user:c});case 12:case"end":return n.stop()}}),n)})))()}async _addCondition(t){var n=this;return o(regeneratorRuntime.mark((function r(){var a,s,o,c,i,u,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=t.flowDefId,s=t.node,(o=s.options&&s.options.atom)&&o.module&&o.atomClassName){r.next=4;break}throw new Error("atom not set for startEventAtom: ".concat(a,".").concat(s.id));case 4:return r.next=6,e.bean.atomClass.get({module:o.module,atomClassName:o.atomClassName,atomClassIdParent:o.atomClassIdParent||0});case 6:return c=r.sent,i=s.options.conditionExpression,u=s.id,r.next=11,n.modelCondition.get({flowDefId:a,startEventId:u});case 11:if(!(l=r.sent)){r.next=19;break}return l.atomClassId=c.id,l.conditionExpression=i,r.next=17,n.modelCondition.update(l);case 17:r.next=21;break;case 19:return r.next=21,n.modelCondition.insert({flowDefId:a,startEventId:u,atomClassId:c.id,conditionExpression:i});case 21:case"end":return r.stop()}}),r)})))()}async _match(t){var n=this;return o(regeneratorRuntime.mark((function a(){var s,o,c,i,u,l,d;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=t.atom,o=t.userId,a.next=3,e.model.query("\n          select a.* from aFlowNodeStartEventAtomCondition a\n            left join aFlowDef b on a.flowDefId=b.id\n            left join aAtom c on b.atomId=c.id\n            where a.iid=? and a.atomClassId=?\n            order by c.atomStatic asc, a.conditionExpression desc\n        ",[e.instance.id,s.atomClassId]);case 3:c=a.sent,i=r(c),a.prev=5,i.s();case 7:if((u=i.n()).done){a.next=16;break}return l=u.value,a.next=11,n._matchCondition({_condition:l,atom:s,userId:o});case 11:if(!(d=a.sent)){a.next=14;break}return a.abrupt("return",d);case 14:a.next=7;break;case 16:a.next=21;break;case 18:a.prev=18,a.t0=a.catch(5),i.e(a.t0);case 21:return a.prev=21,i.f(),a.finish(21);case 24:return a.abrupt("return",null);case 25:case"end":return a.stop()}}),a,null,[[5,18,21,24]])})))()}async _matchCondition(t){var n=this;return o(regeneratorRuntime.mark((function r(){var a,s,o,c,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=t._condition,s=t.atom,o=t.userId,r.next=3,n._checkConditionValid(t);case 3:if(r.sent){r.next=7;break}return r.next=6,n._deleteCondition(t);case 6:return r.abrupt("return",null);case 7:if(!(c=a.conditionExpression)){r.next=12;break}if(e.bean.flow.evaluateExpression({expression:c,globals:{atom:s}})){r.next=12;break}return r.abrupt("return",null);case 12:return r.next=14,e.bean.flow.startById({flowDefId:a.flowDefId,startEventId:a.startEventId,flowUserId:o,flowAtomId:s.atomId});case 14:return i=r.sent,r.abrupt("return",i);case 16:case"end":return r.stop()}}),r)})))()}async _checkConditionValid(t){return o(regeneratorRuntime.mark((function n(){var r,a,s,o,c,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t._condition,n.next=3,e.bean.flowDef.getById({flowDefId:r.flowDefId});case 3:if(a=n.sent){n.next=6;break}return n.abrupt("return",!1);case 6:if(1!==a.atomDisabled){n.next=8;break}return n.abrupt("return",!1);case 8:if(s=a.content?JSON.parse(a.content):null){n.next=11;break}return n.abrupt("return",!1);case 11:if(o=s.process.nodes.find((e=>e.id===r.startEventId))){n.next=14;break}return n.abrupt("return",!1);case 14:if(c=r.conditionExpression,i=o.options&&o.options.conditionExpression,c===i){n.next=18;break}return n.abrupt("return",!1);case 18:return n.abrupt("return",!0);case 19:case"end":return n.stop()}}),n)})))()}async _deleteCondition(e){var t=this;return o(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e._condition,n.next=3,t.modelCondition.delete({id:r.id});case 3:case"end":return n.stop()}}),n)})))()}async _deleteCondition2(e){var t=this;return o(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowDefId,a=e.node,s=a.id,n.next=4,t.modelCondition.delete({flowDefId:r,startEventId:s});case 4:case"end":return n.stop()}}),n)})))()}}return n}},127:e=>{e.exports=e=>{class t extends(e.app.meta.IOMessageBase(e)){}return t}},2694:e=>{e.exports=e=>class{constructor(e){let t=e.context,n=e.contextNode,r=e.nodeDef;this.context=t,this.contextNode=n,this._nodeDef=r,this._flowTaskId=null,this._flowTask=null,this._flowTaskHistory=null,this._taskVars=null,this._utils=null,this._user=null}get vars(){return this._taskVars}get utils(){return this._utils}}},8988:(e,t,n)=>{const r=n(567),a=n(3235),s=n(9709),o=n(3289),c=n(1518),i=n(691),u=n(4302),l=n(8199),d=n(9695),f=n(3113),w=n(7167),m=n(6278);e.exports=e=>e.app.meta.util.mixinClasses(r,[a,s,o,c,i,u,l,d,f,w,m],e)},567:e=>{e.exports=e=>{const t=e.app.meta.mockUtil.parseInfoFromPackage(__dirname);return class{constructor(n){let r=n.nodeInstance;this.nodeInstance=r,this.flowInstance=r.flowInstance,this.context=r.context,this.contextNode=r.contextNode,this.contextTask=e.bean._newBean("".concat(t.relativeName,".local.context.task"),{context:r.context,contextNode:r.contextNode,nodeDef:r.contextNode._nodeDef})}get modelFlowTask(){return e.model.module(t.relativeName).flowTask}get modelFlowTaskHistory(){return e.model.module(t.relativeName).flowTaskHistory}get localRight(){return e.bean._getBean(t.relativeName,"local.right")}}}},3235:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}e.exports=e=>class{async _appendHandleRemark(e){var n,r=this;return(n=regeneratorRuntime.mark((function t(){var n,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.handle,a=r.contextTask._user,s=r.contextTask._flowTaskHistory,t.next=5,r.localRight.appendHandleRemark({flowTask:s,user:a,flowNodeType:r.contextTask._nodeDef.type});case 5:return r.contextTask._flowTaskHistory.handleRemark=n.remark,t.next=8,r.modelFlowTaskHistory.update(r.contextTask._flowTaskHistory);case 8:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(a,s){var o=n.apply(e,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))})()}}},9709:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>{const t=e.app.meta.mockUtil.parseInfoFromPackage(__dirname);return class{async _assignees(){var e=this;return n(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.contextTask._user,r=e.contextTask._flowTask,t.next=4,e.localRight.assignees({flowTask:r,user:n});case 4:return t.next=6,e._assignees_handle();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))()}async _assignees_handle(){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((r=t.contextNode.vars.get("_assignees"))&&0!==r.length){n.next=5;break}a=[],n.next=8;break;case 5:return n.next=7,e.bean.user.select({options:{where:{"a.disabled":0,"a.id":r},orders:[["a.userName","asc"]],removePrivacy:!0}});case 7:a=n.sent;case 8:return s=e.bean.flowTask._getNodeDefOptionsTask({nodeInstance:t.nodeInstance}),n.abrupt("return",{users:a,options:{confirmationAllowAppend:s.confirmationAllowAppend}});case 10:case"end":return n.stop()}}),n)})))()}async _assigneesConfirmation(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.handle,a=t.contextTask._user,s=t.contextTask._flowTask,n.next=5,t.localRight.assigneesConfirmation({flowTask:s,user:a});case 5:return n.next=7,t._assigneesConfirmation_handle({handle:r});case 7:t._notifyTaskHandlings(s.userIdAssignee);case 8:case"end":return n.stop()}}),n)})))()}async _assigneesConfirmation_handle(r){var a=this;return n(regeneratorRuntime.mark((function n(){var s,o,c,i,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=r.handle,o=e.bean.flowTask._getNodeDefOptionsTask({nodeInstance:a.nodeInstance}),a.contextTask._flowTaskHistory.flowTaskStatus=1,a.contextTask._flowTaskHistory.timeHandled=new Date,a.contextTask._flowTaskHistory.handleStatus=s.status,n.next=7,a.modelFlowTaskHistory.update(a.contextTask._flowTaskHistory);case 7:return c=a.contextTask._flowTaskId,n.next=10,a.modelFlowTask.delete({id:c});case 10:return n.next=12,a.modelFlowTaskHistory.delete({flowTaskId:c});case 12:if(1!==s.status){n.next=22;break}return n.next=15,a.flowInstance._parseAssignees(s.assignees);case 15:return(i=n.sent)&&0!==i.length||e.throw.module(t.relativeName,1008,c),o.confirmationAllowAppend||(u=a.contextNode.vars.get("_assignees"),new Set(u).isSuperset(new Set(i))||e.throw.module(t.relativeName,1009,c)),a.contextNode.vars.set("_assigneesConfirmation",i),n.next=21,a.nodeInstance.begin();case 21:case 25:return n.abrupt("return",n.sent);case 22:if(2!==s.status){n.next=26;break}return n.next=25,e.bean.flowTask._gotoFlowNodePrevious({nodeInstance:a.nodeInstance,rejectedNode:null});case 26:case"end":return n.stop()}}),n)})))()}}}},3289:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>class{async _cancelFlow(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.handle,a=t.contextTask._user,s=t.contextTask._flowTask,n.next=5,t.localRight.cancelFlow({flowTask:s,user:a,getOptions:()=>t._getNodeOptionsTask()});case 5:return n.next=7,t._cancelFlow_handle({handle:r});case 7:case"end":return n.stop()}}),n)})))()}async _cancelFlow_handle(t){var r=this;return n(regeneratorRuntime.mark((function n(){var a,s,o,c,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.handle,s=r.contextTask._flowTask,o=s.id,!(c=r.context._flow.flowAtomId)){n.next=7;break}return n.next=7,e.bean.atom.closeDraft({key:{atomId:c}});case 7:return r._notifyTaskHandlings(s.userIdAssignee),n.next=10,r.modelFlowTask.delete({id:o});case 10:return r.contextTask._flowTaskHistory.flowTaskStatus=1,r.contextTask._flowTaskHistory.timeHandled=new Date,r.contextTask._flowTaskHistory.handleStatus=3,r.contextTask._flowTaskHistory.handleRemark=a.remark,n.next=16,r.modelFlowTaskHistory.update(r.contextTask._flowTaskHistory);case 16:return i="Cancelled",n.next=19,r.nodeInstance.clear({flowNodeHandleStatus:3,flowNodeRemark:i});case 19:return n.next=21,r.flowInstance._endFlow({flowHandleStatus:3,flowRemark:i});case 21:case"end":return n.stop()}}),n)})))()}}},1518:e=>{function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,s=function(){};return{s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(i)throw o}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}e.exports=e=>class{async _claim(){var n,a=this;return(n=regeneratorRuntime.mark((function n(){var r,s,o,c,i,u,l,d,f,w;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=a.contextTask._user,s=a.contextTask._flowTask,o=s.id,n.next=5,a.localRight.claim({flowTask:s,user:r});case 5:if(!(c=n.sent)){n.next=8;break}return n.abrupt("return",c);case 8:return i=new Date,a.contextTask._flowTask.timeClaimed=i,a.contextTask._flowTask.flowTaskHidden=0,n.next=13,a.modelFlowTask.update(a.contextTask._flowTask);case 13:return a.contextTask._flowTaskHistory.timeClaimed=i,a.contextTask._flowTaskHistory.flowTaskHidden=0,n.next=17,a.modelFlowTaskHistory.update(a.contextTask._flowTaskHistory);case 17:return n.next=19,e.model.queryOne("\n          select id,userIdAssignee from aFlowTask\n            where iid=? and deleted=0 and flowNodeId=? and specificFlag=2\n          ",[e.instance.id,s.flowNodeId]);case 19:if(!(u=n.sent)){n.next=26;break}return a._notifyTaskHandlings(u.userIdAssignee),n.next=24,e.model.query("\n          delete from aFlowTask\n            where iid=? and id=?\n          ",[e.instance.id,u.id]);case 24:return n.next=26,e.model.query("\n          update aFlowTaskHistory set deleted=1\n            where iid=? and deleted=0 and flowTaskId=?\n          ",[e.instance.id,u.id]);case 26:if(!e.bean.flowTask._getNodeDefOptionsTask({nodeInstance:a.nodeInstance}).bidding){n.next=37;break}return n.next=30,e.model.query("\n          select id,userIdAssignee from aFlowTask\n            where iid=? and deleted=0 and flowNodeId=? and id<>? and (flowTaskStatus=0 and handleStatus=0)\n          ",[e.instance.id,s.flowNodeId,o]);case 30:l=n.sent,d=t(l);try{for(d.s();!(f=d.n()).done;)w=f.value,a._notifyTaskClaimings(w.userIdAssignee)}catch(e){d.e(e)}finally{d.f()}return n.next=35,e.model.query("\n          delete from aFlowTask\n            where iid=? and flowNodeId=? and id<>? and (flowTaskStatus=0 and handleStatus=0)\n          ",[e.instance.id,s.flowNodeId,o]);case 35:return n.next=37,e.model.query("\n          update aFlowTaskHistory set deleted=1\n            where iid=? and deleted=0 and flowNodeId=? and flowTaskId<>? and (flowTaskStatus=0 and handleStatus=0)\n          ",[e.instance.id,s.flowNodeId,o]);case 37:return n.next=39,a.raiseEventClaimed();case 39:return a._notifyTaskClaimings(s.userIdAssignee),a._notifyTaskHandlings(s.userIdAssignee),n.abrupt("return",{timeClaimed:i});case 42:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(a,s){var o=n.apply(e,t);function c(e){r(o,a,s,c,i,"next",e)}function i(e){r(o,a,s,c,i,"throw",e)}c(void 0)}))})()}}},691:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>{const t=e.app.meta.mockUtil.parseInfoFromPackage(__dirname);return class{async _complete(t){var r=this;return n(regeneratorRuntime.mark((function a(){var s,o,c,i;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=t.handle,o=t.formAtom,c=r.contextTask._user,i=r.contextTask._flowTask,a.next=5,r.localRight.complete({flowTask:i,user:c,handle:s,getOptions:()=>r._getNodeOptionsTask()});case 5:if(!o){a.next=8;break}return a.next=8,r._complete_formAtom({formAtom:o});case 8:if(!s){a.next=15;break}return a.next=11,r._complete_handle({handle:s});case 11:return a.next=13,r.raiseEventCompleted();case 13:e.tail(n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._complete_tail({flowTask:i,user:c});case 2:case"end":return e.stop()}}),e)})))),r._notifyTaskHandlings(i.userIdAssignee);case 15:case"end":return a.stop()}}),a)})))()}async _complete_tail(r){return n(regeneratorRuntime.mark((function a(){var s,o,c;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=r.flowTask,o=r.user,c=s.flowNodeId,a.next=4,e.app.meta.util.lock({subdomain:e.subdomain,resource:"".concat(t.relativeName,".flowTask.nodeDoneCheck.").concat(c),fn:function(){var r=n(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.app.meta.util.executeBean({subdomain:e.subdomain,beanModule:t.relativeName,beanFullName:"flowTask",context:{flowNodeId:c},fn:"_nodeDoneCheckLock",transaction:!0,ctxParent:{state:{user:{op:o}}}});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})));return function(){return r.apply(this,arguments)}}()});case 4:case"end":return a.stop()}}),a)})))()}async _complete_formAtom(t){var r=this;return n(regeneratorRuntime.mark((function n(){var a,s,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.formAtom,n.next=3,r._getSchemaWrite();case 3:if(s=n.sent){n.next=6;break}return n.abrupt("return");case 6:return o=r.context._atom.atomId,c=r.contextTask._user,n.next=10,e.bean.atom.write({key:{atomId:o},item:a,options:{schema:s},user:c});case 10:case"end":return n.stop()}}),n)})))()}async _complete_handle(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.handle,a=new Date,t.contextTask._flowTask.flowTaskStatus=1,t.contextTask._flowTask.timeHandled=a,t.contextTask._flowTask.handleStatus=r.status,t.contextTask._flowTask.handleRemark=r.remark,n.next=8,t.modelFlowTask.update(t.contextTask._flowTask);case 8:return t.contextTask._flowTaskHistory.flowTaskStatus=1,t.contextTask._flowTaskHistory.timeHandled=a,t.contextTask._flowTaskHistory.handleStatus=r.status,t.contextTask._flowTaskHistory.handleRemark=r.remark,n.next=14,t.modelFlowTaskHistory.update(t.contextTask._flowTaskHistory);case 14:return n.next=16,t._complete_handle_checkForward();case 16:return n.next=18,t._complete_handle_checkSubstitute();case 18:case"end":return n.stop()}}),n)})))()}async _complete_handle_checkForward(){var e=this;return n(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.contextTask._flowTask.flowTaskIdForwardFrom){t.next=3;break}return t.abrupt("return");case 3:if(!n){t.next=15;break}return t.next=6,e.modelFlowTask.get({id:n});case 6:return r=t.sent,t.next=9,e.modelFlowTask.update({id:n,flowTaskStatus:1});case 9:return t.next=11,e.modelFlowTaskHistory.update({flowTaskStatus:1},{where:{flowTaskId:n}});case 11:e._notifyTaskHandlings(r.userIdAssignee),n=r.flowTaskIdForwardFrom,t.next=3;break;case 15:case"end":return t.stop()}}),t)})))()}async _complete_handle_checkSubstitute(){var e=this;return n(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.contextTask._flowTask.flowTaskIdSubstituteFrom){t.next=3;break}return t.abrupt("return");case 3:if(!n){t.next=15;break}return t.next=6,e.modelFlowTask.get({id:n});case 6:return r=t.sent,t.next=9,e.modelFlowTask.update({id:n,flowTaskStatus:1});case 9:return t.next=11,e.modelFlowTaskHistory.update({flowTaskStatus:1},{where:{flowTaskId:n}});case 11:e._notifyTaskHandlings(r.userIdAssignee),n=r.flowTaskIdSubstituteFrom,t.next=3;break;case 15:case"end":return t.stop()}}),t)})))()}}}},4302:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>class{async raiseEventCreated(){var e=this;return n(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.nodeInstance.change({event:"created",taskInstance:e});case 2:return t.next=4,e._saveVars();case 4:case"end":return t.stop()}}),t)})))()}async raiseEventClaimed(){var e=this;return n(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.nodeInstance.change({event:"claimed",taskInstance:e});case 2:return t.next=4,e._saveVars();case 4:case"end":return t.stop()}}),t)})))()}async raiseEventCompleted(){var e=this;return n(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.nodeInstance.change({event:"completed",taskInstance:e});case 2:return t.next=4,e._saveVars();case 4:case"end":return t.stop()}}),t)})))()}async _saveTaskVars(){var e=this;return n(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.contextTask._taskVars._dirty){t.next=2;break}return t.abrupt("return");case 2:if(e.contextTask._flowTask.taskVars=JSON.stringify(e.contextTask._taskVars._vars),0!==e.contextTask._flowTaskHistory.flowTaskStatus){t.next=6;break}return t.next=6,e.modelFlowTask.update(e.contextTask._flowTask);case 6:return e.contextTask._flowTaskHistory.taskVars=e.contextTask._flowTask.taskVars,t.next=9,e.modelFlowTaskHistory.update(e.contextTask._flowTaskHistory);case 9:e.contextTask._taskVars._dirty=!1;case 10:case"end":return t.stop()}}),t)})))()}async _saveVars(){var e=this;return n(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._saveTaskVars();case 2:return t.next=4,e.nodeInstance._saveNodeVars();case 4:return t.next=6,e.flowInstance._saveFlowVars();case 6:case"end":return t.stop()}}),t)})))()}_notifyTaskClaimings(t){e.bean.flowTask._notifyTaskClaimings(t)}_notifyTaskHandlings(t){e.bean.flowTask._notifyTaskHandlings(t)}}},3113:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>class{async _forward(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.handle,a=t.contextTask._user,s=t.contextTask._flowTask,n.next=5,t.localRight.forward({flowTask:s,user:a,getOptions:()=>t._getNodeOptionsTask()});case 5:return n.next=7,t._forward_handle({handle:r});case 7:case"end":return n.stop()}}),n)})))()}async _forward_handle(t){var r=this;return n(regeneratorRuntime.mark((function n(){var a,s,o,c,i,u,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.handle,s=r.contextTask._user,o=r.contextTask._flowTask,c=o.id,n.next=6,e.bean.flowTask._createTaskInstance({nodeInstance:r.nodeInstance,userIdAssignee:a.assignee,user:s});case 6:return(i=n.sent).contextTask._flowTask.specificFlag=4,i.contextTask._flowTask.flowTaskIdForwardFrom=c,n.next=11,i.modelFlowTask.update(i.contextTask._flowTask);case 11:return i.contextTask._flowTaskHistory.specificFlag=4,i.contextTask._flowTaskHistory.flowTaskIdForwardFrom=c,n.next=15,i.modelFlowTaskHistory.update(i.contextTask._flowTaskHistory);case 15:return i._notifyTaskClaimings(i.contextTask._flowTask.userIdAssignee),u=i.contextTask._flowTask.id,l=new Date,r.contextTask._flowTask.timeHandled=l,r.contextTask._flowTask.handleStatus=4,r.contextTask._flowTask.handleRemark=a.remark,r.contextTask._flowTask.flowTaskIdForwardTo=u,r.contextTask._flowTask.ignoreMark=1,n.next=25,r.modelFlowTask.update(r.contextTask._flowTask);case 25:return r.contextTask._flowTaskHistory.timeHandled=l,r.contextTask._flowTaskHistory.handleStatus=4,r.contextTask._flowTaskHistory.handleRemark=a.remark,r.contextTask._flowTaskHistory.flowTaskIdForwardTo=u,r.contextTask._flowTaskHistory.ignoreMark=1,n.next=32,r.modelFlowTaskHistory.update(r.contextTask._flowTaskHistory);case 32:case"end":return n.stop()}}),n)})))()}async _forwardRecall(){var e=this;return n(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.contextTask._user,r=e.contextTask._flowTask,t.next=4,e.localRight.forwardRecall({flowTask:r,user:n,getOptions:()=>e._getNodeOptionsTask()});case 4:return t.next=6,e._forwardRecall_handle();case 6:case"end":return t.stop()}}),t)})))()}async _forwardRecall_handle(){var e=this;return n(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.contextTask._flowTask,t.next=3,e.modelFlowTask.get({id:n.flowTaskIdForwardTo});case 3:return r=t.sent,t.next=6,e.modelFlowTask.delete({id:r.id});case 6:return t.next=8,e.modelFlowTaskHistory.delete({flowTaskId:r.id});case 8:return e._notifyTaskClaimings(r.userIdAssignee),e.contextTask._flowTask.timeHandled=null,e.contextTask._flowTask.handleStatus=0,e.contextTask._flowTask.handleRemark=null,e.contextTask._flowTask.flowTaskIdForwardTo=0,e.contextTask._flowTask.ignoreMark=0,t.next=16,e.modelFlowTask.update(e.contextTask._flowTask);case 16:return e.contextTask._flowTaskHistory.timeHandled=null,e.contextTask._flowTaskHistory.handleStatus=0,e.contextTask._flowTaskHistory.handleRemark=null,e.contextTask._flowTaskHistory.flowTaskIdForwardTo=0,e.contextTask._flowTaskHistory.ignoreMark=0,t.next=23,e.modelFlowTaskHistory.update(e.contextTask._flowTaskHistory);case 23:case"end":return t.stop()}}),t)})))()}}},8199:(e,t,n)=>{function r(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,s){var o=e.apply(t,n);function c(e){r(o,a,s,c,i,"next",e)}function i(e){r(o,a,s,c,i,"throw",e)}c(void 0)}))}}const s=n(7125),o=n(4796);e.exports=e=>class{async init(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.userIdAssignee,a=e.user,n.next=3,t._createFlowTask({userIdAssignee:r,user:a});case 3:return s=n.sent,n.next=6,t._contextInit({flowTaskId:s,user:a});case 6:return n.next=8,t.raiseEventCreated();case 8:case"end":return n.stop()}}),n)})))()}async _load(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTask,a=e.user,s=e.history,n.next=3,t._contextInit({flowTaskId:r.id,user:a,history:s});case 3:case"end":return n.stop()}}),n)})))()}async _createFlowTask(t){var n=this;return a(regeneratorRuntime.mark((function r(){var s,o,c,i,u,l,d,f,w,m;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s=t.userIdAssignee,o=t.user,c={flowId:n.context._flowId,flowNodeId:n.contextNode._flowNodeId,flowTaskStatus:0,userIdAssignee:s,specificFlag:0,taskVars:"{}"},r.next=4,n.modelFlowTask.insert(c);case 4:return i=r.sent,u=i.insertId,c.flowTaskId=u,r.next=9,n.modelFlowTaskHistory.insert(c);case 9:if(n._notifyTaskClaimings(s),s===o.id){r.next=21;break}return r.next=13,e.bean.user.get({id:n.context._flow.flowUserId});case 13:return l=r.sent,r.next=16,e.bean.user.get({id:s});case 16:d=r.sent,f="".concat(e.text.locale(d.locale,"Task")," - ").concat(e.text.locale(d.locale,n.contextNode._flowNode.flowNodeName)),w="/a/flowtask/flow?flowId=".concat(n.context._flowId,"&flowTaskId=").concat(u),m={userIdTo:s,content:{issuerId:l.id,issuerName:l.userName,issuerAvatar:l.avatar,title:f,body:n.context._flow.flowName,actionPath:w,params:{flowId:n.context._flowId,flowTaskId:u}}},e.tail(a(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.bean.io.publish({message:m,messageClass:{module:"a-flow",messageClassName:"workflow"}});case 2:case"end":return t.stop()}}),t)}))));case 21:return r.abrupt("return",u);case 22:case"end":return r.stop()}}),r)})))()}async _contextInit(t){var n=this;return a(regeneratorRuntime.mark((function r(){var a,c,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=t.flowTaskId,c=t.user,i=t.history,n.contextTask._flowTaskId=a,i){r.next=6;break}return r.next=5,n.modelFlowTask.get({id:a});case 5:n.contextTask._flowTask=r.sent;case 6:return r.next=8,n.modelFlowTaskHistory.get({flowTaskId:a});case 8:n.contextTask._flowTaskHistory=r.sent,n.contextTask._taskVars=new(s()),n.contextTask._taskVars._vars=n.contextTask._flowTaskHistory.taskVars?JSON.parse(n.contextTask._flowTaskHistory.taskVars):{},n.contextTask._utils=new(o({ctx:e,flowInstance:n.flowInstance}))({context:n.context,contextNode:n.contextNode,contextTask:n.contextTask}),n.contextTask._user=c;case 13:case"end":return r.stop()}}),r)})))()}async _hidden(e){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.hidden,a=r?1:0,t.contextTask._flowTask.flowTaskHidden=a,n.next=5,t.modelFlowTask.update(t.contextTask._flowTask);case 5:return t.contextTask._flowTaskHistory.flowTaskHidden=a,n.next=8,t.modelFlowTaskHistory.update(t.contextTask._flowTaskHistory);case 8:case"end":return n.stop()}}),n)})))()}_getNodeOptionsTask(){return e.bean.flowTask._getNodeDefOptionsTask({nodeInstance:this.nodeInstance})}}},9695:e=>{function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,s=function(){};return{s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(i)throw o}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,s){var o=e.apply(t,n);function c(e){r(o,a,s,c,i,"next",e)}function i(e){r(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>class{async _recall(){var e=this;return a(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.contextTask._user,r=e.contextTask._flowTask,t.next=4,e.localRight.recall({flowTask:r,user:n});case 4:return t.next=6,e._recall_handle();case 6:e._notifyTaskHandlings(r.userIdAssignee);case 7:case"end":return t.stop()}}),t)})))()}async _recall_handle(){var n=this;return a(regeneratorRuntime.mark((function r(){var a,s,o,c,i,u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=n.contextTask._flowTask,s=a.id,n.contextTask._flowTaskHistory.flowTaskStatus=1,n.contextTask._flowTaskHistory.timeHandled=new Date,n.contextTask._flowTaskHistory.handleStatus=1,r.next=7,n.modelFlowTaskHistory.update(n.contextTask._flowTaskHistory);case 7:return r.next=9,n.modelFlowTask.delete({id:s});case 9:return r.next=11,n.modelFlowTaskHistory.delete({flowTaskId:s});case 11:return r.next=13,e.model.query("\n          select id,userIdAssignee from aFlowTask\n            where iid=? and deleted=0 and flowNodeId=? and id<>?\n          ",[e.instance.id,a.flowNodeId,s]);case 13:o=r.sent,c=t(o);try{for(c.s();!(i=c.n()).done;)u=i.value,n._notifyTaskClaimings(u.userIdAssignee)}catch(e){c.e(e)}finally{c.f()}return r.next=18,e.model.query("\n          delete from aFlowTask\n            where iid=? and flowNodeId=? and id<>?\n          ",[e.instance.id,a.flowNodeId,s]);case 18:return r.next=20,e.model.query("\n          update aFlowTaskHistory set deleted=1\n            where iid=? and deleted=0 and flowNodeId=? and flowTaskId<>?\n          ",[e.instance.id,a.flowNodeId,s]);case 20:return r.next=22,e.bean.flowTask._gotoFlowNodePrevious({nodeInstance:n.nodeInstance,rejectedNode:null,flowNodeRemark:"Recalled"});case 22:return r.abrupt("return",r.sent);case 23:case"end":return r.stop()}}),r)})))()}}},6278:e=>{function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,s=function(){};return{s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(i)throw o}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,s){var o=e.apply(t,n);function c(e){r(o,a,s,c,i,"next",e)}function i(e){r(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>{const n=e.app.meta.mockUtil.parseInfoFromPackage(__dirname);return class{async _viewAtom(){var e=this;return a(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._getAtomAndSchema({mode:"read"});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()}async _editAtom(){var e=this;return a(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._getAtomAndSchema({mode:"write"});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()}async _getAtomAndSchema(t){var r=this;return a(regeneratorRuntime.mark((function a(){var s,o,c,i,u,l,d,f;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=t.mode,o=r.contextTask._user,c=r.context._atom,i=r.contextTask._flowTaskHistory,u=i.flowTaskId,o&&0!==o.id&&o.id!==i.userIdAssignee&&e.throw.module(n.relativeName,1002,u),c.atomFlowId!==r.context._flowId&&e.throw.module("a-flow",1009,r.context._flowId),"write"===s&&0!==i.flowTaskStatus&&e.throw.module(n.relativeName,1005,u),a.next=10,r._getSchema({mode:s});case 10:if(l=a.sent){a.next=13;break}return a.abrupt("return",null);case 13:return l=e.bean.validation.getSchema(l),a.next=16,r._combineFields({schema:l.schema});case 16:return d=a.sent,f=r._combineFieldsData({fields:d,atom:c}),a.abrupt("return",{schema:l,item:f});case 19:case"end":return a.stop()}}),a)})))()}_combineFieldsData(e){let n=e.fields,r=e.atom;const a={};var s,o=t(n);try{for(o.s();!(s=o.n()).done;){const e=s.value,t=[e,"_".concat(e,"Title"),"_".concat(e,"TitleLocale")];for(var c=0,i=t;c<i.length;c++){const e=i[c];void 0!==r[e]&&(a[e]=r[e])}}}catch(e){o.e(e)}finally{o.f()}return a}async _combineFields(t){return a(regeneratorRuntime.mark((function n(){var r,a,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.schema,a=["atomId","module","atomClassName","atomNameLocale","atomCategoryName","atomCategoryNameLocale","flowNodeNameCurrent","flowNodeNameCurrentLocale","_meta"],n.next=4,e.bean.atom.modelAtom.columns();case 4:return s=n.sent,a=(a=a.concat(Object.keys(s))).concat(Object.keys(r.properties)),(o=new Set(a)).delete("roleIdOwner"),a=Array.from(o),n.abrupt("return",a);case 11:case"end":return n.stop()}}),n)})))()}async _getSchemaRead(){var e=this;return a(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._getSchema({mode:"read"});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()}async _getSchemaWrite(){var e=this;return a(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._getSchema({mode:"write"});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()}async _getSchema(n){var r=this;return a(regeneratorRuntime.mark((function a(){var s,o,c,i,u,l,d,f,w,m,k,p,T;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(s=n.mode,o=r.context._atom.module,c=e.bean.flowTask._getNodeDefOptionsTask({nodeInstance:r.nodeInstance}),i=c.schema&&c.schema[s]){a.next=6;break}return a.abrupt("return",null);case 6:if(!i||Array.isArray(i)||"object"!=typeof i){a.next=8;break}return a.abrupt("return",{module:i.module,validator:i.validator,schema:i.schema});case 8:return a.next=10,r._getSchemaBase();case 10:if(u=a.sent,!0!==i||!u){a.next=13;break}return a.abrupt("return",{module:u.module,validator:u.validator});case 13:u||(u={module:o,schema:{type:"object",properties:{}}}),l=u.schema.properties,d={},f=t(i);try{for(f.s();!(w=f.n()).done;)"string"==typeof(m=w.value)?l[m]&&(d[m]=l[m]):d[m.name]=m.property}catch(e){f.e(e)}finally{f.f()}return k={module:o,schema:{type:"object",properties:d}},p="getSchema".concat(s.replace(s[0],s[0].toUpperCase())),a.next=22,r.flowInstance._flowListener[p](r.contextTask,r.contextNode,{schemaBase:u,schema:k});case 22:return(T=a.sent)&&(k=T),a.abrupt("return",k);case 25:case"end":return a.stop()}}),a)})))()}async _getSchemaBase(){var t=this;return a(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.context._atom.atomClassId,n.next=3,e.bean.atom.schema({atomClass:{id:r}});case 3:return a=n.sent,n.abrupt("return",a);case 5:case"end":return n.stop()}}),n)})))()}}}},7167:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>class{async _substitute(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.handle,a=t.contextTask._user,s=t.contextTask._flowTask,n.next=5,t.localRight.substitute({flowTask:s,user:a,getOptions:()=>t._getNodeOptionsTask()});case 5:return n.next=7,t._substitute_handle({handle:r});case 7:case"end":return n.stop()}}),n)})))()}async _substitute_handle(t){var r=this;return n(regeneratorRuntime.mark((function n(){var a,s,o,c,i,u,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.handle,s=r.contextTask._user,o=r.contextTask._flowTask,c=o.id,n.next=6,e.bean.flowTask._createTaskInstance({nodeInstance:r.nodeInstance,userIdAssignee:a.assignee,user:s});case 6:return(i=n.sent).contextTask._flowTask.specificFlag=5,i.contextTask._flowTask.flowTaskIdSubstituteFrom=c,n.next=11,i.modelFlowTask.update(i.contextTask._flowTask);case 11:return i.contextTask._flowTaskHistory.specificFlag=5,i.contextTask._flowTaskHistory.flowTaskIdSubstituteFrom=c,n.next=15,i.modelFlowTaskHistory.update(i.contextTask._flowTaskHistory);case 15:return i._notifyTaskClaimings(i.contextTask._flowTask.userIdAssignee),u=i.contextTask._flowTask.id,l=new Date,r.contextTask._flowTask.timeHandled=l,r.contextTask._flowTask.handleStatus=5,r.contextTask._flowTask.handleRemark=a.remark,r.contextTask._flowTask.flowTaskIdSubstituteTo=u,r.contextTask._flowTask.ignoreMark=1,n.next=25,r.modelFlowTask.update(r.contextTask._flowTask);case 25:return r.contextTask._flowTaskHistory.timeHandled=l,r.contextTask._flowTaskHistory.handleStatus=5,r.contextTask._flowTaskHistory.handleRemark=a.remark,r.contextTask._flowTaskHistory.flowTaskIdSubstituteTo=u,r.contextTask._flowTaskHistory.ignoreMark=1,n.next=32,r.modelFlowTaskHistory.update(r.contextTask._flowTaskHistory);case 32:case"end":return n.stop()}}),n)})))()}async _substituteRecall(){var e=this;return n(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.contextTask._user,r=e.contextTask._flowTask,t.next=4,e.localRight.substituteRecall({flowTask:r,user:n,getOptions:()=>e._getNodeOptionsTask()});case 4:return t.next=6,e._substituteRecall_handle();case 6:case"end":return t.stop()}}),t)})))()}async _substituteRecall_handle(){var e=this;return n(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.contextTask._flowTask,t.next=3,e.modelFlowTask.get({id:n.flowTaskIdSubstituteTo});case 3:return r=t.sent,t.next=6,e.modelFlowTask.delete({id:r.id});case 6:return t.next=8,e.modelFlowTaskHistory.delete({flowTaskId:r.id});case 8:return e._notifyTaskClaimings(r.userIdAssignee),e.contextTask._flowTask.timeHandled=null,e.contextTask._flowTask.handleStatus=0,e.contextTask._flowTask.handleRemark=null,e.contextTask._flowTask.flowTaskIdSubstituteTo=0,e.contextTask._flowTask.ignoreMark=0,t.next=16,e.modelFlowTask.update(e.contextTask._flowTask);case 16:return e.contextTask._flowTaskHistory.timeHandled=null,e.contextTask._flowTaskHistory.handleStatus=0,e.contextTask._flowTaskHistory.handleRemark=null,e.contextTask._flowTaskHistory.flowTaskIdSubstituteTo=0,e.contextTask._flowTaskHistory.ignoreMark=0,t.next=23,e.modelFlowTaskHistory.update(e.contextTask._flowTaskHistory);case 23:case"end":return t.stop()}}),t)})))()}}},7497:e=>{e.exports=e=>class{selectTasks(e){let t=e.iid,n=e.userIdWho,r=e.where,a=e.orders,s=e.page,o=e.count,c=e.history;return t=parseInt(t),n=parseInt(n),c=parseInt(c),0===c?this._selectTasks_0({iid:t,userIdWho:n,where:r,orders:a,page:s,count:o}):this._selectTasks_1({iid:t,userIdWho:n,where:r,orders:a,page:s,count:o})}_selectTasks_0(t){let n=t.iid,r=t.userIdWho,a=t.where,s=t.orders,o=t.page,c=t.count;a=a?e.model._where(a):null,s=s?e.model._orders(s):null;const i=o?e.model._limit(o.size,o.index):null;let u;const l=a?"".concat(a," AND"):" WHERE",d=s||"",f=i||"";let w;return u=0!==r?" and a.userIdAssignee=".concat(r):"",w=c?"count(*) as _count":"a.*,a.id as flowTaskId,\n            b.flowNodeDefId,b.flowNodeName,b.flowNodeType,\n            c.flowDefId,c.flowDefKey,c.flowDefRevision,c.flowName,c.flowStatus,c.flowAtomId,c.flowNodeIdCurrent,c.flowUserId,\n            d.userName,d.avatar,\n            e.userName as flowUserName,e.avatar as flowUserAvatar\n          ","select ".concat(w," from aFlowTask a\n            inner join aFlowNode b on a.flowNodeId=b.id\n            inner join aFlow c on a.flowId=c.id\n            left join aUser d on a.userIdAssignee=d.id\n            left join aUser e on c.flowUserId=e.id\n\n          ").concat(l,"\n           (\n             a.deleted=0 and a.iid=").concat(n,"\n             ").concat(u,"\n           )\n\n          ").concat(c?"":d,"\n          ").concat(c?"":f,"\n        ")}_selectTasks_1(t){let n=t.iid,r=t.userIdWho,a=t.where,s=t.orders,o=t.page,c=t.count;a=a?e.model._where(a):null,s=s?e.model._orders(s):null;const i=o?e.model._limit(o.size,o.index):null;let u;const l=a?"".concat(a," AND"):" WHERE",d=s||"",f=i||"";let w;return u=0!==r?" and a.userIdAssignee=".concat(r):"",w=c?"count(*) as _count":"a.*,\n            b.flowNodeDefId,b.flowNodeName,b.flowNodeType,b.flowNodeStatus,b.flowNodeHandleStatus,b.flowNodeRemark,b.timeDone,\n            c.flowDefId,c.flowDefKey,c.flowDefRevision,c.flowName,c.flowStatus,c.flowAtomId,c.flowNodeIdCurrent,c.flowUserId,\n            d.userName,d.avatar,\n            e.userName as flowUserName,e.avatar as flowUserAvatar\n          ","select ".concat(w," from aFlowTaskHistory a\n            inner join aFlowNodeHistory b on a.flowNodeId=b.flowNodeId\n            inner join aFlowHistory c on a.flowId=c.flowId\n            left join aUser d on a.userIdAssignee=d.id\n            left join aUser e on c.flowUserId=e.id\n\n          ").concat(l,"\n           (\n             a.deleted=0 and a.iid=").concat(n,"\n             ").concat(u,"\n           )\n\n          ").concat(c?"":d,"\n          ").concat(c?"":f,"\n        ")}}},1613:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>{const t=e.app.meta.mockUtil.parseInfoFromPackage(__dirname);return class{get modelFlowTask(){return e.model.module(t.relativeName).flowTask}_check_specificFlag_normal(t){let n=t.flowTask;1!==n.specificFlag&&2!==n.specificFlag||e.throw(403)}_check_specificFlag_0(t){0!==t.flowTask.specificFlag&&e.throw(403)}_check_specificFlag_1(t){1!==t.flowTask.specificFlag&&e.throw(403)}_check_specificFlag_2(t){2!==t.flowTask.specificFlag&&e.throw(403)}_check_sameUser(n){let r=n.flowTask,a=n.user;const s=r.flowTaskId||r.id;a&&0!==a.id&&a.id!==r.userIdAssignee&&e.throw.module(t.relativeName,1002,s)}_check_notDone(n){let r=n.flowTask;const a=r.flowTaskId||r.id;1===r.flowTaskStatus&&e.throw.module(t.relativeName,1005,a)}_check_notDoneAndHandled(n){let r=n.flowTask;const a=r.flowTaskId||r.id;1!==r.flowTaskStatus&&0===r.handleStatus||e.throw.module(t.relativeName,1005,a)}_check_claimed(n){let r=n.flowTask;const a=r.flowTaskId||r.id;r.timeClaimed||e.throw.module(t.relativeName,1004,a)}async _getNodeOptionsTask(t){return n(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.getOptions,a=t.flowTask,s=t.nodeInstance,!r){n.next=5;break}return n.next=4,r();case 4:return n.abrupt("return",n.sent);case 5:if(s){n.next=9;break}return n.next=8,e.bean.flow._loadFlowNodeInstance({flowNodeId:a.flowNodeId});case 8:s=n.sent;case 9:return n.abrupt("return",e.bean.flowTask._getNodeDefOptionsTask({nodeInstance:s}));case 10:case"end":return n.stop()}}),n)})))()}async _getTask(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.getTask,a=e.flowTaskId,!r){n.next=5;break}return n.next=4,r(a);case 4:case 7:return n.abrupt("return",n.sent);case 5:return n.next=7,t.modelFlowTask.get({id:a});case 8:case"end":return n.stop()}}),n)})))()}async appendHandleRemark(r){var a=this;return n(regeneratorRuntime.mark((function n(){var s,o,c,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:s=r.flowTask,o=r.user,c=r.flowNodeType,i=s.flowTaskId||s.id,a._check_sameUser({flowTask:s,user:o}),("startEventAtom"!==c||1!==s.flowTaskStatus||s.handleRemark)&&e.throw.module(t.relativeName,1011,i);case 4:case"end":return n.stop()}}),n)})))()}async assignees(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=e.flowTask,a=e.user,t._check_specificFlag_1({flowTask:r}),t._check_sameUser({flowTask:r,user:a}),t._check_notDoneAndHandled({flowTask:r}),t._check_claimed({flowTask:r});case 5:case"end":return n.stop()}}),n)})))()}async assigneesConfirmation(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTask,a=e.user,n.next=3,t.assignees({flowTask:r,user:a});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async cancelFlow(r){var a=this;return n(regeneratorRuntime.mark((function n(){var s,o,c,i,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=r.flowTask,o=r.user,c=r.getOptions,i=r.disableCheckTimeClaimed,u=s.flowTaskId||s.id,a._check_specificFlag_normal({flowTask:s}),a._check_sameUser({flowTask:s,user:o}),a._check_notDoneAndHandled({flowTask:s}),i||a._check_claimed({flowTask:s}),n.next=8,a._getNodeOptionsTask({getOptions:c,flowTask:s});case 8:n.sent.allowCancelFlow||e.throw.module(t.relativeName,1010,u);case 10:case"end":return n.stop()}}),n)})))()}async claim(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.flowTask,a=e.user,t._check_sameUser({flowTask:r,user:a}),t._check_notDoneAndHandled({flowTask:r}),!r.timeClaimed){n.next=5;break}return n.abrupt("return",{timeClaimed:r.timeClaimed});case 5:case"end":return n.stop()}}),n)})))()}async complete(r){var a=this;return n(regeneratorRuntime.mark((function n(){var s,o,c,i,u,l,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=r.flowTask,o=r.user,c=r.handle,i=r.getOptions,u=r.disableCheckTimeClaimed,l=s.flowTaskId||s.id,a._check_specificFlag_normal({flowTask:s}),a._check_sameUser({flowTask:s,user:o}),a._check_notDoneAndHandled({flowTask:s}),u||a._check_claimed({flowTask:s}),n.next=8,a._getNodeOptionsTask({getOptions:i,flowTask:s});case 8:d=n.sent,c?(1!==c.status||d.allowPassTask||e.throw.module(t.relativeName,1006,l),2!==c.status||d.allowRejectTask||e.throw.module(t.relativeName,1007,l)):d.allowPassTask||d.allowRejectTask||e.throw(403);case 10:case"end":return n.stop()}}),n)})))()}async recall(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=e.flowTask,a=e.user,t._check_specificFlag_2({flowTask:r}),t._check_sameUser({flowTask:r,user:a}),t._check_notDoneAndHandled({flowTask:r}),t._check_claimed({flowTask:r});case 5:case"end":return n.stop()}}),n)})))()}async forward(r){var a=this;return n(regeneratorRuntime.mark((function n(){var s,o,c,i,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=r.flowTask,o=r.user,c=r.getOptions,i=r.disableCheckTimeClaimed,u=s.flowTaskId||s.id,a._check_sameUser({flowTask:s,user:o}),a._check_notDoneAndHandled({flowTask:s}),i||a._check_claimed({flowTask:s}),s.flowTaskIdSubstituteFrom&&e.throw(403),n.next=8,a._getNodeOptionsTask({getOptions:c,flowTask:s});case 8:n.sent.allowForward&&!s.flowTaskIdForwardTo||e.throw.module(t.relativeName,1012,u);case 10:case"end":return n.stop()}}),n)})))()}async forwardRecall(t){var r=this;return n(regeneratorRuntime.mark((function n(){var a,s,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.flowTask,s=t.user,o=t.getOptions,c=t.getTask,r._check_sameUser({flowTask:a,user:s}),r._check_notDone({flowTask:a}),r._check_claimed({flowTask:a}),n.next=6,r._getNodeOptionsTask({getOptions:o,flowTask:a});case 6:return n.sent.allowForward&&a.flowTaskIdForwardTo||e.throw(403),n.next=10,r._getTask({getTask:c,flowTaskId:a.flowTaskIdForwardTo});case 10:n.sent.timeClaimed&&e.throw(403);case 12:case"end":return n.stop()}}),n)})))()}async substitute(r){var a=this;return n(regeneratorRuntime.mark((function n(){var s,o,c,i,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=r.flowTask,o=r.user,c=r.getOptions,i=r.disableCheckTimeClaimed,u=s.flowTaskId||s.id,a._check_sameUser({flowTask:s,user:o}),a._check_notDoneAndHandled({flowTask:s}),i||a._check_claimed({flowTask:s}),n.next=7,a._getNodeOptionsTask({getOptions:c,flowTask:s});case 7:(!n.sent.allowSubstitute||s.flowTaskIdSubstituteFrom||s.flowTaskIdSubstituteTo)&&e.throw.module(t.relativeName,1013,u);case 9:case"end":return n.stop()}}),n)})))()}async substituteRecall(t){var r=this;return n(regeneratorRuntime.mark((function n(){var a,s,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.flowTask,s=t.user,o=t.getOptions,c=t.getTask,r._check_sameUser({flowTask:a,user:s}),r._check_notDone({flowTask:a}),r._check_claimed({flowTask:a}),n.next=6,r._getNodeOptionsTask({getOptions:o,flowTask:a});case 6:return n.sent.allowSubstitute&&!a.flowTaskIdSubstituteFrom&&a.flowTaskIdSubstituteTo||e.throw(403),n.next=10,r._getTask({getTask:c,flowTaskId:a.flowTaskIdSubstituteTo});case 10:n.sent.timeClaimed&&e.throw(403);case 12:case"end":return n.stop()}}),n)})))()}}}},6877:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}e.exports=e=>{const n=e.app.meta.mockUtil.parseInfoFromPackage(__dirname);return class{async execute(r){return(a=regeneratorRuntime.mark((function t(){var a,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.user,s=e.model.module(n).flowTask,t.next=4,s.count({userIdAssignee:a.id,flowTaskStatus:0,timeClaimed:null});case 4:return o=t.sent,t.abrupt("return",o);case 6:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,s){var o=a.apply(e,n);function c(e){t(o,r,s,c,i,"next",e)}function i(e){t(o,r,s,c,i,"throw",e)}c(void 0)}))})();var a}}}},2223:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}e.exports=e=>{const n=e.app.meta.mockUtil.parseInfoFromPackage(__dirname);return class{async execute(r){return(a=regeneratorRuntime.mark((function t(){var a,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.user,s=e.model.module(n).flowTask,t.next=4,s.count({userIdAssignee:a.id,flowTaskStatus:0,timeClaimed:{op:"notNull"}});case 4:return o=t.sent,t.abrupt("return",o);case 6:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,s){var o=a.apply(e,n);function c(e){t(o,r,s,c,i,"next",e)}function i(e){t(o,r,s,c,i,"throw",e)}c(void 0)}))})();var a}}}},3223:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>{class t extends e.meta.BeanBase{async update(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(1!==e.version){n.next=10;break}return r="\n          CREATE TABLE aFlowNodeStartEventAtomCondition (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            flowDefId int(11) DEFAULT '0',\n            startEventId varchar(255) DEFAULT NULL,\n            atomClassId int(11) DEFAULT '0',\n            conditionExpression TEXT DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        ",n.next=4,t.ctx.model.query(r);case 4:return r="\n          CREATE TABLE aFlowTask (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            flowId int(11) DEFAULT '0',\n            flowNodeId int(11) DEFAULT '0',\n            flowTaskStatus int(11) DEFAULT '0',\n            flowTaskHidden int(11) DEFAULT '0',\n            userIdAssignee int(11) DEFAULT '0',\n            specificFlag int(11) DEFAULT '0',\n            handleStatus int(11) DEFAULT '0',\n            handleRemark TEXT DEFAULT NULL,\n            timeClaimed timestamp DEFAULT NULL,\n            timeHandled timestamp DEFAULT NULL,\n            taskVars JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        ",n.next=7,t.ctx.model.query(r);case 7:return r="\n          CREATE TABLE aFlowTaskHistory (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            flowId int(11) DEFAULT '0',\n            flowTaskId int(11) DEFAULT '0',\n            flowNodeId int(11) DEFAULT '0',\n            flowTaskStatus int(11) DEFAULT '0',\n            flowTaskHidden int(11) DEFAULT '0',\n            userIdAssignee int(11) DEFAULT '0',\n            specificFlag int(11) DEFAULT '0',\n            handleStatus int(11) DEFAULT '0',\n            handleRemark TEXT DEFAULT NULL,\n            timeClaimed timestamp DEFAULT NULL,\n            timeHandled timestamp DEFAULT NULL,\n            taskVars JSON DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        ",n.next=10,t.ctx.model.query(r);case 10:if(2!==e.version){n.next=17;break}return r="\n          ALTER TABLE aFlowTask\n            ADD COLUMN ignoreMark int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdForwardFrom int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdForwardTo int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdSubstituteFrom int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdSubstituteTo int(11) DEFAULT '0'\n                ",n.next=14,t.ctx.model.query(r);case 14:return r="\n          ALTER TABLE aFlowTaskHistory\n            ADD COLUMN ignoreMark int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdForwardFrom int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdForwardTo int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdSubstituteFrom int(11) DEFAULT '0',\n            ADD COLUMN flowTaskIdSubstituteTo int(11) DEFAULT '0'\n                ",n.next=17,t.ctx.model.query(r);case 17:case"end":return n.stop()}}),n)})))()}async init(e){return n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}async test(){return n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}}return t}},7313:(e,t,n)=>{const r=n(3223),a=n(6694),s=n(2463),o=n(1630),c=n(2694),i=n(8988),u=n(7497),l=n(1613),d=n(5504),f=n(6877),w=n(2223),m=n(127);e.exports=e=>({"version.manager":{mode:"app",bean:r},"flow.node.startEventAtom":{mode:"ctx",bean:a},"flow.node.endEventAtom":{mode:"ctx",bean:s},"flow.node.activityUserTask":{mode:"ctx",bean:o},"local.context.task":{mode:"ctx",bean:c},"local.flow.task":{mode:"ctx",bean:i},"local.procedure":{mode:"ctx",bean:u},"local.right":{mode:"ctx",bean:l},flowTask:{mode:"ctx",bean:d,global:!0},"stats.taskClaimings":{mode:"ctx",bean:f},"stats.taskHandlings":{mode:"ctx",bean:w},"io.message.workflow":{mode:"ctx",bean:m}})},342:(e,t,n)=>{function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){s(o,r,a,c,i,"next",e)}function i(e){s(o,r,a,c,i,"throw",e)}c(void 0)}))}}const c=n(5638)("assert");e.exports=e=>{class t extends e.app.meta.FlowNodeBase{constructor(t){super(e,t)}async onNodeEnter(){var t=()=>super.onNodeEnter,n=this;return o(regeneratorRuntime.mark((function r(){var a,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t().call(n);case 2:if(a=r.sent){r.next=5;break}return r.abrupt("return",a);case 5:return s=e.bean.flowTask._getNodeDefOptionsTask({nodeInstance:n.nodeInstance}),r.next=8,n._prepareAssignees({options:s});case 8:if(a=r.sent){r.next=11;break}return r.abrupt("return",!1);case 11:return r.abrupt("return",!0);case 12:case"end":return r.stop()}}),r)})))()}async onNodeBegin(){var t=()=>super.onNodeBegin,n=this;return o(regeneratorRuntime.mark((function a(){var s,o,i,u,l,d,f,w;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t().call(n);case 2:if(s=a.sent){a.next=5;break}return a.abrupt("return",s);case 5:if(o=e.bean.flowTask._getNodeDefOptionsTask({nodeInstance:n.nodeInstance}),i=n.flowInstance._getOpUser(),u=n.contextNode.vars.get("_assigneesConfirmation"),c(u&&u.length>0),!o.allowRecall){a.next=15;break}return a.next=12,e.bean.flowTask._createTaskInstance({nodeInstance:n.nodeInstance,userIdAssignee:i.id,user:i});case 12:return l=a.sent,a.next=15,n._taskConfirmationClaim({taskInstance:l,specificFlag:2});case 15:d=r(u),a.prev=16,d.s();case 18:if((f=d.n()).done){a.next=28;break}return w=f.value,a.next=22,e.bean.flowTask._createTaskInstance({nodeInstance:n.nodeInstance,userIdAssignee:w,user:i});case 22:if(l=a.sent,o.showAssignees){a.next=26;break}return a.next=26,l._hidden({hidden:!0});case 26:a.next=18;break;case 28:a.next=33;break;case 30:a.prev=30,a.t0=a.catch(16),d.e(a.t0);case 33:return a.prev=33,d.f(),a.finish(33);case 36:return a.abrupt("return",!0);case 37:case"end":return a.stop()}}),a,null,[[16,30,33,36]])})))()}async onNodeDoing(){var e=()=>super.onNodeDoing,t=this;return o(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e().call(t);case 2:if(r=n.sent){n.next=5;break}return n.abrupt("return",r);case 5:return n.abrupt("return",!1);case 6:case"end":return n.stop()}}),n)})))()}async onNodeClear(t){var n=()=>super.onNodeClear,r=this;return o(regeneratorRuntime.mark((function a(){var s;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=t.options,a.next=3,e.bean.flowTask._clearRemains({nodeInstance:r.nodeInstance});case 3:return a.next=5,n().call(r,{options:s});case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}}),a)})))()}async onNodeChange(e){var t=()=>super.onNodeChange,n=this;return o(regeneratorRuntime.mark((function r(){var a,s,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=e.options,s=a.event,o=a.taskInstance,"created"!==s){r.next=7;break}return r.next=5,o.flowInstance._flowListener.onTaskCreated(o.contextTask,o.contextNode);case 5:case 10:r.next=15;break;case 7:if("claimed"!==s){r.next=12;break}return r.next=10,o.flowInstance._flowListener.onTaskClaimed(o.contextTask,o.contextNode);case 12:if("completed"!==s){r.next=15;break}return r.next=15,o.flowInstance._flowListener.onTaskCompleted(o.contextTask,o.contextNode);case 15:return r.next=17,t().call(n,{options:a});case 17:return r.abrupt("return",r.sent);case 18:case"end":return r.stop()}}),r)})))()}async _prepareAssignees(t){var n=this;return o(regeneratorRuntime.mark((function r(){var a,s,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=t.options,!((s=n.contextNode.vars.get("_assigneesConfirmation"))&&s.length>0)){r.next=4;break}return r.abrupt("return",!0);case 4:if(n.contextNode.vars.get("_assignees"),s&&0!==s.length){r.next=9;break}return r.next=8,n.flowInstance._parseAssignees(a.assignees);case 8:s=r.sent;case 9:if(0!==s.length&&!a.confirmation){r.next=18;break}return n.contextNode.vars.set("_assignees",s),o=n.flowInstance._getOpUser(),r.next=14,e.bean.flowTask._createTaskInstance({nodeInstance:n.nodeInstance,userIdAssignee:o.id,user:o});case 14:return c=r.sent,r.next=17,n._taskConfirmationClaim({taskInstance:c,specificFlag:1});case 17:return r.abrupt("return",!1);case 18:return n.contextNode.vars.set("_assigneesConfirmation",s),r.abrupt("return",!0);case 20:case"end":return r.stop()}}),r)})))()}async _taskConfirmationClaim(e){return o(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.taskInstance,r=e.specificFlag,a=new Date,n.contextTask._flowTask.specificFlag=r,n.contextTask._flowTask.timeClaimed=a,t.next=6,n.modelFlowTask.update(n.contextTask._flowTask);case 6:return n.contextTask._flowTaskHistory.specificFlag=r,n.contextTask._flowTaskHistory.timeClaimed=a,t.next=10,n.modelFlowTaskHistory.update(n.contextTask._flowTaskHistory);case 10:n._notifyTaskClaimings(n.contextTask._flowTask.userIdAssignee),n._notifyTaskHandlings(n.contextTask._flowTask.userIdAssignee);case 12:case"end":return t.stop()}}),t)})))()}}return t}},4796:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}e.exports=e=>{let n=e.ctx;return class{constructor(e){let t=e.context,n=e.contextNode,r=e.contextTask;this.context=t,this.contextNode=n,this.contextTask=r}async executeService(e){var r,a=this;return(r=regeneratorRuntime.mark((function t(){var r,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.bean,s=e.parameter,o={},a.context&&(o.context=a.context),a.contextNode&&(o.contextNode=a.contextNode),a.contextTask&&(o.contextTask=a.contextTask),t.next=7,n.bean.flow.executeService({bean:r,parameter:s,globals:o});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(a,s){var o=r.apply(e,n);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))})()}}}},7125:e=>{function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e.exports=()=>class{constructor(){this._vars=null,this._dirty=!1}get(e){e=e.split(".");let n=this._vars;var r,a=function(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var a=0,s=function(){};return{s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(i)throw o}}}}(e);try{for(a.s();!(r=a.n()).done&&(n=n[r.value],void 0!==n););}catch(e){a.e(e)}finally{a.f()}return n}set(e,t){e=e.split(".");let n=this._vars;for(let t=0;t<e.length-1;t++){const r=e[t];void 0===n[r]&&(n[r]={}),n=n[r]}n[e[e.length-1]]=t,this._dirty=!0}}},817:e=>{e.exports=e=>({})},1971:e=>{e.exports={1001:"Task not Found: %s",1002:"Task cannot be accessed: %s",1003:"Task has been claimed: %s",1004:"Task should be claimed first: %s",1005:"Task has been handled: %s",1006:"Task cannot be passed: %s",1007:"Task cannot be rejected: %s",1008:"Task Assignees cannot be empty: %s",1009:"Task Assignees cannot be appended: %s",1010:"Flow cannot be cancelled: %s",1011:"Task Handle Remark cannot be appended: %s",1012:"Task has been forwarded: %s",1013:"Task has been substituted: %s"}},7874:e=>{e.exports={startEventAtom:{atom:null,conditionExpression:null,task:{assignees:{users:null,roles:null,vars:"flowUser"},showAssignees:!1,confirmation:!1,confirmationAllowAppend:!1,bidding:!1,completionCondition:{passed:1,rejected:"100%"},rejectedNode:null,allowPassTask:!0,allowRejectTask:!1,allowCancelFlow:!0,allowRecall:!1,allowForward:!1,allowSubstitute:!1,schema:{read:!0,write:!0}}},activityUserTask:{assignees:{users:null,roles:null,vars:null},showAssignees:!0,confirmation:!1,confirmationAllowAppend:!1,bidding:!1,completionCondition:{passed:1,rejected:"100%"},rejectedNode:null,allowPassTask:!0,allowRejectTask:!0,allowCancelFlow:!1,allowRecall:!0,allowForward:!1,allowSubstitute:!1,schema:{read:!0,write:!1}}}},9633:(e,t,n)=>{const r=n(7874);e.exports=e=>{const t=e.meta.mockUtil.parseInfoFromPackage(__dirname),n={startEventAtom:{title:"StartEventAtom",group:"startEvent",bean:"startEventAtom",icon:"/api/static/a/flowtask/bpmn/events/start-event-atom.svg",validator:{module:t.relativeName,validator:"startEventAtom"}},endEventAtom:{title:"EndEventAtom",group:"endEvent",bean:"endEventAtom",icon:"/api/static/a/flowtask/bpmn/events/end-event-atom.svg"},activityUserTask:{title:"ActivityUserTask",group:"activity",bean:"activityUserTask",icon:"/api/static/a/flowtask/bpmn/activities/activity-user-task.svg",validator:{module:t.relativeName,validator:"activityUserTask"}}};for(const e in n){const t=n[e];t.options={},r[e]&&(t.options.default=r[e])}return n}},9724:e=>{e.exports={StartEventAtom:"StartEvent: Data Draft",EndEventAtom:"EndEvent: Data Submit",ActivityUserTask:"Activity: User Task"}},995:e=>{e.exports={Submitted:"已提交",StartEventAtom:"数据起草开始事件",EndEventAtom:"数据提交结束事件",ActivityUserTask:"用户任务活动","Task not Found: %s":"任务未发现: %s","Task cannot be accessed: %s":"任务无权访问: %s","Task has been claimed: %s":"任务已被申领: %s","Task should be claimed first: %s":"任务必须先申领: %s","Task has been handled: %s":"任务已处理: %s","Task cannot be passed: %s":"任务无权被通过: %s","Task cannot be rejected: %s":"任务无权被拒绝: %s","Task Assignees cannot be empty: %s":"任务参与人不允许为空: %s","Task Assignees cannot be appended: %s":"任务参与人不允许追加: %s","Flow cannot be cancelled: %s":"流程无权被取消: %s","Task Handle Remark cannot be appended: %s":"任务处理意见不允许追加: %s","Task has been forwarded: %s":"任务已被转办: %s","Task has been substituted: %s":"任务已被代办: %s"}},9266:(e,t,n)=>{e.exports={"en-us":n(9724),"zh-cn":n(995)}},3247:e=>{e.exports=e=>({activityUserTask:{type:"object",properties:{assignees:{type:"object",ebType:"component",ebTitle:"Assignees",ebRender:{module:"a-flowchart",name:"renderAssignees"},notEmpty:!0},showAssignees:{type:"boolean",ebType:"toggle",ebTitle:"Show Assignees"},confirmation:{type:"boolean",ebType:"toggle",ebTitle:"Confirmation Assignees"},confirmationAllowAppend:{type:"boolean",ebType:"toggle",ebTitle:"ConfirmationAllowAppend"},bidding:{type:"boolean",ebType:"toggle",ebTitle:"Bidding"},completionCondition:{type:"object",ebType:"json",ebTitle:"Completion Condition",notEmpty:!0},rejectedNode:{type:"string",ebType:"component",ebTitle:"Rejected Node",ebRender:{module:"a-flowchart",name:"renderRejectedNode"}},allowPassTask:{type:"boolean",ebType:"toggle",ebTitle:"Allow Pass Task"},allowRejectTask:{type:"boolean",ebType:"toggle",ebTitle:"Allow Reject Task"},allowCancelFlow:{type:"boolean",ebType:"toggle",ebTitle:"Allow Cancel Flow"},allowRecall:{type:"boolean",ebType:"toggle",ebTitle:"Allow Recall"},allowForward:{type:"boolean",ebType:"toggle",ebTitle:"Allow Forward"},allowSubstitute:{type:"boolean",ebType:"toggle",ebTitle:"Allow Substitute"},schema:{type:"object",ebType:"component",ebTitle:"Field Permissions",ebRender:{module:"a-flowchart",name:"renderSchemaFields"},notEmpty:!0}}}})},8933:e=>{e.exports=e=>({startEventAtom:{type:"object",properties:{atom:{type:"object",ebType:"atomClass",ebTitle:"Atom Class",notEmpty:!0,ebParams:{simple:0}},conditionExpression:{type:"string",ebType:"text",ebTitle:"Condition Expression",ebParams:{textarea:!0}},task:{type:"object",ebType:"panel",ebTitle:"User Task Options",$ref:"activityUserTask"}}}})},8326:(e,t,n)=>{const r=n(8933),a=n(3247);e.exports=e=>{const t={};return Object.assign(t,r(e)),Object.assign(t,a(e)),t}},5712:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}e.exports=e=>{class n extends e.Controller{async data(){var e,n=this;return(e=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.ctx.service.flow.data({flowId:n.ctx.request.body.flowId,user:n.ctx.state.user.op});case 2:t=e.sent,n.ctx.success(t);case 4:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))})()}}return n}},242:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>{class t extends e.Controller{async select(){var e=this;return n(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=e.ctx.request.body.options).page=e.ctx.bean.util.page(n.page),t.next=4,e.ctx.service.flowTask.select({options:n,user:e.ctx.state.user.op});case 4:r=t.sent,e.ctx.successMore(r,n.page.index,n.page.size);case 6:case"end":return t.stop()}}),t)})))()}async count(){var e=this;return n(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.ctx.request.body.options,t.next=3,e.ctx.service.flowTask.count({options:n,user:e.ctx.state.user.op});case 3:r=t.sent,e.ctx.success(r);case 5:case"end":return t.stop()}}),t)})))()}async claim(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.claim({flowTaskId:e.ctx.request.body.flowTaskId,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async complete(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.complete({flowTaskId:e.ctx.request.body.flowTaskId,handle:e.ctx.request.body.handle,formAtom:e.ctx.request.body.formAtom,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async appendHandleRemark(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.appendHandleRemark({flowTaskId:e.ctx.request.body.flowTaskId,handle:e.ctx.request.body.handle,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async assignees(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.assignees({flowTaskId:e.ctx.request.body.flowTaskId,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async assigneesConfirmation(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.assigneesConfirmation({flowTaskId:e.ctx.request.body.flowTaskId,handle:e.ctx.request.body.handle,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async recall(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.recall({flowTaskId:e.ctx.request.body.flowTaskId,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async cancelFlow(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.cancelFlow({flowTaskId:e.ctx.request.body.flowTaskId,handle:e.ctx.request.body.handle,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async viewAtom(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.viewAtom({flowTaskId:e.ctx.request.body.flowTaskId,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async editAtom(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.editAtom({flowTaskId:e.ctx.request.body.flowTaskId,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async userSelectForward(){var e=this;return n(regeneratorRuntime.mark((function t(){var n,r,a,s,o,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.ctx.request.body,r=n.flowTaskId,a=n.params,s=e.ctx.state.user.op,o=a.page,t.next=5,e.ctx.service.flowTask.userSelectForward({flowTaskId:r,params:a,user:s});case 5:c=t.sent,e.ctx.successMore(c,o.index,o.size);case 7:case"end":return t.stop()}}),t)})))()}async forward(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.forward({flowTaskId:e.ctx.request.body.flowTaskId,handle:e.ctx.request.body.handle,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async forwardRecall(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.forwardRecall({flowTaskId:e.ctx.request.body.flowTaskId,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async userSelectSubstitute(){var e=this;return n(regeneratorRuntime.mark((function t(){var n,r,a,s,o,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.ctx.request.body,r=n.flowTaskId,a=n.params,s=e.ctx.state.user.op,o=a.page,t.next=5,e.ctx.service.flowTask.userSelectSubstitute({flowTaskId:r,params:a,user:s});case 5:c=t.sent,e.ctx.successMore(c,o.index,o.size);case 7:case"end":return t.stop()}}),t)})))()}async substitute(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.substitute({flowTaskId:e.ctx.request.body.flowTaskId,handle:e.ctx.request.body.handle,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}async substituteRecall(){var e=this;return n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.service.flowTask.substituteRecall({flowTaskId:e.ctx.request.body.flowTaskId,user:e.ctx.state.user.op});case 2:n=t.sent,e.ctx.success(n);case 4:case"end":return t.stop()}}),t)})))()}}return t}},1691:(e,t,n)=>{const r=n(5712),a=n(242);e.exports=e=>({flow:r,flowTask:a})},312:(e,t,n)=>{const r=n(817),a=n(9266),s=n(1971);e.exports=e=>{const t=n(1129)(e),o=n(7313)(e),c=n(5788)(e),i=n(1691)(e),u=n(2481)(e),l=n(3700)(e),d=n(2730)(e);return{aops:t,beans:o,routes:c,controllers:i,services:u,models:l,config:r,locales:a,errors:s,meta:d}}},2730:(e,t,n)=>{e.exports=e=>({base:{atoms:{}},validation:{validators:{startEventAtom:{schemas:"startEventAtom,activityUserTask"},activityUserTask:{schemas:"activityUserTask"}},keywords:{},schemas:n(8326)(e)},flow:{nodes:n(9633)(e)},stats:{providers:{taskClaimings:{user:!0,bean:"taskClaimings"},taskHandlings:{user:!0,bean:"taskHandlings"},taskClaimingsHandlings:{user:!0,bean:{module:"a-stats",name:"deps"},dependencies:["a-flowtask:taskClaimings","a-flowtask:taskHandlings"]}}}})},4486:e=>{e.exports=e=>{class t extends e.meta.Model{constructor(e){super(e,{table:"aFlowNodeStartEventAtomCondition",options:{disableDeleted:!0}})}}return t}},5265:e=>{e.exports=e=>{class t extends e.meta.Model{constructor(e){super(e,{table:"aFlowTask",options:{disableDeleted:!0}})}}return t}},1808:e=>{e.exports=e=>{class t extends e.meta.Model{constructor(e){super(e,{table:"aFlowTaskHistory",options:{disableDeleted:!1}})}}return t}},3700:(e,t,n)=>{const r=n(4486),a=n(5265),s=n(1808);e.exports=e=>({flowNodeStartEventAtomCondition:r,flowTask:a,flowTaskHistory:s})},5788:e=>{e.exports=e=>[{method:"post",path:"flow/data",controller:"flow"},{method:"post",path:"task/select",controller:"flowTask"},{method:"post",path:"task/count",controller:"flowTask"},{method:"post",path:"task/claim",controller:"flowTask",middlewares:"transaction"},{method:"post",path:"task/complete",controller:"flowTask",middlewares:"transaction"},{method:"post",path:"task/appendHandleRemark",controller:"flowTask"},{method:"post",path:"task/assignees",controller:"flowTask"},{method:"post",path:"task/assigneesConfirmation",controller:"flowTask",middlewares:"transaction"},{method:"post",path:"task/recall",controller:"flowTask",middlewares:"transaction"},{method:"post",path:"task/cancelFlow",controller:"flowTask",middlewares:"transaction"},{method:"post",path:"task/viewAtom",controller:"flowTask"},{method:"post",path:"task/editAtom",controller:"flowTask"},{method:"post",path:"task/userSelectForward",controller:"flowTask"},{method:"post",path:"task/forward",controller:"flowTask"},{method:"post",path:"task/forwardRecall",controller:"flowTask"},{method:"post",path:"task/userSelectSubstitute",controller:"flowTask"},{method:"post",path:"task/substitute",controller:"flowTask"},{method:"post",path:"task/substituteRecall",controller:"flowTask"}]},8536:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}e.exports=e=>{class n extends e.Service{async data(e){var n,r=this;return(n=regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.flowId,a=e.user,t.next=3,r.ctx.bean.flowTask.flowData({flowId:n,user:a});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(a,s){var o=n.apply(e,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))})()}}return n}},6411:e=>{function t(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(a,s){var o=e.apply(n,r);function c(e){t(o,a,s,c,i,"next",e)}function i(e){t(o,a,s,c,i,"throw",e)}c(void 0)}))}}e.exports=e=>{class t extends e.Service{async select(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.options,a=e.user,n.next=3,t.ctx.bean.flowTask.select({options:r,user:a});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async count(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.options,a=e.user,n.next=3,t.ctx.bean.flowTask.count({options:r,user:a});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async claim(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t.ctx.bean.flowTask.claim({flowTaskId:r,user:a});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async complete(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.formAtom,o=e.user,n.next=3,t.ctx.bean.flowTask.complete({flowTaskId:r,handle:a,formAtom:s,user:o});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async appendHandleRemark(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.user,n.next=3,t.ctx.bean.flowTask.appendHandleRemark({flowTaskId:r,handle:a,user:s});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async assignees(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t.ctx.bean.flowTask.assignees({flowTaskId:r,user:a});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async assigneesConfirmation(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.user,n.next=3,t.ctx.bean.flowTask.assigneesConfirmation({flowTaskId:r,handle:a,user:s});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async recall(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t.ctx.bean.flowTask.recall({flowTaskId:r,user:a});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async cancelFlow(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.user,n.next=3,t.ctx.bean.flowTask.cancelFlow({flowTaskId:r,handle:a,user:s});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async viewAtom(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t.ctx.bean.flowTask.viewAtom({flowTaskId:r,user:a});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async editAtom(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t.ctx.bean.flowTask.editAtom({flowTaskId:r,user:a});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async userSelectForward(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.params,s=e.user,n.next=3,t.ctx.model.flowTask.get({id:r});case 3:return o=n.sent,n.next=6,t.ctx.bean.local.right.forward({flowTask:o,user:s});case 6:return n.next=8,t.ctx.bean.user.selectGeneral({params:a});case 8:return n.abrupt("return",n.sent);case 9:case"end":return n.stop()}}),n)})))()}async forward(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.user,n.next=3,t.ctx.bean.flowTask.forward({flowTaskId:r,handle:a,user:s});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async forwardRecall(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t.ctx.bean.flowTask.forwardRecall({flowTaskId:r,user:a});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async userSelectSubstitute(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.params,s=e.user,n.next=3,t.ctx.model.flowTask.get({id:r});case 3:return o=n.sent,n.next=6,t.ctx.bean.local.right.substitute({flowTask:o,user:s});case 6:return n.next=8,t.ctx.bean.user.selectGeneral({params:a});case 8:return n.abrupt("return",n.sent);case 9:case"end":return n.stop()}}),n)})))()}async substitute(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.handle,s=e.user,n.next=3,t.ctx.bean.flowTask.substitute({flowTaskId:r,handle:a,user:s});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}async substituteRecall(e){var t=this;return n(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.flowTaskId,a=e.user,n.next=3,t.ctx.bean.flowTask.substituteRecall({flowTaskId:r,user:a});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}}return t}},2481:(e,t,n)=>{const r=n(8536),a=n(6411);e.exports=e=>({flow:r,flowTask:a})},5638:e=>{"use strict";e.exports=require("require3")}},t={},n=function n(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}(312);module.exports=n})();